# ---------------------------------------------------------------------------
# Core application settings
# ---------------------------------------------------------------------------
ENV=local
APP_ENV=dev
APP_NAME=awa-app
SERVICE_NAME=api
ALEMBIC_CONFIG=services/api/alembic.ini
WAIT_FOR_DB_MAX_ATTEMPTS=
WAIT_FOR_DB_DELAY_S=
REQUEST_TIMEOUT_S=15

# ---------------------------------------------------------------------------
# Database and Redis
# ---------------------------------------------------------------------------
DATABASE_URL=postgresql+psycopg://app:app@db:5432/app
PG_ASYNC_DSN=
REDIS_URL=redis://redis:6379/0
CACHE_REDIS_URL=
CACHE_DEFAULT_TTL_S=300
CACHE_NAMESPACE=cache:
BROKER_URL=
RESULT_BACKEND=
QUEUE_NAMES=ingest,alerts
STATS_USE_SQL=0
ROI_CACHE_TTL_SECONDS=300
RETURNS_STATS_VIEW_NAME=returns_raw
ROI_VIEW_NAME=v_roi_full
ROI_MATERIALIZED_VIEW_NAME=mat_v_roi_full

# ---------------------------------------------------------------------------
# S3 / MinIO storage
# ---------------------------------------------------------------------------
MINIO_ENDPOINT=minio:9000
MINIO_SECURE=0
MINIO_ACCESS_KEY=minio
MINIO_SECRET_KEY=minio123
MINIO_BUCKET=awa-bucket
AWS_REGION=us-east-1
INGEST_CHUNK_SIZE_MB=8
# Streaming ingest controls
# Enable to stream files larger than the configured threshold
INGEST_STREAMING_ENABLED=1
INGEST_STREAMING_THRESHOLD_MB=50
# Approximate chunk size (MB) for streaming reads; falls back to row-based size when set
INGEST_STREAMING_CHUNK_SIZE_MB=8
INGEST_STREAMING_CHUNK_SIZE=50000
INGEST_IDEMPOTENT=1
ANALYZE_MIN_ROWS=50000

# ---------------------------------------------------------------------------
# Celery / worker
# ---------------------------------------------------------------------------
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_STORE_EAGER_RESULT=0
CELERY_RESULT_EXPIRES=86400
CELERY_TASK_ALWAYS_EAGER=0
CELERY_LOOP_LAG_MONITOR=1
CELERY_LOOP_LAG_INTERVAL_S=
BACKLOG_PROBE_SECONDS=15
SCHEDULE_NIGHTLY_MAINTENANCE=1
NIGHTLY_MAINTENANCE_CRON=30 2 * * *
SCHEDULE_MV_REFRESH=1
MV_REFRESH_CRON=30 2 * * *
SCHEDULE_LOGISTICS_ETL=0
LOGISTICS_CRON=0 3 * * *
ALERTS_EVALUATION_INTERVAL_CRON=*/5 * * * *
CHECK_INTERVAL_MIN=
TZ=UTC

# ---------------------------------------------------------------------------
# Security / API
# ---------------------------------------------------------------------------
CORS_ORIGINS=
MAX_REQUEST_BYTES=268435456
OIDC_ISSUER=https://keycloak.local/realms/awa
OIDC_AUDIENCE=awa-webapp
OIDC_JWKS_URL=
OIDC_JWKS_BACKGROUND_REFRESH=1
RATE_LIMIT_VIEWER=30/minute
RATE_LIMIT_OPS=120/minute
RATE_LIMIT_ADMIN=240/minute

# ---------------------------------------------------------------------------
# Health checks
# ---------------------------------------------------------------------------
HEALTHCHECK_DB_TIMEOUT_S=2
HEALTHCHECK_REDIS_SOCKET_TIMEOUT_S=2
HEALTHCHECK_HTTP_TIMEOUT_S=2
HEALTHCHECK_CELERY_TIMEOUT_S=2
HEALTHCHECK_INSPECT_TIMEOUT_S=1
HEALTHCHECK_RETRY_ATTEMPTS=3
HEALTHCHECK_RETRY_DELAY_S=1

# ---------------------------------------------------------------------------
# Observability
# ---------------------------------------------------------------------------
LOG_LEVEL=INFO
SENTRY_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.05
SENTRY_PROFILES_SAMPLE_RATE=0.0
PROMETHEUS_MULTIPROC_DIR=
ENABLE_METRICS=1
WORKER_METRICS_HTTP=0
WORKER_METRICS_PORT=9108

# ---------------------------------------------------------------------------
# LLM configuration
# ---------------------------------------------------------------------------
LLM_PROVIDER=local
LLM_SECONDARY_PROVIDER=cloud
LLM_BASE_URL=http://localhost:8000
LLM_PROVIDER_BASE_URL=http://llm:8001
LLM_API_KEY=
LLM_LOCAL_MODEL=gpt-4o-mini
LLM_CLOUD_MODEL=gpt-5
LLM_CLOUD_API_KEY=
LLM_CLOUD_API_BASE=
LLM_EMAIL_CLOUD_THRESHOLD_CHARS=12000
LLM_PRICELIST_CLOUD_THRESHOLD_ROWS=500
LLM_ENABLE_EMAIL=0
LLM_ENABLE_PRICELIST=0
LLM_MIN_CONFIDENCE=0.35
LLM_REQUEST_TIMEOUT_S=60
LLM_LAN_HEALTH_TIMEOUT_S=1

# ---------------------------------------------------------------------------
# ETL / external APIs
# ---------------------------------------------------------------------------
ENABLE_LIVE=0
TASK_ID=
KEEPA_KEY=
HELIUM_API_KEY=
REGION=US
SP_FEES_DATE=
SP_REFRESH_TOKEN=
SP_CLIENT_ID=
SP_CLIENT_SECRET=
HELIUM10_KEY=

# ---------------------------------------------------------------------------
# Alert bot / Telegram
# ---------------------------------------------------------------------------
TELEGRAM_TOKEN=
TELEGRAM_DEFAULT_CHAT_ID=
TELEGRAM_API_BASE=https://api.telegram.org
ALERTS_ENABLED=1
ALERT_RULES_SOURCE=yaml
ALERT_RULES_FILE=config/alert_rules.yaml
ALERT_RULES_PATH=services/alert_bot/config.yaml
ALERT_RULES_WATCH=0
ALERTS_EVALUATION_INTERVAL_CRON=*/5 * * * *
ALERT_SCHEDULE_CRON=*/1 * * * *
ALERT_EVAL_CONCURRENCY=8
ALERT_SEND_CONCURRENCY=8
ALERT_TELEGRAM_MAX_RPS=25
ALERT_TELEGRAM_MAX_CHAT_RPS=1

# ---------------------------------------------------------------------------
# Email ingestion
# ---------------------------------------------------------------------------
IMAP_HOST=
IMAP_USER=
IMAP_PASS=

# ---------------------------------------------------------------------------
# Repricer defaults
# ---------------------------------------------------------------------------
REPRICER_MIN_ROI=0.05
REPRICER_BUYBOX_GAP=0.05
REPRICER_ROUND=0.10

# ---------------------------------------------------------------------------
# Miscellaneous feature toggles
# ---------------------------------------------------------------------------
STATS_CACHE_TTL_S=600
STATS_CACHE_NAMESPACE=stats:
TABLE_MAINTENANCE_LIST=public.reimbursements_raw,public.returns_raw
VACUUM_ENABLE=0
