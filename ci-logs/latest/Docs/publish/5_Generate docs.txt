2025-08-20T07:04:28.4787322Z ##[group]Run pydoc-markdown
2025-08-20T07:04:28.4787630Z [36;1mpydoc-markdown[0m
2025-08-20T07:04:28.4830808Z shell: /usr/bin/bash -e {0}
2025-08-20T07:04:28.4831055Z env:
2025-08-20T07:04:28.4831297Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:04:28.4831702Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-08-20T07:04:28.4832103Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:04:28.4832444Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:04:28.4832784Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:04:28.4833161Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-08-20T07:04:28.4833579Z ##[endgroup]
2025-08-20T07:04:28.9212523Z [WARNING - pydoc_markdown.main]: Unknown configuration options:
2025-08-20T07:04:28.9213332Z Unknown key(s) "{'output_directory'}" at:
2025-08-20T07:04:28.9213722Z In "pydoc-markdown.yml"
2025-08-20T07:04:28.9214085Z   $: TypeHint(pydoc_markdown.PydocMarkdown)
2025-08-20T07:04:28.9214674Z   .renderer: TypeHint(pydoc_markdown.interfaces.Renderer)
2025-08-20T07:04:28.9215307Z   ^: TypeHint(pydoc_markdown.contrib.renderers.markdown.MarkdownRenderer)
2025-08-20T07:04:28.9215739Z 
2025-08-20T07:04:29.2808388Z <a id="__init__"></a>
2025-08-20T07:04:29.2808752Z 
2025-08-20T07:04:29.2808929Z # \_\_init\_\_
2025-08-20T07:04:29.2809175Z 
2025-08-20T07:04:29.2809558Z <a id="api"></a>
2025-08-20T07:04:29.2809825Z 
2025-08-20T07:04:29.2809969Z # api
2025-08-20T07:04:29.2810162Z 
2025-08-20T07:04:29.2810300Z <a id="api.errors"></a>
2025-08-20T07:04:29.2810538Z 
2025-08-20T07:04:29.2810641Z # api.errors
2025-08-20T07:04:29.2810759Z 
2025-08-20T07:04:29.2810863Z <a id="api.sentry_config"></a>
2025-08-20T07:04:29.2811048Z 
2025-08-20T07:04:29.2811185Z # api.sentry\_config
2025-08-20T07:04:29.2811394Z 
2025-08-20T07:04:29.2811566Z <a id="api.tests.test_stats_contracts"></a>
2025-08-20T07:04:29.2811857Z 
2025-08-20T07:04:29.2812023Z # api.tests.test\_stats\_contracts
2025-08-20T07:04:29.2812426Z 
2025-08-20T07:04:29.2812580Z <a id="api.tests.test_sentry_scrub"></a>
2025-08-20T07:04:29.2812884Z 
2025-08-20T07:04:29.2813045Z # api.tests.test\_sentry\_scrub
2025-08-20T07:04:29.2813303Z 
2025-08-20T07:04:29.2813468Z <a id="api.tests.test_roi_basic_auth"></a>
2025-08-20T07:04:29.2813781Z 
2025-08-20T07:04:29.2813943Z # api.tests.test\_roi\_basic\_auth
2025-08-20T07:04:29.2814223Z 
2025-08-20T07:04:29.2814381Z <a id="api.tests.test_errors_json"></a>
2025-08-20T07:04:29.2814689Z 
2025-08-20T07:04:29.2814834Z # api.tests.test\_errors\_json
2025-08-20T07:04:29.2815089Z 
2025-08-20T07:04:29.2815241Z <a id="api.tests.test_llm"></a>
2025-08-20T07:04:29.2815500Z 
2025-08-20T07:04:29.2815733Z # api.tests.test\_llm
2025-08-20T07:04:29.2815958Z 
2025-08-20T07:04:29.2816119Z <a id="api.tests.test_roi_filters"></a>
2025-08-20T07:04:29.2816429Z 
2025-08-20T07:04:29.2816575Z # api.tests.test\_roi\_filters
2025-08-20T07:04:29.2816841Z 
2025-08-20T07:04:29.2817002Z <a id="api.tests.test_sentry_event"></a>
2025-08-20T07:04:29.2817613Z 
2025-08-20T07:04:29.2817776Z # api.tests.test\_sentry\_event
2025-08-20T07:04:29.2818038Z 
2025-08-20T07:04:29.2818253Z <a id="api.tests.test_sentry_event.DummyTransport"></a>
2025-08-20T07:04:29.2818645Z 
2025-08-20T07:04:29.2818787Z ## DummyTransport Objects
2025-08-20T07:04:29.2819023Z 
2025-08-20T07:04:29.2819144Z ```python
2025-08-20T07:04:29.2819616Z class DummyTransport()
2025-08-20T07:04:29.2819937Z ```
2025-08-20T07:04:29.2820094Z 
2025-08-20T07:04:29.2820408Z <a id="api.tests.test_sentry_event.DummyTransport.capture_envelope"></a>
2025-08-20T07:04:29.2820887Z 
2025-08-20T07:04:29.2821026Z #### capture\_envelope
2025-08-20T07:04:29.2821235Z 
2025-08-20T07:04:29.2821349Z ```python
2025-08-20T07:04:29.2821660Z def capture_envelope(envelope)
2025-08-20T07:04:29.2821965Z ```
2025-08-20T07:04:29.2822072Z 
2025-08-20T07:04:29.2822221Z Capture events sent as envelopes by Sentry SDK >= 2.0.
2025-08-20T07:04:29.2822471Z 
2025-08-20T07:04:29.2822574Z <a id="api.tests.test_cors"></a>
2025-08-20T07:04:29.2823000Z 
2025-08-20T07:04:29.2823089Z # api.tests.test\_cors
2025-08-20T07:04:29.2823227Z 
2025-08-20T07:04:29.2823332Z <a id="api.tests.test_imports"></a>
2025-08-20T07:04:29.2823517Z 
2025-08-20T07:04:29.2823606Z # api.tests.test\_imports
2025-08-20T07:04:29.2823760Z 
2025-08-20T07:04:29.2823861Z <a id="api.tests.test_rate_limit"></a>
2025-08-20T07:04:29.2824052Z 
2025-08-20T07:04:29.2824145Z # api.tests.test\_rate\_limit
2025-08-20T07:04:29.2824320Z 
2025-08-20T07:04:29.2824433Z <a id="api.tests.test_rate_limit.app"></a>
2025-08-20T07:04:29.2824637Z 
2025-08-20T07:04:29.2824721Z #### app
2025-08-20T07:04:29.2824825Z 
2025-08-20T07:04:29.2824900Z noqa: E402
2025-08-20T07:04:29.2825010Z 
2025-08-20T07:04:29.2825110Z <a id="api.tests.test_stats_sql"></a>
2025-08-20T07:04:29.2825297Z 
2025-08-20T07:04:29.2825389Z # api.tests.test\_stats\_sql
2025-08-20T07:04:29.2825556Z 
2025-08-20T07:04:29.2825657Z <a id="api.tests.test_entrypoint"></a>
2025-08-20T07:04:29.2825858Z 
2025-08-20T07:04:29.2825961Z # api.tests.test\_entrypoint
2025-08-20T07:04:29.2826121Z 
2025-08-20T07:04:29.2826246Z <a id="api.tests.test_stats_future_contracts"></a>
2025-08-20T07:04:29.2826482Z 
2025-08-20T07:04:29.2826595Z # api.tests.test\_stats\_future\_contracts
2025-08-20T07:04:29.2826804Z 
2025-08-20T07:04:29.2826907Z <a id="api.tests.test_health"></a>
2025-08-20T07:04:29.2827096Z 
2025-08-20T07:04:29.2827185Z # api.tests.test\_health
2025-08-20T07:04:29.2827337Z 
2025-08-20T07:04:29.2827439Z <a id="api.tests.test_score"></a>
2025-08-20T07:04:29.2827615Z 
2025-08-20T07:04:29.2827703Z # api.tests.test\_score
2025-08-20T07:04:29.2827851Z 
2025-08-20T07:04:29.2827945Z <a id="api.logging_config"></a>
2025-08-20T07:04:29.2828113Z 
2025-08-20T07:04:29.2828197Z # api.logging\_config
2025-08-20T07:04:29.2828341Z 
2025-08-20T07:04:29.2828436Z <a id="api.migrations.env"></a>
2025-08-20T07:04:29.2828603Z 
2025-08-20T07:04:29.2828695Z # api.migrations.env
2025-08-20T07:04:29.2828831Z 
2025-08-20T07:04:29.2828979Z <a id="api.migrations.versions.0022_fix_roi_view"></a>
2025-08-20T07:04:29.2829225Z 
2025-08-20T07:04:29.2829530Z # api.migrations.versions.0022\_fix\_roi\_view
2025-08-20T07:04:29.2829789Z 
2025-08-20T07:04:29.2829916Z <a id="api.migrations.versions.0004_fee_cron"></a>
2025-08-20T07:04:29.2830159Z 
2025-08-20T07:04:29.2830269Z # api.migrations.versions.0004\_fee\_cron
2025-08-20T07:04:29.2830475Z 
2025-08-20T07:04:29.2830663Z <a id="api.migrations.versions.3e9d5c5aff2c_rename_fulf_fee"></a>
2025-08-20T07:04:29.2830950Z 
2025-08-20T07:04:29.2831108Z # api.migrations.versions.3e9d5c5aff2c\_rename\_fulf\_fee
2025-08-20T07:04:29.2831358Z 
2025-08-20T07:04:29.2831487Z <a id="api.migrations.versions.0003_vendor_prices"></a>
2025-08-20T07:04:29.2831693Z 
2025-08-20T07:04:29.2831800Z # api.migrations.versions.0003\_vendor\_prices
2025-08-20T07:04:29.2831987Z 
2025-08-20T07:04:29.2832110Z <a id="api.migrations.versions.0024_create_buybox"></a>
2025-08-20T07:04:29.2832342Z 
2025-08-20T07:04:29.2832448Z # api.migrations.versions.0024\_create\_buybox
2025-08-20T07:04:29.2832820Z 
2025-08-20T07:04:29.2832954Z <a id="api.migrations.versions.0002_create_roi_view"></a>
2025-08-20T07:04:29.2833158Z 
2025-08-20T07:04:29.2833266Z # api.migrations.versions.0002\_create\_roi\_view
2025-08-20T07:04:29.2833459Z 
2025-08-20T07:04:29.2833577Z <a id="api.migrations.versions.0006_fix_roi_views"></a>
2025-08-20T07:04:29.2833769Z 
2025-08-20T07:04:29.2833873Z # api.migrations.versions.0006\_fix\_roi\_views
2025-08-20T07:04:29.2834059Z 
2025-08-20T07:04:29.2834181Z <a id="api.migrations.versions.0020_unified_schema"></a>
2025-08-20T07:04:29.2834375Z 
2025-08-20T07:04:29.2834486Z # api.migrations.versions.0020\_unified\_schema
2025-08-20T07:04:29.2834664Z 
2025-08-20T07:04:29.2834796Z <a id="api.migrations.versions.0025_pr4_indexes_loadlog"></a>
2025-08-20T07:04:29.2835016Z 
2025-08-20T07:04:29.2835131Z # api.migrations.versions.0025\_pr4\_indexes\_loadlog
2025-08-20T07:04:29.2835324Z 
2025-08-20T07:04:29.2835444Z <a id="api.migrations.versions.0023_add_storage_fee"></a>
2025-08-20T07:04:29.2835782Z 
2025-08-20T07:04:29.2835890Z # api.migrations.versions.0023\_add\_storage\_fee
2025-08-20T07:04:29.2836076Z 
2025-08-20T07:04:29.2836215Z <a id="api.migrations.versions.0026_amazon_new_reports"></a>
2025-08-20T07:04:29.2836426Z 
2025-08-20T07:04:29.2836542Z # api.migrations.versions.0026\_amazon\_new\_reports
2025-08-20T07:04:29.2836737Z 
2025-08-20T07:04:29.2836841Z <a id="api.migrations.versions.0001_baseline"></a>
2025-08-20T07:04:29.2837024Z 
2025-08-20T07:04:29.2837123Z # api.migrations.versions.0001\_baseline
2025-08-20T07:04:29.2837306Z 
2025-08-20T07:04:29.2837396Z <a id="api.migrations.versions"></a>
2025-08-20T07:04:29.2837554Z 
2025-08-20T07:04:29.2837640Z # api.migrations.versions
2025-08-20T07:04:29.2837772Z 
2025-08-20T07:04:29.2837850Z <a id="api.migrations"></a>
2025-08-20T07:04:29.2837987Z 
2025-08-20T07:04:29.2838054Z # api.migrations
2025-08-20T07:04:29.2838163Z 
2025-08-20T07:04:29.2838231Z <a id="api.db"></a>
2025-08-20T07:04:29.2838356Z 
2025-08-20T07:04:29.2838418Z # api.db
2025-08-20T07:04:29.2838504Z 
2025-08-20T07:04:29.2838590Z <a id="api.routes.score"></a>
2025-08-20T07:04:29.2838727Z 
2025-08-20T07:04:29.2838795Z # api.routes.score
2025-08-20T07:04:29.2838905Z 
2025-08-20T07:04:29.2838981Z <a id="api.routes.stats"></a>
2025-08-20T07:04:29.2839114Z 
2025-08-20T07:04:29.2839181Z # api.routes.stats
2025-08-20T07:04:29.2839287Z 
2025-08-20T07:04:29.2839539Z <a id="api.routes.roi"></a>
2025-08-20T07:04:29.2839679Z 
2025-08-20T07:04:29.2839751Z # api.routes.roi
2025-08-20T07:04:29.2839852Z 
2025-08-20T07:04:29.2839932Z <a id="api.routes.health"></a>
2025-08-20T07:04:29.2840075Z 
2025-08-20T07:04:29.2840145Z # api.routes.health
2025-08-20T07:04:29.2840252Z 
2025-08-20T07:04:29.2840343Z <a id="api.routes.health.MAX_SKEW"></a>
2025-08-20T07:04:29.2840515Z 
2025-08-20T07:04:29.2840579Z #### MAX\_SKEW
2025-08-20T07:04:29.2840675Z 
2025-08-20T07:04:29.2840741Z seconds
2025-08-20T07:04:29.2840823Z 
2025-08-20T07:04:29.2840913Z <a id="api.routes.health.health"></a>
2025-08-20T07:04:29.2841083Z 
2025-08-20T07:04:29.2841150Z #### health
2025-08-20T07:04:29.2841238Z 
2025-08-20T07:04:29.2841302Z ```python
2025-08-20T07:04:29.2841505Z @router.get("/health", include_in_schema=False)
2025-08-20T07:04:29.2841897Z async def health(session: AsyncSession = Depends(get_session)) -> JSONResponse
2025-08-20T07:04:29.2842244Z ```
2025-08-20T07:04:29.2842328Z 
2025-08-20T07:04:29.2842448Z Return 200 when DB reachable and clocks are in sync.
2025-08-20T07:04:29.2842638Z 
2025-08-20T07:04:29.2842725Z <a id="api.routes.repository"></a>
2025-08-20T07:04:29.2842886Z 
2025-08-20T07:04:29.2842963Z # api.routes.repository
2025-08-20T07:04:29.2843086Z 
2025-08-20T07:04:29.2843157Z <a id="api.routes"></a>
2025-08-20T07:04:29.2843280Z 
2025-08-20T07:04:29.2843345Z # api.routes
2025-08-20T07:04:29.2843442Z 
2025-08-20T07:04:29.2843523Z <a id="api.models.fee"></a>
2025-08-20T07:04:29.2843652Z 
2025-08-20T07:04:29.2843716Z # api.models.fee
2025-08-20T07:04:29.2843824Z 
2025-08-20T07:04:29.2844026Z <a id="api.models"></a>
2025-08-20T07:04:29.2844143Z 
2025-08-20T07:04:29.2844205Z # api.models
2025-08-20T07:04:29.2844303Z 
2025-08-20T07:04:29.2844382Z <a id="api.roi_repository"></a>
2025-08-20T07:04:29.2844521Z 
2025-08-20T07:04:29.2844592Z # api.roi\_repository
2025-08-20T07:04:29.2844714Z 
2025-08-20T07:04:29.2844783Z <a id="api.main"></a>
2025-08-20T07:04:29.2844892Z 
2025-08-20T07:04:29.2844960Z # api.main
2025-08-20T07:04:29.2845050Z 
2025-08-20T07:04:29.2845126Z <a id="api.main.ready"></a>
2025-08-20T07:04:29.2845258Z 
2025-08-20T07:04:29.2845317Z #### ready
2025-08-20T07:04:29.2845406Z 
2025-08-20T07:04:29.2845468Z ```python
2025-08-20T07:04:29.2845732Z @app.get("/ready", status_code=status.HTTP_200_OK, include_in_schema=False)
2025-08-20T07:04:29.2846162Z async def ready(session: AsyncSession = Depends(get_session)) -> dict[str,
2025-08-20T07:04:29.2846501Z                                                                       str]
2025-08-20T07:04:29.2846731Z ```
2025-08-20T07:04:29.2846930Z 
2025-08-20T07:04:29.2847025Z Return 200 only when migrations are at head.
2025-08-20T07:04:29.2847202Z 
2025-08-20T07:04:29.2847273Z <a id="api.config"></a>
2025-08-20T07:04:29.2847387Z 
2025-08-20T07:04:29.2847450Z # api.config
2025-08-20T07:04:29.2847551Z 
2025-08-20T07:04:29.2847625Z <a id="api.security"></a>
2025-08-20T07:04:29.2847750Z 
2025-08-20T07:04:29.2847819Z # api.security
2025-08-20T07:04:29.2847918Z 
2025-08-20T07:04:29.2847981Z <a id="etl"></a>
2025-08-20T07:04:29.2848085Z 
2025-08-20T07:04:29.2848145Z # etl
2025-08-20T07:04:29.2848229Z 
2025-08-20T07:04:29.2848307Z <a id="etl.fba_fee_ingestor"></a>
2025-08-20T07:04:29.2848461Z 
2025-08-20T07:04:29.2848533Z # etl.fba\_fee\_ingestor
2025-08-20T07:04:29.2848653Z 
2025-08-20T07:04:29.2848734Z <a id="etl.sp_fees_ingestor"></a>
2025-08-20T07:04:29.2848881Z 
2025-08-20T07:04:29.2848953Z # etl.sp\_fees\_ingestor
2025-08-20T07:04:29.2849075Z 
2025-08-20T07:04:29.2849152Z <a id="etl.keepa_ingestor"></a>
2025-08-20T07:04:29.2849300Z 
2025-08-20T07:04:29.2849535Z # etl.keepa\_ingestor
2025-08-20T07:04:29.2849661Z 
2025-08-20T07:04:29.2849727Z <a id="etl.db"></a>
2025-08-20T07:04:29.2849833Z 
2025-08-20T07:04:29.2849898Z # etl.db
2025-08-20T07:04:29.2849984Z 
2025-08-20T07:04:29.2850065Z <a id="etl.dialects.schemas"></a>
2025-08-20T07:04:29.2850216Z 
2025-08-20T07:04:29.2850288Z # etl.dialects.schemas
2025-08-20T07:04:29.2850406Z 
2025-08-20T07:04:29.2850511Z <a id="etl.dialects.amazon_reimbursements"></a>
2025-08-20T07:04:29.2850696Z 
2025-08-20T07:04:29.2850782Z # etl.dialects.amazon\_reimbursements
2025-08-20T07:04:29.2850941Z 
2025-08-20T07:04:29.2851039Z <a id="etl.dialects.amazon_ads_sp_cost"></a>
2025-08-20T07:04:29.2851207Z 
2025-08-20T07:04:29.2851292Z # etl.dialects.amazon\_ads\_sp\_cost
2025-08-20T07:04:29.2851627Z 
2025-08-20T07:04:29.2851785Z <a id="etl.dialects.test_generic"></a>
2025-08-20T07:04:29.2851983Z 
2025-08-20T07:04:29.2852062Z # etl.dialects.test\_generic
2025-08-20T07:04:29.2852201Z 
2025-08-20T07:04:29.2852301Z <a id="etl.dialects.amazon_returns"></a>
2025-08-20T07:04:29.2852463Z 
2025-08-20T07:04:29.2852553Z # etl.dialects.amazon\_returns
2025-08-20T07:04:29.2852689Z 
2025-08-20T07:04:29.2852783Z <a id="etl.dialects.amazon_fee_preview"></a>
2025-08-20T07:04:29.2852955Z 
2025-08-20T07:04:29.2853038Z # etl.dialects.amazon\_fee\_preview
2025-08-20T07:04:29.2853191Z 
2025-08-20T07:04:29.2853370Z <a id="etl.dialects.amazon_inventory_ledger"></a>
2025-08-20T07:04:29.2853693Z 
2025-08-20T07:04:29.2853857Z # etl.dialects.amazon\_inventory\_ledger
2025-08-20T07:04:29.2854020Z 
2025-08-20T07:04:29.2854119Z <a id="etl.dialects.amazon_settlements"></a>
2025-08-20T07:04:29.2854288Z 
2025-08-20T07:04:29.2854374Z # etl.dialects.amazon\_settlements
2025-08-20T07:04:29.2854528Z 
2025-08-20T07:04:29.2854602Z <a id="etl.dialects"></a>
2025-08-20T07:04:29.2854726Z 
2025-08-20T07:04:29.2854792Z # etl.dialects
2025-08-20T07:04:29.2854894Z 
2025-08-20T07:04:29.2854960Z <a id="ingest"></a>
2025-08-20T07:04:29.2855064Z 
2025-08-20T07:04:29.2855258Z # ingest
2025-08-20T07:04:29.2855343Z 
2025-08-20T07:04:29.2855422Z <a id="ingest.maintenance"></a>
2025-08-20T07:04:29.2855562Z 
2025-08-20T07:04:29.2855639Z # ingest.maintenance
2025-08-20T07:04:29.2855751Z 
2025-08-20T07:04:29.2855829Z <a id="ingest.copy_loader"></a>
2025-08-20T07:04:29.2855966Z 
2025-08-20T07:04:29.2856036Z # ingest.copy\_loader
2025-08-20T07:04:29.2856147Z 
2025-08-20T07:04:29.2856250Z <a id="ingest.copy_loader.copy_df_via_temp"></a>
2025-08-20T07:04:29.2856430Z 
2025-08-20T07:04:29.2856501Z #### copy\_df\_via\_temp
2025-08-20T07:04:29.2856622Z 
2025-08-20T07:04:29.2856691Z ```python
2025-08-20T07:04:29.2856857Z def copy_df_via_temp(engine: Engine,
2025-08-20T07:04:29.2857094Z                      df: pd.DataFrame,
2025-08-20T07:04:29.2857320Z                      target_table: str,
2025-08-20T07:04:29.2857542Z                      *,
2025-08-20T07:04:29.2857745Z                      target_schema: Optional[str] = None,
2025-08-20T07:04:29.2858003Z                      columns: Sequence[str],
2025-08-20T07:04:29.2858392Z                      conflict_cols: Optional[Sequence[str]] = None,
2025-08-20T07:04:29.2858669Z                      analyze_after: bool = False,
2025-08-20T07:04:29.2858932Z                      connection: Any | None = None) -> int
2025-08-20T07:04:29.2859162Z ```
2025-08-20T07:04:29.2859251Z 
2025-08-20T07:04:29.2859603Z Bulk load *df* into *target_table* using COPY and a staging table.
2025-08-20T07:04:29.2859970Z 
2025-08-20T07:04:29.2860109Z <a id="ingest.tests.test_smoke"></a>
2025-08-20T07:04:29.2860381Z 
2025-08-20T07:04:29.2860485Z # ingest.tests.test\_smoke
2025-08-20T07:04:29.2860618Z 
2025-08-20T07:04:29.2860701Z <a id="ingest.tests"></a>
2025-08-20T07:04:29.2860823Z 
2025-08-20T07:04:29.2860888Z # ingest.tests
2025-08-20T07:04:29.2860993Z 
2025-08-20T07:04:29.2861074Z <a id="ingest.upload_router"></a>
2025-08-20T07:04:29.2861217Z 
2025-08-20T07:04:29.2861291Z # ingest.upload\_router
2025-08-20T07:04:29.2861415Z 
2025-08-20T07:04:29.2861501Z <a id="ingest.email_watcher"></a>
2025-08-20T07:04:29.2861647Z 
2025-08-20T07:04:29.2861724Z # ingest.email\_watcher
2025-08-20T07:04:29.2861839Z 
2025-08-20T07:04:29.2861922Z <a id="ingest.email_watcher.main"></a>
2025-08-20T07:04:29.2862084Z 
2025-08-20T07:04:29.2862145Z #### main
2025-08-20T07:04:29.2862233Z 
2025-08-20T07:04:29.2862294Z ```python
2025-08-20T07:04:29.2862461Z def main() -> dict[str, str]
2025-08-20T07:04:29.2862645Z ```
2025-08-20T07:04:29.2862735Z 
2025-08-20T07:04:29.2862870Z Upload CSV/XLSX attachments to MinIO and trigger ingestion.
2025-08-20T07:04:29.2863088Z 
2025-08-20T07:04:29.2863219Z Returns {"status": "success"} when processing completes.
2025-08-20T07:04:29.2863437Z 
2025-08-20T07:04:29.2863514Z <a id="ingest.tasks"></a>
2025-08-20T07:04:29.2863648Z 
2025-08-20T07:04:29.2863712Z # ingest.tasks
2025-08-20T07:04:29.2863827Z 
2025-08-20T07:04:29.2863923Z <a id="ingest.tasks.task_import_file"></a>
2025-08-20T07:04:29.2864095Z 
2025-08-20T07:04:29.2864173Z #### task\_import\_file
2025-08-20T07:04:29.2864298Z 
2025-08-20T07:04:29.2864361Z ```python
2025-08-20T07:04:29.2864568Z @celery_app.task(name="ingest.import_file", bind=True)
2025-08-20T07:04:29.2864843Z def task_import_file(self: Any,
2025-08-20T07:04:29.2865052Z                      uri: str,
2025-08-20T07:04:29.2865266Z                      report_type: str | None = None,
2025-08-20T07:04:29.2865536Z                      force: bool = False) -> dict[str, Any]
2025-08-20T07:04:29.2865777Z ```
2025-08-20T07:04:29.2865860Z 
2025-08-20T07:04:29.2865989Z Import a file into Postgres using existing ETL pipeline.
2025-08-20T07:04:29.2866198Z 
2025-08-20T07:04:29.2866287Z <a id="ingest.celery_app"></a>
2025-08-20T07:04:29.2866426Z 
2025-08-20T07:04:29.2866497Z # ingest.celery\_app
2025-08-20T07:04:29.2866621Z 
2025-08-20T07:04:29.2866705Z <a id="ingest.ingest_router"></a>
2025-08-20T07:04:29.2866851Z 
2025-08-20T07:04:29.2866924Z # ingest.ingest\_router
2025-08-20T07:04:29.2867049Z 
2025-08-20T07:04:29.2867123Z <a id="logistics_etl"></a>
2025-08-20T07:04:29.2867410Z 
2025-08-20T07:04:29.2867481Z # logistics\_etl
2025-08-20T07:04:29.2867585Z 
2025-08-20T07:04:29.2867658Z Daily logistics ETL job.
2025-08-20T07:04:29.2867790Z 
2025-08-20T07:04:29.2867870Z <a id="logistics_etl.__main__"></a>
2025-08-20T07:04:29.2868020Z 
2025-08-20T07:04:29.2868096Z # logistics\_etl.\_\_main\_\_
2025-08-20T07:04:29.2868235Z 
2025-08-20T07:04:29.2868311Z <a id="logistics_etl.dsn"></a>
2025-08-20T07:04:29.2868450Z 
2025-08-20T07:04:29.2868525Z # logistics\_etl.dsn
2025-08-20T07:04:29.2868636Z 
2025-08-20T07:04:29.2868752Z Local DSN builder to avoid cross-service dependency.
2025-08-20T07:04:29.2868962Z 
2025-08-20T07:04:29.2869051Z <a id="logistics_etl.dsn.build_dsn"></a>
2025-08-20T07:04:29.2869217Z 
2025-08-20T07:04:29.2869280Z #### build\_dsn
2025-08-20T07:04:29.2869611Z 
2025-08-20T07:04:29.2869682Z ```python
2025-08-20T07:04:29.2869863Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:04:29.2870081Z ```
2025-08-20T07:04:29.2870171Z 
2025-08-20T07:04:29.2870447Z Return a Postgres DSN assembled from environment variables.
2025-08-20T07:04:29.2870669Z 
2025-08-20T07:04:29.2870817Z Prefers explicit DSNs via ``PG_SYNC_DSN``/``PG_ASYNC_DSN`` or
2025-08-20T07:04:29.2871213Z ``DATABASE_URL``. Falls back to individual PG_* settings and raises an
2025-08-20T07:04:29.2871552Z error when any required variable is missing.
2025-08-20T07:04:29.2871731Z 
2025-08-20T07:04:29.2871822Z <a id="logistics_etl.tests.conftest"></a>
2025-08-20T07:04:29.2871991Z 
2025-08-20T07:04:29.2872079Z # logistics\_etl.tests.conftest
2025-08-20T07:04:29.2872219Z 
2025-08-20T07:04:29.2872320Z <a id="logistics_etl.tests.test_repository"></a>
2025-08-20T07:04:29.2872505Z 
2025-08-20T07:04:29.2872592Z # logistics\_etl.tests.test\_repository
2025-08-20T07:04:29.2872750Z 
2025-08-20T07:04:29.2872839Z <a id="logistics_etl.tests.test_cron"></a>
2025-08-20T07:04:29.2873010Z 
2025-08-20T07:04:29.2873090Z # logistics\_etl.tests.test\_cron
2025-08-20T07:04:29.2873236Z 
2025-08-20T07:04:29.2873338Z <a id="logistics_etl.tests.test_imports"></a>
2025-08-20T07:04:29.2873532Z 
2025-08-20T07:04:29.2873615Z # logistics\_etl.tests.test\_imports
2025-08-20T07:04:29.2873777Z 
2025-08-20T07:04:29.2873868Z <a id="logistics_etl.tests.test_smoke"></a>
2025-08-20T07:04:29.2874034Z 
2025-08-20T07:04:29.2874114Z # logistics\_etl.tests.test\_smoke
2025-08-20T07:04:29.2874267Z 
2025-08-20T07:04:29.2874358Z <a id="logistics_etl.tests.test_client"></a>
2025-08-20T07:04:29.2874524Z 
2025-08-20T07:04:29.2874611Z # logistics\_etl.tests.test\_client
2025-08-20T07:04:29.2874760Z 
2025-08-20T07:04:29.2874840Z <a id="logistics_etl.tests"></a>
2025-08-20T07:04:29.2874985Z 
2025-08-20T07:04:29.2875056Z # logistics\_etl.tests
2025-08-20T07:04:29.2875170Z 
2025-08-20T07:04:29.2875245Z <a id="logistics_etl.flow"></a>
2025-08-20T07:04:29.2875387Z 
2025-08-20T07:04:29.2875456Z # logistics\_etl.flow
2025-08-20T07:04:29.2875570Z 
2025-08-20T07:04:29.2875655Z <a id="logistics_etl.client"></a>
2025-08-20T07:04:29.2875797Z 
2025-08-20T07:04:29.2948216Z # logistics\_etl.client
2025-08-20T07:04:29.2948517Z 
2025-08-20T07:04:29.2948687Z <a id="logistics_etl.cron"></a>
2025-08-20T07:04:29.2948999Z 
2025-08-20T07:04:29.2949151Z # logistics\_etl.cron
2025-08-20T07:04:29.2949607Z 
2025-08-20T07:04:29.2949773Z <a id="logistics_etl.db"></a>
2025-08-20T07:04:29.2950067Z 
2025-08-20T07:04:29.2950223Z # logistics\_etl.db
2025-08-20T07:04:29.2950457Z 
2025-08-20T07:04:29.2950642Z <a id="logistics_etl.repository"></a>
2025-08-20T07:04:29.2950987Z 
2025-08-20T07:04:29.2951160Z # logistics\_etl.repository
2025-08-20T07:04:29.2951440Z 
2025-08-20T07:04:29.2951583Z <a id="alert_bot"></a>
2025-08-20T07:04:29.2951832Z 
2025-08-20T07:04:29.2951966Z # alert\_bot
2025-08-20T07:04:29.2952164Z 
2025-08-20T07:04:29.2952341Z <a id="alert_bot.tests.test_smoke"></a>
2025-08-20T07:04:29.2952696Z 
2025-08-20T07:04:29.2952859Z # alert\_bot.tests.test\_smoke
2025-08-20T07:04:29.2953150Z 
2025-08-20T07:04:29.2953317Z <a id="alert_bot.tests"></a>
2025-08-20T07:04:29.2953596Z 
2025-08-20T07:04:29.2954013Z # alert\_bot.tests
2025-08-20T07:04:29.2954168Z 
2025-08-20T07:04:29.2954273Z <a id="alert_bot.alert_bot"></a>
2025-08-20T07:04:29.2954452Z 
2025-08-20T07:04:29.2954621Z # alert\_bot.alert\_bot
2025-08-20T07:04:29.2954775Z 
2025-08-20T07:04:29.2954868Z <a id="alert_bot.rules"></a>
2025-08-20T07:04:29.2955029Z 
2025-08-20T07:04:29.2955116Z # alert\_bot.rules
2025-08-20T07:04:29.2955243Z 
2025-08-20T07:04:29.2955324Z <a id="common"></a>
2025-08-20T07:04:29.2955466Z 
2025-08-20T07:04:29.2955542Z # common
2025-08-20T07:04:29.2955650Z 
2025-08-20T07:04:29.2955738Z <a id="common.dsn"></a>
2025-08-20T07:04:29.2955889Z 
2025-08-20T07:04:29.2955968Z # common.dsn
2025-08-20T07:04:29.2956084Z 
2025-08-20T07:04:29.2956193Z <a id="common.dsn.build_dsn"></a>
2025-08-20T07:04:29.2956378Z 
2025-08-20T07:04:29.2956455Z #### build\_dsn
2025-08-20T07:04:29.2956584Z 
2025-08-20T07:04:29.2956661Z ```python
2025-08-20T07:04:29.2956871Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:04:29.2957147Z ```
2025-08-20T07:04:29.2957405Z 
2025-08-20T07:04:29.2957555Z Return a Postgres DSN, validating required variables.
2025-08-20T07:04:29.2957814Z 
2025-08-20T07:04:29.2958044Z The function prefers explicit DSNs via ``PG_SYNC_DSN`` / ``PG_ASYNC_DSN`` or
2025-08-20T07:04:29.2958581Z ``DATABASE_URL``.  If those are absent it assembles a connection string from
2025-08-20T07:04:29.2959087Z ``PG_HOST`` and related variables and raises a helpful error when any are
2025-08-20T07:04:29.2959725Z missing.
2025-08-20T07:04:29.2959837Z 
2025-08-20T07:04:29.2959938Z <a id="common.models_vendor"></a>
2025-08-20T07:04:29.2960127Z 
2025-08-20T07:04:29.2960215Z # common.models\_vendor
2025-08-20T07:04:29.2960361Z 
2025-08-20T07:04:29.2960452Z <a id="common.models_vendor.Vendor"></a>
2025-08-20T07:04:29.2960615Z 
2025-08-20T07:04:29.2960681Z ## Vendor Objects
2025-08-20T07:04:29.2960784Z 
2025-08-20T07:04:29.2960851Z ```python
2025-08-20T07:04:29.2961003Z class Vendor(Base)
2025-08-20T07:04:29.2961166Z ```
2025-08-20T07:04:29.2961254Z 
2025-08-20T07:04:29.2961340Z Vendor of inventory items.
2025-08-20T07:04:29.2961476Z 
2025-08-20T07:04:29.2961576Z <a id="common.models_vendor.VendorPrice"></a>
2025-08-20T07:04:29.2961753Z 
2025-08-20T07:04:29.2961832Z ## VendorPrice Objects
2025-08-20T07:04:29.2961946Z 
2025-08-20T07:04:29.2962006Z ```python
2025-08-20T07:04:29.2962167Z class VendorPrice(Base)
2025-08-20T07:04:29.2962340Z ```
2025-08-20T07:04:29.2962426Z 
2025-08-20T07:04:29.2962528Z Association table linking vendors to pricing.
2025-08-20T07:04:29.2962704Z 
2025-08-20T07:04:29.2962779Z <a id="common.db_url"></a>
2025-08-20T07:04:29.2962910Z 
2025-08-20T07:04:29.2962975Z # common.db\_url
2025-08-20T07:04:29.2963081Z 
2025-08-20T07:04:29.2963169Z <a id="common.db_url.build_url"></a>
2025-08-20T07:04:29.2963332Z 
2025-08-20T07:04:29.2963396Z #### build\_url
2025-08-20T07:04:29.2963504Z 
2025-08-20T07:04:29.2963566Z ```python
2025-08-20T07:04:29.2963734Z def build_url(async_: bool = True) -> str
2025-08-20T07:04:29.2963962Z ```
2025-08-20T07:04:29.2964052Z 
2025-08-20T07:04:29.2964147Z Return Postgres DSN from env or PG_* parts.
2025-08-20T07:04:29.2964328Z 
2025-08-20T07:04:29.2964405Z <a id="common.keepa"></a>
2025-08-20T07:04:29.2964530Z 
2025-08-20T07:04:29.2964605Z # common.keepa
2025-08-20T07:04:29.2964738Z 
2025-08-20T07:04:29.2964811Z <a id="common.llm"></a>
2025-08-20T07:04:29.2964933Z 
2025-08-20T07:04:29.2964996Z # common.llm
2025-08-20T07:04:29.2965088Z 
2025-08-20T07:04:29.2965166Z <a id="common.settings"></a>
2025-08-20T07:04:29.2965306Z 
2025-08-20T07:04:29.2965373Z # common.settings
2025-08-20T07:04:29.2965478Z 
2025-08-20T07:04:29.2965553Z <a id="common.db"></a>
2025-08-20T07:04:29.2965667Z 
2025-08-20T07:04:29.2965729Z # common.db
2025-08-20T07:04:29.2965820Z 
2025-08-20T07:04:29.2965918Z <a id="common.db.build_sqlalchemy_url"></a>
2025-08-20T07:04:29.2966085Z 
2025-08-20T07:04:29.2966157Z #### build\_sqlalchemy\_url
2025-08-20T07:04:29.2966291Z 
2025-08-20T07:04:29.2966354Z ```python
2025-08-20T07:04:29.2966521Z def build_sqlalchemy_url() -> str
2025-08-20T07:04:29.2966866Z ```
2025-08-20T07:04:29.2966945Z 
2025-08-20T07:04:29.2967042Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T07:04:29.2967207Z 
2025-08-20T07:04:29.2967294Z <a id="common.db.build_asyncpg_dsn"></a>
2025-08-20T07:04:29.2967464Z 
2025-08-20T07:04:29.2967536Z #### build\_asyncpg\_dsn
2025-08-20T07:04:29.2967657Z 
2025-08-20T07:04:29.2967716Z ```python
2025-08-20T07:04:29.2967882Z def build_asyncpg_dsn() -> str
2025-08-20T07:04:29.2968069Z ```
2025-08-20T07:04:29.2968153Z 
2025-08-20T07:04:29.2968278Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T07:04:29.2968486Z 
2025-08-20T07:04:29.2968573Z <a id="common.db.refresh_mvs"></a>
2025-08-20T07:04:29.2968721Z 
2025-08-20T07:04:29.2968785Z #### refresh\_mvs
2025-08-20T07:04:29.2968892Z 
2025-08-20T07:04:29.2968951Z ```python
2025-08-20T07:04:29.2969136Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T07:04:29.2969489Z ```
2025-08-20T07:04:29.2969568Z 
2025-08-20T07:04:29.2969832Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T07:04:29.2970054Z 
2025-08-20T07:04:29.2970128Z <a id="common.config"></a>
2025-08-20T07:04:29.2970256Z 
2025-08-20T07:04:29.2970336Z # common.config
2025-08-20T07:04:29.2970438Z 
2025-08-20T07:04:29.2970511Z <a id="common.base"></a>
2025-08-20T07:04:29.2970638Z 
2025-08-20T07:04:29.2970700Z # common.base
2025-08-20T07:04:29.2970795Z 
2025-08-20T07:04:29.2970872Z <a id="common.base.Base"></a>
2025-08-20T07:04:29.2971015Z 
2025-08-20T07:04:29.2971078Z ## Base Objects
2025-08-20T07:04:29.2971175Z 
2025-08-20T07:04:29.2971241Z ```python
2025-08-20T07:04:29.2971403Z class Base(DeclarativeBase)
2025-08-20T07:04:29.2971597Z ```
2025-08-20T07:04:29.2971675Z 
2025-08-20T07:04:29.2971755Z Base class for SQLAlchemy models.
2025-08-20T07:04:29.2971903Z 
2025-08-20T07:04:29.2971972Z <a id="repricer"></a>
2025-08-20T07:04:29.2972085Z 
2025-08-20T07:04:29.2972154Z # repricer
2025-08-20T07:04:29.2972243Z 
2025-08-20T07:04:29.2972327Z <a id="repricer.app.schemas"></a>
2025-08-20T07:04:29.2972484Z 
2025-08-20T07:04:29.2972567Z # repricer.app.schemas
2025-08-20T07:04:29.2972682Z 
2025-08-20T07:04:29.2972762Z <a id="repricer.app.deps"></a>
2025-08-20T07:04:29.2972905Z 
2025-08-20T07:04:29.2972976Z # repricer.app.deps
2025-08-20T07:04:29.2973087Z 
2025-08-20T07:04:29.2973200Z Placeholder module for Keepa / SP-API clients.
2025-08-20T07:04:29.2973390Z 
2025-08-20T07:04:29.2973470Z <a id="repricer.app.logic"></a>
2025-08-20T07:04:29.2973607Z 
2025-08-20T07:04:29.2973686Z # repricer.app.logic
2025-08-20T07:04:29.2973800Z 
2025-08-20T07:04:29.2973893Z <a id="repricer.app.logic.MIN_MARGIN"></a>
2025-08-20T07:04:29.2974070Z 
2025-08-20T07:04:29.2974134Z #### MIN\_MARGIN
2025-08-20T07:04:29.2974233Z 
2025-08-20T07:04:29.2974292Z 15 % ROI
2025-08-20T07:04:29.2974382Z 
2025-08-20T07:04:29.2974480Z <a id="repricer.app.logic.compute_price"></a>
2025-08-20T07:04:29.2974655Z 
2025-08-20T07:04:29.2974727Z #### compute\_price
2025-08-20T07:04:29.2974830Z 
2025-08-20T07:04:29.2974901Z ```python
2025-08-20T07:04:29.2975149Z def compute_price(asin: str, cost: Decimal, fees: Decimal) -> Decimal
2025-08-20T07:04:29.2975445Z ```
2025-08-20T07:04:29.2975537Z 
2025-08-20T07:04:29.2975643Z Toy algorithm: ensure 15 % ROI and round to cents.
2025-08-20T07:04:29.2975915Z Replace with real competitive logic later.
2025-08-20T07:04:29.2976090Z 
2025-08-20T07:04:29.2976173Z <a id="repricer.app.main"></a>
2025-08-20T07:04:29.2976313Z 
2025-08-20T07:04:29.2976394Z # repricer.app.main
2025-08-20T07:04:29.2976501Z 
2025-08-20T07:04:29.2976576Z <a id="repricer.app"></a>
2025-08-20T07:04:29.2976709Z 
2025-08-20T07:04:29.2976775Z # repricer.app
2025-08-20T07:04:29.2976874Z 
2025-08-20T07:04:29.2976963Z <a id="repricer.tests.test_imports"></a>
2025-08-20T07:04:29.2977134Z 
2025-08-20T07:04:29.2977213Z # repricer.tests.test\_imports
2025-08-20T07:04:29.2977348Z 
2025-08-20T07:04:29.2977439Z <a id="repricer.tests.test_smoke"></a>
2025-08-20T07:04:29.2977599Z 
2025-08-20T07:04:29.2977678Z # repricer.tests.test\_smoke
2025-08-20T07:04:29.2977945Z 
2025-08-20T07:04:29.2978021Z <a id="repricer.tests"></a>
2025-08-20T07:04:29.2978150Z 
2025-08-20T07:04:29.2978216Z # repricer.tests
2025-08-20T07:04:29.2978326Z 
2025-08-20T07:04:29.2978387Z <a id="db"></a>
2025-08-20T07:04:29.2978485Z 
2025-08-20T07:04:29.2978547Z # db
2025-08-20T07:04:29.2978628Z 
2025-08-20T07:04:29.2978701Z <a id="db.utils.views"></a>
2025-08-20T07:04:29.2978826Z 
2025-08-20T07:04:29.2978897Z # db.utils.views
2025-08-20T07:04:29.2978998Z 
2025-08-20T07:04:29.2979087Z <a id="db.utils.views.replace_view"></a>
2025-08-20T07:04:29.2979254Z 
2025-08-20T07:04:29.2979321Z #### replace\_view
2025-08-20T07:04:29.2979526Z 
2025-08-20T07:04:29.2979592Z ```python
2025-08-20T07:04:29.2979781Z def replace_view(name: str, new_sql: str) -> None
2025-08-20T07:04:29.2980025Z ```
2025-08-20T07:04:29.2980104Z 
2025-08-20T07:04:29.2980191Z Drop and recreate a SQL view atomically.
2025-08-20T07:04:29.2980351Z 
2025-08-20T07:04:29.2980435Z <a id="db.utils"></a>
2025-08-20T07:04:29.2980670Z 
2025-08-20T07:04:29.2980731Z # db.utils
2025-08-20T07:04:29.2980825Z 
2025-08-20T07:04:29.2980899Z <a id="price_importer"></a>
2025-08-20T07:04:29.2981026Z 
2025-08-20T07:04:29.2981099Z # price\_importer
2025-08-20T07:04:29.2981203Z 
2025-08-20T07:04:29.2981304Z <a id="price_importer.services_common.dsn"></a>
2025-08-20T07:04:29.2981485Z 
2025-08-20T07:04:29.2981581Z # price\_importer.services\_common.dsn
2025-08-20T07:04:29.2981745Z 
2025-08-20T07:04:29.2981867Z <a id="price_importer.services_common.dsn.build_dsn"></a>
2025-08-20T07:04:29.2982076Z 
2025-08-20T07:04:29.2982138Z #### build\_dsn
2025-08-20T07:04:29.2982235Z 
2025-08-20T07:04:29.2982302Z ```python
2025-08-20T07:04:29.2982470Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:04:29.2982687Z ```
2025-08-20T07:04:29.2982767Z 
2025-08-20T07:04:29.2982833Z Return safe DSN.
2025-08-20T07:04:29.2982932Z 
2025-08-20T07:04:29.2983262Z sync=True → SQLAlchemy (+psycopg) else plain asyncpg.
2025-08-20T07:04:29.2983464Z 
2025-08-20T07:04:29.2983613Z <a id="price_importer.services_common.models_vendor"></a>
2025-08-20T07:04:29.2983821Z 
2025-08-20T07:04:29.2983927Z # price\_importer.services\_common.models\_vendor
2025-08-20T07:04:29.2984111Z 
2025-08-20T07:04:29.2984218Z <a id="price_importer.services_common.db_url"></a>
2025-08-20T07:04:29.2984399Z 
2025-08-20T07:04:29.2984490Z # price\_importer.services\_common.db\_url
2025-08-20T07:04:29.2984663Z 
2025-08-20T07:04:29.2984792Z <a id="price_importer.services_common.db_url.build_url"></a>
2025-08-20T07:04:29.2985004Z 
2025-08-20T07:04:29.2985067Z #### build\_url
2025-08-20T07:04:29.2985171Z 
2025-08-20T07:04:29.2985234Z ```python
2025-08-20T07:04:29.2985415Z def build_url(async_: bool = True) -> str
2025-08-20T07:04:29.2985631Z ```
2025-08-20T07:04:29.2985711Z 
2025-08-20T07:04:29.2985814Z Return Postgres DSN from env or PG_* parts.
2025-08-20T07:04:29.2985983Z 
2025-08-20T07:04:29.2986089Z <a id="price_importer.services_common.keepa"></a>
2025-08-20T07:04:29.2986279Z 
2025-08-20T07:04:29.2986379Z # price\_importer.services\_common.keepa
2025-08-20T07:04:29.2986544Z 
2025-08-20T07:04:29.2986644Z <a id="price_importer.services_common.llm"></a>
2025-08-20T07:04:29.2986828Z 
2025-08-20T07:04:29.2986915Z # price\_importer.services\_common.llm
2025-08-20T07:04:29.2987074Z 
2025-08-20T07:04:29.2987195Z <a id="price_importer.services_common.settings"></a>
2025-08-20T07:04:29.2987388Z 
2025-08-20T07:04:29.2987479Z # price\_importer.services\_common.settings
2025-08-20T07:04:29.2987653Z 
2025-08-20T07:04:29.2987751Z <a id="price_importer.services_common.db"></a>
2025-08-20T07:04:29.2987925Z 
2025-08-20T07:04:29.2988014Z # price\_importer.services\_common.db
2025-08-20T07:04:29.2988172Z 
2025-08-20T07:04:29.2988321Z <a id="price_importer.services_common.db.build_sqlalchemy_url"></a>
2025-08-20T07:04:29.2988556Z 
2025-08-20T07:04:29.2988635Z #### build\_sqlalchemy\_url
2025-08-20T07:04:29.2988760Z 
2025-08-20T07:04:29.2988820Z ```python
2025-08-20T07:04:29.2988988Z def build_sqlalchemy_url() -> str
2025-08-20T07:04:29.2989310Z ```
2025-08-20T07:04:29.2989507Z 
2025-08-20T07:04:29.2989601Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T07:04:29.2989773Z 
2025-08-20T07:04:29.2989915Z <a id="price_importer.services_common.db.build_asyncpg_dsn"></a>
2025-08-20T07:04:29.2990141Z 
2025-08-20T07:04:29.2990213Z #### build\_asyncpg\_dsn
2025-08-20T07:04:29.2990339Z 
2025-08-20T07:04:29.2990398Z ```python
2025-08-20T07:04:29.2990559Z def build_asyncpg_dsn() -> str
2025-08-20T07:04:29.2990753Z ```
2025-08-20T07:04:29.2990832Z 
2025-08-20T07:04:29.2990955Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T07:04:29.2991170Z 
2025-08-20T07:04:29.2991292Z <a id="price_importer.services_common.db.refresh_mvs"></a>
2025-08-20T07:04:29.2991497Z 
2025-08-20T07:04:29.2991566Z #### refresh\_mvs
2025-08-20T07:04:29.2991669Z 
2025-08-20T07:04:29.2991728Z ```python
2025-08-20T07:04:29.2991917Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T07:04:29.2992161Z ```
2025-08-20T07:04:29.2992366Z 
2025-08-20T07:04:29.2992507Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T07:04:29.2992719Z 
2025-08-20T07:04:29.2992819Z <a id="price_importer.services_common"></a>
2025-08-20T07:04:29.2992991Z 
2025-08-20T07:04:29.2993075Z # price\_importer.services\_common
2025-08-20T07:04:29.2993225Z 
2025-08-20T07:04:29.2993330Z <a id="price_importer.services_common.base"></a>
2025-08-20T07:04:29.2993512Z 
2025-08-20T07:04:29.2993598Z # price\_importer.services\_common.base
2025-08-20T07:04:29.2993766Z 
2025-08-20T07:04:29.2993851Z <a id="price_importer.normaliser"></a>
2025-08-20T07:04:29.2994011Z 
2025-08-20T07:04:29.2994095Z # price\_importer.normaliser
2025-08-20T07:04:29.2994232Z 
2025-08-20T07:04:29.2994331Z <a id="price_importer.common.models_vendor"></a>
2025-08-20T07:04:29.2994516Z 
2025-08-20T07:04:29.2994601Z # price\_importer.common.models\_vendor
2025-08-20T07:04:29.2994762Z 
2025-08-20T07:04:29.2994849Z <a id="price_importer.common.db_url"></a>
2025-08-20T07:04:29.2995022Z 
2025-08-20T07:04:29.2995113Z # price\_importer.common.db\_url
2025-08-20T07:04:29.2995257Z 
2025-08-20T07:04:29.2995366Z <a id="price_importer.common.db_url.make_dsn"></a>
2025-08-20T07:04:29.2995547Z 
2025-08-20T07:04:29.2995609Z #### make\_dsn
2025-08-20T07:04:29.2995706Z 
2025-08-20T07:04:29.2995771Z ```python
2025-08-20T07:04:29.2995937Z def make_dsn(async_: bool = False) -> str
2025-08-20T07:04:29.2996157Z ```
2025-08-20T07:04:29.2996235Z 
2025-08-20T07:04:29.2996351Z Return DSN built from either PG_* or POSTGRES_* vars.
2025-08-20T07:04:29.2996554Z 
2025-08-20T07:04:29.2996657Z <a id="price_importer.common.db_url.build_url"></a>
2025-08-20T07:04:29.2996843Z 
2025-08-20T07:04:29.2996910Z #### build\_url
2025-08-20T07:04:29.2997007Z 
2025-08-20T07:04:29.2997066Z ```python
2025-08-20T07:04:29.2997242Z def build_url(async_: bool = False) -> str
2025-08-20T07:04:29.2997461Z ```
2025-08-20T07:04:29.2997556Z 
2025-08-20T07:04:29.2997681Z Return Postgres DSN built from environment variables.
2025-08-20T07:04:29.2997885Z 
2025-08-20T07:04:29.2997980Z <a id="price_importer.common"></a>
2025-08-20T07:04:29.2998131Z 
2025-08-20T07:04:29.2998208Z # price\_importer.common
2025-08-20T07:04:29.2998334Z 
2025-08-20T07:04:29.2998427Z <a id="price_importer.common.base"></a>
2025-08-20T07:04:29.2998590Z 
2025-08-20T07:04:29.2998672Z # price\_importer.common.base
2025-08-20T07:04:29.2998821Z 
2025-08-20T07:04:29.2998916Z <a id="price_importer.tests.conftest"></a>
2025-08-20T07:04:29.2999086Z 
2025-08-20T07:04:29.2999176Z # price\_importer.tests.conftest
2025-08-20T07:04:29.2999320Z 
2025-08-20T07:04:29.2999624Z <a id="price_importer.tests.test_reader"></a>
2025-08-20T07:04:29.2999810Z 
2025-08-20T07:04:29.2999904Z # price\_importer.tests.test\_reader
2025-08-20T07:04:29.3000059Z 
2025-08-20T07:04:29.3000158Z <a id="price_importer.tests.test_imports"></a>
2025-08-20T07:04:29.3000360Z 
2025-08-20T07:04:29.3000447Z # price\_importer.tests.test\_imports
2025-08-20T07:04:29.3000603Z 
2025-08-20T07:04:29.3000705Z <a id="price_importer.tests.test_smoke"></a>
2025-08-20T07:04:29.3001003Z 
2025-08-20T07:04:29.3001086Z # price\_importer.tests.test\_smoke
2025-08-20T07:04:29.3001241Z 
2025-08-20T07:04:29.3001350Z <a id="price_importer.tests.test_normaliser"></a>
2025-08-20T07:04:29.3001534Z 
2025-08-20T07:04:29.3001621Z # price\_importer.tests.test\_normaliser
2025-08-20T07:04:29.3001790Z 
2025-08-20T07:04:29.3001870Z <a id="price_importer.tests"></a>
2025-08-20T07:04:29.3002018Z 
2025-08-20T07:04:29.3002096Z # price\_importer.tests
2025-08-20T07:04:29.3002217Z 
2025-08-20T07:04:29.3002300Z <a id="price_importer.reader"></a>
2025-08-20T07:04:29.3002447Z 
2025-08-20T07:04:29.3002527Z # price\_importer.reader
2025-08-20T07:04:29.3002653Z 
2025-08-20T07:04:29.3002740Z <a id="price_importer.repository"></a>
2025-08-20T07:04:29.3002901Z 
2025-08-20T07:04:29.3002981Z # price\_importer.repository
2025-08-20T07:04:29.3003116Z 
2025-08-20T07:04:29.3003203Z <a id="price_importer.import"></a>
2025-08-20T07:04:29.3003350Z 
2025-08-20T07:04:29.3003424Z # price\_importer.import
2025-08-20T07:04:29.3003660Z 
2025-08-20T07:04:29.3003734Z <a id="fees_h10"></a>
2025-08-20T07:04:29.3003845Z 
2025-08-20T07:04:29.3003906Z # fees\_h10
2025-08-20T07:04:29.3004001Z 
2025-08-20T07:04:29.3004077Z <a id="fees_h10.worker"></a>
2025-08-20T07:04:29.3004205Z 
2025-08-20T07:04:29.3004269Z # fees\_h10.worker
2025-08-20T07:04:29.3004381Z 
2025-08-20T07:04:29.3004477Z <a id="fees_h10.worker.list_active_asins"></a>
2025-08-20T07:04:29.3004652Z 
2025-08-20T07:04:29.3004730Z #### list\_active\_asins
2025-08-20T07:04:29.3004848Z 
2025-08-20T07:04:29.3004909Z ```python
2025-08-20T07:04:29.3005078Z def list_active_asins() -> list[str]
2025-08-20T07:04:29.3005282Z ```
2025-08-20T07:04:29.3005367Z 
2025-08-20T07:04:29.3005475Z Return known ASINs or an empty list if unavailable.
2025-08-20T07:04:29.3005666Z 
2025-08-20T07:04:29.3005752Z <a id="fees_h10.tests.test_smoke"></a>
2025-08-20T07:04:29.3005906Z 
2025-08-20T07:04:29.3005983Z # fees\_h10.tests.test\_smoke
2025-08-20T07:04:29.3006128Z 
2025-08-20T07:04:29.3006222Z <a id="fees_h10.tests"></a>
2025-08-20T07:04:29.3006355Z 
2025-08-20T07:04:29.3006419Z # fees\_h10.tests
2025-08-20T07:04:29.3006529Z 
2025-08-20T07:04:29.3006603Z <a id="fees_h10.client"></a>
2025-08-20T07:04:29.3006734Z 
2025-08-20T07:04:29.3006798Z # fees\_h10.client
2025-08-20T07:04:29.3006907Z 
2025-08-20T07:04:29.3006987Z <a id="fees_h10.repository"></a>
2025-08-20T07:04:29.3007129Z 
2025-08-20T07:04:29.3007205Z # fees\_h10.repository
2025-08-20T07:04:29.3007319Z 
2025-08-20T07:04:29.3007419Z <a id="fees_h10.repository.upsert_fees_raw"></a>
2025-08-20T07:04:29.3007607Z 
2025-08-20T07:04:29.3007676Z #### upsert\_fees\_raw
2025-08-20T07:04:29.3007788Z 
2025-08-20T07:04:29.3007849Z ```python
2025-08-20T07:04:29.3008019Z def upsert_fees_raw(engine: Engine,
2025-08-20T07:04:29.3008268Z                     rows: Iterable[Mapping[str, Any]],
2025-08-20T07:04:29.3008502Z                     *,
2025-08-20T07:04:29.3008730Z                     testing: bool = False) -> Optional[Dict[str, int]]
2025-08-20T07:04:29.3008999Z ```
2025-08-20T07:04:29.3009084Z 
2025-08-20T07:04:29.3009161Z Idempotent upsert for fees.
2025-08-20T07:04:29.3009294Z 
2025-08-20T07:04:29.3009557Z TESTING-only: returns counts for inserted/updated/skipped rows.
2025-08-20T07:04:29.3010162Z Assumes logical key (asin, marketplace, fee_type).
2025-08-20T07:04:29.3010679Z Only updates when one of the mutable fields changes.
2025-08-20T07:04:29.3010948Z 
2025-08-20T07:04:29.3011018Z <a id="emailer"></a>
2025-08-20T07:04:29.3011129Z 
2025-08-20T07:04:29.3011198Z # emailer
2025-08-20T07:04:29.3011287Z 
2025-08-20T07:04:29.3011386Z <a id="emailer.tests.test_import_emailer"></a>
2025-08-20T07:04:29.3011567Z 
2025-08-20T07:04:29.3011655Z # emailer.tests.test\_import\_emailer
2025-08-20T07:04:29.3011814Z 
2025-08-20T07:04:29.3011903Z <a id="emailer.tests.test_smoke"></a>
2025-08-20T07:04:29.3012056Z 
2025-08-20T07:04:29.3012135Z # emailer.tests.test\_smoke
2025-08-20T07:04:29.3012267Z 
2025-08-20T07:04:29.3012349Z <a id="emailer.tests"></a>
2025-08-20T07:04:29.3012620Z 
2025-08-20T07:04:29.3012689Z # emailer.tests
2025-08-20T07:04:29.3012799Z 
2025-08-20T07:04:29.3012880Z <a id="emailer.generate_body"></a>
2025-08-20T07:04:29.3013028Z 
2025-08-20T07:04:29.3013103Z # emailer.generate\_body
2025-08-20T07:04:29.3013230Z 
2025-08-20T07:04:29.3013300Z <a id="llm_server"></a>
2025-08-20T07:04:29.3013415Z 
2025-08-20T07:04:29.3013485Z # llm\_server
2025-08-20T07:04:29.3013580Z 
2025-08-20T07:04:29.3013657Z <a id="llm_server.app"></a>
2025-08-20T07:04:29.3013790Z 
2025-08-20T07:04:29.3013854Z # llm\_server.app
2025-08-20T07:04:29.3013958Z 
