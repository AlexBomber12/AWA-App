2025-08-20T07:01:17.2377046Z ##[group]Run pydoc-markdown
2025-08-20T07:01:17.2377340Z [36;1mpydoc-markdown[0m
2025-08-20T07:01:17.2417219Z shell: /usr/bin/bash -e {0}
2025-08-20T07:01:17.2417458Z env:
2025-08-20T07:01:17.2417694Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:01:17.2418103Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-08-20T07:01:17.2418497Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:01:17.2418855Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:01:17.2419202Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:01:17.2419545Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-08-20T07:01:17.2419834Z ##[endgroup]
2025-08-20T07:01:17.7592960Z [WARNING - pydoc_markdown.main]: Unknown configuration options:
2025-08-20T07:01:17.7593878Z Unknown key(s) "{'output_directory'}" at:
2025-08-20T07:01:17.7594360Z In "pydoc-markdown.yml"
2025-08-20T07:01:17.7594807Z   $: TypeHint(pydoc_markdown.PydocMarkdown)
2025-08-20T07:01:17.7595491Z   .renderer: TypeHint(pydoc_markdown.interfaces.Renderer)
2025-08-20T07:01:17.7596555Z   ^: TypeHint(pydoc_markdown.contrib.renderers.markdown.MarkdownRenderer)
2025-08-20T07:01:17.7597098Z 
2025-08-20T07:01:18.1132149Z <a id="__init__"></a>
2025-08-20T07:01:18.1135378Z 
2025-08-20T07:01:18.1135526Z # \_\_init\_\_
2025-08-20T07:01:18.1135740Z 
2025-08-20T07:01:18.1136045Z <a id="api"></a>
2025-08-20T07:01:18.1136263Z 
2025-08-20T07:01:18.1136376Z # api
2025-08-20T07:01:18.1136542Z 
2025-08-20T07:01:18.1136684Z <a id="api.errors"></a>
2025-08-20T07:01:18.1136921Z 
2025-08-20T07:01:18.1137050Z # api.errors
2025-08-20T07:01:18.1137234Z 
2025-08-20T07:01:18.1137387Z <a id="api.sentry_config"></a>
2025-08-20T07:01:18.1137669Z 
2025-08-20T07:01:18.1137805Z # api.sentry\_config
2025-08-20T07:01:18.1138019Z 
2025-08-20T07:01:18.1138201Z <a id="api.tests.test_stats_contracts"></a>
2025-08-20T07:01:18.1138542Z 
2025-08-20T07:01:18.1139095Z # api.tests.test\_stats\_contracts
2025-08-20T07:01:18.1139412Z 
2025-08-20T07:01:18.1139590Z <a id="api.tests.test_sentry_scrub"></a>
2025-08-20T07:01:18.1139906Z 
2025-08-20T07:01:18.1140055Z # api.tests.test\_sentry\_scrub
2025-08-20T07:01:18.1140330Z 
2025-08-20T07:01:18.1140503Z <a id="api.tests.test_roi_basic_auth"></a>
2025-08-20T07:01:18.1140822Z 
2025-08-20T07:01:18.1140975Z # api.tests.test\_roi\_basic\_auth
2025-08-20T07:01:18.1141272Z 
2025-08-20T07:01:18.1141435Z <a id="api.tests.test_errors_json"></a>
2025-08-20T07:01:18.1141744Z 
2025-08-20T07:01:18.1141906Z # api.tests.test\_errors\_json
2025-08-20T07:01:18.1142169Z 
2025-08-20T07:01:18.1142312Z <a id="api.tests.test_llm"></a>
2025-08-20T07:01:18.1142579Z 
2025-08-20T07:01:18.1142709Z # api.tests.test\_llm
2025-08-20T07:01:18.1142927Z 
2025-08-20T07:01:18.1143087Z <a id="api.tests.test_roi_filters"></a>
2025-08-20T07:01:18.1143405Z 
2025-08-20T07:01:18.1143547Z # api.tests.test\_roi\_filters
2025-08-20T07:01:18.1143800Z 
2025-08-20T07:01:18.1143978Z <a id="api.tests.test_sentry_event"></a>
2025-08-20T07:01:18.1144292Z 
2025-08-20T07:01:18.1144439Z # api.tests.test\_sentry\_event
2025-08-20T07:01:18.1144701Z 
2025-08-20T07:01:18.1144935Z <a id="api.tests.test_sentry_event.DummyTransport"></a>
2025-08-20T07:01:18.1145315Z 
2025-08-20T07:01:18.1145455Z ## DummyTransport Objects
2025-08-20T07:01:18.1145697Z 
2025-08-20T07:01:18.1145981Z ```python
2025-08-20T07:01:18.1146303Z class DummyTransport()
2025-08-20T07:01:18.1146644Z ```
2025-08-20T07:01:18.1146793Z 
2025-08-20T07:01:18.1147122Z <a id="api.tests.test_sentry_event.DummyTransport.capture_envelope"></a>
2025-08-20T07:01:18.1147705Z 
2025-08-20T07:01:18.1147846Z #### capture\_envelope
2025-08-20T07:01:18.1148071Z 
2025-08-20T07:01:18.1148184Z ```python
2025-08-20T07:01:18.1148497Z def capture_envelope(envelope)
2025-08-20T07:01:18.1148871Z ```
2025-08-20T07:01:18.1149018Z 
2025-08-20T07:01:18.1149246Z Capture events sent as envelopes by Sentry SDK >= 2.0.
2025-08-20T07:01:18.1149646Z 
2025-08-20T07:01:18.1149795Z <a id="api.tests.test_cors"></a>
2025-08-20T07:01:18.1150427Z 
2025-08-20T07:01:18.1150578Z # api.tests.test\_cors
2025-08-20T07:01:18.1150799Z 
2025-08-20T07:01:18.1150950Z <a id="api.tests.test_imports"></a>
2025-08-20T07:01:18.1151253Z 
2025-08-20T07:01:18.1151392Z # api.tests.test\_imports
2025-08-20T07:01:18.1151628Z 
2025-08-20T07:01:18.1151785Z <a id="api.tests.test_rate_limit"></a>
2025-08-20T07:01:18.1152095Z 
2025-08-20T07:01:18.1152239Z # api.tests.test\_rate\_limit
2025-08-20T07:01:18.1152500Z 
2025-08-20T07:01:18.1152685Z <a id="api.tests.test_rate_limit.app"></a>
2025-08-20T07:01:18.1153010Z 
2025-08-20T07:01:18.1153122Z #### app
2025-08-20T07:01:18.1153292Z 
2025-08-20T07:01:18.1153404Z noqa: E402
2025-08-20T07:01:18.1153565Z 
2025-08-20T07:01:18.1153720Z <a id="api.tests.test_stats_sql"></a>
2025-08-20T07:01:18.1154026Z 
2025-08-20T07:01:18.1154171Z # api.tests.test\_stats\_sql
2025-08-20T07:01:18.1154423Z 
2025-08-20T07:01:18.1154592Z <a id="api.tests.test_entrypoint"></a>
2025-08-20T07:01:18.1154912Z 
2025-08-20T07:01:18.1155052Z # api.tests.test\_entrypoint
2025-08-20T07:01:18.1155316Z 
2025-08-20T07:01:18.1155503Z <a id="api.tests.test_stats_future_contracts"></a>
2025-08-20T07:01:18.1156041Z 
2025-08-20T07:01:18.1156223Z # api.tests.test\_stats\_future\_contracts
2025-08-20T07:01:18.1156558Z 
2025-08-20T07:01:18.1156706Z <a id="api.tests.test_health"></a>
2025-08-20T07:01:18.1156988Z 
2025-08-20T07:01:18.1157131Z # api.tests.test\_health
2025-08-20T07:01:18.1157365Z 
2025-08-20T07:01:18.1157511Z <a id="api.tests.test_score"></a>
2025-08-20T07:01:18.1157789Z 
2025-08-20T07:01:18.1157925Z # api.tests.test\_score
2025-08-20T07:01:18.1158147Z 
2025-08-20T07:01:18.1158290Z <a id="api.logging_config"></a>
2025-08-20T07:01:18.1158552Z 
2025-08-20T07:01:18.1158683Z # api.logging\_config
2025-08-20T07:01:18.1158897Z 
2025-08-20T07:01:18.1159047Z <a id="api.migrations.env"></a>
2025-08-20T07:01:18.1159308Z 
2025-08-20T07:01:18.1159438Z # api.migrations.env
2025-08-20T07:01:18.1159856Z 
2025-08-20T07:01:18.1160085Z <a id="api.migrations.versions.0022_fix_roi_view"></a>
2025-08-20T07:01:18.1160461Z 
2025-08-20T07:01:18.1160651Z # api.migrations.versions.0022\_fix\_roi\_view
2025-08-20T07:01:18.1161004Z 
2025-08-20T07:01:18.1161205Z <a id="api.migrations.versions.0004_fee_cron"></a>
2025-08-20T07:01:18.1161578Z 
2025-08-20T07:01:18.1161760Z # api.migrations.versions.0004\_fee\_cron
2025-08-20T07:01:18.1162089Z 
2025-08-20T07:01:18.1162386Z <a id="api.migrations.versions.3e9d5c5aff2c_rename_fulf_fee"></a>
2025-08-20T07:01:18.1162842Z 
2025-08-20T07:01:18.1163092Z # api.migrations.versions.3e9d5c5aff2c\_rename\_fulf\_fee
2025-08-20T07:01:18.1163502Z 
2025-08-20T07:01:18.1163722Z <a id="api.migrations.versions.0003_vendor_prices"></a>
2025-08-20T07:01:18.1164110Z 
2025-08-20T07:01:18.1164299Z # api.migrations.versions.0003\_vendor\_prices
2025-08-20T07:01:18.1164643Z 
2025-08-20T07:01:18.1164863Z <a id="api.migrations.versions.0024_create_buybox"></a>
2025-08-20T07:01:18.1165264Z 
2025-08-20T07:01:18.1165465Z # api.migrations.versions.0024\_create\_buybox
2025-08-20T07:01:18.1166071Z 
2025-08-20T07:01:18.1166313Z <a id="api.migrations.versions.0002_create_roi_view"></a>
2025-08-20T07:01:18.1166708Z 
2025-08-20T07:01:18.1166918Z # api.migrations.versions.0002\_create\_roi\_view
2025-08-20T07:01:18.1167275Z 
2025-08-20T07:01:18.1167495Z <a id="api.migrations.versions.0006_fix_roi_views"></a>
2025-08-20T07:01:18.1167883Z 
2025-08-20T07:01:18.1168083Z # api.migrations.versions.0006\_fix\_roi\_views
2025-08-20T07:01:18.1168434Z 
2025-08-20T07:01:18.1168668Z <a id="api.migrations.versions.0020_unified_schema"></a>
2025-08-20T07:01:18.1169051Z 
2025-08-20T07:01:18.1169246Z # api.migrations.versions.0020\_unified\_schema
2025-08-20T07:01:18.1169604Z 
2025-08-20T07:01:18.1169855Z <a id="api.migrations.versions.0025_pr4_indexes_loadlog"></a>
2025-08-20T07:01:18.1170263Z 
2025-08-20T07:01:18.1170480Z # api.migrations.versions.0025\_pr4\_indexes\_loadlog
2025-08-20T07:01:18.1170867Z 
2025-08-20T07:01:18.1171106Z <a id="api.migrations.versions.0023_add_storage_fee"></a>
2025-08-20T07:01:18.1171729Z 
2025-08-20T07:01:18.1171938Z # api.migrations.versions.0023\_add\_storage\_fee
2025-08-20T07:01:18.1172289Z 
2025-08-20T07:01:18.1172543Z <a id="api.migrations.versions.0026_amazon_new_reports"></a>
2025-08-20T07:01:18.1172960Z 
2025-08-20T07:01:18.1173176Z # api.migrations.versions.0026\_amazon\_new\_reports
2025-08-20T07:01:18.1173545Z 
2025-08-20T07:01:18.1173750Z <a id="api.migrations.versions.0001_baseline"></a>
2025-08-20T07:01:18.1174122Z 
2025-08-20T07:01:18.1174294Z # api.migrations.versions.0001\_baseline
2025-08-20T07:01:18.1174637Z 
2025-08-20T07:01:18.1174810Z <a id="api.migrations.versions"></a>
2025-08-20T07:01:18.1175111Z 
2025-08-20T07:01:18.1175255Z # api.migrations.versions
2025-08-20T07:01:18.1175510Z 
2025-08-20T07:01:18.1175650Z <a id="api.migrations"></a>
2025-08-20T07:01:18.1176077Z 
2025-08-20T07:01:18.1176211Z # api.migrations
2025-08-20T07:01:18.1176417Z 
2025-08-20T07:01:18.1176551Z <a id="api.db"></a>
2025-08-20T07:01:18.1176758Z 
2025-08-20T07:01:18.1176876Z # api.db
2025-08-20T07:01:18.1177036Z 
2025-08-20T07:01:18.1177182Z <a id="api.routes.score"></a>
2025-08-20T07:01:18.1177445Z 
2025-08-20T07:01:18.1177568Z # api.routes.score
2025-08-20T07:01:18.1177763Z 
2025-08-20T07:01:18.1177903Z <a id="api.routes.stats"></a>
2025-08-20T07:01:18.1178167Z 
2025-08-20T07:01:18.1178291Z # api.routes.stats
2025-08-20T07:01:18.1178486Z 
2025-08-20T07:01:18.1178628Z <a id="api.routes.roi"></a>
2025-08-20T07:01:18.1178873Z 
2025-08-20T07:01:18.1178995Z # api.routes.roi
2025-08-20T07:01:18.1179182Z 
2025-08-20T07:01:18.1179334Z <a id="api.routes.health"></a>
2025-08-20T07:01:18.1179592Z 
2025-08-20T07:01:18.1179719Z # api.routes.health
2025-08-20T07:01:18.1179927Z 
2025-08-20T07:01:18.1180092Z <a id="api.routes.health.MAX_SKEW"></a>
2025-08-20T07:01:18.1180405Z 
2025-08-20T07:01:18.1180531Z #### MAX\_SKEW
2025-08-20T07:01:18.1180714Z 
2025-08-20T07:01:18.1180823Z seconds
2025-08-20T07:01:18.1181198Z 
2025-08-20T07:01:18.1181379Z <a id="api.routes.health.health"></a>
2025-08-20T07:01:18.1181692Z 
2025-08-20T07:01:18.1181804Z #### health
2025-08-20T07:01:18.1181980Z 
2025-08-20T07:01:18.1182095Z ```python
2025-08-20T07:01:18.1182448Z @router.get("/health", include_in_schema=False)
2025-08-20T07:01:18.1183190Z async def health(session: AsyncSession = Depends(get_session)) -> JSONResponse
2025-08-20T07:01:18.1183826Z ```
2025-08-20T07:01:18.1183976Z 
2025-08-20T07:01:18.1184186Z Return 200 when DB reachable and clocks are in sync.
2025-08-20T07:01:18.1184552Z 
2025-08-20T07:01:18.1184718Z <a id="api.routes.repository"></a>
2025-08-20T07:01:18.1185005Z 
2025-08-20T07:01:18.1185142Z # api.routes.repository
2025-08-20T07:01:18.1185380Z 
2025-08-20T07:01:18.1185511Z <a id="api.routes"></a>
2025-08-20T07:01:18.1185725Z 
2025-08-20T07:01:18.1186024Z # api.routes
2025-08-20T07:01:18.1186210Z 
2025-08-20T07:01:18.1186348Z <a id="api.models.fee"></a>
2025-08-20T07:01:18.1186588Z 
2025-08-20T07:01:18.1186709Z # api.models.fee
2025-08-20T07:01:18.1186888Z 
2025-08-20T07:01:18.1186998Z <a id="api.models"></a>
2025-08-20T07:01:18.1187174Z 
2025-08-20T07:01:18.1187266Z # api.models
2025-08-20T07:01:18.1187406Z 
2025-08-20T07:01:18.1187520Z <a id="api.roi_repository"></a>
2025-08-20T07:01:18.1187739Z 
2025-08-20T07:01:18.1187844Z # api.roi\_repository
2025-08-20T07:01:18.1188014Z 
2025-08-20T07:01:18.1188122Z <a id="api.main"></a>
2025-08-20T07:01:18.1188286Z 
2025-08-20T07:01:18.1188377Z # api.main
2025-08-20T07:01:18.1188514Z 
2025-08-20T07:01:18.1188626Z <a id="api.main.ready"></a>
2025-08-20T07:01:18.1188824Z 
2025-08-20T07:01:18.1188915Z #### ready
2025-08-20T07:01:18.1189049Z 
2025-08-20T07:01:18.1189142Z ```python
2025-08-20T07:01:18.1189542Z @app.get("/ready", status_code=status.HTTP_200_OK, include_in_schema=False)
2025-08-20T07:01:18.1190256Z async def ready(session: AsyncSession = Depends(get_session)) -> dict[str,
2025-08-20T07:01:18.1190812Z                                                                       str]
2025-08-20T07:01:18.1191215Z ```
2025-08-20T07:01:18.1191549Z 
2025-08-20T07:01:18.1191713Z Return 200 only when migrations are at head.
2025-08-20T07:01:18.1192023Z 
2025-08-20T07:01:18.1192134Z <a id="api.config"></a>
2025-08-20T07:01:18.1192312Z 
2025-08-20T07:01:18.1192414Z # api.config
2025-08-20T07:01:18.1192558Z 
2025-08-20T07:01:18.1192671Z <a id="api.security"></a>
2025-08-20T07:01:18.1192872Z 
2025-08-20T07:01:18.1192981Z # api.security
2025-08-20T07:01:18.1193137Z 
2025-08-20T07:01:18.1193248Z <a id="etl"></a>
2025-08-20T07:01:18.1193433Z 
2025-08-20T07:01:18.1193535Z # etl
2025-08-20T07:01:18.1193679Z 
2025-08-20T07:01:18.1193818Z <a id="etl.fba_fee_ingestor"></a>
2025-08-20T07:01:18.1194080Z 
2025-08-20T07:01:18.1194190Z # etl.fba\_fee\_ingestor
2025-08-20T07:01:18.1194363Z 
2025-08-20T07:01:18.1194488Z <a id="etl.sp_fees_ingestor"></a>
2025-08-20T07:01:18.1194707Z 
2025-08-20T07:01:18.1194813Z # etl.sp\_fees\_ingestor
2025-08-20T07:01:18.1195008Z 
2025-08-20T07:01:18.1195131Z <a id="etl.keepa_ingestor"></a>
2025-08-20T07:01:18.1195374Z 
2025-08-20T07:01:18.1195484Z # etl.keepa\_ingestor
2025-08-20T07:01:18.1195685Z 
2025-08-20T07:01:18.1195802Z <a id="etl.db"></a>
2025-08-20T07:01:18.1196163Z 
2025-08-20T07:01:18.1196280Z # etl.db
2025-08-20T07:01:18.1196432Z 
2025-08-20T07:01:18.1196556Z <a id="etl.dialects.schemas"></a>
2025-08-20T07:01:18.1196786Z 
2025-08-20T07:01:18.1196899Z # etl.dialects.schemas
2025-08-20T07:01:18.1197077Z 
2025-08-20T07:01:18.1197236Z <a id="etl.dialects.amazon_reimbursements"></a>
2025-08-20T07:01:18.1197535Z 
2025-08-20T07:01:18.1197687Z # etl.dialects.amazon\_reimbursements
2025-08-20T07:01:18.1197968Z 
2025-08-20T07:01:18.1198141Z <a id="etl.dialects.amazon_ads_sp_cost"></a>
2025-08-20T07:01:18.1198445Z 
2025-08-20T07:01:18.1198591Z # etl.dialects.amazon\_ads\_sp\_cost
2025-08-20T07:01:18.1198853Z 
2025-08-20T07:01:18.1198982Z <a id="etl.dialects.test_generic"></a>
2025-08-20T07:01:18.1199226Z 
2025-08-20T07:01:18.1199344Z # etl.dialects.test\_generic
2025-08-20T07:01:18.1199705Z 
2025-08-20T07:01:18.1199840Z <a id="etl.dialects.amazon_returns"></a>
2025-08-20T07:01:18.1200076Z 
2025-08-20T07:01:18.1200193Z # etl.dialects.amazon\_returns
2025-08-20T07:01:18.1200386Z 
2025-08-20T07:01:18.1200518Z <a id="etl.dialects.amazon_fee_preview"></a>
2025-08-20T07:01:18.1200811Z 
2025-08-20T07:01:18.1200953Z # etl.dialects.amazon\_fee\_preview
2025-08-20T07:01:18.1201221Z 
2025-08-20T07:01:18.1201400Z <a id="etl.dialects.amazon_inventory_ledger"></a>
2025-08-20T07:01:18.1201733Z 
2025-08-20T07:01:18.1201883Z # etl.dialects.amazon\_inventory\_ledger
2025-08-20T07:01:18.1202171Z 
2025-08-20T07:01:18.1202340Z <a id="etl.dialects.amazon_settlements"></a>
2025-08-20T07:01:18.1202641Z 
2025-08-20T07:01:18.1202786Z # etl.dialects.amazon\_settlements
2025-08-20T07:01:18.1203059Z 
2025-08-20T07:01:18.1203185Z <a id="etl.dialects"></a>
2025-08-20T07:01:18.1203418Z 
2025-08-20T07:01:18.1203533Z # etl.dialects
2025-08-20T07:01:18.1203723Z 
2025-08-20T07:01:18.1203843Z <a id="ingest"></a>
2025-08-20T07:01:18.1204048Z 
2025-08-20T07:01:18.1204174Z # ingest
2025-08-20T07:01:18.1204331Z 
2025-08-20T07:01:18.1204484Z <a id="ingest.maintenance"></a>
2025-08-20T07:01:18.1204751Z 
2025-08-20T07:01:18.1204891Z # ingest.maintenance
2025-08-20T07:01:18.1205108Z 
2025-08-20T07:01:18.1205256Z <a id="ingest.copy_loader"></a>
2025-08-20T07:01:18.1205527Z 
2025-08-20T07:01:18.1205658Z # ingest.copy\_loader
2025-08-20T07:01:18.1206049Z 
2025-08-20T07:01:18.1206249Z <a id="ingest.copy_loader.copy_df_via_temp"></a>
2025-08-20T07:01:18.1206599Z 
2025-08-20T07:01:18.1206732Z #### copy\_df\_via\_temp
2025-08-20T07:01:18.1206960Z 
2025-08-20T07:01:18.1207083Z ```python
2025-08-20T07:01:18.1207387Z def copy_df_via_temp(engine: Engine,
2025-08-20T07:01:18.1207827Z                      df: pd.DataFrame,
2025-08-20T07:01:18.1208255Z                      target_table: str,
2025-08-20T07:01:18.1208657Z                      *,
2025-08-20T07:01:18.1209031Z                      target_schema: Optional[str] = None,
2025-08-20T07:01:18.1209569Z                      columns: Sequence[str],
2025-08-20T07:01:18.1210291Z                      conflict_cols: Optional[Sequence[str]] = None,
2025-08-20T07:01:18.1210804Z                      analyze_after: bool = False,
2025-08-20T07:01:18.1211284Z                      connection: Any | None = None) -> int
2025-08-20T07:01:18.1211715Z ```
2025-08-20T07:01:18.1211878Z 
2025-08-20T07:01:18.1212157Z Bulk load *df* into *target_table* using COPY and a staging table.
2025-08-20T07:01:18.1212586Z 
2025-08-20T07:01:18.1212740Z <a id="ingest.tests.test_smoke"></a>
2025-08-20T07:01:18.1213042Z 
2025-08-20T07:01:18.1213183Z # ingest.tests.test\_smoke
2025-08-20T07:01:18.1213426Z 
2025-08-20T07:01:18.1213571Z <a id="ingest.tests"></a>
2025-08-20T07:01:18.1213803Z 
2025-08-20T07:01:18.1213922Z # ingest.tests
2025-08-20T07:01:18.1214114Z 
2025-08-20T07:01:18.1214261Z <a id="ingest.upload_router"></a>
2025-08-20T07:01:18.1214537Z 
2025-08-20T07:01:18.1214667Z # ingest.upload\_router
2025-08-20T07:01:18.1214902Z 
2025-08-20T07:01:18.1215054Z <a id="ingest.email_watcher"></a>
2025-08-20T07:01:18.1215323Z 
2025-08-20T07:01:18.1215462Z # ingest.email\_watcher
2025-08-20T07:01:18.1215677Z 
2025-08-20T07:01:18.1215993Z <a id="ingest.email_watcher.main"></a>
2025-08-20T07:01:18.1216311Z 
2025-08-20T07:01:18.1216420Z #### main
2025-08-20T07:01:18.1216581Z 
2025-08-20T07:01:18.1216693Z ```python
2025-08-20T07:01:18.1216998Z def main() -> dict[str, str]
2025-08-20T07:01:18.1217356Z ```
2025-08-20T07:01:18.1217512Z 
2025-08-20T07:01:18.1217767Z Upload CSV/XLSX attachments to MinIO and trigger ingestion.
2025-08-20T07:01:18.1218190Z 
2025-08-20T07:01:18.1218444Z Returns {"status": "success"} when processing completes.
2025-08-20T07:01:18.1218836Z 
2025-08-20T07:01:18.1218977Z <a id="ingest.tasks"></a>
2025-08-20T07:01:18.1219226Z 
2025-08-20T07:01:18.1219346Z # ingest.tasks
2025-08-20T07:01:18.1219558Z 
2025-08-20T07:01:18.1219729Z <a id="ingest.tasks.task_import_file"></a>
2025-08-20T07:01:18.1220058Z 
2025-08-20T07:01:18.1220416Z #### task\_import\_file
2025-08-20T07:01:18.1220648Z 
2025-08-20T07:01:18.1220763Z ```python
2025-08-20T07:01:18.1221148Z @celery_app.task(name="ingest.import_file", bind=True)
2025-08-20T07:01:18.1221687Z def task_import_file(self: Any,
2025-08-20T07:01:18.1222089Z                      uri: str,
2025-08-20T07:01:18.1222488Z                      report_type: str | None = None,
2025-08-20T07:01:18.1222984Z                      force: bool = False) -> dict[str, Any]
2025-08-20T07:01:18.1223421Z ```
2025-08-20T07:01:18.1223566Z 
2025-08-20T07:01:18.1223808Z Import a file into Postgres using existing ETL pipeline.
2025-08-20T07:01:18.1224201Z 
2025-08-20T07:01:18.1224360Z <a id="ingest.celery_app"></a>
2025-08-20T07:01:18.1224620Z 
2025-08-20T07:01:18.1224751Z # ingest.celery\_app
2025-08-20T07:01:18.1224973Z 
2025-08-20T07:01:18.1225123Z <a id="ingest.ingest_router"></a>
2025-08-20T07:01:18.1225405Z 
2025-08-20T07:01:18.1225538Z # ingest.ingest\_router
2025-08-20T07:01:18.1225767Z 
2025-08-20T07:01:18.1226079Z <a id="logistics_etl"></a>
2025-08-20T07:01:18.1226337Z 
2025-08-20T07:01:18.1226464Z # logistics\_etl
2025-08-20T07:01:18.1226655Z 
2025-08-20T07:01:18.1226794Z Daily logistics ETL job.
2025-08-20T07:01:18.1227031Z 
2025-08-20T07:01:18.1227173Z <a id="logistics_etl.__main__"></a>
2025-08-20T07:01:18.1227457Z 
2025-08-20T07:01:18.1227593Z # logistics\_etl.\_\_main\_\_
2025-08-20T07:01:18.1227855Z 
2025-08-20T07:01:18.1227999Z <a id="logistics_etl.dsn"></a>
2025-08-20T07:01:18.1228255Z 
2025-08-20T07:01:18.1228392Z # logistics\_etl.dsn
2025-08-20T07:01:18.1228601Z 
2025-08-20T07:01:18.1228820Z Local DSN builder to avoid cross-service dependency.
2025-08-20T07:01:18.1229207Z 
2025-08-20T07:01:18.1229371Z <a id="logistics_etl.dsn.build_dsn"></a>
2025-08-20T07:01:18.1229682Z 
2025-08-20T07:01:18.1229798Z #### build\_dsn
2025-08-20T07:01:18.1229993Z 
2025-08-20T07:01:18.1230107Z ```python
2025-08-20T07:01:18.1230428Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:01:18.1230834Z ```
2025-08-20T07:01:18.1230999Z 
2025-08-20T07:01:18.1231482Z Return a Postgres DSN assembled from environment variables.
2025-08-20T07:01:18.1231898Z 
2025-08-20T07:01:18.1232173Z Prefers explicit DSNs via ``PG_SYNC_DSN``/``PG_ASYNC_DSN`` or
2025-08-20T07:01:18.1232886Z ``DATABASE_URL``. Falls back to individual PG_* settings and raises an
2025-08-20T07:01:18.1233516Z error when any required variable is missing.
2025-08-20T07:01:18.1233853Z 
2025-08-20T07:01:18.1234027Z <a id="logistics_etl.tests.conftest"></a>
2025-08-20T07:01:18.1234348Z 
2025-08-20T07:01:18.1234505Z # logistics\_etl.tests.conftest
2025-08-20T07:01:18.1234770Z 
2025-08-20T07:01:18.1234957Z <a id="logistics_etl.tests.test_repository"></a>
2025-08-20T07:01:18.1235307Z 
2025-08-20T07:01:18.1235465Z # logistics\_etl.tests.test\_repository
2025-08-20T07:01:18.1235768Z 
2025-08-20T07:01:18.1236112Z <a id="logistics_etl.tests.test_cron"></a>
2025-08-20T07:01:18.1236445Z 
2025-08-20T07:01:18.1236594Z # logistics\_etl.tests.test\_cron
2025-08-20T07:01:18.1236883Z 
2025-08-20T07:01:18.1237064Z <a id="logistics_etl.tests.test_imports"></a>
2025-08-20T07:01:18.1237400Z 
2025-08-20T07:01:18.1237558Z # logistics\_etl.tests.test\_imports
2025-08-20T07:01:18.1237863Z 
2025-08-20T07:01:18.1238039Z <a id="logistics_etl.tests.test_smoke"></a>
2025-08-20T07:01:18.1238370Z 
2025-08-20T07:01:18.1238526Z # logistics\_etl.tests.test\_smoke
2025-08-20T07:01:18.1238817Z 
2025-08-20T07:01:18.1238988Z <a id="logistics_etl.tests.test_client"></a>
2025-08-20T07:01:18.1239311Z 
2025-08-20T07:01:18.1239472Z # logistics\_etl.tests.test\_client
2025-08-20T07:01:18.1239759Z 
2025-08-20T07:01:18.1239907Z <a id="logistics_etl.tests"></a>
2025-08-20T07:01:18.1240188Z 
2025-08-20T07:01:18.1240320Z # logistics\_etl.tests
2025-08-20T07:01:18.1240544Z 
2025-08-20T07:01:18.1240688Z <a id="logistics_etl.flow"></a>
2025-08-20T07:01:18.1240955Z 
2025-08-20T07:01:18.1241082Z # logistics\_etl.flow
2025-08-20T07:01:18.1241295Z 
2025-08-20T07:01:18.1241451Z <a id="logistics_etl.client"></a>
2025-08-20T07:01:18.1241936Z 
2025-08-20T07:01:18.1307472Z # logistics\_etl.client
2025-08-20T07:01:18.1307816Z 
2025-08-20T07:01:18.1308038Z <a id="logistics_etl.cron"></a>
2025-08-20T07:01:18.1308447Z 
2025-08-20T07:01:18.1308651Z # logistics\_etl.cron
2025-08-20T07:01:18.1308925Z 
2025-08-20T07:01:18.1309097Z <a id="logistics_etl.db"></a>
2025-08-20T07:01:18.1309400Z 
2025-08-20T07:01:18.1309554Z # logistics\_etl.db
2025-08-20T07:01:18.1309791Z 
2025-08-20T07:01:18.1309995Z <a id="logistics_etl.repository"></a>
2025-08-20T07:01:18.1310246Z 
2025-08-20T07:01:18.1310364Z # logistics\_etl.repository
2025-08-20T07:01:18.1310567Z 
2025-08-20T07:01:18.1310676Z <a id="alert_bot"></a>
2025-08-20T07:01:18.1310847Z 
2025-08-20T07:01:18.1310941Z # alert\_bot
2025-08-20T07:01:18.1311075Z 
2025-08-20T07:01:18.1311203Z <a id="alert_bot.tests.test_smoke"></a>
2025-08-20T07:01:18.1311441Z 
2025-08-20T07:01:18.1311550Z # alert\_bot.tests.test\_smoke
2025-08-20T07:01:18.1311756Z 
2025-08-20T07:01:18.1311864Z <a id="alert_bot.tests"></a>
2025-08-20T07:01:18.1312069Z 
2025-08-20T07:01:18.1312174Z # alert\_bot.tests
2025-08-20T07:01:18.1312333Z 
2025-08-20T07:01:18.1312443Z <a id="alert_bot.alert_bot"></a>
2025-08-20T07:01:18.1312642Z 
2025-08-20T07:01:18.1312748Z # alert\_bot.alert\_bot
2025-08-20T07:01:18.1312911Z 
2025-08-20T07:01:18.1313014Z <a id="alert_bot.rules"></a>
2025-08-20T07:01:18.1313204Z 
2025-08-20T07:01:18.1313297Z # alert\_bot.rules
2025-08-20T07:01:18.1313447Z 
2025-08-20T07:01:18.1313540Z <a id="common"></a>
2025-08-20T07:01:18.1313693Z 
2025-08-20T07:01:18.1313870Z # common
2025-08-20T07:01:18.1313994Z 
2025-08-20T07:01:18.1314106Z <a id="common.dsn"></a>
2025-08-20T07:01:18.1314271Z 
2025-08-20T07:01:18.1314360Z # common.dsn
2025-08-20T07:01:18.1314498Z 
2025-08-20T07:01:18.1314613Z <a id="common.dsn.build_dsn"></a>
2025-08-20T07:01:18.1314864Z 
2025-08-20T07:01:18.1314955Z #### build\_dsn
2025-08-20T07:01:18.1315107Z 
2025-08-20T07:01:18.1315197Z ```python
2025-08-20T07:01:18.1315454Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:01:18.1315776Z ```
2025-08-20T07:01:18.1316391Z 
2025-08-20T07:01:18.1316593Z Return a Postgres DSN, validating required variables.
2025-08-20T07:01:18.1316924Z 
2025-08-20T07:01:18.1317210Z The function prefers explicit DSNs via ``PG_SYNC_DSN`` / ``PG_ASYNC_DSN`` or
2025-08-20T07:01:18.1317760Z ``DATABASE_URL``.  If those are absent it assembles a connection string from
2025-08-20T07:01:18.1318266Z ``PG_HOST`` and related variables and raises a helpful error when any are
2025-08-20T07:01:18.1318657Z missing.
2025-08-20T07:01:18.1318764Z 
2025-08-20T07:01:18.1318872Z <a id="common.models_vendor"></a>
2025-08-20T07:01:18.1319059Z 
2025-08-20T07:01:18.1319148Z # common.models\_vendor
2025-08-20T07:01:18.1319302Z 
2025-08-20T07:01:18.1319410Z <a id="common.models_vendor.Vendor"></a>
2025-08-20T07:01:18.1319617Z 
2025-08-20T07:01:18.1319699Z ## Vendor Objects
2025-08-20T07:01:18.1319833Z 
2025-08-20T07:01:18.1319911Z ```python
2025-08-20T07:01:18.1320101Z class Vendor(Base)
2025-08-20T07:01:18.1320304Z ```
2025-08-20T07:01:18.1320406Z 
2025-08-20T07:01:18.1320506Z Vendor of inventory items.
2025-08-20T07:01:18.1320665Z 
2025-08-20T07:01:18.1320785Z <a id="common.models_vendor.VendorPrice"></a>
2025-08-20T07:01:18.1321011Z 
2025-08-20T07:01:18.1321098Z ## VendorPrice Objects
2025-08-20T07:01:18.1321238Z 
2025-08-20T07:01:18.1321313Z ```python
2025-08-20T07:01:18.1321509Z class VendorPrice(Base)
2025-08-20T07:01:18.1321721Z ```
2025-08-20T07:01:18.1321824Z 
2025-08-20T07:01:18.1321947Z Association table linking vendors to pricing.
2025-08-20T07:01:18.1322169Z 
2025-08-20T07:01:18.1322262Z <a id="common.db_url"></a>
2025-08-20T07:01:18.1322417Z 
2025-08-20T07:01:18.1322496Z # common.db\_url
2025-08-20T07:01:18.1322628Z 
2025-08-20T07:01:18.1322726Z <a id="common.db_url.build_url"></a>
2025-08-20T07:01:18.1322914Z 
2025-08-20T07:01:18.1322991Z #### build\_url
2025-08-20T07:01:18.1323118Z 
2025-08-20T07:01:18.1323192Z ```python
2025-08-20T07:01:18.1323400Z def build_url(async_: bool = True) -> str
2025-08-20T07:01:18.1323801Z ```
2025-08-20T07:01:18.1323901Z 
2025-08-20T07:01:18.1324026Z Return Postgres DSN from env or PG_* parts.
2025-08-20T07:01:18.1324240Z 
2025-08-20T07:01:18.1324334Z <a id="common.keepa"></a>
2025-08-20T07:01:18.1324493Z 
2025-08-20T07:01:18.1324575Z # common.keepa
2025-08-20T07:01:18.1324696Z 
2025-08-20T07:01:18.1324781Z <a id="common.llm"></a>
2025-08-20T07:01:18.1324926Z 
2025-08-20T07:01:18.1325003Z # common.llm
2025-08-20T07:01:18.1325118Z 
2025-08-20T07:01:18.1325219Z <a id="common.settings"></a>
2025-08-20T07:01:18.1325389Z 
2025-08-20T07:01:18.1325470Z # common.settings
2025-08-20T07:01:18.1325603Z 
2025-08-20T07:01:18.1325688Z <a id="common.db"></a>
2025-08-20T07:01:18.1325967Z 
2025-08-20T07:01:18.1326085Z # common.db
2025-08-20T07:01:18.1326207Z 
2025-08-20T07:01:18.1326318Z <a id="common.db.build_sqlalchemy_url"></a>
2025-08-20T07:01:18.1326531Z 
2025-08-20T07:01:18.1326629Z #### build\_sqlalchemy\_url
2025-08-20T07:01:18.1326789Z 
2025-08-20T07:01:18.1326866Z ```python
2025-08-20T07:01:18.1327094Z def build_sqlalchemy_url() -> str
2025-08-20T07:01:18.1327351Z ```
2025-08-20T07:01:18.1327459Z 
2025-08-20T07:01:18.1327576Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T07:01:18.1327759Z 
2025-08-20T07:01:18.1327850Z <a id="common.db.build_asyncpg_dsn"></a>
2025-08-20T07:01:18.1328038Z 
2025-08-20T07:01:18.1328115Z #### build\_asyncpg\_dsn
2025-08-20T07:01:18.1328243Z 
2025-08-20T07:01:18.1328316Z ```python
2025-08-20T07:01:18.1328489Z def build_asyncpg_dsn() -> str
2025-08-20T07:01:18.1328692Z ```
2025-08-20T07:01:18.1328774Z 
2025-08-20T07:01:18.1328902Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T07:01:18.1329139Z 
2025-08-20T07:01:18.1329225Z <a id="common.db.refresh_mvs"></a>
2025-08-20T07:01:18.1329386Z 
2025-08-20T07:01:18.1329458Z #### refresh\_mvs
2025-08-20T07:01:18.1329564Z 
2025-08-20T07:01:18.1329628Z ```python
2025-08-20T07:01:18.1329829Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T07:01:18.1330081Z ```
2025-08-20T07:01:18.1330166Z 
2025-08-20T07:01:18.1330437Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T07:01:18.1330655Z 
2025-08-20T07:01:18.1330734Z <a id="common.config"></a>
2025-08-20T07:01:18.1330873Z 
2025-08-20T07:01:18.1330940Z # common.config
2025-08-20T07:01:18.1331046Z 
2025-08-20T07:01:18.1331128Z <a id="common.base"></a>
2025-08-20T07:01:18.1331251Z 
2025-08-20T07:01:18.1331316Z # common.base
2025-08-20T07:01:18.1331415Z 
2025-08-20T07:01:18.1331501Z <a id="common.base.Base"></a>
2025-08-20T07:01:18.1331640Z 
2025-08-20T07:01:18.1331707Z ## Base Objects
2025-08-20T07:01:18.1331811Z 
2025-08-20T07:01:18.1331872Z ```python
2025-08-20T07:01:18.1332036Z class Base(DeclarativeBase)
2025-08-20T07:01:18.1332231Z ```
2025-08-20T07:01:18.1332310Z 
2025-08-20T07:01:18.1332401Z Base class for SQLAlchemy models.
2025-08-20T07:01:18.1332556Z 
2025-08-20T07:01:18.1332628Z <a id="repricer"></a>
2025-08-20T07:01:18.1332746Z 
2025-08-20T07:01:18.1332817Z # repricer
2025-08-20T07:01:18.1332909Z 
2025-08-20T07:01:18.1333001Z <a id="repricer.app.schemas"></a>
2025-08-20T07:01:18.1333166Z 
2025-08-20T07:01:18.1333243Z # repricer.app.schemas
2025-08-20T07:01:18.1333367Z 
2025-08-20T07:01:18.1333458Z <a id="repricer.app.deps"></a>
2025-08-20T07:01:18.1333604Z 
2025-08-20T07:01:18.1333677Z # repricer.app.deps
2025-08-20T07:01:18.1333791Z 
2025-08-20T07:01:18.1333916Z Placeholder module for Keepa / SP-API clients.
2025-08-20T07:01:18.1334122Z 
2025-08-20T07:01:18.1334210Z <a id="repricer.app.logic"></a>
2025-08-20T07:01:18.1334369Z 
2025-08-20T07:01:18.1334444Z # repricer.app.logic
2025-08-20T07:01:18.1334563Z 
2025-08-20T07:01:18.1334663Z <a id="repricer.app.logic.MIN_MARGIN"></a>
2025-08-20T07:01:18.1334851Z 
2025-08-20T07:01:18.1334917Z #### MIN\_MARGIN
2025-08-20T07:01:18.1335020Z 
2025-08-20T07:01:18.1335090Z 15 % ROI
2025-08-20T07:01:18.1335178Z 
2025-08-20T07:01:18.1335283Z <a id="repricer.app.logic.compute_price"></a>
2025-08-20T07:01:18.1335472Z 
2025-08-20T07:01:18.1335542Z #### compute\_price
2025-08-20T07:01:18.1335762Z 
2025-08-20T07:01:18.1335941Z ```python
2025-08-20T07:01:18.1336208Z def compute_price(asin: str, cost: Decimal, fees: Decimal) -> Decimal
2025-08-20T07:01:18.1336525Z ```
2025-08-20T07:01:18.1336613Z 
2025-08-20T07:01:18.1336723Z Toy algorithm: ensure 15 % ROI and round to cents.
2025-08-20T07:01:18.1337012Z Replace with real competitive logic later.
2025-08-20T07:01:18.1337194Z 
2025-08-20T07:01:18.1337279Z <a id="repricer.app.main"></a>
2025-08-20T07:01:18.1337432Z 
2025-08-20T07:01:18.1337505Z # repricer.app.main
2025-08-20T07:01:18.1337617Z 
2025-08-20T07:01:18.1337695Z <a id="repricer.app"></a>
2025-08-20T07:01:18.1337835Z 
2025-08-20T07:01:18.1337904Z # repricer.app
2025-08-20T07:01:18.1338006Z 
2025-08-20T07:01:18.1338110Z <a id="repricer.tests.test_imports"></a>
2025-08-20T07:01:18.1338292Z 
2025-08-20T07:01:18.1338378Z # repricer.tests.test\_imports
2025-08-20T07:01:18.1338531Z 
2025-08-20T07:01:18.1338622Z <a id="repricer.tests.test_smoke"></a>
2025-08-20T07:01:18.1338790Z 
2025-08-20T07:01:18.1338875Z # repricer.tests.test\_smoke
2025-08-20T07:01:18.1339029Z 
2025-08-20T07:01:18.1339108Z <a id="repricer.tests"></a>
2025-08-20T07:01:18.1339243Z 
2025-08-20T07:01:18.1339321Z # repricer.tests
2025-08-20T07:01:18.1339427Z 
2025-08-20T07:01:18.1339491Z <a id="db"></a>
2025-08-20T07:01:18.1339599Z 
2025-08-20T07:01:18.1339659Z # db
2025-08-20T07:01:18.1339743Z 
2025-08-20T07:01:18.1339819Z <a id="db.utils.views"></a>
2025-08-20T07:01:18.1339955Z 
2025-08-20T07:01:18.1340021Z # db.utils.views
2025-08-20T07:01:18.1340126Z 
2025-08-20T07:01:18.1340227Z <a id="db.utils.views.replace_view"></a>
2025-08-20T07:01:18.1340397Z 
2025-08-20T07:01:18.1340468Z #### replace\_view
2025-08-20T07:01:18.1340573Z 
2025-08-20T07:01:18.1340646Z ```python
2025-08-20T07:01:18.1340843Z def replace_view(name: str, new_sql: str) -> None
2025-08-20T07:01:18.1341099Z ```
2025-08-20T07:01:18.1341184Z 
2025-08-20T07:01:18.1341274Z Drop and recreate a SQL view atomically.
2025-08-20T07:01:18.1341451Z 
2025-08-20T07:01:18.1341527Z <a id="db.utils"></a>
2025-08-20T07:01:18.1341760Z 
2025-08-20T07:01:18.1341831Z # db.utils
2025-08-20T07:01:18.1341924Z 
2025-08-20T07:01:18.1342004Z <a id="price_importer"></a>
2025-08-20T07:01:18.1342137Z 
2025-08-20T07:01:18.1342213Z # price\_importer
2025-08-20T07:01:18.1342321Z 
2025-08-20T07:01:18.1342427Z <a id="price_importer.services_common.dsn"></a>
2025-08-20T07:01:18.1342623Z 
2025-08-20T07:01:18.1342716Z # price\_importer.services\_common.dsn
2025-08-20T07:01:18.1342884Z 
2025-08-20T07:01:18.1343013Z <a id="price_importer.services_common.dsn.build_dsn"></a>
2025-08-20T07:01:18.1343223Z 
2025-08-20T07:01:18.1343287Z #### build\_dsn
2025-08-20T07:01:18.1343389Z 
2025-08-20T07:01:18.1343461Z ```python
2025-08-20T07:01:18.1343632Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:01:18.1343855Z ```
2025-08-20T07:01:18.1343936Z 
2025-08-20T07:01:18.1344002Z Return safe DSN.
2025-08-20T07:01:18.1344113Z 
2025-08-20T07:01:18.1344464Z sync=True → SQLAlchemy (+psycopg) else plain asyncpg.
2025-08-20T07:01:18.1344676Z 
2025-08-20T07:01:18.1344816Z <a id="price_importer.services_common.models_vendor"></a>
2025-08-20T07:01:18.1345028Z 
2025-08-20T07:01:18.1345139Z # price\_importer.services\_common.models\_vendor
2025-08-20T07:01:18.1345343Z 
2025-08-20T07:01:18.1345459Z <a id="price_importer.services_common.db_url"></a>
2025-08-20T07:01:18.1345656Z 
2025-08-20T07:01:18.1345753Z # price\_importer.services\_common.db\_url
2025-08-20T07:01:18.1346042Z 
2025-08-20T07:01:18.1346178Z <a id="price_importer.services_common.db_url.build_url"></a>
2025-08-20T07:01:18.1346401Z 
2025-08-20T07:01:18.1346472Z #### build\_url
2025-08-20T07:01:18.1346574Z 
2025-08-20T07:01:18.1346639Z ```python
2025-08-20T07:01:18.1346822Z def build_url(async_: bool = True) -> str
2025-08-20T07:01:18.1347046Z ```
2025-08-20T07:01:18.1347132Z 
2025-08-20T07:01:18.1347229Z Return Postgres DSN from env or PG_* parts.
2025-08-20T07:01:18.1347408Z 
2025-08-20T07:01:18.1347523Z <a id="price_importer.services_common.keepa"></a>
2025-08-20T07:01:18.1347839Z 
2025-08-20T07:01:18.1347937Z # price\_importer.services\_common.keepa
2025-08-20T07:01:18.1348110Z 
2025-08-20T07:01:18.1348218Z <a id="price_importer.services_common.llm"></a>
2025-08-20T07:01:18.1348405Z 
2025-08-20T07:01:18.1348496Z # price\_importer.services\_common.llm
2025-08-20T07:01:18.1348669Z 
2025-08-20T07:01:18.1348787Z <a id="price_importer.services_common.settings"></a>
2025-08-20T07:01:18.1348988Z 
2025-08-20T07:01:18.1349089Z # price\_importer.services\_common.settings
2025-08-20T07:01:18.1349264Z 
2025-08-20T07:01:18.1349363Z <a id="price_importer.services_common.db"></a>
2025-08-20T07:01:18.1349545Z 
2025-08-20T07:01:18.1349642Z # price\_importer.services\_common.db
2025-08-20T07:01:18.1349808Z 
2025-08-20T07:01:18.1349965Z <a id="price_importer.services_common.db.build_sqlalchemy_url"></a>
2025-08-20T07:01:18.1350219Z 
2025-08-20T07:01:18.1350296Z #### build\_sqlalchemy\_url
2025-08-20T07:01:18.1350433Z 
2025-08-20T07:01:18.1350501Z ```python
2025-08-20T07:01:18.1350676Z def build_sqlalchemy_url() -> str
2025-08-20T07:01:18.1350900Z ```
2025-08-20T07:01:18.1350984Z 
2025-08-20T07:01:18.1351083Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T07:01:18.1351269Z 
2025-08-20T07:01:18.1351417Z <a id="price_importer.services_common.db.build_asyncpg_dsn"></a>
2025-08-20T07:01:18.1351650Z 
2025-08-20T07:01:18.1351726Z #### build\_asyncpg\_dsn
2025-08-20T07:01:18.1351858Z 
2025-08-20T07:01:18.1351921Z ```python
2025-08-20T07:01:18.1352098Z def build_asyncpg_dsn() -> str
2025-08-20T07:01:18.1352301Z ```
2025-08-20T07:01:18.1352383Z 
2025-08-20T07:01:18.1352518Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T07:01:18.1352735Z 
2025-08-20T07:01:18.1352865Z <a id="price_importer.services_common.db.refresh_mvs"></a>
2025-08-20T07:01:18.1353085Z 
2025-08-20T07:01:18.1353154Z #### refresh\_mvs
2025-08-20T07:01:18.1353261Z 
2025-08-20T07:01:18.1353333Z ```python
2025-08-20T07:01:18.1353533Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T07:01:18.1353800Z ```
2025-08-20T07:01:18.1353999Z 
2025-08-20T07:01:18.1354140Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T07:01:18.1354371Z 
2025-08-20T07:01:18.1354470Z <a id="price_importer.services_common"></a>
2025-08-20T07:01:18.1354648Z 
2025-08-20T07:01:18.1354734Z # price\_importer.services\_common
2025-08-20T07:01:18.1354903Z 
2025-08-20T07:01:18.1355008Z <a id="price_importer.services_common.base"></a>
2025-08-20T07:01:18.1355197Z 
2025-08-20T07:01:18.1355295Z # price\_importer.services\_common.base
2025-08-20T07:01:18.1355465Z 
2025-08-20T07:01:18.1355556Z <a id="price_importer.normaliser"></a>
2025-08-20T07:01:18.1355729Z 
2025-08-20T07:01:18.1355962Z # price\_importer.normaliser
2025-08-20T07:01:18.1356175Z 
2025-08-20T07:01:18.1356288Z <a id="price_importer.common.models_vendor"></a>
2025-08-20T07:01:18.1356486Z 
2025-08-20T07:01:18.1356576Z # price\_importer.common.models\_vendor
2025-08-20T07:01:18.1356746Z 
2025-08-20T07:01:18.1356846Z <a id="price_importer.common.db_url"></a>
2025-08-20T07:01:18.1357026Z 
2025-08-20T07:01:18.1357116Z # price\_importer.common.db\_url
2025-08-20T07:01:18.1357271Z 
2025-08-20T07:01:18.1357377Z <a id="price_importer.common.db_url.make_dsn"></a>
2025-08-20T07:01:18.1357568Z 
2025-08-20T07:01:18.1357634Z #### make\_dsn
2025-08-20T07:01:18.1357741Z 
2025-08-20T07:01:18.1357803Z ```python
2025-08-20T07:01:18.1357990Z def make_dsn(async_: bool = False) -> str
2025-08-20T07:01:18.1358217Z ```
2025-08-20T07:01:18.1358301Z 
2025-08-20T07:01:18.1358429Z Return DSN built from either PG_* or POSTGRES_* vars.
2025-08-20T07:01:18.1358632Z 
2025-08-20T07:01:18.1358740Z <a id="price_importer.common.db_url.build_url"></a>
2025-08-20T07:01:18.1358941Z 
2025-08-20T07:01:18.1359005Z #### build\_url
2025-08-20T07:01:18.1359107Z 
2025-08-20T07:01:18.1359170Z ```python
2025-08-20T07:01:18.1359352Z def build_url(async_: bool = False) -> str
2025-08-20T07:01:18.1359588Z ```
2025-08-20T07:01:18.1359669Z 
2025-08-20T07:01:18.1359792Z Return Postgres DSN built from environment variables.
2025-08-20T07:01:18.1360128Z 
2025-08-20T07:01:18.1360222Z <a id="price_importer.common"></a>
2025-08-20T07:01:18.1360377Z 
2025-08-20T07:01:18.1360455Z # price\_importer.common
2025-08-20T07:01:18.1360593Z 
2025-08-20T07:01:18.1360684Z <a id="price_importer.common.base"></a>
2025-08-20T07:01:18.1360855Z 
2025-08-20T07:01:18.1360945Z # price\_importer.common.base
2025-08-20T07:01:18.1361087Z 
2025-08-20T07:01:18.1361184Z <a id="price_importer.tests.conftest"></a>
2025-08-20T07:01:18.1361361Z 
2025-08-20T07:01:18.1361454Z # price\_importer.tests.conftest
2025-08-20T07:01:18.1361606Z 
2025-08-20T07:01:18.1361703Z <a id="price_importer.tests.test_reader"></a>
2025-08-20T07:01:18.1361895Z 
2025-08-20T07:01:18.1361983Z # price\_importer.tests.test\_reader
2025-08-20T07:01:18.1362145Z 
2025-08-20T07:01:18.1362253Z <a id="price_importer.tests.test_imports"></a>
2025-08-20T07:01:18.1362458Z 
2025-08-20T07:01:18.1362549Z # price\_importer.tests.test\_imports
2025-08-20T07:01:18.1362721Z 
2025-08-20T07:01:18.1362822Z <a id="price_importer.tests.test_smoke"></a>
2025-08-20T07:01:18.1363002Z 
2025-08-20T07:01:18.1363090Z # price\_importer.tests.test\_smoke
2025-08-20T07:01:18.1363257Z 
2025-08-20T07:01:18.1363365Z <a id="price_importer.tests.test_normaliser"></a>
2025-08-20T07:01:18.1363555Z 
2025-08-20T07:01:18.1363653Z # price\_importer.tests.test\_normaliser
2025-08-20T07:01:18.1363822Z 
2025-08-20T07:01:18.1363907Z <a id="price_importer.tests"></a>
2025-08-20T07:01:18.1364069Z 
2025-08-20T07:01:18.1364146Z # price\_importer.tests
2025-08-20T07:01:18.1364272Z 
2025-08-20T07:01:18.1364357Z <a id="price_importer.reader"></a>
2025-08-20T07:01:18.1364519Z 
2025-08-20T07:01:18.1364596Z # price\_importer.reader
2025-08-20T07:01:18.1364723Z 
2025-08-20T07:01:18.1364818Z <a id="price_importer.repository"></a>
2025-08-20T07:01:18.1364983Z 
2025-08-20T07:01:18.1365069Z # price\_importer.repository
2025-08-20T07:01:18.1365212Z 
2025-08-20T07:01:18.1365305Z <a id="price_importer.import"></a>
2025-08-20T07:01:18.1365464Z 
2025-08-20T07:01:18.1365543Z # price\_importer.import
2025-08-20T07:01:18.1365789Z 
2025-08-20T07:01:18.1365963Z <a id="fees_h10"></a>
2025-08-20T07:01:18.1366085Z 
2025-08-20T07:01:18.1366155Z # fees\_h10
2025-08-20T07:01:18.1366249Z 
2025-08-20T07:01:18.1366326Z <a id="fees_h10.worker"></a>
2025-08-20T07:01:18.1366462Z 
2025-08-20T07:01:18.1366538Z # fees\_h10.worker
2025-08-20T07:01:18.1366647Z 
2025-08-20T07:01:18.1366744Z <a id="fees_h10.worker.list_active_asins"></a>
2025-08-20T07:01:18.1366932Z 
2025-08-20T07:01:18.1367006Z #### list\_active\_asins
2025-08-20T07:01:18.1367128Z 
2025-08-20T07:01:18.1367190Z ```python
2025-08-20T07:01:18.1367370Z def list_active_asins() -> list[str]
2025-08-20T07:01:18.1367592Z ```
2025-08-20T07:01:18.1367674Z 
2025-08-20T07:01:18.1367787Z Return known ASINs or an empty list if unavailable.
2025-08-20T07:01:18.1367986Z 
2025-08-20T07:01:18.1368075Z <a id="fees_h10.tests.test_smoke"></a>
2025-08-20T07:01:18.1368236Z 
2025-08-20T07:01:18.1368316Z # fees\_h10.tests.test\_smoke
2025-08-20T07:01:18.1368464Z 
2025-08-20T07:01:18.1368542Z <a id="fees_h10.tests"></a>
2025-08-20T07:01:18.1368673Z 
2025-08-20T07:01:18.1368746Z # fees\_h10.tests
2025-08-20T07:01:18.1368852Z 
2025-08-20T07:01:18.1368925Z <a id="fees_h10.client"></a>
2025-08-20T07:01:18.1369057Z 
2025-08-20T07:01:18.1369128Z # fees\_h10.client
2025-08-20T07:01:18.1369234Z 
2025-08-20T07:01:18.1369316Z <a id="fees_h10.repository"></a>
2025-08-20T07:01:18.1369466Z 
2025-08-20T07:01:18.1369538Z # fees\_h10.repository
2025-08-20T07:01:18.1369657Z 
2025-08-20T07:01:18.1369761Z <a id="fees_h10.repository.upsert_fees_raw"></a>
2025-08-20T07:01:18.1369953Z 
2025-08-20T07:01:18.1370023Z #### upsert\_fees\_raw
2025-08-20T07:01:18.1370139Z 
2025-08-20T07:01:18.1370208Z ```python
2025-08-20T07:01:18.1370380Z def upsert_fees_raw(engine: Engine,
2025-08-20T07:01:18.1370635Z                     rows: Iterable[Mapping[str, Any]],
2025-08-20T07:01:18.1370888Z                     *,
2025-08-20T07:01:18.1371121Z                     testing: bool = False) -> Optional[Dict[str, int]]
2025-08-20T07:01:18.1371645Z ```
2025-08-20T07:01:18.1371734Z 
2025-08-20T07:01:18.1371815Z Idempotent upsert for fees.
2025-08-20T07:01:18.1371952Z 
2025-08-20T07:01:18.1372112Z TESTING-only: returns counts for inserted/updated/skipped rows.
2025-08-20T07:01:18.1372459Z Assumes logical key (asin, marketplace, fee_type).
2025-08-20T07:01:18.1372773Z Only updates when one of the mutable fields changes.
2025-08-20T07:01:18.1372973Z 
2025-08-20T07:01:18.1373045Z <a id="emailer"></a>
2025-08-20T07:01:18.1373161Z 
2025-08-20T07:01:18.1373223Z # emailer
2025-08-20T07:01:18.1373313Z 
2025-08-20T07:01:18.1373422Z <a id="emailer.tests.test_import_emailer"></a>
2025-08-20T07:01:18.1373606Z 
2025-08-20T07:01:18.1373696Z # emailer.tests.test\_import\_emailer
2025-08-20T07:01:18.1373861Z 
2025-08-20T07:01:18.1373954Z <a id="emailer.tests.test_smoke"></a>
2025-08-20T07:01:18.1374111Z 
2025-08-20T07:01:18.1374195Z # emailer.tests.test\_smoke
2025-08-20T07:01:18.1374338Z 
2025-08-20T07:01:18.1374419Z <a id="emailer.tests"></a>
2025-08-20T07:01:18.1374553Z 
2025-08-20T07:01:18.1374627Z # emailer.tests
2025-08-20T07:01:18.1374730Z 
2025-08-20T07:01:18.1374816Z <a id="emailer.generate_body"></a>
2025-08-20T07:01:18.1374970Z 
2025-08-20T07:01:18.1375052Z # emailer.generate\_body
2025-08-20T07:01:18.1375179Z 
2025-08-20T07:01:18.1375251Z <a id="llm_server"></a>
2025-08-20T07:01:18.1375375Z 
2025-08-20T07:01:18.1375439Z # llm\_server
2025-08-20T07:01:18.1375537Z 
2025-08-20T07:01:18.1375615Z <a id="llm_server.app"></a>
2025-08-20T07:01:18.1375753Z 
2025-08-20T07:01:18.1375915Z # llm\_server.app
2025-08-20T07:01:18.1376030Z 
