2025-08-20T07:35:20.3905768Z ##[group]Run pydoc-markdown
2025-08-20T07:35:20.3906050Z [36;1mpydoc-markdown[0m
2025-08-20T07:35:20.3946695Z shell: /usr/bin/bash -e {0}
2025-08-20T07:35:20.3946921Z env:
2025-08-20T07:35:20.3947152Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:35:20.3947554Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-08-20T07:35:20.3947942Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:35:20.3948287Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:35:20.3948621Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T07:35:20.3948951Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-08-20T07:35:20.3949232Z ##[endgroup]
2025-08-20T07:35:20.6985607Z [WARNING - pydoc_markdown.main]: Unknown configuration options:
2025-08-20T07:35:20.6986428Z Unknown key(s) "{'output_directory'}" at:
2025-08-20T07:35:20.6986848Z In "pydoc-markdown.yml"
2025-08-20T07:35:20.6987243Z   $: TypeHint(pydoc_markdown.PydocMarkdown)
2025-08-20T07:35:20.6987820Z   .renderer: TypeHint(pydoc_markdown.interfaces.Renderer)
2025-08-20T07:35:20.6988483Z   ^: TypeHint(pydoc_markdown.contrib.renderers.markdown.MarkdownRenderer)
2025-08-20T07:35:20.6988936Z 
2025-08-20T07:35:21.0703679Z <a id="__init__"></a>
2025-08-20T07:35:21.0704024Z 
2025-08-20T07:35:21.0704157Z # \_\_init\_\_
2025-08-20T07:35:21.0704347Z 
2025-08-20T07:35:21.0704472Z <a id="api"></a>
2025-08-20T07:35:21.0704668Z 
2025-08-20T07:35:21.0704789Z # api
2025-08-20T07:35:21.0704947Z 
2025-08-20T07:35:21.0705086Z <a id="api.errors"></a>
2025-08-20T07:35:21.0705325Z 
2025-08-20T07:35:21.0705442Z # api.errors
2025-08-20T07:35:21.0705621Z 
2025-08-20T07:35:21.0705770Z <a id="api.sentry_config"></a>
2025-08-20T07:35:21.0706040Z 
2025-08-20T07:35:21.0706175Z # api.sentry\_config
2025-08-20T07:35:21.0706385Z 
2025-08-20T07:35:21.0706574Z <a id="api.tests.test_stats_contracts"></a>
2025-08-20T07:35:21.0706895Z 
2025-08-20T07:35:21.0707513Z # api.tests.test\_stats\_contracts
2025-08-20T07:35:21.0707831Z 
2025-08-20T07:35:21.0707998Z <a id="api.tests.test_sentry_scrub"></a>
2025-08-20T07:35:21.0708301Z 
2025-08-20T07:35:21.0708444Z # api.tests.test\_sentry\_scrub
2025-08-20T07:35:21.0708708Z 
2025-08-20T07:35:21.0708882Z <a id="api.tests.test_roi_basic_auth"></a>
2025-08-20T07:35:21.0709197Z 
2025-08-20T07:35:21.0709351Z # api.tests.test\_roi\_basic\_auth
2025-08-20T07:35:21.0709625Z 
2025-08-20T07:35:21.0709780Z <a id="api.tests.test_errors_json"></a>
2025-08-20T07:35:21.0710083Z 
2025-08-20T07:35:21.0710224Z # api.tests.test\_errors\_json
2025-08-20T07:35:21.0710477Z 
2025-08-20T07:35:21.0710619Z <a id="api.tests.test_llm"></a>
2025-08-20T07:35:21.0710878Z 
2025-08-20T07:35:21.0711254Z # api.tests.test\_llm
2025-08-20T07:35:21.0711476Z 
2025-08-20T07:35:21.0711639Z <a id="api.tests.test_roi_filters"></a>
2025-08-20T07:35:21.0711931Z 
2025-08-20T07:35:21.0712073Z # api.tests.test\_roi\_filters
2025-08-20T07:35:21.0712328Z 
2025-08-20T07:35:21.0712739Z <a id="api.tests.test_sentry_event"></a>
2025-08-20T07:35:21.0713087Z 
2025-08-20T07:35:21.0713239Z # api.tests.test\_sentry\_event
2025-08-20T07:35:21.0713505Z 
2025-08-20T07:35:21.0713730Z <a id="api.tests.test_sentry_event.DummyTransport"></a>
2025-08-20T07:35:21.0714097Z 
2025-08-20T07:35:21.0714243Z ## DummyTransport Objects
2025-08-20T07:35:21.0714478Z 
2025-08-20T07:35:21.0714594Z ```python
2025-08-20T07:35:21.0714893Z class DummyTransport()
2025-08-20T07:35:21.0715209Z ```
2025-08-20T07:35:21.0715363Z 
2025-08-20T07:35:21.0715667Z <a id="api.tests.test_sentry_event.DummyTransport.capture_envelope"></a>
2025-08-20T07:35:21.0716130Z 
2025-08-20T07:35:21.0716268Z #### capture\_envelope
2025-08-20T07:35:21.0716475Z 
2025-08-20T07:35:21.0716587Z ```python
2025-08-20T07:35:21.0716906Z def capture_envelope(envelope)
2025-08-20T07:35:21.0717261Z ```
2025-08-20T07:35:21.0717414Z 
2025-08-20T07:35:21.0717637Z Capture events sent as envelopes by Sentry SDK >= 2.0.
2025-08-20T07:35:21.0718018Z 
2025-08-20T07:35:21.0718176Z <a id="api.tests.test_cors"></a>
2025-08-20T07:35:21.0718842Z 
2025-08-20T07:35:21.0718987Z # api.tests.test\_cors
2025-08-20T07:35:21.0719210Z 
2025-08-20T07:35:21.0719372Z <a id="api.tests.test_imports"></a>
2025-08-20T07:35:21.0719657Z 
2025-08-20T07:35:21.0719799Z # api.tests.test\_imports
2025-08-20T07:35:21.0720035Z 
2025-08-20T07:35:21.0720191Z <a id="api.tests.test_rate_limit"></a>
2025-08-20T07:35:21.0720479Z 
2025-08-20T07:35:21.0720622Z # api.tests.test\_rate\_limit
2025-08-20T07:35:21.0720878Z 
2025-08-20T07:35:21.0721050Z <a id="api.tests.test_rate_limit.app"></a>
2025-08-20T07:35:21.0721359Z 
2025-08-20T07:35:21.0721480Z #### app
2025-08-20T07:35:21.0721640Z 
2025-08-20T07:35:21.0721752Z noqa: E402
2025-08-20T07:35:21.0721911Z 
2025-08-20T07:35:21.0722071Z <a id="api.tests.test_stats_sql"></a>
2025-08-20T07:35:21.0722360Z 
2025-08-20T07:35:21.0722719Z # api.tests.test\_stats\_sql
2025-08-20T07:35:21.0722983Z 
2025-08-20T07:35:21.0723144Z <a id="api.tests.test_entrypoint"></a>
2025-08-20T07:35:21.0723457Z 
2025-08-20T07:35:21.0723611Z # api.tests.test\_entrypoint
2025-08-20T07:35:21.0723863Z 
2025-08-20T07:35:21.0724062Z <a id="api.tests.test_stats_future_contracts"></a>
2025-08-20T07:35:21.0724408Z 
2025-08-20T07:35:21.0724590Z # api.tests.test\_stats\_future\_contracts
2025-08-20T07:35:21.0724896Z 
2025-08-20T07:35:21.0725044Z <a id="api.tests.test_health"></a>
2025-08-20T07:35:21.0725329Z 
2025-08-20T07:35:21.0725463Z # api.tests.test\_health
2025-08-20T07:35:21.0725692Z 
2025-08-20T07:35:21.0725846Z <a id="api.tests.test_score"></a>
2025-08-20T07:35:21.0726114Z 
2025-08-20T07:35:21.0726249Z # api.tests.test\_score
2025-08-20T07:35:21.0726472Z 
2025-08-20T07:35:21.0726627Z <a id="api.logging_config"></a>
2025-08-20T07:35:21.0726876Z 
2025-08-20T07:35:21.0727004Z # api.logging\_config
2025-08-20T07:35:21.0727217Z 
2025-08-20T07:35:21.0727369Z <a id="api.migrations.env"></a>
2025-08-20T07:35:21.0727628Z 
2025-08-20T07:35:21.0727766Z # api.migrations.env
2025-08-20T07:35:21.0728208Z 
2025-08-20T07:35:21.0728435Z <a id="api.migrations.versions.0022_fix_roi_view"></a>
2025-08-20T07:35:21.0728788Z 
2025-08-20T07:35:21.0728981Z # api.migrations.versions.0022\_fix\_roi\_view
2025-08-20T07:35:21.0729307Z 
2025-08-20T07:35:21.0729504Z <a id="api.migrations.versions.0004_fee_cron"></a>
2025-08-20T07:35:21.0729847Z 
2025-08-20T07:35:21.0730021Z # api.migrations.versions.0004\_fee\_cron
2025-08-20T07:35:21.0730330Z 
2025-08-20T07:35:21.0730613Z <a id="api.migrations.versions.3e9d5c5aff2c_rename_fulf_fee"></a>
2025-08-20T07:35:21.0731032Z 
2025-08-20T07:35:21.0731275Z # api.migrations.versions.3e9d5c5aff2c\_rename\_fulf\_fee
2025-08-20T07:35:21.0731661Z 
2025-08-20T07:35:21.0731893Z <a id="api.migrations.versions.0003_vendor_prices"></a>
2025-08-20T07:35:21.0732249Z 
2025-08-20T07:35:21.0732443Z # api.migrations.versions.0003\_vendor\_prices
2025-08-20T07:35:21.0732966Z 
2025-08-20T07:35:21.0733189Z <a id="api.migrations.versions.0024_create_buybox"></a>
2025-08-20T07:35:21.0733672Z 
2025-08-20T07:35:21.0733882Z # api.migrations.versions.0024\_create\_buybox
2025-08-20T07:35:21.0734262Z 
2025-08-20T07:35:21.0734489Z <a id="api.migrations.versions.0002_create_roi_view"></a>
2025-08-20T07:35:21.0734867Z 
2025-08-20T07:35:21.0735070Z # api.migrations.versions.0002\_create\_roi\_view
2025-08-20T07:35:21.0735409Z 
2025-08-20T07:35:21.0735633Z <a id="api.migrations.versions.0006_fix_roi_views"></a>
2025-08-20T07:35:21.0735982Z 
2025-08-20T07:35:21.0736171Z # api.migrations.versions.0006\_fix\_roi\_views
2025-08-20T07:35:21.0736510Z 
2025-08-20T07:35:21.0736731Z <a id="api.migrations.versions.0020_unified_schema"></a>
2025-08-20T07:35:21.0737092Z 
2025-08-20T07:35:21.0737288Z # api.migrations.versions.0020\_unified\_schema
2025-08-20T07:35:21.0737618Z 
2025-08-20T07:35:21.0737861Z <a id="api.migrations.versions.0025_pr4_indexes_loadlog"></a>
2025-08-20T07:35:21.0738254Z 
2025-08-20T07:35:21.0738477Z # api.migrations.versions.0025\_pr4\_indexes\_loadlog
2025-08-20T07:35:21.0738840Z 
2025-08-20T07:35:21.0739077Z <a id="api.migrations.versions.0023_add_storage_fee"></a>
2025-08-20T07:35:21.0739756Z 
2025-08-20T07:35:21.0739962Z # api.migrations.versions.0023\_add\_storage\_fee
2025-08-20T07:35:21.0740308Z 
2025-08-20T07:35:21.0740563Z <a id="api.migrations.versions.0026_amazon_new_reports"></a>
2025-08-20T07:35:21.0740953Z 
2025-08-20T07:35:21.0741158Z # api.migrations.versions.0026\_amazon\_new\_reports
2025-08-20T07:35:21.0741524Z 
2025-08-20T07:35:21.0741724Z <a id="api.migrations.versions.0001_baseline"></a>
2025-08-20T07:35:21.0742062Z 
2025-08-20T07:35:21.0742229Z # api.migrations.versions.0001\_baseline
2025-08-20T07:35:21.0742812Z 
2025-08-20T07:35:21.0742982Z <a id="api.migrations.versions"></a>
2025-08-20T07:35:21.0743272Z 
2025-08-20T07:35:21.0743425Z # api.migrations.versions
2025-08-20T07:35:21.0743707Z 
2025-08-20T07:35:21.0743845Z <a id="api.migrations"></a>
2025-08-20T07:35:21.0744090Z 
2025-08-20T07:35:21.0744214Z # api.migrations
2025-08-20T07:35:21.0744402Z 
2025-08-20T07:35:21.0744535Z <a id="api.db"></a>
2025-08-20T07:35:21.0744742Z 
2025-08-20T07:35:21.0744855Z # api.db
2025-08-20T07:35:21.0745088Z 
2025-08-20T07:35:21.0745252Z <a id="api.routes.score"></a>
2025-08-20T07:35:21.0745511Z 
2025-08-20T07:35:21.0745641Z # api.routes.score
2025-08-20T07:35:21.0745839Z 
2025-08-20T07:35:21.0745988Z <a id="api.routes.stats"></a>
2025-08-20T07:35:21.0746233Z 
2025-08-20T07:35:21.0746354Z # api.routes.stats
2025-08-20T07:35:21.0746552Z 
2025-08-20T07:35:21.0746688Z <a id="api.routes.roi"></a>
2025-08-20T07:35:21.0746924Z 
2025-08-20T07:35:21.0747051Z # api.routes.roi
2025-08-20T07:35:21.0747238Z 
2025-08-20T07:35:21.0747381Z <a id="api.routes.health"></a>
2025-08-20T07:35:21.0747628Z 
2025-08-20T07:35:21.0747759Z # api.routes.health
2025-08-20T07:35:21.0747956Z 
2025-08-20T07:35:21.0748119Z <a id="api.routes.health.MAX_SKEW"></a>
2025-08-20T07:35:21.0748424Z 
2025-08-20T07:35:21.0748536Z #### MAX\_SKEW
2025-08-20T07:35:21.0748711Z 
2025-08-20T07:35:21.0748823Z seconds
2025-08-20T07:35:21.0749225Z 
2025-08-20T07:35:21.0749388Z <a id="api.routes.health.health"></a>
2025-08-20T07:35:21.0749686Z 
2025-08-20T07:35:21.0749807Z #### health
2025-08-20T07:35:21.0749970Z 
2025-08-20T07:35:21.0750083Z ```python
2025-08-20T07:35:21.0750439Z @router.get("/health", include_in_schema=False)
2025-08-20T07:35:21.0751136Z async def health(session: AsyncSession = Depends(get_session)) -> JSONResponse
2025-08-20T07:35:21.0751736Z ```
2025-08-20T07:35:21.0751885Z 
2025-08-20T07:35:21.0752091Z Return 200 when DB reachable and clocks are in sync.
2025-08-20T07:35:21.0752448Z 
2025-08-20T07:35:21.0752787Z <a id="api.routes.repository"></a>
2025-08-20T07:35:21.0753075Z 
2025-08-20T07:35:21.0753225Z # api.routes.repository
2025-08-20T07:35:21.0753449Z 
2025-08-20T07:35:21.0753578Z <a id="api.routes"></a>
2025-08-20T07:35:21.0753797Z 
2025-08-20T07:35:21.0753912Z # api.routes
2025-08-20T07:35:21.0754090Z 
2025-08-20T07:35:21.0754231Z <a id="api.models.fee"></a>
2025-08-20T07:35:21.0754483Z 
2025-08-20T07:35:21.0754609Z # api.models.fee
2025-08-20T07:35:21.0754819Z 
2025-08-20T07:35:21.0754981Z <a id="api.models"></a>
2025-08-20T07:35:21.0755197Z 
2025-08-20T07:35:21.0755310Z # api.models
2025-08-20T07:35:21.0755482Z 
2025-08-20T07:35:21.0755630Z <a id="api.roi_repository"></a>
2025-08-20T07:35:21.0755882Z 
2025-08-20T07:35:21.0756012Z # api.roi\_repository
2025-08-20T07:35:21.0756227Z 
2025-08-20T07:35:21.0756353Z <a id="api.main"></a>
2025-08-20T07:35:21.0756553Z 
2025-08-20T07:35:21.0756665Z # api.main
2025-08-20T07:35:21.0756834Z 
2025-08-20T07:35:21.0756971Z <a id="api.main.ready"></a>
2025-08-20T07:35:21.0757202Z 
2025-08-20T07:35:21.0757321Z #### ready
2025-08-20T07:35:21.0757479Z 
2025-08-20T07:35:21.0757592Z ```python
2025-08-20T07:35:21.0758054Z @app.get("/ready", status_code=status.HTTP_200_OK, include_in_schema=False)
2025-08-20T07:35:21.0758800Z async def ready(session: AsyncSession = Depends(get_session)) -> dict[str,
2025-08-20T07:35:21.0759329Z                                                                       str]
2025-08-20T07:35:21.0759674Z ```
2025-08-20T07:35:21.0759994Z 
2025-08-20T07:35:21.0760133Z Return 200 only when migrations are at head.
2025-08-20T07:35:21.0760398Z 
2025-08-20T07:35:21.0760511Z <a id="api.config"></a>
2025-08-20T07:35:21.0760686Z 
2025-08-20T07:35:21.0760785Z # api.config
2025-08-20T07:35:21.0760929Z 
2025-08-20T07:35:21.0761037Z <a id="api.security"></a>
2025-08-20T07:35:21.0761223Z 
2025-08-20T07:35:21.0761320Z # api.security
2025-08-20T07:35:21.0761472Z 
2025-08-20T07:35:21.0761568Z <a id="etl"></a>
2025-08-20T07:35:21.0761717Z 
2025-08-20T07:35:21.0761809Z # etl
2025-08-20T07:35:21.0761933Z 
2025-08-20T07:35:21.0762053Z <a id="etl.fba_fee_ingestor"></a>
2025-08-20T07:35:21.0762275Z 
2025-08-20T07:35:21.0762381Z # etl.fba\_fee\_ingestor
2025-08-20T07:35:21.0762753Z 
2025-08-20T07:35:21.0762879Z <a id="etl.sp_fees_ingestor"></a>
2025-08-20T07:35:21.0763101Z 
2025-08-20T07:35:21.0763207Z # etl.sp\_fees\_ingestor
2025-08-20T07:35:21.0763384Z 
2025-08-20T07:35:21.0763506Z <a id="etl.keepa_ingestor"></a>
2025-08-20T07:35:21.0763723Z 
2025-08-20T07:35:21.0763826Z # etl.keepa\_ingestor
2025-08-20T07:35:21.0763993Z 
2025-08-20T07:35:21.0764102Z <a id="etl.db"></a>
2025-08-20T07:35:21.0764262Z 
2025-08-20T07:35:21.0764359Z # etl.db
2025-08-20T07:35:21.0764499Z 
2025-08-20T07:35:21.0764627Z <a id="etl.dialects.schemas"></a>
2025-08-20T07:35:21.0764867Z 
2025-08-20T07:35:21.0764989Z # etl.dialects.schemas
2025-08-20T07:35:21.0765180Z 
2025-08-20T07:35:21.0765352Z <a id="etl.dialects.amazon_reimbursements"></a>
2025-08-20T07:35:21.0765642Z 
2025-08-20T07:35:21.0765778Z # etl.dialects.amazon\_reimbursements
2025-08-20T07:35:21.0766008Z 
2025-08-20T07:35:21.0766145Z <a id="etl.dialects.amazon_ads_sp_cost"></a>
2025-08-20T07:35:21.0766402Z 
2025-08-20T07:35:21.0766527Z # etl.dialects.amazon\_ads\_sp\_cost
2025-08-20T07:35:21.0766768Z 
2025-08-20T07:35:21.0766909Z <a id="etl.dialects.test_generic"></a>
2025-08-20T07:35:21.0767173Z 
2025-08-20T07:35:21.0767306Z # etl.dialects.test\_generic
2025-08-20T07:35:21.0767725Z 
2025-08-20T07:35:21.0767883Z <a id="etl.dialects.amazon_returns"></a>
2025-08-20T07:35:21.0768121Z 
2025-08-20T07:35:21.0768233Z # etl.dialects.amazon\_returns
2025-08-20T07:35:21.0768439Z 
2025-08-20T07:35:21.0768572Z <a id="etl.dialects.amazon_fee_preview"></a>
2025-08-20T07:35:21.0768816Z 
2025-08-20T07:35:21.0768938Z # etl.dialects.amazon\_fee\_preview
2025-08-20T07:35:21.0769176Z 
2025-08-20T07:35:21.0769335Z <a id="etl.dialects.amazon_inventory_ledger"></a>
2025-08-20T07:35:21.0769625Z 
2025-08-20T07:35:21.0769777Z # etl.dialects.amazon\_inventory\_ledger
2025-08-20T07:35:21.0770055Z 
2025-08-20T07:35:21.0770211Z <a id="etl.dialects.amazon_settlements"></a>
2025-08-20T07:35:21.0770478Z 
2025-08-20T07:35:21.0770604Z # etl.dialects.amazon\_settlements
2025-08-20T07:35:21.0770822Z 
2025-08-20T07:35:21.0770940Z <a id="etl.dialects"></a>
2025-08-20T07:35:21.0771130Z 
2025-08-20T07:35:21.0771224Z # etl.dialects
2025-08-20T07:35:21.0771373Z 
2025-08-20T07:35:21.0771486Z <a id="ingest"></a>
2025-08-20T07:35:21.0771659Z 
2025-08-20T07:35:21.0771762Z # ingest
2025-08-20T07:35:21.0771904Z 
2025-08-20T07:35:21.0772032Z <a id="ingest.maintenance"></a>
2025-08-20T07:35:21.0772257Z 
2025-08-20T07:35:21.0772371Z # ingest.maintenance
2025-08-20T07:35:21.0772719Z 
2025-08-20T07:35:21.0772844Z <a id="ingest.copy_loader"></a>
2025-08-20T07:35:21.0773065Z 
2025-08-20T07:35:21.0773174Z # ingest.copy\_loader
2025-08-20T07:35:21.0773339Z 
2025-08-20T07:35:21.0773485Z <a id="ingest.copy_loader.copy_df_via_temp"></a>
2025-08-20T07:35:21.0773756Z 
2025-08-20T07:35:21.0773855Z #### copy\_df\_via\_temp
2025-08-20T07:35:21.0774021Z 
2025-08-20T07:35:21.0774106Z ```python
2025-08-20T07:35:21.0774343Z def copy_df_via_temp(engine: Engine,
2025-08-20T07:35:21.0774654Z                      df: pd.DataFrame,
2025-08-20T07:35:21.0774985Z                      target_table: str,
2025-08-20T07:35:21.0775360Z                      *,
2025-08-20T07:35:21.0775697Z                      target_schema: Optional[str] = None,
2025-08-20T07:35:21.0776145Z                      columns: Sequence[str],
2025-08-20T07:35:21.0776767Z                      conflict_cols: Optional[Sequence[str]] = None,
2025-08-20T07:35:21.0777238Z                      analyze_after: bool = False,
2025-08-20T07:35:21.0777674Z                      connection: Any | None = None) -> int
2025-08-20T07:35:21.0778098Z ```
2025-08-20T07:35:21.0778244Z 
2025-08-20T07:35:21.0778529Z Bulk load *df* into *target_table* using COPY and a staging table.
2025-08-20T07:35:21.0778942Z 
2025-08-20T07:35:21.0779095Z <a id="ingest.tests.test_smoke"></a>
2025-08-20T07:35:21.0779378Z 
2025-08-20T07:35:21.0779535Z # ingest.tests.test\_smoke
2025-08-20T07:35:21.0779778Z 
2025-08-20T07:35:21.0779917Z <a id="ingest.tests"></a>
2025-08-20T07:35:21.0780155Z 
2025-08-20T07:35:21.0780274Z # ingest.tests
2025-08-20T07:35:21.0780455Z 
2025-08-20T07:35:21.0780608Z <a id="ingest.upload_router"></a>
2025-08-20T07:35:21.0780872Z 
2025-08-20T07:35:21.0781008Z # ingest.upload\_router
2025-08-20T07:35:21.0781231Z 
2025-08-20T07:35:21.0781390Z <a id="ingest.email_watcher"></a>
2025-08-20T07:35:21.0781654Z 
2025-08-20T07:35:21.0781784Z # ingest.email\_watcher
2025-08-20T07:35:21.0782000Z 
2025-08-20T07:35:21.0782155Z <a id="ingest.email_watcher.main"></a>
2025-08-20T07:35:21.0782441Z 
2025-08-20T07:35:21.0782776Z #### main
2025-08-20T07:35:21.0782944Z 
2025-08-20T07:35:21.0783059Z ```python
2025-08-20T07:35:21.0783361Z def main() -> dict[str, str]
2025-08-20T07:35:21.0783696Z ```
2025-08-20T07:35:21.0783842Z 
2025-08-20T07:35:21.0784099Z Upload CSV/XLSX attachments to MinIO and trigger ingestion.
2025-08-20T07:35:21.0784495Z 
2025-08-20T07:35:21.0784723Z Returns {"status": "success"} when processing completes.
2025-08-20T07:35:21.0785102Z 
2025-08-20T07:35:21.0785240Z <a id="ingest.tasks"></a>
2025-08-20T07:35:21.0785464Z 
2025-08-20T07:35:21.0785585Z # ingest.tasks
2025-08-20T07:35:21.0785796Z 
2025-08-20T07:35:21.0785972Z <a id="ingest.tasks.task_import_file"></a>
2025-08-20T07:35:21.0786280Z 
2025-08-20T07:35:21.0786657Z #### task\_import\_file
2025-08-20T07:35:21.0786888Z 
2025-08-20T07:35:21.0787003Z ```python
2025-08-20T07:35:21.0787371Z @celery_app.task(name="ingest.import_file", bind=True)
2025-08-20T07:35:21.0787869Z def task_import_file(self: Any,
2025-08-20T07:35:21.0788250Z                      uri: str,
2025-08-20T07:35:21.0788636Z                      report_type: str | None = None,
2025-08-20T07:35:21.0789110Z                      force: bool = False) -> dict[str, Any]
2025-08-20T07:35:21.0789523Z ```
2025-08-20T07:35:21.0789676Z 
2025-08-20T07:35:21.0789909Z Import a file into Postgres using existing ETL pipeline.
2025-08-20T07:35:21.0790285Z 
2025-08-20T07:35:21.0790431Z <a id="ingest.celery_app"></a>
2025-08-20T07:35:21.0790687Z 
2025-08-20T07:35:21.0790811Z # ingest.celery\_app
2025-08-20T07:35:21.0791015Z 
2025-08-20T07:35:21.0791165Z <a id="ingest.ingest_router"></a>
2025-08-20T07:35:21.0791431Z 
2025-08-20T07:35:21.0791566Z # ingest.ingest\_router
2025-08-20T07:35:21.0791784Z 
2025-08-20T07:35:21.0791935Z <a id="logistics_etl"></a>
2025-08-20T07:35:21.0792176Z 
2025-08-20T07:35:21.0792297Z # logistics\_etl
2025-08-20T07:35:21.0792677Z 
2025-08-20T07:35:21.0792824Z Daily logistics ETL job.
2025-08-20T07:35:21.0793060Z 
2025-08-20T07:35:21.0793218Z <a id="logistics_etl.__main__"></a>
2025-08-20T07:35:21.0793493Z 
2025-08-20T07:35:21.0793628Z # logistics\_etl.\_\_main\_\_
2025-08-20T07:35:21.0793878Z 
2025-08-20T07:35:21.0794024Z <a id="logistics_etl.dsn"></a>
2025-08-20T07:35:21.0794274Z 
2025-08-20T07:35:21.0794397Z # logistics\_etl.dsn
2025-08-20T07:35:21.0794607Z 
2025-08-20T07:35:21.0794816Z Local DSN builder to avoid cross-service dependency.
2025-08-20T07:35:21.0795172Z 
2025-08-20T07:35:21.0795344Z <a id="logistics_etl.dsn.build_dsn"></a>
2025-08-20T07:35:21.0795641Z 
2025-08-20T07:35:21.0795759Z #### build\_dsn
2025-08-20T07:35:21.0795940Z 
2025-08-20T07:35:21.0796061Z ```python
2025-08-20T07:35:21.0796374Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:35:21.0796774Z ```
2025-08-20T07:35:21.0796929Z 
2025-08-20T07:35:21.0797413Z Return a Postgres DSN assembled from environment variables.
2025-08-20T07:35:21.0797821Z 
2025-08-20T07:35:21.0798089Z Prefers explicit DSNs via ``PG_SYNC_DSN``/``PG_ASYNC_DSN`` or
2025-08-20T07:35:21.0798782Z ``DATABASE_URL``. Falls back to individual PG_* settings and raises an
2025-08-20T07:35:21.0799379Z error when any required variable is missing.
2025-08-20T07:35:21.0799692Z 
2025-08-20T07:35:21.0799871Z <a id="logistics_etl.tests.conftest"></a>
2025-08-20T07:35:21.0800177Z 
2025-08-20T07:35:21.0800323Z # logistics\_etl.tests.conftest
2025-08-20T07:35:21.0800583Z 
2025-08-20T07:35:21.0800766Z <a id="logistics_etl.tests.test_repository"></a>
2025-08-20T07:35:21.0801100Z 
2025-08-20T07:35:21.0801267Z # logistics\_etl.tests.test\_repository
2025-08-20T07:35:21.0801564Z 
2025-08-20T07:35:21.0801729Z <a id="logistics_etl.tests.test_cron"></a>
2025-08-20T07:35:21.0802036Z 
2025-08-20T07:35:21.0802200Z # logistics\_etl.tests.test\_cron
2025-08-20T07:35:21.0802482Z 
2025-08-20T07:35:21.0802857Z <a id="logistics_etl.tests.test_imports"></a>
2025-08-20T07:35:21.0803201Z 
2025-08-20T07:35:21.0803361Z # logistics\_etl.tests.test\_imports
2025-08-20T07:35:21.0803653Z 
2025-08-20T07:35:21.0803831Z <a id="logistics_etl.tests.test_smoke"></a>
2025-08-20T07:35:21.0804138Z 
2025-08-20T07:35:21.0804287Z # logistics\_etl.tests.test\_smoke
2025-08-20T07:35:21.0804557Z 
2025-08-20T07:35:21.0804736Z <a id="logistics_etl.tests.test_client"></a>
2025-08-20T07:35:21.0805042Z 
2025-08-20T07:35:21.0805190Z # logistics\_etl.tests.test\_client
2025-08-20T07:35:21.0805477Z 
2025-08-20T07:35:21.0805622Z <a id="logistics_etl.tests"></a>
2025-08-20T07:35:21.0805879Z 
2025-08-20T07:35:21.0806019Z # logistics\_etl.tests
2025-08-20T07:35:21.0806226Z 
2025-08-20T07:35:21.0806363Z <a id="logistics_etl.flow"></a>
2025-08-20T07:35:21.0806609Z 
2025-08-20T07:35:21.0806747Z # logistics\_etl.flow
2025-08-20T07:35:21.0806955Z 
2025-08-20T07:35:21.0807101Z <a id="logistics_etl.client"></a>
2025-08-20T07:35:21.0807605Z 
2025-08-20T07:35:21.0880541Z # logistics\_etl.client
2025-08-20T07:35:21.0880836Z 
2025-08-20T07:35:21.0880968Z <a id="logistics_etl.cron"></a>
2025-08-20T07:35:21.0881200Z 
2025-08-20T07:35:21.0881325Z # logistics\_etl.cron
2025-08-20T07:35:21.0881503Z 
2025-08-20T07:35:21.0881621Z <a id="logistics_etl.db"></a>
2025-08-20T07:35:21.0881838Z 
2025-08-20T07:35:21.0881958Z # logistics\_etl.db
2025-08-20T07:35:21.0882136Z 
2025-08-20T07:35:21.0882270Z <a id="logistics_etl.repository"></a>
2025-08-20T07:35:21.0882702Z 
2025-08-20T07:35:21.0882823Z # logistics\_etl.repository
2025-08-20T07:35:21.0883030Z 
2025-08-20T07:35:21.0883144Z <a id="alert_bot"></a>
2025-08-20T07:35:21.0883320Z 
2025-08-20T07:35:21.0883419Z # alert\_bot
2025-08-20T07:35:21.0883572Z 
2025-08-20T07:35:21.0883708Z <a id="alert_bot.tests.test_smoke"></a>
2025-08-20T07:35:21.0883958Z 
2025-08-20T07:35:21.0884076Z # alert\_bot.tests.test\_smoke
2025-08-20T07:35:21.0884292Z 
2025-08-20T07:35:21.0884410Z <a id="alert_bot.tests"></a>
2025-08-20T07:35:21.0884628Z 
2025-08-20T07:35:21.0884732Z # alert\_bot.tests
2025-08-20T07:35:21.0884892Z 
2025-08-20T07:35:21.0885014Z <a id="alert_bot.alert_bot"></a>
2025-08-20T07:35:21.0885228Z 
2025-08-20T07:35:21.0885343Z # alert\_bot.alert\_bot
2025-08-20T07:35:21.0885518Z 
2025-08-20T07:35:21.0885635Z <a id="alert_bot.rules"></a>
2025-08-20T07:35:21.0885842Z 
2025-08-20T07:35:21.0885947Z # alert\_bot.rules
2025-08-20T07:35:21.0886105Z 
2025-08-20T07:35:21.0886208Z <a id="common"></a>
2025-08-20T07:35:21.0886373Z 
2025-08-20T07:35:21.0886464Z # common
2025-08-20T07:35:21.0886593Z 
2025-08-20T07:35:21.0886706Z <a id="common.dsn"></a>
2025-08-20T07:35:21.0886878Z 
2025-08-20T07:35:21.0886975Z # common.dsn
2025-08-20T07:35:21.0887125Z 
2025-08-20T07:35:21.0887269Z <a id="common.dsn.build_dsn"></a>
2025-08-20T07:35:21.0887498Z 
2025-08-20T07:35:21.0887597Z #### build\_dsn
2025-08-20T07:35:21.0887749Z 
2025-08-20T07:35:21.0887844Z ```python
2025-08-20T07:35:21.0888110Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:35:21.0888455Z ```
2025-08-20T07:35:21.0888839Z 
2025-08-20T07:35:21.0889043Z Return a Postgres DSN, validating required variables.
2025-08-20T07:35:21.0889358Z 
2025-08-20T07:35:21.0889648Z The function prefers explicit DSNs via ``PG_SYNC_DSN`` / ``PG_ASYNC_DSN`` or
2025-08-20T07:35:21.0890329Z ``DATABASE_URL``.  If those are absent it assembles a connection string from
2025-08-20T07:35:21.0890941Z ``PG_HOST`` and related variables and raises a helpful error when any are
2025-08-20T07:35:21.0891426Z missing.
2025-08-20T07:35:21.0891567Z 
2025-08-20T07:35:21.0891705Z <a id="common.models_vendor"></a>
2025-08-20T07:35:21.0891927Z 
2025-08-20T07:35:21.0892033Z # common.models\_vendor
2025-08-20T07:35:21.0892205Z 
2025-08-20T07:35:21.0892337Z <a id="common.models_vendor.Vendor"></a>
2025-08-20T07:35:21.0892786Z 
2025-08-20T07:35:21.0892897Z ## Vendor Objects
2025-08-20T07:35:21.0893064Z 
2025-08-20T07:35:21.0893160Z ```python
2025-08-20T07:35:21.0893393Z class Vendor(Base)
2025-08-20T07:35:21.0893659Z ```
2025-08-20T07:35:21.0893787Z 
2025-08-20T07:35:21.0893909Z Vendor of inventory items.
2025-08-20T07:35:21.0894104Z 
2025-08-20T07:35:21.0894250Z <a id="common.models_vendor.VendorPrice"></a>
2025-08-20T07:35:21.0894512Z 
2025-08-20T07:35:21.0894627Z ## VendorPrice Objects
2025-08-20T07:35:21.0894799Z 
2025-08-20T07:35:21.0894980Z ```python
2025-08-20T07:35:21.0895222Z class VendorPrice(Base)
2025-08-20T07:35:21.0895479Z ```
2025-08-20T07:35:21.0895602Z 
2025-08-20T07:35:21.0895755Z Association table linking vendors to pricing.
2025-08-20T07:35:21.0896019Z 
2025-08-20T07:35:21.0896134Z <a id="common.db_url"></a>
2025-08-20T07:35:21.0896325Z 
2025-08-20T07:35:21.0896426Z # common.db\_url
2025-08-20T07:35:21.0896585Z 
2025-08-20T07:35:21.0896710Z <a id="common.db_url.build_url"></a>
2025-08-20T07:35:21.0896952Z 
2025-08-20T07:35:21.0897048Z #### build\_url
2025-08-20T07:35:21.0897206Z 
2025-08-20T07:35:21.0897298Z ```python
2025-08-20T07:35:21.0897552Z def build_url(async_: bool = True) -> str
2025-08-20T07:35:21.0898086Z ```
2025-08-20T07:35:21.0898214Z 
2025-08-20T07:35:21.0898363Z Return Postgres DSN from env or PG_* parts.
2025-08-20T07:35:21.0898617Z 
2025-08-20T07:35:21.0898729Z <a id="common.keepa"></a>
2025-08-20T07:35:21.0898922Z 
2025-08-20T07:35:21.0899016Z # common.keepa
2025-08-20T07:35:21.0899162Z 
2025-08-20T07:35:21.0899270Z <a id="common.llm"></a>
2025-08-20T07:35:21.0899451Z 
2025-08-20T07:35:21.0899549Z # common.llm
2025-08-20T07:35:21.0899689Z 
2025-08-20T07:35:21.0899814Z <a id="common.settings"></a>
2025-08-20T07:35:21.0900010Z 
2025-08-20T07:35:21.0900114Z # common.settings
2025-08-20T07:35:21.0900271Z 
2025-08-20T07:35:21.0900378Z <a id="common.db"></a>
2025-08-20T07:35:21.0900543Z 
2025-08-20T07:35:21.0900632Z # common.db
2025-08-20T07:35:21.0900771Z 
2025-08-20T07:35:21.0900905Z <a id="common.db.build_sqlalchemy_url"></a>
2025-08-20T07:35:21.0901143Z 
2025-08-20T07:35:21.0901278Z #### build\_sqlalchemy\_url
2025-08-20T07:35:21.0901469Z 
2025-08-20T07:35:21.0901563Z ```python
2025-08-20T07:35:21.0901819Z def build_sqlalchemy_url() -> str
2025-08-20T07:35:21.0902133Z ```
2025-08-20T07:35:21.0902260Z 
2025-08-20T07:35:21.0902400Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T07:35:21.0902843Z 
2025-08-20T07:35:21.0902982Z <a id="common.db.build_asyncpg_dsn"></a>
2025-08-20T07:35:21.0903230Z 
2025-08-20T07:35:21.0903337Z #### build\_asyncpg\_dsn
2025-08-20T07:35:21.0903519Z 
2025-08-20T07:35:21.0903617Z ```python
2025-08-20T07:35:21.0903862Z def build_asyncpg_dsn() -> str
2025-08-20T07:35:21.0904151Z ```
2025-08-20T07:35:21.0904265Z 
2025-08-20T07:35:21.0904446Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T07:35:21.0904763Z 
2025-08-20T07:35:21.0904886Z <a id="common.db.refresh_mvs"></a>
2025-08-20T07:35:21.0905110Z 
2025-08-20T07:35:21.0905205Z #### refresh\_mvs
2025-08-20T07:35:21.0905361Z 
2025-08-20T07:35:21.0905453Z ```python
2025-08-20T07:35:21.0905744Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T07:35:21.0906103Z ```
2025-08-20T07:35:21.0906226Z 
2025-08-20T07:35:21.0906627Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T07:35:21.0906951Z 
2025-08-20T07:35:21.0907065Z <a id="common.config"></a>
2025-08-20T07:35:21.0907258Z 
2025-08-20T07:35:21.0907359Z # common.config
2025-08-20T07:35:21.0907507Z 
2025-08-20T07:35:21.0907620Z <a id="common.base"></a>
2025-08-20T07:35:21.0907792Z 
2025-08-20T07:35:21.0907882Z # common.base
2025-08-20T07:35:21.0908024Z 
2025-08-20T07:35:21.0908153Z <a id="common.base.Base"></a>
2025-08-20T07:35:21.0908365Z 
2025-08-20T07:35:21.0908460Z ## Base Objects
2025-08-20T07:35:21.0908614Z 
2025-08-20T07:35:21.0908705Z ```python
2025-08-20T07:35:21.0908955Z class Base(DeclarativeBase)
2025-08-20T07:35:21.0909244Z ```
2025-08-20T07:35:21.0909362Z 
2025-08-20T07:35:21.0909488Z Base class for SQLAlchemy models.
2025-08-20T07:35:21.0909701Z 
2025-08-20T07:35:21.0909805Z <a id="repricer"></a>
2025-08-20T07:35:21.0909976Z 
2025-08-20T07:35:21.0910079Z # repricer
2025-08-20T07:35:21.0910212Z 
2025-08-20T07:35:21.0910340Z <a id="repricer.app.schemas"></a>
2025-08-20T07:35:21.0910573Z 
2025-08-20T07:35:21.0910681Z # repricer.app.schemas
2025-08-20T07:35:21.0910858Z 
2025-08-20T07:35:21.0910981Z <a id="repricer.app.deps"></a>
2025-08-20T07:35:21.0911195Z 
2025-08-20T07:35:21.0911299Z # repricer.app.deps
2025-08-20T07:35:21.0911459Z 
2025-08-20T07:35:21.0911642Z Placeholder module for Keepa / SP-API clients.
2025-08-20T07:35:21.0911908Z 
2025-08-20T07:35:21.0912031Z <a id="repricer.app.logic"></a>
2025-08-20T07:35:21.0912249Z 
2025-08-20T07:35:21.0912353Z # repricer.app.logic
2025-08-20T07:35:21.0912667Z 
2025-08-20T07:35:21.0912821Z <a id="repricer.app.logic.MIN_MARGIN"></a>
2025-08-20T07:35:21.0913085Z 
2025-08-20T07:35:21.0913180Z #### MIN\_MARGIN
2025-08-20T07:35:21.0913327Z 
2025-08-20T07:35:21.0913423Z 15 % ROI
2025-08-20T07:35:21.0913552Z 
2025-08-20T07:35:21.0913707Z <a id="repricer.app.logic.compute_price"></a>
2025-08-20T07:35:21.0913976Z 
2025-08-20T07:35:21.0914077Z #### compute\_price
2025-08-20T07:35:21.0914476Z 
2025-08-20T07:35:21.0914576Z ```python
2025-08-20T07:35:21.0914937Z def compute_price(asin: str, cost: Decimal, fees: Decimal) -> Decimal
2025-08-20T07:35:21.0915365Z ```
2025-08-20T07:35:21.0915486Z 
2025-08-20T07:35:21.0915641Z Toy algorithm: ensure 15 % ROI and round to cents.
2025-08-20T07:35:21.0916049Z Replace with real competitive logic later.
2025-08-20T07:35:21.0916289Z 
2025-08-20T07:35:21.0916408Z <a id="repricer.app.main"></a>
2025-08-20T07:35:21.0916623Z 
2025-08-20T07:35:21.0916725Z # repricer.app.main
2025-08-20T07:35:21.0916884Z 
2025-08-20T07:35:21.0917000Z <a id="repricer.app"></a>
2025-08-20T07:35:21.0917191Z 
2025-08-20T07:35:21.0917290Z # repricer.app
2025-08-20T07:35:21.0917433Z 
2025-08-20T07:35:21.0917565Z <a id="repricer.tests.test_imports"></a>
2025-08-20T07:35:21.0917797Z 
2025-08-20T07:35:21.0917914Z # repricer.tests.test\_imports
2025-08-20T07:35:21.0918120Z 
2025-08-20T07:35:21.0918251Z <a id="repricer.tests.test_smoke"></a>
2025-08-20T07:35:21.0918484Z 
2025-08-20T07:35:21.0918610Z # repricer.tests.test\_smoke
2025-08-20T07:35:21.0918821Z 
2025-08-20T07:35:21.0918931Z <a id="repricer.tests"></a>
2025-08-20T07:35:21.0919118Z 
2025-08-20T07:35:21.0919222Z # repricer.tests
2025-08-20T07:35:21.0919379Z 
2025-08-20T07:35:21.0919474Z <a id="db"></a>
2025-08-20T07:35:21.0919616Z 
2025-08-20T07:35:21.0919712Z # db
2025-08-20T07:35:21.0919835Z 
2025-08-20T07:35:21.0919940Z <a id="db.utils.views"></a>
2025-08-20T07:35:21.0920132Z 
2025-08-20T07:35:21.0920232Z # db.utils.views
2025-08-20T07:35:21.0920381Z 
2025-08-20T07:35:21.0920521Z <a id="db.utils.views.replace_view"></a>
2025-08-20T07:35:21.0920763Z 
2025-08-20T07:35:21.0920864Z #### replace\_view
2025-08-20T07:35:21.0921018Z 
2025-08-20T07:35:21.0921120Z ```python
2025-08-20T07:35:21.0921399Z def replace_view(name: str, new_sql: str) -> None
2025-08-20T07:35:21.0921760Z ```
2025-08-20T07:35:21.0921885Z 
2025-08-20T07:35:21.0922017Z Drop and recreate a SQL view atomically.
2025-08-20T07:35:21.0922265Z 
2025-08-20T07:35:21.0922373Z <a id="db.utils"></a>
2025-08-20T07:35:21.0922915Z 
2025-08-20T07:35:21.0923017Z # db.utils
2025-08-20T07:35:21.0923149Z 
2025-08-20T07:35:21.0923261Z <a id="price_importer"></a>
2025-08-20T07:35:21.0923459Z 
2025-08-20T07:35:21.0923567Z # price\_importer
2025-08-20T07:35:21.0923725Z 
2025-08-20T07:35:21.0923880Z <a id="price_importer.services_common.dsn"></a>
2025-08-20T07:35:21.0924165Z 
2025-08-20T07:35:21.0924299Z # price\_importer.services\_common.dsn
2025-08-20T07:35:21.0924540Z 
2025-08-20T07:35:21.0924721Z <a id="price_importer.services_common.dsn.build_dsn"></a>
2025-08-20T07:35:21.0925015Z 
2025-08-20T07:35:21.0925109Z #### build\_dsn
2025-08-20T07:35:21.0925255Z 
2025-08-20T07:35:21.0925354Z ```python
2025-08-20T07:35:21.0925601Z def build_dsn(sync: bool = True) -> str
2025-08-20T07:35:21.0925932Z ```
2025-08-20T07:35:21.0926054Z 
2025-08-20T07:35:21.0926151Z Return safe DSN.
2025-08-20T07:35:21.0926311Z 
2025-08-20T07:35:21.0926775Z sync=True → SQLAlchemy (+psycopg) else plain asyncpg.
2025-08-20T07:35:21.0927078Z 
2025-08-20T07:35:21.0927276Z <a id="price_importer.services_common.models_vendor"></a>
2025-08-20T07:35:21.0927581Z 
2025-08-20T07:35:21.0927746Z # price\_importer.services\_common.models\_vendor
2025-08-20T07:35:21.0928032Z 
2025-08-20T07:35:21.0928188Z <a id="price_importer.services_common.db_url"></a>
2025-08-20T07:35:21.0928470Z 
2025-08-20T07:35:21.0928608Z # price\_importer.services\_common.db\_url
2025-08-20T07:35:21.0928867Z 
2025-08-20T07:35:21.0929057Z <a id="price_importer.services_common.db_url.build_url"></a>
2025-08-20T07:35:21.0929361Z 
2025-08-20T07:35:21.0929465Z #### build\_url
2025-08-20T07:35:21.0929617Z 
2025-08-20T07:35:21.0929708Z ```python
2025-08-20T07:35:21.0929968Z def build_url(async_: bool = True) -> str
2025-08-20T07:35:21.0930298Z ```
2025-08-20T07:35:21.0930425Z 
2025-08-20T07:35:21.0930567Z Return Postgres DSN from env or PG_* parts.
2025-08-20T07:35:21.0930821Z 
2025-08-20T07:35:21.0930982Z <a id="price_importer.services_common.keepa"></a>
2025-08-20T07:35:21.0931435Z 
2025-08-20T07:35:21.0931579Z # price\_importer.services\_common.keepa
2025-08-20T07:35:21.0931824Z 
2025-08-20T07:35:21.0931978Z <a id="price_importer.services_common.llm"></a>
2025-08-20T07:35:21.0932235Z 
2025-08-20T07:35:21.0932363Z # price\_importer.services\_common.llm
2025-08-20T07:35:21.0932771Z 
2025-08-20T07:35:21.0932937Z <a id="price_importer.services_common.settings"></a>
2025-08-20T07:35:21.0933230Z 
2025-08-20T07:35:21.0933380Z # price\_importer.services\_common.settings
2025-08-20T07:35:21.0933626Z 
2025-08-20T07:35:21.0933773Z <a id="price_importer.services_common.db"></a>
2025-08-20T07:35:21.0934033Z 
2025-08-20T07:35:21.0934167Z # price\_importer.services\_common.db
2025-08-20T07:35:21.0934395Z 
2025-08-20T07:35:21.0934613Z <a id="price_importer.services_common.db.build_sqlalchemy_url"></a>
2025-08-20T07:35:21.0934967Z 
2025-08-20T07:35:21.0935082Z #### build\_sqlalchemy\_url
2025-08-20T07:35:21.0935269Z 
2025-08-20T07:35:21.0935371Z ```python
2025-08-20T07:35:21.0935631Z def build_sqlalchemy_url() -> str
2025-08-20T07:35:21.0935946Z ```
2025-08-20T07:35:21.0936066Z 
2025-08-20T07:35:21.0936205Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T07:35:21.0936461Z 
2025-08-20T07:35:21.0936668Z <a id="price_importer.services_common.db.build_asyncpg_dsn"></a>
2025-08-20T07:35:21.0936992Z 
2025-08-20T07:35:21.0937099Z #### build\_asyncpg\_dsn
2025-08-20T07:35:21.0937285Z 
2025-08-20T07:35:21.0937379Z ```python
2025-08-20T07:35:21.0937628Z def build_asyncpg_dsn() -> str
2025-08-20T07:35:21.0937920Z ```
2025-08-20T07:35:21.0938042Z 
2025-08-20T07:35:21.0938237Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T07:35:21.0938547Z 
2025-08-20T07:35:21.0938733Z <a id="price_importer.services_common.db.refresh_mvs"></a>
2025-08-20T07:35:21.0939038Z 
2025-08-20T07:35:21.0939135Z #### refresh\_mvs
2025-08-20T07:35:21.0939287Z 
2025-08-20T07:35:21.0939382Z ```python
2025-08-20T07:35:21.0939669Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T07:35:21.0940043Z ```
2025-08-20T07:35:21.0940339Z 
2025-08-20T07:35:21.0940543Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T07:35:21.0940854Z 
2025-08-20T07:35:21.0941002Z <a id="price_importer.services_common"></a>
2025-08-20T07:35:21.0941248Z 
2025-08-20T07:35:21.0941371Z # price\_importer.services\_common
2025-08-20T07:35:21.0941596Z 
2025-08-20T07:35:21.0941745Z <a id="price_importer.services_common.base"></a>
2025-08-20T07:35:21.0942008Z 
2025-08-20T07:35:21.0942145Z # price\_importer.services\_common.base
2025-08-20T07:35:21.0942386Z 
2025-08-20T07:35:21.0942689Z <a id="price_importer.normaliser"></a>
2025-08-20T07:35:21.0942940Z 
2025-08-20T07:35:21.0943061Z # price\_importer.normaliser
2025-08-20T07:35:21.0943263Z 
2025-08-20T07:35:21.0943416Z <a id="price_importer.common.models_vendor"></a>
2025-08-20T07:35:21.0943736Z 
2025-08-20T07:35:21.0943866Z # price\_importer.common.models\_vendor
2025-08-20T07:35:21.0944106Z 
2025-08-20T07:35:21.0944241Z <a id="price_importer.common.db_url"></a>
2025-08-20T07:35:21.0944489Z 
2025-08-20T07:35:21.0944622Z # price\_importer.common.db\_url
2025-08-20T07:35:21.0944841Z 
2025-08-20T07:35:21.0944991Z <a id="price_importer.common.db_url.make_dsn"></a>
2025-08-20T07:35:21.0945259Z 
2025-08-20T07:35:21.0945351Z #### make\_dsn
2025-08-20T07:35:21.0945500Z 
2025-08-20T07:35:21.0945593Z ```python
2025-08-20T07:35:21.0945848Z def make_dsn(async_: bool = False) -> str
2025-08-20T07:35:21.0946173Z ```
2025-08-20T07:35:21.0946297Z 
2025-08-20T07:35:21.0946486Z Return DSN built from either PG_* or POSTGRES_* vars.
2025-08-20T07:35:21.0946778Z 
2025-08-20T07:35:21.0946942Z <a id="price_importer.common.db_url.build_url"></a>
2025-08-20T07:35:21.0947223Z 
2025-08-20T07:35:21.0947318Z #### build\_url
2025-08-20T07:35:21.0947471Z 
2025-08-20T07:35:21.0947570Z ```python
2025-08-20T07:35:21.0947834Z def build_url(async_: bool = False) -> str
2025-08-20T07:35:21.0948172Z ```
2025-08-20T07:35:21.0948295Z 
2025-08-20T07:35:21.0948473Z Return Postgres DSN built from environment variables.
2025-08-20T07:35:21.0948941Z 
2025-08-20T07:35:21.0949077Z <a id="price_importer.common"></a>
2025-08-20T07:35:21.0949310Z 
2025-08-20T07:35:21.0949426Z # price\_importer.common
2025-08-20T07:35:21.0949613Z 
2025-08-20T07:35:21.0949744Z <a id="price_importer.common.base"></a>
2025-08-20T07:35:21.0949979Z 
2025-08-20T07:35:21.0950105Z # price\_importer.common.base
2025-08-20T07:35:21.0950307Z 
2025-08-20T07:35:21.0950450Z <a id="price_importer.tests.conftest"></a>
2025-08-20T07:35:21.0950697Z 
2025-08-20T07:35:21.0950829Z # price\_importer.tests.conftest
2025-08-20T07:35:21.0951041Z 
2025-08-20T07:35:21.0951184Z <a id="price_importer.tests.test_reader"></a>
2025-08-20T07:35:21.0951440Z 
2025-08-20T07:35:21.0951564Z # price\_importer.tests.test\_reader
2025-08-20T07:35:21.0951788Z 
2025-08-20T07:35:21.0951941Z <a id="price_importer.tests.test_imports"></a>
2025-08-20T07:35:21.0952243Z 
2025-08-20T07:35:21.0952373Z # price\_importer.tests.test\_imports
2025-08-20T07:35:21.0952749Z 
2025-08-20T07:35:21.0952905Z <a id="price_importer.tests.test_smoke"></a>
2025-08-20T07:35:21.0953157Z 
2025-08-20T07:35:21.0953278Z # price\_importer.tests.test\_smoke
2025-08-20T07:35:21.0953505Z 
2025-08-20T07:35:21.0953652Z <a id="price_importer.tests.test_normaliser"></a>
2025-08-20T07:35:21.0953910Z 
2025-08-20T07:35:21.0954047Z # price\_importer.tests.test\_normaliser
2025-08-20T07:35:21.0954283Z 
2025-08-20T07:35:21.0954402Z <a id="price_importer.tests"></a>
2025-08-20T07:35:21.0954608Z 
2025-08-20T07:35:21.0954721Z # price\_importer.tests
2025-08-20T07:35:21.0954888Z 
2025-08-20T07:35:21.0955006Z <a id="price_importer.reader"></a>
2025-08-20T07:35:21.0955227Z 
2025-08-20T07:35:21.0955334Z # price\_importer.reader
2025-08-20T07:35:21.0955511Z 
2025-08-20T07:35:21.0955643Z <a id="price_importer.repository"></a>
2025-08-20T07:35:21.0955876Z 
2025-08-20T07:35:21.0955994Z # price\_importer.repository
2025-08-20T07:35:21.0956204Z 
2025-08-20T07:35:21.0956339Z <a id="price_importer.import"></a>
2025-08-20T07:35:21.0956569Z 
2025-08-20T07:35:21.0956684Z # price\_importer.import
2025-08-20T07:35:21.0957045Z 
2025-08-20T07:35:21.0957153Z <a id="fees_h10"></a>
2025-08-20T07:35:21.0957329Z 
2025-08-20T07:35:21.0957428Z # fees\_h10
2025-08-20T07:35:21.0957575Z 
2025-08-20T07:35:21.0957691Z <a id="fees_h10.worker"></a>
2025-08-20T07:35:21.0957902Z 
2025-08-20T07:35:21.0958017Z # fees\_h10.worker
2025-08-20T07:35:21.0958188Z 
2025-08-20T07:35:21.0958325Z <a id="fees_h10.worker.list_active_asins"></a>
2025-08-20T07:35:21.0958584Z 
2025-08-20T07:35:21.0958699Z #### list\_active\_asins
2025-08-20T07:35:21.0958886Z 
2025-08-20T07:35:21.0958982Z ```python
2025-08-20T07:35:21.0959243Z def list_active_asins() -> list[str]
2025-08-20T07:35:21.0959564Z ```
2025-08-20T07:35:21.0959689Z 
2025-08-20T07:35:21.0959856Z Return known ASINs or an empty list if unavailable.
2025-08-20T07:35:21.0960137Z 
2025-08-20T07:35:21.0960265Z <a id="fees_h10.tests.test_smoke"></a>
2025-08-20T07:35:21.0960498Z 
2025-08-20T07:35:21.0960618Z # fees\_h10.tests.test\_smoke
2025-08-20T07:35:21.0960829Z 
2025-08-20T07:35:21.0960947Z <a id="fees_h10.tests"></a>
2025-08-20T07:35:21.0961134Z 
2025-08-20T07:35:21.0961235Z # fees\_h10.tests
2025-08-20T07:35:21.0961386Z 
2025-08-20T07:35:21.0961497Z <a id="fees_h10.client"></a>
2025-08-20T07:35:21.0961694Z 
2025-08-20T07:35:21.0961799Z # fees\_h10.client
2025-08-20T07:35:21.0961949Z 
2025-08-20T07:35:21.0962072Z <a id="fees_h10.repository"></a>
2025-08-20T07:35:21.0962285Z 
2025-08-20T07:35:21.0962391Z # fees\_h10.repository
2025-08-20T07:35:21.0962749Z 
2025-08-20T07:35:21.0962901Z <a id="fees_h10.repository.upsert_fees_raw"></a>
2025-08-20T07:35:21.0963180Z 
2025-08-20T07:35:21.0963284Z #### upsert\_fees\_raw
2025-08-20T07:35:21.0963455Z 
2025-08-20T07:35:21.0963558Z ```python
2025-08-20T07:35:21.0963805Z def upsert_fees_raw(engine: Engine,
2025-08-20T07:35:21.0964172Z                     rows: Iterable[Mapping[str, Any]],
2025-08-20T07:35:21.0964518Z                     *,
2025-08-20T07:35:21.0964855Z                     testing: bool = False) -> Optional[Dict[str, int]]
2025-08-20T07:35:21.0965405Z ```
2025-08-20T07:35:21.0965536Z 
2025-08-20T07:35:21.0965651Z Idempotent upsert for fees.
2025-08-20T07:35:21.0965850Z 
2025-08-20T07:35:21.0966074Z TESTING-only: returns counts for inserted/updated/skipped rows.
2025-08-20T07:35:21.0966559Z Assumes logical key (asin, marketplace, fee_type).
2025-08-20T07:35:21.0967007Z Only updates when one of the mutable fields changes.
2025-08-20T07:35:21.0967289Z 
2025-08-20T07:35:21.0967391Z <a id="emailer"></a>
2025-08-20T07:35:21.0967556Z 
2025-08-20T07:35:21.0967643Z # emailer
2025-08-20T07:35:21.0967773Z 
2025-08-20T07:35:21.0967925Z <a id="emailer.tests.test_import_emailer"></a>
2025-08-20T07:35:21.0968191Z 
2025-08-20T07:35:21.0968323Z # emailer.tests.test\_import\_emailer
2025-08-20T07:35:21.0968556Z 
2025-08-20T07:35:21.0968686Z <a id="emailer.tests.test_smoke"></a>
2025-08-20T07:35:21.0968912Z 
2025-08-20T07:35:21.0969027Z # emailer.tests.test\_smoke
2025-08-20T07:35:21.0969231Z 
2025-08-20T07:35:21.0969351Z <a id="emailer.tests"></a>
2025-08-20T07:35:21.0969550Z 
2025-08-20T07:35:21.0969646Z # emailer.tests
2025-08-20T07:35:21.0969806Z 
2025-08-20T07:35:21.0997433Z <a id="emailer.generate_body"></a>
2025-08-20T07:35:21.0997748Z 
2025-08-20T07:35:21.0997880Z # emailer.generate\_body
2025-08-20T07:35:21.0998072Z 
2025-08-20T07:35:21.0998181Z <a id="llm_server"></a>
2025-08-20T07:35:21.0998354Z 
2025-08-20T07:35:21.0998464Z # llm\_server
2025-08-20T07:35:21.0998602Z 
2025-08-20T07:35:21.0998717Z <a id="llm_server.app"></a>
2025-08-20T07:35:21.0998917Z 
2025-08-20T07:35:21.0999012Z # llm\_server.app
2025-08-20T07:35:21.0999164Z 
