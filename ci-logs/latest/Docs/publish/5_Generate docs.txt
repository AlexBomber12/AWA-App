2025-08-20T18:26:20.6693387Z ##[group]Run pydoc-markdown
2025-08-20T18:26:20.6693706Z [36;1mpydoc-markdown[0m
2025-08-20T18:26:20.6734324Z shell: /usr/bin/bash -e {0}
2025-08-20T18:26:20.6734598Z env:
2025-08-20T18:26:20.6734901Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T18:26:20.6735411Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-08-20T18:26:20.6735905Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T18:26:20.6736339Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T18:26:20.6736768Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T18:26:20.6737206Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-08-20T18:26:20.6737563Z ##[endgroup]
2025-08-20T18:26:20.9728692Z [WARNING - pydoc_markdown.main]: Unknown configuration options:
2025-08-20T18:26:20.9729449Z Unknown key(s) "{'output_directory'}" at:
2025-08-20T18:26:20.9729861Z In "pydoc-markdown.yml"
2025-08-20T18:26:20.9730254Z   $: TypeHint(pydoc_markdown.PydocMarkdown)
2025-08-20T18:26:20.9731207Z   .renderer: TypeHint(pydoc_markdown.interfaces.Renderer)
2025-08-20T18:26:20.9732467Z   ^: TypeHint(pydoc_markdown.contrib.renderers.markdown.MarkdownRenderer)
2025-08-20T18:26:20.9733523Z 
2025-08-20T18:26:21.3337370Z <a id="__init__"></a>
2025-08-20T18:26:21.3337794Z 
2025-08-20T18:26:21.3337920Z # \_\_init\_\_
2025-08-20T18:26:21.3338114Z 
2025-08-20T18:26:21.3338251Z <a id="api"></a>
2025-08-20T18:26:21.3338456Z 
2025-08-20T18:26:21.3338569Z # api
2025-08-20T18:26:21.3338740Z 
2025-08-20T18:26:21.3338882Z <a id="api.errors"></a>
2025-08-20T18:26:21.3339116Z 
2025-08-20T18:26:21.3339241Z # api.errors
2025-08-20T18:26:21.3339437Z 
2025-08-20T18:26:21.3339589Z <a id="api.sentry_config"></a>
2025-08-20T18:26:21.3339852Z 
2025-08-20T18:26:21.3339996Z # api.sentry\_config
2025-08-20T18:26:21.3340211Z 
2025-08-20T18:26:21.3340391Z <a id="api.tests.test_stats_contracts"></a>
2025-08-20T18:26:21.3340720Z 
2025-08-20T18:26:21.3340931Z # api.tests.test\_stats\_contracts
2025-08-20T18:26:21.3341231Z 
2025-08-20T18:26:21.3341398Z <a id="api.tests.test_sentry_scrub"></a>
2025-08-20T18:26:21.3341710Z 
2025-08-20T18:26:21.3341865Z # api.tests.test\_sentry\_scrub
2025-08-20T18:26:21.3342121Z 
2025-08-20T18:26:21.3342306Z <a id="api.tests.test_roi_basic_auth"></a>
2025-08-20T18:26:21.3342629Z 
2025-08-20T18:26:21.3342778Z # api.tests.test\_roi\_basic\_auth
2025-08-20T18:26:21.3343313Z 
2025-08-20T18:26:21.3343502Z <a id="api.tests.test_errors_json"></a>
2025-08-20T18:26:21.3343814Z 
2025-08-20T18:26:21.3343966Z # api.tests.test\_errors\_json
2025-08-20T18:26:21.3344231Z 
2025-08-20T18:26:21.3344383Z <a id="api.tests.test_llm"></a>
2025-08-20T18:26:21.3344638Z 
2025-08-20T18:26:21.3344781Z # api.tests.test\_llm
2025-08-20T18:26:21.3345000Z 
2025-08-20T18:26:21.3345161Z <a id="api.tests.test_roi_filters"></a>
2025-08-20T18:26:21.3345458Z 
2025-08-20T18:26:21.3345608Z # api.tests.test\_roi\_filters
2025-08-20T18:26:21.3345868Z 
2025-08-20T18:26:21.3346470Z <a id="api.tests.test_sentry_event"></a>
2025-08-20T18:26:21.3346821Z 
2025-08-20T18:26:21.3346974Z # api.tests.test\_sentry\_event
2025-08-20T18:26:21.3347240Z 
2025-08-20T18:26:21.3347477Z <a id="api.tests.test_sentry_event.DummyTransport"></a>
2025-08-20T18:26:21.3347852Z 
2025-08-20T18:26:21.3347995Z ## DummyTransport Objects
2025-08-20T18:26:21.3348236Z 
2025-08-20T18:26:21.3348367Z ```python
2025-08-20T18:26:21.3348668Z class DummyTransport()
2025-08-20T18:26:21.3348997Z ```
2025-08-20T18:26:21.3349151Z 
2025-08-20T18:26:21.3349523Z <a id="api.tests.test_sentry_event.DummyTransport.capture_envelope"></a>
2025-08-20T18:26:21.3350000Z 
2025-08-20T18:26:21.3350134Z #### capture\_envelope
2025-08-20T18:26:21.3350348Z 
2025-08-20T18:26:21.3350474Z ```python
2025-08-20T18:26:21.3350789Z def capture_envelope(envelope)
2025-08-20T18:26:21.3351156Z ```
2025-08-20T18:26:21.3351311Z 
2025-08-20T18:26:21.3351542Z Capture events sent as envelopes by Sentry SDK >= 2.0.
2025-08-20T18:26:21.3351939Z 
2025-08-20T18:26:21.3352099Z <a id="api.tests.test_cors"></a>
2025-08-20T18:26:21.3352753Z 
2025-08-20T18:26:21.3352896Z # api.tests.test\_cors
2025-08-20T18:26:21.3353329Z 
2025-08-20T18:26:21.3353492Z <a id="api.tests.test_imports"></a>
2025-08-20T18:26:21.3353781Z 
2025-08-20T18:26:21.3353936Z # api.tests.test\_imports
2025-08-20T18:26:21.3354174Z 
2025-08-20T18:26:21.3354332Z <a id="api.tests.test_rate_limit"></a>
2025-08-20T18:26:21.3354634Z 
2025-08-20T18:26:21.3354780Z # api.tests.test\_rate\_limit
2025-08-20T18:26:21.3355036Z 
2025-08-20T18:26:21.3355214Z <a id="api.tests.test_rate_limit.app"></a>
2025-08-20T18:26:21.3355540Z 
2025-08-20T18:26:21.3355656Z #### app
2025-08-20T18:26:21.3355816Z 
2025-08-20T18:26:21.3355937Z noqa: E402
2025-08-20T18:26:21.3356101Z 
2025-08-20T18:26:21.3356257Z <a id="api.tests.test_stats_sql"></a>
2025-08-20T18:26:21.3356558Z 
2025-08-20T18:26:21.3356707Z # api.tests.test\_stats\_sql
2025-08-20T18:26:21.3356957Z 
2025-08-20T18:26:21.3357118Z <a id="api.tests.test_entrypoint"></a>
2025-08-20T18:26:21.3357444Z 
2025-08-20T18:26:21.3357598Z # api.tests.test\_entrypoint
2025-08-20T18:26:21.3357851Z 
2025-08-20T18:26:21.3358059Z <a id="api.tests.test_stats_future_contracts"></a>
2025-08-20T18:26:21.3358402Z 
2025-08-20T18:26:21.3358572Z # api.tests.test\_stats\_future\_contracts
2025-08-20T18:26:21.3358884Z 
2025-08-20T18:26:21.3359037Z <a id="api.tests.test_health"></a>
2025-08-20T18:26:21.3359307Z 
2025-08-20T18:26:21.3359446Z # api.tests.test\_health
2025-08-20T18:26:21.3359685Z 
2025-08-20T18:26:21.3359833Z <a id="api.tests.test_score"></a>
2025-08-20T18:26:21.3360116Z 
2025-08-20T18:26:21.3360265Z # api.tests.test\_score
2025-08-20T18:26:21.3360483Z 
2025-08-20T18:26:21.3360629Z <a id="api.logging_config"></a>
2025-08-20T18:26:21.3360894Z 
2025-08-20T18:26:21.3361026Z # api.logging\_config
2025-08-20T18:26:21.3361241Z 
2025-08-20T18:26:21.3361386Z <a id="api.migrations.env"></a>
2025-08-20T18:26:21.3361650Z 
2025-08-20T18:26:21.3361783Z # api.migrations.env
2025-08-20T18:26:21.3362004Z 
2025-08-20T18:26:21.3362241Z <a id="api.migrations.versions.0022_fix_roi_view"></a>
2025-08-20T18:26:21.3362598Z 
2025-08-20T18:26:21.3362790Z # api.migrations.versions.0022\_fix\_roi\_view
2025-08-20T18:26:21.3363320Z 
2025-08-20T18:26:21.3363537Z <a id="api.migrations.versions.0004_fee_cron"></a>
2025-08-20T18:26:21.3363885Z 
2025-08-20T18:26:21.3364063Z # api.migrations.versions.0004\_fee\_cron
2025-08-20T18:26:21.3364388Z 
2025-08-20T18:26:21.3364668Z <a id="api.migrations.versions.3e9d5c5aff2c_rename_fulf_fee"></a>
2025-08-20T18:26:21.3365101Z 
2025-08-20T18:26:21.3365369Z # api.migrations.versions.3e9d5c5aff2c\_rename\_fulf\_fee
2025-08-20T18:26:21.3365770Z 
2025-08-20T18:26:21.3365996Z <a id="api.migrations.versions.0003_vendor_prices"></a>
2025-08-20T18:26:21.3366374Z 
2025-08-20T18:26:21.3366577Z # api.migrations.versions.0003\_vendor\_prices
2025-08-20T18:26:21.3366928Z 
2025-08-20T18:26:21.3367155Z <a id="api.migrations.versions.0024_create_buybox"></a>
2025-08-20T18:26:21.3367830Z 
2025-08-20T18:26:21.3368030Z # api.migrations.versions.0024\_create\_buybox
2025-08-20T18:26:21.3368511Z 
2025-08-20T18:26:21.3368744Z <a id="api.migrations.versions.0002_create_roi_view"></a>
2025-08-20T18:26:21.3369132Z 
2025-08-20T18:26:21.3369348Z # api.migrations.versions.0002\_create\_roi\_view
2025-08-20T18:26:21.3369696Z 
2025-08-20T18:26:21.3369913Z <a id="api.migrations.versions.0006_fix_roi_views"></a>
2025-08-20T18:26:21.3370270Z 
2025-08-20T18:26:21.3370483Z # api.migrations.versions.0006\_fix\_roi\_views
2025-08-20T18:26:21.3370824Z 
2025-08-20T18:26:21.3371055Z <a id="api.migrations.versions.0020_unified_schema"></a>
2025-08-20T18:26:21.3371431Z 
2025-08-20T18:26:21.3371627Z # api.migrations.versions.0020\_unified\_schema
2025-08-20T18:26:21.3371964Z 
2025-08-20T18:26:21.3372228Z <a id="api.migrations.versions.0025_pr4_indexes_loadlog"></a>
2025-08-20T18:26:21.3372629Z 
2025-08-20T18:26:21.3372859Z # api.migrations.versions.0025\_pr4\_indexes\_loadlog
2025-08-20T18:26:21.3373427Z 
2025-08-20T18:26:21.3373682Z <a id="api.migrations.versions.0023_add_storage_fee"></a>
2025-08-20T18:26:21.3374324Z 
2025-08-20T18:26:21.3374532Z # api.migrations.versions.0023\_add\_storage\_fee
2025-08-20T18:26:21.3374886Z 
2025-08-20T18:26:21.3375136Z <a id="api.migrations.versions.0026_amazon_new_reports"></a>
2025-08-20T18:26:21.3375535Z 
2025-08-20T18:26:21.3375754Z # api.migrations.versions.0026\_amazon\_new\_reports
2025-08-20T18:26:21.3376111Z 
2025-08-20T18:26:21.3376313Z <a id="api.migrations.versions.0001_baseline"></a>
2025-08-20T18:26:21.3376666Z 
2025-08-20T18:26:21.3376839Z # api.migrations.versions.0001\_baseline
2025-08-20T18:26:21.3377169Z 
2025-08-20T18:26:21.3377333Z <a id="api.migrations.versions"></a>
2025-08-20T18:26:21.3377632Z 
2025-08-20T18:26:21.3377779Z # api.migrations.versions
2025-08-20T18:26:21.3378021Z 
2025-08-20T18:26:21.3378169Z <a id="api.migrations"></a>
2025-08-20T18:26:21.3378413Z 
2025-08-20T18:26:21.3378543Z # api.migrations
2025-08-20T18:26:21.3378747Z 
2025-08-20T18:26:21.3378890Z <a id="api.db"></a>
2025-08-20T18:26:21.3379103Z 
2025-08-20T18:26:21.3379217Z # api.db
2025-08-20T18:26:21.3379390Z 
2025-08-20T18:26:21.3379542Z <a id="api.routes.score"></a>
2025-08-20T18:26:21.3379801Z 
2025-08-20T18:26:21.3379937Z # api.routes.score
2025-08-20T18:26:21.3380137Z 
2025-08-20T18:26:21.3380282Z <a id="api.routes.stats"></a>
2025-08-20T18:26:21.3380545Z 
2025-08-20T18:26:21.3380673Z # api.routes.stats
2025-08-20T18:26:21.3380871Z 
2025-08-20T18:26:21.3381016Z <a id="api.routes.roi"></a>
2025-08-20T18:26:21.3381265Z 
2025-08-20T18:26:21.3381387Z # api.routes.roi
2025-08-20T18:26:21.3381580Z 
2025-08-20T18:26:21.3381731Z <a id="api.routes.health"></a>
2025-08-20T18:26:21.3381986Z 
2025-08-20T18:26:21.3382114Z # api.routes.health
2025-08-20T18:26:21.3382318Z 
2025-08-20T18:26:21.3382495Z <a id="api.routes.health.MAX_SKEW"></a>
2025-08-20T18:26:21.3382793Z 
2025-08-20T18:26:21.3382908Z #### MAX\_SKEW
2025-08-20T18:26:21.3383277Z 
2025-08-20T18:26:21.3383394Z seconds
2025-08-20T18:26:21.3383562Z 
2025-08-20T18:26:21.3383733Z <a id="api.routes.health.health"></a>
2025-08-20T18:26:21.3384069Z 
2025-08-20T18:26:21.3384186Z #### health
2025-08-20T18:26:21.3384350Z 
2025-08-20T18:26:21.3384476Z ```python
2025-08-20T18:26:21.3384826Z @router.get("/health", include_in_schema=False)
2025-08-20T18:26:21.3385546Z async def health(session: AsyncSession = Depends(get_session)) -> JSONResponse
2025-08-20T18:26:21.3386158Z ```
2025-08-20T18:26:21.3386325Z 
2025-08-20T18:26:21.3386530Z Return 200 when DB reachable and clocks are in sync.
2025-08-20T18:26:21.3386886Z 
2025-08-20T18:26:21.3387050Z <a id="api.routes.repository"></a>
2025-08-20T18:26:21.3387330Z 
2025-08-20T18:26:21.3387473Z # api.routes.repository
2025-08-20T18:26:21.3387709Z 
2025-08-20T18:26:21.3387852Z <a id="api.routes"></a>
2025-08-20T18:26:21.3388072Z 
2025-08-20T18:26:21.3388197Z # api.routes
2025-08-20T18:26:21.3388387Z 
2025-08-20T18:26:21.3388534Z <a id="api.models.fee"></a>
2025-08-20T18:26:21.3388781Z 
2025-08-20T18:26:21.3389145Z # api.models.fee
2025-08-20T18:26:21.3389366Z 
2025-08-20T18:26:21.3389503Z <a id="api.models"></a>
2025-08-20T18:26:21.3389728Z 
2025-08-20T18:26:21.3389855Z # api.models
2025-08-20T18:26:21.3390034Z 
2025-08-20T18:26:21.3390184Z <a id="api.roi_repository"></a>
2025-08-20T18:26:21.3390453Z 
2025-08-20T18:26:21.3390586Z # api.roi\_repository
2025-08-20T18:26:21.3390796Z 
2025-08-20T18:26:21.3390924Z <a id="api.main"></a>
2025-08-20T18:26:21.3391143Z 
2025-08-20T18:26:21.3391262Z # api.main
2025-08-20T18:26:21.3391552Z 
2025-08-20T18:26:21.3391705Z <a id="api.main.ready"></a>
2025-08-20T18:26:21.3391950Z 
2025-08-20T18:26:21.3392095Z #### ready
2025-08-20T18:26:21.3392261Z 
2025-08-20T18:26:21.3392371Z ```python
2025-08-20T18:26:21.3392764Z @app.get("/ready", status_code=status.HTTP_200_OK, include_in_schema=False)
2025-08-20T18:26:21.3393657Z async def ready(session: AsyncSession = Depends(get_session)) -> dict[str,
2025-08-20T18:26:21.3394193Z                                                                       str]
2025-08-20T18:26:21.3394594Z ```
2025-08-20T18:26:21.3394924Z 
2025-08-20T18:26:21.3395076Z Return 200 only when migrations are at head.
2025-08-20T18:26:21.3395335Z 
2025-08-20T18:26:21.3395459Z <a id="api.config"></a>
2025-08-20T18:26:21.3395644Z 
2025-08-20T18:26:21.3395744Z # api.config
2025-08-20T18:26:21.3395900Z 
2025-08-20T18:26:21.3396019Z <a id="api.security"></a>
2025-08-20T18:26:21.3396227Z 
2025-08-20T18:26:21.3396343Z # api.security
2025-08-20T18:26:21.3396522Z 
2025-08-20T18:26:21.3396632Z <a id="etl"></a>
2025-08-20T18:26:21.3396818Z 
2025-08-20T18:26:21.3396920Z # etl
2025-08-20T18:26:21.3397071Z 
2025-08-20T18:26:21.3397208Z <a id="etl.fba_fee_ingestor"></a>
2025-08-20T18:26:21.3397449Z 
2025-08-20T18:26:21.3397563Z # etl.fba\_fee\_ingestor
2025-08-20T18:26:21.3397743Z 
2025-08-20T18:26:21.3397859Z <a id="etl.sp_fees_ingestor"></a>
2025-08-20T18:26:21.3398072Z 
2025-08-20T18:26:21.3398187Z # etl.sp\_fees\_ingestor
2025-08-20T18:26:21.3398377Z 
2025-08-20T18:26:21.3398501Z <a id="etl.keepa_ingestor"></a>
2025-08-20T18:26:21.3398748Z 
2025-08-20T18:26:21.3398865Z # etl.keepa\_ingestor
2025-08-20T18:26:21.3399059Z 
2025-08-20T18:26:21.3399181Z <a id="etl.db"></a>
2025-08-20T18:26:21.3399356Z 
2025-08-20T18:26:21.3399464Z # etl.db
2025-08-20T18:26:21.3399606Z 
2025-08-20T18:26:21.3399733Z <a id="etl.dialects.schemas"></a>
2025-08-20T18:26:21.3399943Z 
2025-08-20T18:26:21.3400049Z # etl.dialects.schemas
2025-08-20T18:26:21.3400227Z 
2025-08-20T18:26:21.3400381Z <a id="etl.dialects.amazon_reimbursements"></a>
2025-08-20T18:26:21.3400668Z 
2025-08-20T18:26:21.3400812Z # etl.dialects.amazon\_reimbursements
2025-08-20T18:26:21.3401064Z 
2025-08-20T18:26:21.3401215Z <a id="etl.dialects.amazon_ads_sp_cost"></a>
2025-08-20T18:26:21.3401503Z 
2025-08-20T18:26:21.3401648Z # etl.dialects.amazon\_ads\_sp\_cost
2025-08-20T18:26:21.3401913Z 
2025-08-20T18:26:21.3402050Z <a id="etl.dialects.test_generic"></a>
2025-08-20T18:26:21.3402298Z 
2025-08-20T18:26:21.3402414Z # etl.dialects.test\_generic
2025-08-20T18:26:21.3402624Z 
2025-08-20T18:26:21.3402776Z <a id="etl.dialects.amazon_returns"></a>
2025-08-20T18:26:21.3403041Z 
2025-08-20T18:26:21.3403381Z # etl.dialects.amazon\_returns
2025-08-20T18:26:21.3403612Z 
2025-08-20T18:26:21.3403777Z <a id="etl.dialects.amazon_fee_preview"></a>
2025-08-20T18:26:21.3404060Z 
2025-08-20T18:26:21.3404200Z # etl.dialects.amazon\_fee\_preview
2025-08-20T18:26:21.3404509Z 
2025-08-20T18:26:21.3404678Z <a id="etl.dialects.amazon_inventory_ledger"></a>
2025-08-20T18:26:21.3404958Z 
2025-08-20T18:26:21.3405103Z # etl.dialects.amazon\_inventory\_ledger
2025-08-20T18:26:21.3405352Z 
2025-08-20T18:26:21.3405486Z <a id="etl.dialects.amazon_settlements"></a>
2025-08-20T18:26:21.3405730Z 
2025-08-20T18:26:21.3405859Z # etl.dialects.amazon\_settlements
2025-08-20T18:26:21.3406065Z 
2025-08-20T18:26:21.3406170Z <a id="etl.dialects"></a>
2025-08-20T18:26:21.3406348Z 
2025-08-20T18:26:21.3406449Z # etl.dialects
2025-08-20T18:26:21.3406616Z 
2025-08-20T18:26:21.3406726Z <a id="ingest"></a>
2025-08-20T18:26:21.3407090Z 
2025-08-20T18:26:21.3407205Z # ingest
2025-08-20T18:26:21.3407345Z 
2025-08-20T18:26:21.3407486Z <a id="ingest.maintenance"></a>
2025-08-20T18:26:21.3407725Z 
2025-08-20T18:26:21.3407845Z # ingest.maintenance
2025-08-20T18:26:21.3408042Z 
2025-08-20T18:26:21.3408173Z <a id="ingest.copy_loader"></a>
2025-08-20T18:26:21.3408400Z 
2025-08-20T18:26:21.3408517Z # ingest.copy\_loader
2025-08-20T18:26:21.3408719Z 
2025-08-20T18:26:21.3408890Z <a id="ingest.copy_loader.copy_df_via_temp"></a>
2025-08-20T18:26:21.3409207Z 
2025-08-20T18:26:21.3409346Z #### copy\_df\_via\_temp
2025-08-20T18:26:21.3409568Z 
2025-08-20T18:26:21.3409686Z ```python
2025-08-20T18:26:21.3410011Z def copy_df_via_temp(engine: Engine,
2025-08-20T18:26:21.3410443Z                      df: pd.DataFrame,
2025-08-20T18:26:21.3410881Z                      target_table: str,
2025-08-20T18:26:21.3411285Z                      *,
2025-08-20T18:26:21.3411674Z                      target_schema: Optional[str] = None,
2025-08-20T18:26:21.3412167Z                      columns: Sequence[str],
2025-08-20T18:26:21.3412887Z                      conflict_cols: Optional[Sequence[str]] = None,
2025-08-20T18:26:21.3413610Z                      analyze_after: bool = False,
2025-08-20T18:26:21.3414101Z                      connection: Any | None = None) -> int
2025-08-20T18:26:21.3414536Z ```
2025-08-20T18:26:21.3414867Z 
2025-08-20T18:26:21.3415275Z Bulk load *df* into *target_table* using COPY and a staging table.
2025-08-20T18:26:21.3415813Z 
2025-08-20T18:26:21.3415975Z <a id="ingest.tests.test_smoke"></a>
2025-08-20T18:26:21.3416264Z 
2025-08-20T18:26:21.3416416Z # ingest.tests.test\_smoke
2025-08-20T18:26:21.3416650Z 
2025-08-20T18:26:21.3416784Z <a id="ingest.tests"></a>
2025-08-20T18:26:21.3417012Z 
2025-08-20T18:26:21.3417142Z # ingest.tests
2025-08-20T18:26:21.3417329Z 
2025-08-20T18:26:21.3417482Z <a id="ingest.upload_router"></a>
2025-08-20T18:26:21.3417763Z 
2025-08-20T18:26:21.3417898Z # ingest.upload\_router
2025-08-20T18:26:21.3418132Z 
2025-08-20T18:26:21.3418298Z <a id="ingest.email_watcher"></a>
2025-08-20T18:26:21.3418565Z 
2025-08-20T18:26:21.3418702Z # ingest.email\_watcher
2025-08-20T18:26:21.3418918Z 
2025-08-20T18:26:21.3419086Z <a id="ingest.email_watcher.main"></a>
2025-08-20T18:26:21.3419377Z 
2025-08-20T18:26:21.3419491Z #### main
2025-08-20T18:26:21.3419660Z 
2025-08-20T18:26:21.3419779Z ```python
2025-08-20T18:26:21.3420077Z def main() -> dict[str, str]
2025-08-20T18:26:21.3420431Z ```
2025-08-20T18:26:21.3420582Z 
2025-08-20T18:26:21.3420842Z Upload CSV/XLSX attachments to MinIO and trigger ingestion.
2025-08-20T18:26:21.3421238Z 
2025-08-20T18:26:21.3421473Z Returns {"status": "success"} when processing completes.
2025-08-20T18:26:21.3421861Z 
2025-08-20T18:26:21.3422000Z <a id="ingest.tasks"></a>
2025-08-20T18:26:21.3422227Z 
2025-08-20T18:26:21.3422347Z # ingest.tasks
2025-08-20T18:26:21.3422559Z 
2025-08-20T18:26:21.3422788Z <a id="ingest.tasks.task_import_file"></a>
2025-08-20T18:26:21.3423335Z 
2025-08-20T18:26:21.3423493Z #### task\_import\_file
2025-08-20T18:26:21.3423731Z 
2025-08-20T18:26:21.3423859Z ```python
2025-08-20T18:26:21.3424243Z @celery_app.task(name="ingest.import_file", bind=True)
2025-08-20T18:26:21.3424776Z def task_import_file(self: Any,
2025-08-20T18:26:21.3425165Z                      uri: str,
2025-08-20T18:26:21.3425571Z                      report_type: str | None = None,
2025-08-20T18:26:21.3426053Z                      force: bool = False) -> dict[str, Any]
2025-08-20T18:26:21.3426489Z ```
2025-08-20T18:26:21.3426641Z 
2025-08-20T18:26:21.3426893Z Import a file into Postgres using existing ETL pipeline.
2025-08-20T18:26:21.3427279Z 
2025-08-20T18:26:21.3427432Z <a id="ingest.celery_app"></a>
2025-08-20T18:26:21.3427696Z 
2025-08-20T18:26:21.3427829Z # ingest.celery\_app
2025-08-20T18:26:21.3428040Z 
2025-08-20T18:26:21.3428187Z <a id="ingest.ingest_router"></a>
2025-08-20T18:26:21.3428463Z 
2025-08-20T18:26:21.3428597Z # ingest.ingest\_router
2025-08-20T18:26:21.3428815Z 
2025-08-20T18:26:21.3429212Z <a id="logistics_etl"></a>
2025-08-20T18:26:21.3429463Z 
2025-08-20T18:26:21.3429587Z # logistics\_etl
2025-08-20T18:26:21.3429783Z 
2025-08-20T18:26:21.3429931Z Daily logistics ETL job.
2025-08-20T18:26:21.3430161Z 
2025-08-20T18:26:21.3430310Z <a id="logistics_etl.__main__"></a>
2025-08-20T18:26:21.3430600Z 
2025-08-20T18:26:21.3430738Z # logistics\_etl.\_\_main\_\_
2025-08-20T18:26:21.3430986Z 
2025-08-20T18:26:21.3431138Z <a id="logistics_etl.dsn"></a>
2025-08-20T18:26:21.3431384Z 
2025-08-20T18:26:21.3431513Z # logistics\_etl.dsn
2025-08-20T18:26:21.3431717Z 
2025-08-20T18:26:21.3431942Z Local DSN builder to avoid cross-service dependency.
2025-08-20T18:26:21.3432305Z 
2025-08-20T18:26:21.3432469Z <a id="logistics_etl.dsn.build_dsn"></a>
2025-08-20T18:26:21.3432783Z 
2025-08-20T18:26:21.3432901Z #### build\_dsn
2025-08-20T18:26:21.3433272Z 
2025-08-20T18:26:21.3433401Z ```python
2025-08-20T18:26:21.3433732Z def build_dsn(sync: bool = True) -> str
2025-08-20T18:26:21.3434142Z ```
2025-08-20T18:26:21.3434306Z 
2025-08-20T18:26:21.3434773Z Return a Postgres DSN assembled from environment variables.
2025-08-20T18:26:21.3435179Z 
2025-08-20T18:26:21.3435459Z Prefers explicit DSNs via ``PG_SYNC_DSN``/``PG_ASYNC_DSN`` or
2025-08-20T18:26:21.3436168Z ``DATABASE_URL``. Falls back to individual PG_* settings and raises an
2025-08-20T18:26:21.3436791Z error when any required variable is missing.
2025-08-20T18:26:21.3437110Z 
2025-08-20T18:26:21.3437289Z <a id="logistics_etl.tests.conftest"></a>
2025-08-20T18:26:21.3437600Z 
2025-08-20T18:26:21.3437759Z # logistics\_etl.tests.conftest
2025-08-20T18:26:21.3438020Z 
2025-08-20T18:26:21.3438214Z <a id="logistics_etl.tests.test_repository"></a>
2025-08-20T18:26:21.3438550Z 
2025-08-20T18:26:21.3438711Z # logistics\_etl.tests.test\_repository
2025-08-20T18:26:21.3439021Z 
2025-08-20T18:26:21.3439193Z <a id="logistics_etl.tests.test_cron"></a>
2025-08-20T18:26:21.3439502Z 
2025-08-20T18:26:21.3439660Z # logistics\_etl.tests.test\_cron
2025-08-20T18:26:21.3439943Z 
2025-08-20T18:26:21.3440123Z <a id="logistics_etl.tests.test_imports"></a>
2025-08-20T18:26:21.3440452Z 
2025-08-20T18:26:21.3440619Z # logistics\_etl.tests.test\_imports
2025-08-20T18:26:21.3440904Z 
2025-08-20T18:26:21.3441073Z <a id="logistics_etl.tests.test_smoke"></a>
2025-08-20T18:26:21.3441395Z 
2025-08-20T18:26:21.3441550Z # logistics\_etl.tests.test\_smoke
2025-08-20T18:26:21.3441830Z 
2025-08-20T18:26:21.3442012Z <a id="logistics_etl.tests.test_client"></a>
2025-08-20T18:26:21.3442325Z 
2025-08-20T18:26:21.3442478Z # logistics\_etl.tests.test\_client
2025-08-20T18:26:21.3442759Z 
2025-08-20T18:26:21.3442919Z <a id="logistics_etl.tests"></a>
2025-08-20T18:26:21.3443369Z 
2025-08-20T18:26:21.3443511Z # logistics\_etl.tests
2025-08-20T18:26:21.3443737Z 
2025-08-20T18:26:21.3443869Z <a id="logistics_etl.flow"></a>
2025-08-20T18:26:21.3444131Z 
2025-08-20T18:26:21.3444271Z # logistics\_etl.flow
2025-08-20T18:26:21.3444490Z 
2025-08-20T18:26:21.3444644Z <a id="logistics_etl.client"></a>
2025-08-20T18:26:21.3444936Z 
2025-08-20T18:26:21.3510691Z # logistics\_etl.client
2025-08-20T18:26:21.3511006Z 
2025-08-20T18:26:21.3511160Z <a id="logistics_etl.cron"></a>
2025-08-20T18:26:21.3511421Z 
2025-08-20T18:26:21.3511549Z # logistics\_etl.cron
2025-08-20T18:26:21.3511738Z 
2025-08-20T18:26:21.3511863Z <a id="logistics_etl.db"></a>
2025-08-20T18:26:21.3512089Z 
2025-08-20T18:26:21.3512208Z # logistics\_etl.db
2025-08-20T18:26:21.3512379Z 
2025-08-20T18:26:21.3512519Z <a id="logistics_etl.repository"></a>
2025-08-20T18:26:21.3512771Z 
2025-08-20T18:26:21.3512893Z # logistics\_etl.repository
2025-08-20T18:26:21.3513304Z 
2025-08-20T18:26:21.3513426Z <a id="alert_bot"></a>
2025-08-20T18:26:21.3513623Z 
2025-08-20T18:26:21.3513736Z # alert\_bot
2025-08-20T18:26:21.3513895Z 
2025-08-20T18:26:21.3514055Z <a id="alert_bot.tests.test_smoke"></a>
2025-08-20T18:26:21.3514314Z 
2025-08-20T18:26:21.3514451Z # alert\_bot.tests.test\_smoke
2025-08-20T18:26:21.3514691Z 
2025-08-20T18:26:21.3514831Z <a id="alert_bot.tests"></a>
2025-08-20T18:26:21.3515317Z 
2025-08-20T18:26:21.3515441Z # alert\_bot.tests
2025-08-20T18:26:21.3515618Z 
2025-08-20T18:26:21.3515743Z <a id="alert_bot.alert_bot"></a>
2025-08-20T18:26:21.3515967Z 
2025-08-20T18:26:21.3516083Z # alert\_bot.alert\_bot
2025-08-20T18:26:21.3516263Z 
2025-08-20T18:26:21.3516382Z <a id="alert_bot.rules"></a>
2025-08-20T18:26:21.3516594Z 
2025-08-20T18:26:21.3516713Z # alert\_bot.rules
2025-08-20T18:26:21.3516876Z 
2025-08-20T18:26:21.3516977Z <a id="common"></a>
2025-08-20T18:26:21.3517150Z 
2025-08-20T18:26:21.3517244Z # common
2025-08-20T18:26:21.3517375Z 
2025-08-20T18:26:21.3517492Z <a id="common.dsn"></a>
2025-08-20T18:26:21.3517673Z 
2025-08-20T18:26:21.3517771Z # common.dsn
2025-08-20T18:26:21.3517922Z 
2025-08-20T18:26:21.3518055Z <a id="common.dsn.build_dsn"></a>
2025-08-20T18:26:21.3518287Z 
2025-08-20T18:26:21.3518389Z #### build\_dsn
2025-08-20T18:26:21.3518550Z 
2025-08-20T18:26:21.3518645Z ```python
2025-08-20T18:26:21.3518913Z def build_dsn(sync: bool = True) -> str
2025-08-20T18:26:21.3519276Z ```
2025-08-20T18:26:21.3519569Z 
2025-08-20T18:26:21.3519771Z Return a Postgres DSN, validating required variables.
2025-08-20T18:26:21.3520088Z 
2025-08-20T18:26:21.3520375Z The function prefers explicit DSNs via ``PG_SYNC_DSN`` / ``PG_ASYNC_DSN`` or
2025-08-20T18:26:21.3521039Z ``DATABASE_URL``.  If those are absent it assembles a connection string from
2025-08-20T18:26:21.3521663Z ``PG_HOST`` and related variables and raises a helpful error when any are
2025-08-20T18:26:21.3522160Z missing.
2025-08-20T18:26:21.3522389Z 
2025-08-20T18:26:21.3522526Z <a id="common.models_vendor"></a>
2025-08-20T18:26:21.3522751Z 
2025-08-20T18:26:21.3522863Z # common.models\_vendor
2025-08-20T18:26:21.3523043Z 
2025-08-20T18:26:21.3523421Z <a id="common.models_vendor.Vendor"></a>
2025-08-20T18:26:21.3523673Z 
2025-08-20T18:26:21.3523778Z ## Vendor Objects
2025-08-20T18:26:21.3523946Z 
2025-08-20T18:26:21.3524041Z ```python
2025-08-20T18:26:21.3524279Z class Vendor(Base)
2025-08-20T18:26:21.3524557Z ```
2025-08-20T18:26:21.3524693Z 
2025-08-20T18:26:21.3524817Z Vendor of inventory items.
2025-08-20T18:26:21.3525024Z 
2025-08-20T18:26:21.3525177Z <a id="common.models_vendor.VendorPrice"></a>
2025-08-20T18:26:21.3525461Z 
2025-08-20T18:26:21.3525579Z ## VendorPrice Objects
2025-08-20T18:26:21.3525761Z 
2025-08-20T18:26:21.3525861Z ```python
2025-08-20T18:26:21.3526111Z class VendorPrice(Base)
2025-08-20T18:26:21.3526397Z ```
2025-08-20T18:26:21.3526527Z 
2025-08-20T18:26:21.3526681Z Association table linking vendors to pricing.
2025-08-20T18:26:21.3526949Z 
2025-08-20T18:26:21.3527076Z <a id="common.db_url"></a>
2025-08-20T18:26:21.3527270Z 
2025-08-20T18:26:21.3527367Z # common.db\_url
2025-08-20T18:26:21.3527535Z 
2025-08-20T18:26:21.3527669Z <a id="common.db_url.build_url"></a>
2025-08-20T18:26:21.3527913Z 
2025-08-20T18:26:21.3528011Z #### build\_url
2025-08-20T18:26:21.3528180Z 
2025-08-20T18:26:21.3528274Z ```python
2025-08-20T18:26:21.3528542Z def build_url(async_: bool = True) -> str
2025-08-20T18:26:21.3528894Z ```
2025-08-20T18:26:21.3529019Z 
2025-08-20T18:26:21.3529186Z Return Postgres DSN from environment variables.
2025-08-20T18:26:21.3529467Z 
2025-08-20T18:26:21.3529584Z <a id="common.keepa"></a>
2025-08-20T18:26:21.3529788Z 
2025-08-20T18:26:21.3529890Z # common.keepa
2025-08-20T18:26:21.3530042Z 
2025-08-20T18:26:21.3530146Z <a id="common.llm"></a>
2025-08-20T18:26:21.3530336Z 
2025-08-20T18:26:21.3530433Z # common.llm
2025-08-20T18:26:21.3530576Z 
2025-08-20T18:26:21.3530708Z <a id="common.settings"></a>
2025-08-20T18:26:21.3530912Z 
2025-08-20T18:26:21.3531012Z # common.settings
2025-08-20T18:26:21.3531172Z 
2025-08-20T18:26:21.3531284Z <a id="common.db"></a>
2025-08-20T18:26:21.3531475Z 
2025-08-20T18:26:21.3531568Z # common.db
2025-08-20T18:26:21.3531709Z 
2025-08-20T18:26:21.3531849Z <a id="common.db.build_sqlalchemy_url"></a>
2025-08-20T18:26:21.3532108Z 
2025-08-20T18:26:21.3532226Z #### build\_sqlalchemy\_url
2025-08-20T18:26:21.3532431Z 
2025-08-20T18:26:21.3532525Z ```python
2025-08-20T18:26:21.3533185Z def build_sqlalchemy_url() -> str
2025-08-20T18:26:21.3533510Z ```
2025-08-20T18:26:21.3533639Z 
2025-08-20T18:26:21.3533780Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T18:26:21.3534040Z 
2025-08-20T18:26:21.3534182Z <a id="common.db.build_asyncpg_dsn"></a>
2025-08-20T18:26:21.3534446Z 
2025-08-20T18:26:21.3534557Z #### build\_asyncpg\_dsn
2025-08-20T18:26:21.3534740Z 
2025-08-20T18:26:21.3534843Z ```python
2025-08-20T18:26:21.3535083Z def build_asyncpg_dsn() -> str
2025-08-20T18:26:21.3535373Z ```
2025-08-20T18:26:21.3535489Z 
2025-08-20T18:26:21.3535681Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T18:26:21.3535995Z 
2025-08-20T18:26:21.3536114Z <a id="common.db.refresh_mvs"></a>
2025-08-20T18:26:21.3536337Z 
2025-08-20T18:26:21.3536435Z #### refresh\_mvs
2025-08-20T18:26:21.3536599Z 
2025-08-20T18:26:21.3536691Z ```python
2025-08-20T18:26:21.3536984Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T18:26:21.3537349Z ```
2025-08-20T18:26:21.3537481Z 
2025-08-20T18:26:21.3537857Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T18:26:21.3538176Z 
2025-08-20T18:26:21.3538296Z <a id="common.config"></a>
2025-08-20T18:26:21.3538489Z 
2025-08-20T18:26:21.3538592Z # common.config
2025-08-20T18:26:21.3538745Z 
2025-08-20T18:26:21.3538857Z <a id="common.base"></a>
2025-08-20T18:26:21.3539046Z 
2025-08-20T18:26:21.3539142Z # common.base
2025-08-20T18:26:21.3539289Z 
2025-08-20T18:26:21.3539412Z <a id="common.base.Base"></a>
2025-08-20T18:26:21.3539619Z 
2025-08-20T18:26:21.3539717Z ## Base Objects
2025-08-20T18:26:21.3539871Z 
2025-08-20T18:26:21.3539962Z ```python
2025-08-20T18:26:21.3540202Z class Base(DeclarativeBase)
2025-08-20T18:26:21.3540492Z ```
2025-08-20T18:26:21.3540608Z 
2025-08-20T18:26:21.3540738Z Base class for SQLAlchemy models.
2025-08-20T18:26:21.3540982Z 
2025-08-20T18:26:21.3541090Z <a id="repricer"></a>
2025-08-20T18:26:21.3541293Z 
2025-08-20T18:26:21.3541447Z # repricer
2025-08-20T18:26:21.3541586Z 
2025-08-20T18:26:21.3541721Z <a id="repricer.app.schemas"></a>
2025-08-20T18:26:21.3541973Z 
2025-08-20T18:26:21.3542089Z # repricer.app.schemas
2025-08-20T18:26:21.3542267Z 
2025-08-20T18:26:21.3542389Z <a id="repricer.app.deps"></a>
2025-08-20T18:26:21.3542604Z 
2025-08-20T18:26:21.3542712Z # repricer.app.deps
2025-08-20T18:26:21.3542880Z 
2025-08-20T18:26:21.3543212Z Placeholder module for Keepa / SP-API clients.
2025-08-20T18:26:21.3543492Z 
2025-08-20T18:26:21.3543615Z <a id="repricer.app.logic"></a>
2025-08-20T18:26:21.3543837Z 
2025-08-20T18:26:21.3543948Z # repricer.app.logic
2025-08-20T18:26:21.3544118Z 
2025-08-20T18:26:21.3544262Z <a id="repricer.app.logic.MIN_MARGIN"></a>
2025-08-20T18:26:21.3544532Z 
2025-08-20T18:26:21.3544629Z #### MIN\_MARGIN
2025-08-20T18:26:21.3544775Z 
2025-08-20T18:26:21.3544876Z 15 % ROI
2025-08-20T18:26:21.3545004Z 
2025-08-20T18:26:21.3545159Z <a id="repricer.app.logic.compute_price"></a>
2025-08-20T18:26:21.3545427Z 
2025-08-20T18:26:21.3545537Z #### compute\_price
2025-08-20T18:26:21.3545703Z 
2025-08-20T18:26:21.3545809Z ```python
2025-08-20T18:26:21.3546175Z def compute_price(asin: str, cost: Decimal, fees: Decimal) -> Decimal
2025-08-20T18:26:21.3546626Z ```
2025-08-20T18:26:21.3546759Z 
2025-08-20T18:26:21.3546920Z Toy algorithm: ensure 15 % ROI and round to cents.
2025-08-20T18:26:21.3547332Z Replace with real competitive logic later.
2025-08-20T18:26:21.3547579Z 
2025-08-20T18:26:21.3547704Z <a id="repricer.app.main"></a>
2025-08-20T18:26:21.3547912Z 
2025-08-20T18:26:21.3548022Z # repricer.app.main
2025-08-20T18:26:21.3548184Z 
2025-08-20T18:26:21.3548296Z <a id="repricer.app"></a>
2025-08-20T18:26:21.3548491Z 
2025-08-20T18:26:21.3548593Z # repricer.app
2025-08-20T18:26:21.3548740Z 
2025-08-20T18:26:21.3548884Z <a id="repricer.tests.test_imports"></a>
2025-08-20T18:26:21.3549132Z 
2025-08-20T18:26:21.3549249Z # repricer.tests.test\_imports
2025-08-20T18:26:21.3549471Z 
2025-08-20T18:26:21.3549600Z <a id="repricer.tests.test_smoke"></a>
2025-08-20T18:26:21.3550020Z 
2025-08-20T18:26:21.3550143Z # repricer.tests.test\_smoke
2025-08-20T18:26:21.3550362Z 
2025-08-20T18:26:21.3550475Z <a id="repricer.tests"></a>
2025-08-20T18:26:21.3550665Z 
2025-08-20T18:26:21.3550771Z # repricer.tests
2025-08-20T18:26:21.3550930Z 
2025-08-20T18:26:21.3551023Z <a id="db"></a>
2025-08-20T18:26:21.3551174Z 
2025-08-20T18:26:21.3551273Z # db
2025-08-20T18:26:21.3551398Z 
2025-08-20T18:26:21.3551509Z <a id="db.utils.views"></a>
2025-08-20T18:26:21.3551705Z 
2025-08-20T18:26:21.3551803Z # db.utils.views
2025-08-20T18:26:21.3551957Z 
2025-08-20T18:26:21.3552093Z <a id="db.utils.views.replace_view"></a>
2025-08-20T18:26:21.3552352Z 
2025-08-20T18:26:21.3552452Z #### replace\_view
2025-08-20T18:26:21.3552607Z 
2025-08-20T18:26:21.3552709Z ```python
2025-08-20T18:26:21.3552997Z def replace_view(name: str, new_sql: str) -> None
2025-08-20T18:26:21.3553537Z ```
2025-08-20T18:26:21.3553668Z 
2025-08-20T18:26:21.3553802Z Drop and recreate a SQL view atomically.
2025-08-20T18:26:21.3554060Z 
2025-08-20T18:26:21.3554182Z <a id="db.utils"></a>
2025-08-20T18:26:21.3554546Z 
2025-08-20T18:26:21.3554653Z # db.utils
2025-08-20T18:26:21.3554786Z 
2025-08-20T18:26:21.3554905Z <a id="price_importer"></a>
2025-08-20T18:26:21.3555103Z 
2025-08-20T18:26:21.3555214Z # price\_importer
2025-08-20T18:26:21.3555369Z 
2025-08-20T18:26:21.3555525Z <a id="price_importer.services_common.dsn"></a>
2025-08-20T18:26:21.3555805Z 
2025-08-20T18:26:21.3555941Z # price\_importer.services\_common.dsn
2025-08-20T18:26:21.3556187Z 
2025-08-20T18:26:21.3556381Z <a id="price_importer.services_common.dsn.build_dsn"></a>
2025-08-20T18:26:21.3556690Z 
2025-08-20T18:26:21.3556791Z #### build\_dsn
2025-08-20T18:26:21.3556940Z 
2025-08-20T18:26:21.3557042Z ```python
2025-08-20T18:26:21.3557294Z def build_dsn(sync: bool = True) -> str
2025-08-20T18:26:21.3557627Z ```
2025-08-20T18:26:21.3557747Z 
2025-08-20T18:26:21.3557847Z Return safe DSN.
2025-08-20T18:26:21.3558007Z 
2025-08-20T18:26:21.3558280Z Prefers explicit DSNs via ``PG_SYNC_DSN``/``PG_ASYNC_DSN`` or ``DATABASE_URL``.
2025-08-20T18:26:21.3558820Z Falls back to individual PG_* variables.
2025-08-20T18:26:21.3559501Z sync=True → SQLAlchemy (+psycopg) else plain asyncpg.
2025-08-20T18:26:21.3559797Z 
2025-08-20T18:26:21.3559989Z <a id="price_importer.services_common.models_vendor"></a>
2025-08-20T18:26:21.3560296Z 
2025-08-20T18:26:21.3560462Z # price\_importer.services\_common.models\_vendor
2025-08-20T18:26:21.3560756Z 
2025-08-20T18:26:21.3560921Z <a id="price_importer.services_common.db_url"></a>
2025-08-20T18:26:21.3561199Z 
2025-08-20T18:26:21.3561345Z # price\_importer.services\_common.db\_url
2025-08-20T18:26:21.3561592Z 
2025-08-20T18:26:21.3561786Z <a id="price_importer.services_common.db_url.build_url"></a>
2025-08-20T18:26:21.3562102Z 
2025-08-20T18:26:21.3562211Z #### build\_url
2025-08-20T18:26:21.3562362Z 
2025-08-20T18:26:21.3562459Z ```python
2025-08-20T18:26:21.3562726Z def build_url(async_: bool = True) -> str
2025-08-20T18:26:21.3563252Z ```
2025-08-20T18:26:21.3563395Z 
2025-08-20T18:26:21.3563572Z Return Postgres DSN from environment variables.
2025-08-20T18:26:21.3563863Z 
2025-08-20T18:26:21.3564034Z <a id="price_importer.services_common.keepa"></a>
2025-08-20T18:26:21.3564307Z 
2025-08-20T18:26:21.3564444Z # price\_importer.services\_common.keepa
2025-08-20T18:26:21.3564699Z 
2025-08-20T18:26:21.3564855Z <a id="price_importer.services_common.llm"></a>
2025-08-20T18:26:21.3565124Z 
2025-08-20T18:26:21.3565259Z # price\_importer.services\_common.llm
2025-08-20T18:26:21.3565505Z 
2025-08-20T18:26:21.3565677Z <a id="price_importer.services_common.settings"></a>
2025-08-20T18:26:21.3565965Z 
2025-08-20T18:26:21.3566115Z # price\_importer.services\_common.settings
2025-08-20T18:26:21.3566368Z 
2025-08-20T18:26:21.3566519Z <a id="price_importer.services_common.db"></a>
2025-08-20T18:26:21.3566786Z 
2025-08-20T18:26:21.3566920Z # price\_importer.services\_common.db
2025-08-20T18:26:21.3567152Z 
2025-08-20T18:26:21.3567385Z <a id="price_importer.services_common.db.build_sqlalchemy_url"></a>
2025-08-20T18:26:21.3567946Z 
2025-08-20T18:26:21.3568081Z #### build\_sqlalchemy\_url
2025-08-20T18:26:21.3568286Z 
2025-08-20T18:26:21.3568390Z ```python
2025-08-20T18:26:21.3568642Z def build_sqlalchemy_url() -> str
2025-08-20T18:26:21.3568953Z ```
2025-08-20T18:26:21.3569075Z 
2025-08-20T18:26:21.3569222Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T18:26:21.3569487Z 
2025-08-20T18:26:21.3569710Z <a id="price_importer.services_common.db.build_asyncpg_dsn"></a>
2025-08-20T18:26:21.3570058Z 
2025-08-20T18:26:21.3570181Z #### build\_asyncpg\_dsn
2025-08-20T18:26:21.3570368Z 
2025-08-20T18:26:21.3570466Z ```python
2025-08-20T18:26:21.3570738Z def build_asyncpg_dsn() -> str
2025-08-20T18:26:21.3571034Z ```
2025-08-20T18:26:21.3571163Z 
2025-08-20T18:26:21.3571355Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T18:26:21.3571667Z 
2025-08-20T18:26:21.3571857Z <a id="price_importer.services_common.db.refresh_mvs"></a>
2025-08-20T18:26:21.3572175Z 
2025-08-20T18:26:21.3572286Z #### refresh\_mvs
2025-08-20T18:26:21.3572614Z 
2025-08-20T18:26:21.3572720Z ```python
2025-08-20T18:26:21.3573015Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T18:26:21.3573549Z ```
2025-08-20T18:26:21.3573671Z 
2025-08-20T18:26:21.3573870Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T18:26:21.3574188Z 
2025-08-20T18:26:21.3574335Z <a id="price_importer.services_common"></a>
2025-08-20T18:26:21.3574595Z 
2025-08-20T18:26:21.3574732Z # price\_importer.services\_common
2025-08-20T18:26:21.3574970Z 
2025-08-20T18:26:21.3575125Z <a id="price_importer.services_common.base"></a>
2025-08-20T18:26:21.3575400Z 
2025-08-20T18:26:21.3575547Z # price\_importer.services\_common.base
2025-08-20T18:26:21.3575791Z 
2025-08-20T18:26:21.3575923Z <a id="price_importer.normaliser"></a>
2025-08-20T18:26:21.3576171Z 
2025-08-20T18:26:21.3576300Z # price\_importer.normaliser
2025-08-20T18:26:21.3576496Z 
2025-08-20T18:26:21.3576650Z <a id="price_importer.common.models_vendor"></a>
2025-08-20T18:26:21.3576940Z 
2025-08-20T18:26:21.3577081Z # price\_importer.common.models\_vendor
2025-08-20T18:26:21.3577322Z 
2025-08-20T18:26:21.3577467Z <a id="price_importer.common.db_url"></a>
2025-08-20T18:26:21.3577720Z 
2025-08-20T18:26:21.3577845Z # price\_importer.common.db\_url
2025-08-20T18:26:21.3578066Z 
2025-08-20T18:26:21.3578225Z <a id="price_importer.common.db_url.make_dsn"></a>
2025-08-20T18:26:21.3578505Z 
2025-08-20T18:26:21.3578612Z #### make\_dsn
2025-08-20T18:26:21.3578758Z 
2025-08-20T18:26:21.3578853Z ```python
2025-08-20T18:26:21.3579108Z def make_dsn(async_: bool = False) -> str
2025-08-20T18:26:21.3579440Z ```
2025-08-20T18:26:21.3579562Z 
2025-08-20T18:26:21.3579687Z Return DSN using shared builder.
2025-08-20T18:26:21.3579919Z 
2025-08-20T18:26:21.3580087Z <a id="price_importer.common.db_url.build_url"></a>
2025-08-20T18:26:21.3580380Z 
2025-08-20T18:26:21.3580478Z #### build\_url
2025-08-20T18:26:21.3580630Z 
2025-08-20T18:26:21.3580736Z ```python
2025-08-20T18:26:21.3580999Z def build_url(async_: bool = False) -> str
2025-08-20T18:26:21.3581358Z ```
2025-08-20T18:26:21.3581478Z 
2025-08-20T18:26:21.3581668Z Return Postgres DSN built from environment variables.
2025-08-20T18:26:21.3581969Z 
2025-08-20T18:26:21.3582096Z <a id="price_importer.common"></a>
2025-08-20T18:26:21.3582313Z 
2025-08-20T18:26:21.3582426Z # price\_importer.common
2025-08-20T18:26:21.3582616Z 
2025-08-20T18:26:21.3582748Z <a id="price_importer.common.base"></a>
2025-08-20T18:26:21.3583004Z 
2025-08-20T18:26:21.3583283Z # price\_importer.common.base
2025-08-20T18:26:21.3583488Z 
2025-08-20T18:26:21.3583632Z <a id="price_importer.tests.conftest"></a>
2025-08-20T18:26:21.3583884Z 
2025-08-20T18:26:21.3584008Z # price\_importer.tests.conftest
2025-08-20T18:26:21.3584220Z 
2025-08-20T18:26:21.3584362Z <a id="price_importer.tests.test_reader"></a>
2025-08-20T18:26:21.3584652Z 
2025-08-20T18:26:21.3584780Z # price\_importer.tests.test\_reader
2025-08-20T18:26:21.3585007Z 
2025-08-20T18:26:21.3585165Z <a id="price_importer.tests.test_imports"></a>
2025-08-20T18:26:21.3585610Z 
2025-08-20T18:26:21.3585744Z # price\_importer.tests.test\_imports
2025-08-20T18:26:21.3585993Z 
2025-08-20T18:26:21.3586137Z <a id="price_importer.tests.test_smoke"></a>
2025-08-20T18:26:21.3586388Z 
2025-08-20T18:26:21.3586516Z # price\_importer.tests.test\_smoke
2025-08-20T18:26:21.3586758Z 
2025-08-20T18:26:21.3586913Z <a id="price_importer.tests.test_normaliser"></a>
2025-08-20T18:26:21.3587177Z 
2025-08-20T18:26:21.3587323Z # price\_importer.tests.test\_normaliser
2025-08-20T18:26:21.3587586Z 
2025-08-20T18:26:21.3587717Z <a id="price_importer.tests"></a>
2025-08-20T18:26:21.3587967Z 
2025-08-20T18:26:21.3588086Z # price\_importer.tests
2025-08-20T18:26:21.3588284Z 
2025-08-20T18:26:21.3588421Z <a id="price_importer.reader"></a>
2025-08-20T18:26:21.3588675Z 
2025-08-20T18:26:21.3588798Z # price\_importer.reader
2025-08-20T18:26:21.3589004Z 
2025-08-20T18:26:21.3589157Z <a id="price_importer.repository"></a>
2025-08-20T18:26:21.3589388Z 
2025-08-20T18:26:21.3589534Z # price\_importer.repository
2025-08-20T18:26:21.3589917Z 
2025-08-20T18:26:21.3590048Z <a id="price_importer.import"></a>
2025-08-20T18:26:21.3590282Z 
2025-08-20T18:26:21.3590402Z # price\_importer.import
2025-08-20T18:26:21.3590602Z 
2025-08-20T18:26:21.3590711Z <a id="fees_h10"></a>
2025-08-20T18:26:21.3590880Z 
2025-08-20T18:26:21.3590984Z # fees\_h10
2025-08-20T18:26:21.3591115Z 
2025-08-20T18:26:21.3591227Z <a id="fees_h10.worker"></a>
2025-08-20T18:26:21.3591434Z 
2025-08-20T18:26:21.3591540Z # fees\_h10.worker
2025-08-20T18:26:21.3591696Z 
2025-08-20T18:26:21.3591845Z <a id="fees_h10.worker.list_active_asins"></a>
2025-08-20T18:26:21.3592106Z 
2025-08-20T18:26:21.3592219Z #### list\_active\_asins
2025-08-20T18:26:21.3592394Z 
2025-08-20T18:26:21.3592496Z ```python
2025-08-20T18:26:21.3592750Z def list_active_asins() -> list[str]
2025-08-20T18:26:21.3593223Z ```
2025-08-20T18:26:21.3593351Z 
2025-08-20T18:26:21.3593519Z Return known ASINs or an empty list if unavailable.
2025-08-20T18:26:21.3593825Z 
2025-08-20T18:26:21.3593963Z <a id="fees_h10.tests.test_smoke"></a>
2025-08-20T18:26:21.3594211Z 
2025-08-20T18:26:21.3594333Z # fees\_h10.tests.test\_smoke
2025-08-20T18:26:21.3594544Z 
2025-08-20T18:26:21.3594658Z <a id="fees_h10.tests"></a>
2025-08-20T18:26:21.3594856Z 
2025-08-20T18:26:21.3594964Z # fees\_h10.tests
2025-08-20T18:26:21.3595122Z 
2025-08-20T18:26:21.3595235Z <a id="fees_h10.client"></a>
2025-08-20T18:26:21.3595434Z 
2025-08-20T18:26:21.3595535Z # fees\_h10.client
2025-08-20T18:26:21.3595688Z 
2025-08-20T18:26:21.3595805Z <a id="fees_h10.repository"></a>
2025-08-20T18:26:21.3596022Z 
2025-08-20T18:26:21.3596128Z # fees\_h10.repository
2025-08-20T18:26:21.3596296Z 
2025-08-20T18:26:21.3596458Z <a id="fees_h10.repository.upsert_fees_raw"></a>
2025-08-20T18:26:21.3596727Z 
2025-08-20T18:26:21.3596835Z #### upsert\_fees\_raw
2025-08-20T18:26:21.3597002Z 
2025-08-20T18:26:21.3597104Z ```python
2025-08-20T18:26:21.3597356Z def upsert_fees_raw(engine: Engine,
2025-08-20T18:26:21.3597726Z                     rows: Iterable[Mapping[str, Any]],
2025-08-20T18:26:21.3598086Z                     *,
2025-08-20T18:26:21.3598423Z                     testing: bool = False) -> Optional[Dict[str, int]]
2025-08-20T18:26:21.3598806Z ```
2025-08-20T18:26:21.3598933Z 
2025-08-20T18:26:21.3599051Z Idempotent upsert for fees.
2025-08-20T18:26:21.3599252Z 
2025-08-20T18:26:21.3599478Z TESTING-only: returns counts for inserted/updated/skipped rows.
2025-08-20T18:26:21.3599976Z Assumes logical key (asin, marketplace, fee_type).
2025-08-20T18:26:21.3600434Z Only updates when one of the mutable fields changes.
2025-08-20T18:26:21.3600734Z 
2025-08-20T18:26:21.3600841Z <a id="emailer"></a>
2025-08-20T18:26:21.3601013Z 
2025-08-20T18:26:21.3601107Z # emailer
2025-08-20T18:26:21.3601243Z 
2025-08-20T18:26:21.3601404Z <a id="emailer.tests.test_import_emailer"></a>
2025-08-20T18:26:21.3601670Z 
2025-08-20T18:26:21.3601806Z # emailer.tests.test\_import\_emailer
2025-08-20T18:26:21.3602059Z 
2025-08-20T18:26:21.3602376Z <a id="emailer.tests.test_smoke"></a>
2025-08-20T18:26:21.3602629Z 
2025-08-20T18:26:21.3602751Z # emailer.tests.test\_smoke
2025-08-20T18:26:21.3602964Z 
2025-08-20T18:26:21.3603238Z <a id="emailer.tests"></a>
2025-08-20T18:26:21.3603466Z 
2025-08-20T18:26:21.3603593Z # emailer.tests
2025-08-20T18:26:21.3603746Z 
2025-08-20T18:26:21.3603836Z <a id="emailer.generate_body"></a>
2025-08-20T18:26:21.3603995Z 
2025-08-20T18:26:21.3604080Z # emailer.generate\_body
2025-08-20T18:26:21.3604210Z 
2025-08-20T18:26:21.3604287Z <a id="llm_server"></a>
2025-08-20T18:26:21.3604413Z 
2025-08-20T18:26:21.3604512Z # llm\_server
2025-08-20T18:26:21.3604613Z 
2025-08-20T18:26:21.3604698Z <a id="llm_server.app"></a>
2025-08-20T18:26:21.3604829Z 
2025-08-20T18:26:21.3604900Z # llm\_server.app
2025-08-20T18:26:21.3605006Z 
