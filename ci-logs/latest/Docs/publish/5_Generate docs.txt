2025-08-20T16:48:20.5554708Z ##[group]Run pydoc-markdown
2025-08-20T16:48:20.5555010Z [36;1mpydoc-markdown[0m
2025-08-20T16:48:20.5595848Z shell: /usr/bin/bash -e {0}
2025-08-20T16:48:20.5596083Z env:
2025-08-20T16:48:20.5596312Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T16:48:20.5596716Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-08-20T16:48:20.5597094Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T16:48:20.5597428Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T16:48:20.5597753Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-08-20T16:48:20.5598088Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-08-20T16:48:20.5598362Z ##[endgroup]
2025-08-20T16:48:20.8791671Z [WARNING - pydoc_markdown.main]: Unknown configuration options:
2025-08-20T16:48:20.8792283Z Unknown key(s) "{'output_directory'}" at:
2025-08-20T16:48:20.8792864Z In "pydoc-markdown.yml"
2025-08-20T16:48:20.8793212Z   $: TypeHint(pydoc_markdown.PydocMarkdown)
2025-08-20T16:48:20.8794039Z   .renderer: TypeHint(pydoc_markdown.interfaces.Renderer)
2025-08-20T16:48:20.8794896Z   ^: TypeHint(pydoc_markdown.contrib.renderers.markdown.MarkdownRenderer)
2025-08-20T16:48:20.8795560Z 
2025-08-20T16:48:21.2514428Z <a id="__init__"></a>
2025-08-20T16:48:21.2515077Z 
2025-08-20T16:48:21.2515280Z # \_\_init\_\_
2025-08-20T16:48:21.2515542Z 
2025-08-20T16:48:21.2515716Z <a id="api"></a>
2025-08-20T16:48:21.2515982Z 
2025-08-20T16:48:21.2516140Z # api
2025-08-20T16:48:21.2516361Z 
2025-08-20T16:48:21.2516541Z <a id="api.errors"></a>
2025-08-20T16:48:21.2516747Z 
2025-08-20T16:48:21.2516857Z # api.errors
2025-08-20T16:48:21.2517013Z 
2025-08-20T16:48:21.2517165Z <a id="api.sentry_config"></a>
2025-08-20T16:48:21.2517401Z 
2025-08-20T16:48:21.2517518Z # api.sentry\_config
2025-08-20T16:48:21.2517710Z 
2025-08-20T16:48:21.2517869Z <a id="api.tests.test_stats_contracts"></a>
2025-08-20T16:48:21.2518171Z 
2025-08-20T16:48:21.2518302Z # api.tests.test\_stats\_contracts
2025-08-20T16:48:21.2518585Z 
2025-08-20T16:48:21.2518731Z <a id="api.tests.test_sentry_scrub"></a>
2025-08-20T16:48:21.2519003Z 
2025-08-20T16:48:21.2519132Z # api.tests.test\_sentry\_scrub
2025-08-20T16:48:21.2519365Z 
2025-08-20T16:48:21.2519512Z <a id="api.tests.test_roi_basic_auth"></a>
2025-08-20T16:48:21.2519786Z 
2025-08-20T16:48:21.2519913Z # api.tests.test\_roi\_basic\_auth
2025-08-20T16:48:21.2520159Z 
2025-08-20T16:48:21.2520297Z <a id="api.tests.test_errors_json"></a>
2025-08-20T16:48:21.2520561Z 
2025-08-20T16:48:21.2520691Z # api.tests.test\_errors\_json
2025-08-20T16:48:21.2520914Z 
2025-08-20T16:48:21.2521036Z <a id="api.tests.test_llm"></a>
2025-08-20T16:48:21.2521265Z 
2025-08-20T16:48:21.2521379Z # api.tests.test\_llm
2025-08-20T16:48:21.2521569Z 
2025-08-20T16:48:21.2521709Z <a id="api.tests.test_roi_filters"></a>
2025-08-20T16:48:21.2521983Z 
2025-08-20T16:48:21.2522110Z # api.tests.test\_roi\_filters
2025-08-20T16:48:21.2522341Z 
2025-08-20T16:48:21.2522778Z <a id="api.tests.test_sentry_event"></a>
2025-08-20T16:48:21.2523426Z 
2025-08-20T16:48:21.2523558Z # api.tests.test\_sentry\_event
2025-08-20T16:48:21.2523745Z 
2025-08-20T16:48:21.2523909Z <a id="api.tests.test_sentry_event.DummyTransport"></a>
2025-08-20T16:48:21.2524174Z 
2025-08-20T16:48:21.2524274Z ## DummyTransport Objects
2025-08-20T16:48:21.2524448Z 
2025-08-20T16:48:21.2524534Z ```python
2025-08-20T16:48:21.2524754Z class DummyTransport()
2025-08-20T16:48:21.2524996Z ```
2025-08-20T16:48:21.2525102Z 
2025-08-20T16:48:21.2525336Z <a id="api.tests.test_sentry_event.DummyTransport.capture_envelope"></a>
2025-08-20T16:48:21.2525689Z 
2025-08-20T16:48:21.2525782Z #### capture\_envelope
2025-08-20T16:48:21.2525937Z 
2025-08-20T16:48:21.2526019Z ```python
2025-08-20T16:48:21.2526241Z def capture_envelope(envelope)
2025-08-20T16:48:21.2526504Z ```
2025-08-20T16:48:21.2526610Z 
2025-08-20T16:48:21.2526766Z Capture events sent as envelopes by Sentry SDK >= 2.0.
2025-08-20T16:48:21.2527040Z 
2025-08-20T16:48:21.2527152Z <a id="api.tests.test_cors"></a>
2025-08-20T16:48:21.2527573Z 
2025-08-20T16:48:21.2527676Z # api.tests.test\_cors
2025-08-20T16:48:21.2527830Z 
2025-08-20T16:48:21.2527941Z <a id="api.tests.test_imports"></a>
2025-08-20T16:48:21.2528150Z 
2025-08-20T16:48:21.2528249Z # api.tests.test\_imports
2025-08-20T16:48:21.2528418Z 
2025-08-20T16:48:21.2528528Z <a id="api.tests.test_rate_limit"></a>
2025-08-20T16:48:21.2528746Z 
2025-08-20T16:48:21.2528849Z # api.tests.test\_rate\_limit
2025-08-20T16:48:21.2529027Z 
2025-08-20T16:48:21.2529158Z <a id="api.tests.test_rate_limit.app"></a>
2025-08-20T16:48:21.2529383Z 
2025-08-20T16:48:21.2529464Z #### app
2025-08-20T16:48:21.2529581Z 
2025-08-20T16:48:21.2529665Z noqa: E402
2025-08-20T16:48:21.2529780Z 
2025-08-20T16:48:21.2529887Z <a id="api.tests.test_stats_sql"></a>
2025-08-20T16:48:21.2530105Z 
2025-08-20T16:48:21.2530205Z # api.tests.test\_stats\_sql
2025-08-20T16:48:21.2530380Z 
2025-08-20T16:48:21.2530496Z <a id="api.tests.test_entrypoint"></a>
2025-08-20T16:48:21.2530708Z 
2025-08-20T16:48:21.2530811Z # api.tests.test\_entrypoint
2025-08-20T16:48:21.2530990Z 
2025-08-20T16:48:21.2531126Z <a id="api.tests.test_stats_future_contracts"></a>
2025-08-20T16:48:21.2531371Z 
2025-08-20T16:48:21.2531487Z # api.tests.test\_stats\_future\_contracts
2025-08-20T16:48:21.2531718Z 
2025-08-20T16:48:21.2531824Z <a id="api.tests.test_health"></a>
2025-08-20T16:48:21.2532025Z 
2025-08-20T16:48:21.2532127Z # api.tests.test\_health
2025-08-20T16:48:21.2532288Z 
2025-08-20T16:48:21.2532390Z <a id="api.tests.test_score"></a>
2025-08-20T16:48:21.2532711Z 
2025-08-20T16:48:21.2532806Z # api.tests.test\_score
2025-08-20T16:48:21.2532962Z 
2025-08-20T16:48:21.2533064Z <a id="api.logging_config"></a>
2025-08-20T16:48:21.2533251Z 
2025-08-20T16:48:21.2533342Z # api.logging\_config
2025-08-20T16:48:21.2533495Z 
2025-08-20T16:48:21.2533601Z <a id="api.migrations.env"></a>
2025-08-20T16:48:21.2533782Z 
2025-08-20T16:48:21.2533874Z # api.migrations.env
2025-08-20T16:48:21.2534016Z 
2025-08-20T16:48:21.2534151Z <a id="api.migrations.versions.0022_fix_roi_view"></a>
2025-08-20T16:48:21.2534360Z 
2025-08-20T16:48:21.2534468Z # api.migrations.versions.0022\_fix\_roi\_view
2025-08-20T16:48:21.2534664Z 
2025-08-20T16:48:21.2534773Z <a id="api.migrations.versions.0004_fee_cron"></a>
2025-08-20T16:48:21.2534959Z 
2025-08-20T16:48:21.2535059Z # api.migrations.versions.0004\_fee\_cron
2025-08-20T16:48:21.2535228Z 
2025-08-20T16:48:21.2535377Z <a id="api.migrations.versions.3e9d5c5aff2c_rename_fulf_fee"></a>
2025-08-20T16:48:21.2535615Z 
2025-08-20T16:48:21.2535749Z # api.migrations.versions.3e9d5c5aff2c\_rename\_fulf\_fee
2025-08-20T16:48:21.2535962Z 
2025-08-20T16:48:21.2536080Z <a id="api.migrations.versions.0003_vendor_prices"></a>
2025-08-20T16:48:21.2536287Z 
2025-08-20T16:48:21.2536395Z # api.migrations.versions.0003\_vendor\_prices
2025-08-20T16:48:21.2536573Z 
2025-08-20T16:48:21.2536694Z <a id="api.migrations.versions.0024_create_buybox"></a>
2025-08-20T16:48:21.2536910Z 
2025-08-20T16:48:21.2537020Z # api.migrations.versions.0024\_create\_buybox
2025-08-20T16:48:21.2537446Z 
2025-08-20T16:48:21.2537570Z <a id="api.migrations.versions.0002_create_roi_view"></a>
2025-08-20T16:48:21.2537773Z 
2025-08-20T16:48:21.2537889Z # api.migrations.versions.0002\_create\_roi\_view
2025-08-20T16:48:21.2538075Z 
2025-08-20T16:48:21.2538189Z <a id="api.migrations.versions.0006_fix_roi_views"></a>
2025-08-20T16:48:21.2538387Z 
2025-08-20T16:48:21.2538492Z # api.migrations.versions.0006\_fix\_roi\_views
2025-08-20T16:48:21.2538675Z 
2025-08-20T16:48:21.2538806Z <a id="api.migrations.versions.0020_unified_schema"></a>
2025-08-20T16:48:21.2539002Z 
2025-08-20T16:48:21.2539103Z # api.migrations.versions.0020\_unified\_schema
2025-08-20T16:48:21.2539288Z 
2025-08-20T16:48:21.2539425Z <a id="api.migrations.versions.0025_pr4_indexes_loadlog"></a>
2025-08-20T16:48:21.2539642Z 
2025-08-20T16:48:21.2539761Z # api.migrations.versions.0025\_pr4\_indexes\_loadlog
2025-08-20T16:48:21.2539962Z 
2025-08-20T16:48:21.2540080Z <a id="api.migrations.versions.0023_add_storage_fee"></a>
2025-08-20T16:48:21.2540420Z 
2025-08-20T16:48:21.2540532Z # api.migrations.versions.0023\_add\_storage\_fee
2025-08-20T16:48:21.2540713Z 
2025-08-20T16:48:21.2540847Z <a id="api.migrations.versions.0026_amazon_new_reports"></a>
2025-08-20T16:48:21.2541065Z 
2025-08-20T16:48:21.2541179Z # api.migrations.versions.0026\_amazon\_new\_reports
2025-08-20T16:48:21.2541373Z 
2025-08-20T16:48:21.2541479Z <a id="api.migrations.versions.0001_baseline"></a>
2025-08-20T16:48:21.2541677Z 
2025-08-20T16:48:21.2541769Z # api.migrations.versions.0001\_baseline
2025-08-20T16:48:21.2541945Z 
2025-08-20T16:48:21.2542037Z <a id="api.migrations.versions"></a>
2025-08-20T16:48:21.2542193Z 
2025-08-20T16:48:21.2542275Z # api.migrations.versions
2025-08-20T16:48:21.2542408Z 
2025-08-20T16:48:21.2542483Z <a id="api.migrations"></a>
2025-08-20T16:48:21.2542725Z 
2025-08-20T16:48:21.2542793Z # api.migrations
2025-08-20T16:48:21.2542906Z 
2025-08-20T16:48:21.2542972Z <a id="api.db"></a>
2025-08-20T16:48:21.2543085Z 
2025-08-20T16:48:21.2543155Z # api.db
2025-08-20T16:48:21.2543243Z 
2025-08-20T16:48:21.2543324Z <a id="api.routes.score"></a>
2025-08-20T16:48:21.2543469Z 
2025-08-20T16:48:21.2543540Z # api.routes.score
2025-08-20T16:48:21.2543653Z 
2025-08-20T16:48:21.2543731Z <a id="api.routes.stats"></a>
2025-08-20T16:48:21.2543872Z 
2025-08-20T16:48:21.2543941Z # api.routes.stats
2025-08-20T16:48:21.2544043Z 
2025-08-20T16:48:21.2544127Z <a id="api.routes.roi"></a>
2025-08-20T16:48:21.2544254Z 
2025-08-20T16:48:21.2544319Z # api.routes.roi
2025-08-20T16:48:21.2544421Z 
2025-08-20T16:48:21.2544506Z <a id="api.routes.health"></a>
2025-08-20T16:48:21.2544643Z 
2025-08-20T16:48:21.2544711Z # api.routes.health
2025-08-20T16:48:21.2544823Z 
2025-08-20T16:48:21.2544914Z <a id="api.routes.health.MAX_SKEW"></a>
2025-08-20T16:48:21.2545078Z 
2025-08-20T16:48:21.2545148Z #### MAX\_SKEW
2025-08-20T16:48:21.2545248Z 
2025-08-20T16:48:21.2545309Z seconds
2025-08-20T16:48:21.2545398Z 
2025-08-20T16:48:21.2545495Z <a id="api.routes.health.health"></a>
2025-08-20T16:48:21.2545664Z 
2025-08-20T16:48:21.2545726Z #### health
2025-08-20T16:48:21.2545824Z 
2025-08-20T16:48:21.2545887Z ```python
2025-08-20T16:48:21.2546080Z @router.get("/health", include_in_schema=False)
2025-08-20T16:48:21.2546478Z async def health(session: AsyncSession = Depends(get_session)) -> JSONResponse
2025-08-20T16:48:21.2546819Z ```
2025-08-20T16:48:21.2546901Z 
2025-08-20T16:48:21.2547013Z Return 200 when DB reachable and clocks are in sync.
2025-08-20T16:48:21.2547205Z 
2025-08-20T16:48:21.2547295Z <a id="api.routes.repository"></a>
2025-08-20T16:48:21.2547449Z 
2025-08-20T16:48:21.2547523Z # api.routes.repository
2025-08-20T16:48:21.2547649Z 
2025-08-20T16:48:21.2547718Z <a id="api.routes"></a>
2025-08-20T16:48:21.2547833Z 
2025-08-20T16:48:21.2547902Z # api.routes
2025-08-20T16:48:21.2547997Z 
2025-08-20T16:48:21.2548074Z <a id="api.models.fee"></a>
2025-08-20T16:48:21.2548203Z 
2025-08-20T16:48:21.2548273Z # api.models.fee
2025-08-20T16:48:21.2548381Z 
2025-08-20T16:48:21.2548579Z <a id="api.models"></a>
2025-08-20T16:48:21.2548701Z 
2025-08-20T16:48:21.2548763Z # api.models
2025-08-20T16:48:21.2548854Z 
2025-08-20T16:48:21.2548932Z <a id="api.roi_repository"></a>
2025-08-20T16:48:21.2549074Z 
2025-08-20T16:48:21.2549143Z # api.roi\_repository
2025-08-20T16:48:21.2549256Z 
2025-08-20T16:48:21.2549328Z <a id="api.main"></a>
2025-08-20T16:48:21.2549437Z 
2025-08-20T16:48:21.2549499Z # api.main
2025-08-20T16:48:21.2549593Z 
2025-08-20T16:48:21.2549670Z <a id="api.main.ready"></a>
2025-08-20T16:48:21.2549796Z 
2025-08-20T16:48:21.2549857Z #### ready
2025-08-20T16:48:21.2549950Z 
2025-08-20T16:48:21.2550011Z ```python
2025-08-20T16:48:21.2550272Z @app.get("/ready", status_code=status.HTTP_200_OK, include_in_schema=False)
2025-08-20T16:48:21.2550699Z async def ready(session: AsyncSession = Depends(get_session)) -> dict[str,
2025-08-20T16:48:21.2551051Z                                                                       str]
2025-08-20T16:48:21.2551277Z ```
2025-08-20T16:48:21.2551482Z 
2025-08-20T16:48:21.2551577Z Return 200 only when migrations are at head.
2025-08-20T16:48:21.2551747Z 
2025-08-20T16:48:21.2551819Z <a id="api.config"></a>
2025-08-20T16:48:21.2551941Z 
2025-08-20T16:48:21.2552004Z # api.config
2025-08-20T16:48:21.2552098Z 
2025-08-20T16:48:21.2552179Z <a id="api.security"></a>
2025-08-20T16:48:21.2552305Z 
2025-08-20T16:48:21.2552369Z # api.security
2025-08-20T16:48:21.2552473Z 
2025-08-20T16:48:21.2552644Z <a id="etl"></a>
2025-08-20T16:48:21.2552745Z 
2025-08-20T16:48:21.2552805Z # etl
2025-08-20T16:48:21.2552895Z 
2025-08-20T16:48:21.2552972Z <a id="etl.fba_fee_ingestor"></a>
2025-08-20T16:48:21.2553116Z 
2025-08-20T16:48:21.2553193Z # etl.fba\_fee\_ingestor
2025-08-20T16:48:21.2553316Z 
2025-08-20T16:48:21.2553403Z <a id="etl.sp_fees_ingestor"></a>
2025-08-20T16:48:21.2553543Z 
2025-08-20T16:48:21.2553617Z # etl.sp\_fees\_ingestor
2025-08-20T16:48:21.2553735Z 
2025-08-20T16:48:21.2553811Z <a id="etl.keepa_ingestor"></a>
2025-08-20T16:48:21.2553961Z 
2025-08-20T16:48:21.2554030Z # etl.keepa\_ingestor
2025-08-20T16:48:21.2554139Z 
2025-08-20T16:48:21.2554208Z <a id="etl.db"></a>
2025-08-20T16:48:21.2554313Z 
2025-08-20T16:48:21.2554373Z # etl.db
2025-08-20T16:48:21.2554457Z 
2025-08-20T16:48:21.2554545Z <a id="etl.dialects.schemas"></a>
2025-08-20T16:48:21.2554687Z 
2025-08-20T16:48:21.2554762Z # etl.dialects.schemas
2025-08-20T16:48:21.2554887Z 
2025-08-20T16:48:21.2554993Z <a id="etl.dialects.amazon_reimbursements"></a>
2025-08-20T16:48:21.2555175Z 
2025-08-20T16:48:21.2555274Z # etl.dialects.amazon\_reimbursements
2025-08-20T16:48:21.2555432Z 
2025-08-20T16:48:21.2555525Z <a id="etl.dialects.amazon_ads_sp_cost"></a>
2025-08-20T16:48:21.2555696Z 
2025-08-20T16:48:21.2555785Z # etl.dialects.amazon\_ads\_sp\_cost
2025-08-20T16:48:21.2555939Z 
2025-08-20T16:48:21.2556023Z <a id="etl.dialects.test_generic"></a>
2025-08-20T16:48:21.2556189Z 
2025-08-20T16:48:21.2556266Z # etl.dialects.test\_generic
2025-08-20T16:48:21.2556404Z 
2025-08-20T16:48:21.2556507Z <a id="etl.dialects.amazon_returns"></a>
2025-08-20T16:48:21.2556670Z 
2025-08-20T16:48:21.2556751Z # etl.dialects.amazon\_returns
2025-08-20T16:48:21.2556887Z 
2025-08-20T16:48:21.2556987Z <a id="etl.dialects.amazon_fee_preview"></a>
2025-08-20T16:48:21.2557157Z 
2025-08-20T16:48:21.2557239Z # etl.dialects.amazon\_fee\_preview
2025-08-20T16:48:21.2557398Z 
2025-08-20T16:48:21.2557501Z <a id="etl.dialects.amazon_inventory_ledger"></a>
2025-08-20T16:48:21.2557684Z 
2025-08-20T16:48:21.2557777Z # etl.dialects.amazon\_inventory\_ledger
2025-08-20T16:48:21.2557940Z 
2025-08-20T16:48:21.2558034Z <a id="etl.dialects.amazon_settlements"></a>
2025-08-20T16:48:21.2558200Z 
2025-08-20T16:48:21.2558290Z # etl.dialects.amazon\_settlements
2025-08-20T16:48:21.2558437Z 
2025-08-20T16:48:21.2558509Z <a id="etl.dialects"></a>
2025-08-20T16:48:21.2558639Z 
2025-08-20T16:48:21.2558702Z # etl.dialects
2025-08-20T16:48:21.2558797Z 
2025-08-20T16:48:21.2558874Z <a id="ingest"></a>
2025-08-20T16:48:21.2558977Z 
2025-08-20T16:48:21.2559165Z # ingest
2025-08-20T16:48:21.2559250Z 
2025-08-20T16:48:21.2559337Z <a id="ingest.maintenance"></a>
2025-08-20T16:48:21.2559477Z 
2025-08-20T16:48:21.2559547Z # ingest.maintenance
2025-08-20T16:48:21.2559666Z 
2025-08-20T16:48:21.2559743Z <a id="ingest.copy_loader"></a>
2025-08-20T16:48:21.2559877Z 
2025-08-20T16:48:21.2559948Z # ingest.copy\_loader
2025-08-20T16:48:21.2560067Z 
2025-08-20T16:48:21.2560165Z <a id="ingest.copy_loader.copy_df_via_temp"></a>
2025-08-20T16:48:21.2560343Z 
2025-08-20T16:48:21.2560420Z #### copy\_df\_via\_temp
2025-08-20T16:48:21.2560540Z 
2025-08-20T16:48:21.2560602Z ```python
2025-08-20T16:48:21.2560776Z def copy_df_via_temp(engine: Engine,
2025-08-20T16:48:21.2561012Z                      df: pd.DataFrame,
2025-08-20T16:48:21.2561244Z                      target_table: str,
2025-08-20T16:48:21.2561455Z                      *,
2025-08-20T16:48:21.2561664Z                      target_schema: Optional[str] = None,
2025-08-20T16:48:21.2561924Z                      columns: Sequence[str],
2025-08-20T16:48:21.2562312Z                      conflict_cols: Optional[Sequence[str]] = None,
2025-08-20T16:48:21.2562726Z                      analyze_after: bool = False,
2025-08-20T16:48:21.2562983Z                      connection: Any | None = None) -> int
2025-08-20T16:48:21.2563219Z ```
2025-08-20T16:48:21.2563300Z 
2025-08-20T16:48:21.2563450Z Bulk load *df* into *target_table* using COPY and a staging table.
2025-08-20T16:48:21.2563697Z 
2025-08-20T16:48:21.2563782Z <a id="ingest.tests.test_smoke"></a>
2025-08-20T16:48:21.2563935Z 
2025-08-20T16:48:21.2564017Z # ingest.tests.test\_smoke
2025-08-20T16:48:21.2564145Z 
2025-08-20T16:48:21.2564218Z <a id="ingest.tests"></a>
2025-08-20T16:48:21.2564345Z 
2025-08-20T16:48:21.2564410Z # ingest.tests
2025-08-20T16:48:21.2564510Z 
2025-08-20T16:48:21.2564591Z <a id="ingest.upload_router"></a>
2025-08-20T16:48:21.2564743Z 
2025-08-20T16:48:21.2564815Z # ingest.upload\_router
2025-08-20T16:48:21.2564932Z 
2025-08-20T16:48:21.2565020Z <a id="ingest.email_watcher"></a>
2025-08-20T16:48:21.2565165Z 
2025-08-20T16:48:21.2565235Z # ingest.email\_watcher
2025-08-20T16:48:21.2565350Z 
2025-08-20T16:48:21.2565440Z <a id="ingest.email_watcher.main"></a>
2025-08-20T16:48:21.2565599Z 
2025-08-20T16:48:21.2565661Z #### main
2025-08-20T16:48:21.2565754Z 
2025-08-20T16:48:21.2565817Z ```python
2025-08-20T16:48:21.2565976Z def main() -> dict[str, str]
2025-08-20T16:48:21.2566170Z ```
2025-08-20T16:48:21.2566251Z 
2025-08-20T16:48:21.2566395Z Upload CSV/XLSX attachments to MinIO and trigger ingestion.
2025-08-20T16:48:21.2566614Z 
2025-08-20T16:48:21.2566742Z Returns {"status": "success"} when processing completes.
2025-08-20T16:48:21.2566958Z 
2025-08-20T16:48:21.2567031Z <a id="ingest.tasks"></a>
2025-08-20T16:48:21.2567153Z 
2025-08-20T16:48:21.2567216Z # ingest.tasks
2025-08-20T16:48:21.2567327Z 
2025-08-20T16:48:21.2567426Z <a id="ingest.tasks.task_import_file"></a>
2025-08-20T16:48:21.2567596Z 
2025-08-20T16:48:21.2567666Z #### task\_import\_file
2025-08-20T16:48:21.2567787Z 
2025-08-20T16:48:21.2567855Z ```python
2025-08-20T16:48:21.2568056Z @celery_app.task(name="ingest.import_file", bind=True)
2025-08-20T16:48:21.2568339Z def task_import_file(self: Any,
2025-08-20T16:48:21.2568541Z                      uri: str,
2025-08-20T16:48:21.2568763Z                      report_type: str | None = None,
2025-08-20T16:48:21.2569020Z                      force: bool = False) -> dict[str, Any]
2025-08-20T16:48:21.2569256Z ```
2025-08-20T16:48:21.2569337Z 
2025-08-20T16:48:21.2569473Z Import a file into Postgres using existing ETL pipeline.
2025-08-20T16:48:21.2569675Z 
2025-08-20T16:48:21.2569755Z <a id="ingest.celery_app"></a>
2025-08-20T16:48:21.2569898Z 
2025-08-20T16:48:21.2569969Z # ingest.celery\_app
2025-08-20T16:48:21.2570081Z 
2025-08-20T16:48:21.2570162Z <a id="ingest.ingest_router"></a>
2025-08-20T16:48:21.2570317Z 
2025-08-20T16:48:21.2570388Z # ingest.ingest\_router
2025-08-20T16:48:21.2570506Z 
2025-08-20T16:48:21.2570584Z <a id="logistics_etl"></a>
2025-08-20T16:48:21.2570859Z 
2025-08-20T16:48:21.2570923Z # logistics\_etl
2025-08-20T16:48:21.2571033Z 
2025-08-20T16:48:21.2571107Z Daily logistics ETL job.
2025-08-20T16:48:21.2571232Z 
2025-08-20T16:48:21.2571312Z <a id="logistics_etl.__main__"></a>
2025-08-20T16:48:21.2571467Z 
2025-08-20T16:48:21.2571542Z # logistics\_etl.\_\_main\_\_
2025-08-20T16:48:21.2571677Z 
2025-08-20T16:48:21.2571757Z <a id="logistics_etl.dsn"></a>
2025-08-20T16:48:21.2571889Z 
2025-08-20T16:48:21.2571958Z # logistics\_etl.dsn
2025-08-20T16:48:21.2572069Z 
2025-08-20T16:48:21.2572190Z Local DSN builder to avoid cross-service dependency.
2025-08-20T16:48:21.2572385Z 
2025-08-20T16:48:21.2572471Z <a id="logistics_etl.dsn.build_dsn"></a>
2025-08-20T16:48:21.2572756Z 
2025-08-20T16:48:21.2572822Z #### build\_dsn
2025-08-20T16:48:21.2572922Z 
2025-08-20T16:48:21.2572989Z ```python
2025-08-20T16:48:21.2573157Z def build_dsn(sync: bool = True) -> str
2025-08-20T16:48:21.2573380Z ```
2025-08-20T16:48:21.2573458Z 
2025-08-20T16:48:21.2573717Z Return a Postgres DSN assembled from environment variables.
2025-08-20T16:48:21.2573941Z 
2025-08-20T16:48:21.2574086Z Prefers explicit DSNs via ``PG_SYNC_DSN``/``PG_ASYNC_DSN`` or
2025-08-20T16:48:21.2574473Z ``DATABASE_URL``. Falls back to individual PG_* settings and raises an
2025-08-20T16:48:21.2574813Z error when any required variable is missing.
2025-08-20T16:48:21.2574988Z 
2025-08-20T16:48:21.2575084Z <a id="logistics_etl.tests.conftest"></a>
2025-08-20T16:48:21.2575251Z 
2025-08-20T16:48:21.2575332Z # logistics\_etl.tests.conftest
2025-08-20T16:48:21.2575473Z 
2025-08-20T16:48:21.2575580Z <a id="logistics_etl.tests.test_repository"></a>
2025-08-20T16:48:21.2575759Z 
2025-08-20T16:48:21.2575844Z # logistics\_etl.tests.test\_repository
2025-08-20T16:48:21.2576044Z 
2025-08-20T16:48:21.2576134Z <a id="logistics_etl.tests.test_cron"></a>
2025-08-20T16:48:21.2576299Z 
2025-08-20T16:48:21.2576383Z # logistics\_etl.tests.test\_cron
2025-08-20T16:48:21.2576528Z 
2025-08-20T16:48:21.2576621Z <a id="logistics_etl.tests.test_imports"></a>
2025-08-20T16:48:21.2576807Z 
2025-08-20T16:48:21.2576888Z # logistics\_etl.tests.test\_imports
2025-08-20T16:48:21.2577041Z 
2025-08-20T16:48:21.2577129Z <a id="logistics_etl.tests.test_smoke"></a>
2025-08-20T16:48:21.2577301Z 
2025-08-20T16:48:21.2577382Z # logistics\_etl.tests.test\_smoke
2025-08-20T16:48:21.2577530Z 
2025-08-20T16:48:21.2577629Z <a id="logistics_etl.tests.test_client"></a>
2025-08-20T16:48:21.2577795Z 
2025-08-20T16:48:21.2577875Z # logistics\_etl.tests.test\_client
2025-08-20T16:48:21.2578032Z 
2025-08-20T16:48:21.2578111Z <a id="logistics_etl.tests"></a>
2025-08-20T16:48:21.2578251Z 
2025-08-20T16:48:21.2578320Z # logistics\_etl.tests
2025-08-20T16:48:21.2578445Z 
2025-08-20T16:48:21.2578520Z <a id="logistics_etl.flow"></a>
2025-08-20T16:48:21.2578655Z 
2025-08-20T16:48:21.2578730Z # logistics\_etl.flow
2025-08-20T16:48:21.2578843Z 
2025-08-20T16:48:21.2578937Z <a id="logistics_etl.client"></a>
2025-08-20T16:48:21.2579088Z 
2025-08-20T16:48:21.2649716Z # logistics\_etl.client
2025-08-20T16:48:21.2650072Z 
2025-08-20T16:48:21.2650246Z <a id="logistics_etl.cron"></a>
2025-08-20T16:48:21.2650551Z 
2025-08-20T16:48:21.2650712Z # logistics\_etl.cron
2025-08-20T16:48:21.2650941Z 
2025-08-20T16:48:21.2651126Z <a id="logistics_etl.db"></a>
2025-08-20T16:48:21.2651404Z 
2025-08-20T16:48:21.2651540Z # logistics\_etl.db
2025-08-20T16:48:21.2651779Z 
2025-08-20T16:48:21.2651911Z <a id="logistics_etl.repository"></a>
2025-08-20T16:48:21.2652130Z 
2025-08-20T16:48:21.2652232Z # logistics\_etl.repository
2025-08-20T16:48:21.2652411Z 
2025-08-20T16:48:21.2652683Z <a id="alert_bot"></a>
2025-08-20T16:48:21.2652840Z 
2025-08-20T16:48:21.2652926Z # alert\_bot
2025-08-20T16:48:21.2653071Z 
2025-08-20T16:48:21.2653266Z <a id="alert_bot.tests.test_smoke"></a>
2025-08-20T16:48:21.2653610Z 
2025-08-20T16:48:21.2653772Z # alert\_bot.tests.test\_smoke
2025-08-20T16:48:21.2654000Z 
2025-08-20T16:48:21.2654125Z <a id="alert_bot.tests"></a>
2025-08-20T16:48:21.2654303Z 
2025-08-20T16:48:21.2654535Z # alert\_bot.tests
2025-08-20T16:48:21.2654642Z 
2025-08-20T16:48:21.2654727Z <a id="alert_bot.alert_bot"></a>
2025-08-20T16:48:21.2654867Z 
2025-08-20T16:48:21.2654936Z # alert\_bot.alert\_bot
2025-08-20T16:48:21.2655061Z 
2025-08-20T16:48:21.2655146Z <a id="alert_bot.rules"></a>
2025-08-20T16:48:21.2655279Z 
2025-08-20T16:48:21.2655342Z # alert\_bot.rules
2025-08-20T16:48:21.2655452Z 
2025-08-20T16:48:21.2655516Z <a id="common"></a>
2025-08-20T16:48:21.2655620Z 
2025-08-20T16:48:21.2655687Z # common
2025-08-20T16:48:21.2655776Z 
2025-08-20T16:48:21.2655847Z <a id="common.dsn"></a>
2025-08-20T16:48:21.2655961Z 
2025-08-20T16:48:21.2656029Z # common.dsn
2025-08-20T16:48:21.2656121Z 
2025-08-20T16:48:21.2656205Z <a id="common.dsn.build_dsn"></a>
2025-08-20T16:48:21.2656357Z 
2025-08-20T16:48:21.2656420Z #### build\_dsn
2025-08-20T16:48:21.2656519Z 
2025-08-20T16:48:21.2656581Z ```python
2025-08-20T16:48:21.2656760Z def build_dsn(sync: bool = True) -> str
2025-08-20T16:48:21.2656980Z ```
2025-08-20T16:48:21.2657184Z 
2025-08-20T16:48:21.2657308Z Return a Postgres DSN, validating required variables.
2025-08-20T16:48:21.2657508Z 
2025-08-20T16:48:21.2657699Z The function prefers explicit DSNs via ``PG_SYNC_DSN`` / ``PG_ASYNC_DSN`` or
2025-08-20T16:48:21.2658138Z ``DATABASE_URL``.  If those are absent it assembles a connection string from
2025-08-20T16:48:21.2658557Z ``PG_HOST`` and related variables and raises a helpful error when any are
2025-08-20T16:48:21.2658869Z missing.
2025-08-20T16:48:21.2658964Z 
2025-08-20T16:48:21.2659046Z <a id="common.models_vendor"></a>
2025-08-20T16:48:21.2659193Z 
2025-08-20T16:48:21.2659272Z # common.models\_vendor
2025-08-20T16:48:21.2659392Z 
2025-08-20T16:48:21.2659479Z <a id="common.models_vendor.Vendor"></a>
2025-08-20T16:48:21.2659653Z 
2025-08-20T16:48:21.2659719Z ## Vendor Objects
2025-08-20T16:48:21.2659825Z 
2025-08-20T16:48:21.2659887Z ```python
2025-08-20T16:48:21.2660042Z class Vendor(Base)
2025-08-20T16:48:21.2660200Z ```
2025-08-20T16:48:21.2660291Z 
2025-08-20T16:48:21.2660373Z Vendor of inventory items.
2025-08-20T16:48:21.2660505Z 
2025-08-20T16:48:21.2660612Z <a id="common.models_vendor.VendorPrice"></a>
2025-08-20T16:48:21.2660790Z 
2025-08-20T16:48:21.2660861Z ## VendorPrice Objects
2025-08-20T16:48:21.2660982Z 
2025-08-20T16:48:21.2661043Z ```python
2025-08-20T16:48:21.2661198Z class VendorPrice(Base)
2025-08-20T16:48:21.2661381Z ```
2025-08-20T16:48:21.2661460Z 
2025-08-20T16:48:21.2661560Z Association table linking vendors to pricing.
2025-08-20T16:48:21.2661744Z 
2025-08-20T16:48:21.2661819Z <a id="common.db_url"></a>
2025-08-20T16:48:21.2661945Z 
2025-08-20T16:48:21.2662017Z # common.db\_url
2025-08-20T16:48:21.2662119Z 
2025-08-20T16:48:21.2662203Z <a id="common.db_url.build_url"></a>
2025-08-20T16:48:21.2662362Z 
2025-08-20T16:48:21.2662423Z #### build\_url
2025-08-20T16:48:21.2662650Z 
2025-08-20T16:48:21.2662712Z ```python
2025-08-20T16:48:21.2662887Z def build_url(async_: bool = True) -> str
2025-08-20T16:48:21.2663110Z ```
2025-08-20T16:48:21.2663196Z 
2025-08-20T16:48:21.2663303Z Return Postgres DSN from environment variables.
2025-08-20T16:48:21.2663489Z 
2025-08-20T16:48:21.2663570Z <a id="common.keepa"></a>
2025-08-20T16:48:21.2663699Z 
2025-08-20T16:48:21.2663774Z # common.keepa
2025-08-20T16:48:21.2663882Z 
2025-08-20T16:48:21.2663955Z <a id="common.llm"></a>
2025-08-20T16:48:21.2664074Z 
2025-08-20T16:48:21.2664136Z # common.llm
2025-08-20T16:48:21.2664235Z 
2025-08-20T16:48:21.2664315Z <a id="common.settings"></a>
2025-08-20T16:48:21.2664450Z 
2025-08-20T16:48:21.2664523Z # common.settings
2025-08-20T16:48:21.2664635Z 
2025-08-20T16:48:21.2664704Z <a id="common.db"></a>
2025-08-20T16:48:21.2664823Z 
2025-08-20T16:48:21.2664884Z # common.db
2025-08-20T16:48:21.2664973Z 
2025-08-20T16:48:21.2665062Z <a id="common.db.build_sqlalchemy_url"></a>
2025-08-20T16:48:21.2665244Z 
2025-08-20T16:48:21.2665317Z #### build\_sqlalchemy\_url
2025-08-20T16:48:21.2665444Z 
2025-08-20T16:48:21.2665515Z ```python
2025-08-20T16:48:21.2665679Z def build_sqlalchemy_url() -> str
2025-08-20T16:48:21.2666021Z ```
2025-08-20T16:48:21.2666100Z 
2025-08-20T16:48:21.2666191Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T16:48:21.2666366Z 
2025-08-20T16:48:21.2666450Z <a id="common.db.build_asyncpg_dsn"></a>
2025-08-20T16:48:21.2666612Z 
2025-08-20T16:48:21.2666683Z #### build\_asyncpg\_dsn
2025-08-20T16:48:21.2666814Z 
2025-08-20T16:48:21.2666875Z ```python
2025-08-20T16:48:21.2667041Z def build_asyncpg_dsn() -> str
2025-08-20T16:48:21.2667233Z ```
2025-08-20T16:48:21.2667310Z 
2025-08-20T16:48:21.2667442Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T16:48:21.2667651Z 
2025-08-20T16:48:21.2667735Z <a id="common.db.refresh_mvs"></a>
2025-08-20T16:48:21.2667890Z 
2025-08-20T16:48:21.2667954Z #### refresh\_mvs
2025-08-20T16:48:21.2668057Z 
2025-08-20T16:48:21.2668124Z ```python
2025-08-20T16:48:21.2668309Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T16:48:21.2668560Z ```
2025-08-20T16:48:21.2668639Z 
2025-08-20T16:48:21.2668888Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T16:48:21.2669108Z 
2025-08-20T16:48:21.2669183Z <a id="common.config"></a>
2025-08-20T16:48:21.2669310Z 
2025-08-20T16:48:21.2669374Z # common.config
2025-08-20T16:48:21.2669480Z 
2025-08-20T16:48:21.2669553Z <a id="common.base"></a>
2025-08-20T16:48:21.2669672Z 
2025-08-20T16:48:21.2669740Z # common.base
2025-08-20T16:48:21.2669835Z 
2025-08-20T16:48:21.2669968Z <a id="common.base.Base"></a>
2025-08-20T16:48:21.2670112Z 
2025-08-20T16:48:21.2670175Z ## Base Objects
2025-08-20T16:48:21.2670271Z 
2025-08-20T16:48:21.2670331Z ```python
2025-08-20T16:48:21.2670496Z class Base(DeclarativeBase)
2025-08-20T16:48:21.2670682Z ```
2025-08-20T16:48:21.2670766Z 
2025-08-20T16:48:21.2670846Z Base class for SQLAlchemy models.
2025-08-20T16:48:21.2670989Z 
2025-08-20T16:48:21.2671067Z <a id="repricer"></a>
2025-08-20T16:48:21.2671180Z 
2025-08-20T16:48:21.2671242Z # repricer
2025-08-20T16:48:21.2671335Z 
2025-08-20T16:48:21.2671417Z <a id="repricer.app.schemas"></a>
2025-08-20T16:48:21.2671573Z 
2025-08-20T16:48:21.2671647Z # repricer.app.schemas
2025-08-20T16:48:21.2671773Z 
2025-08-20T16:48:21.2671853Z <a id="repricer.app.deps"></a>
2025-08-20T16:48:21.2671993Z 
2025-08-20T16:48:21.2672069Z # repricer.app.deps
2025-08-20T16:48:21.2672178Z 
2025-08-20T16:48:21.2672292Z Placeholder module for Keepa / SP-API clients.
2025-08-20T16:48:21.2672477Z 
2025-08-20T16:48:21.2672674Z <a id="repricer.app.logic"></a>
2025-08-20T16:48:21.2672816Z 
2025-08-20T16:48:21.2672889Z # repricer.app.logic
2025-08-20T16:48:21.2673009Z 
2025-08-20T16:48:21.2673103Z <a id="repricer.app.logic.MIN_MARGIN"></a>
2025-08-20T16:48:21.2673275Z 
2025-08-20T16:48:21.2673344Z #### MIN\_MARGIN
2025-08-20T16:48:21.2673444Z 
2025-08-20T16:48:21.2673503Z 15 % ROI
2025-08-20T16:48:21.2673588Z 
2025-08-20T16:48:21.2673694Z <a id="repricer.app.logic.compute_price"></a>
2025-08-20T16:48:21.2673877Z 
2025-08-20T16:48:21.2673943Z #### compute\_price
2025-08-20T16:48:21.2674055Z 
2025-08-20T16:48:21.2674124Z ```python
2025-08-20T16:48:21.2674364Z def compute_price(asin: str, cost: Decimal, fees: Decimal) -> Decimal
2025-08-20T16:48:21.2674664Z ```
2025-08-20T16:48:21.2674744Z 
2025-08-20T16:48:21.2674853Z Toy algorithm: ensure 15 % ROI and round to cents.
2025-08-20T16:48:21.2675128Z Replace with real competitive logic later.
2025-08-20T16:48:21.2675297Z 
2025-08-20T16:48:21.2675382Z <a id="repricer.app.main"></a>
2025-08-20T16:48:21.2675520Z 
2025-08-20T16:48:21.2675589Z # repricer.app.main
2025-08-20T16:48:21.2675702Z 
2025-08-20T16:48:21.2675776Z <a id="repricer.app"></a>
2025-08-20T16:48:21.2675902Z 
2025-08-20T16:48:21.2675972Z # repricer.app
2025-08-20T16:48:21.2676072Z 
2025-08-20T16:48:21.2676162Z <a id="repricer.tests.test_imports"></a>
2025-08-20T16:48:21.2676328Z 
2025-08-20T16:48:21.2676417Z # repricer.tests.test\_imports
2025-08-20T16:48:21.2676552Z 
2025-08-20T16:48:21.2676637Z <a id="repricer.tests.test_smoke"></a>
2025-08-20T16:48:21.2676800Z 
2025-08-20T16:48:21.2676881Z # repricer.tests.test\_smoke
2025-08-20T16:48:21.2677147Z 
2025-08-20T16:48:21.2677232Z <a id="repricer.tests"></a>
2025-08-20T16:48:21.2677365Z 
2025-08-20T16:48:21.2677432Z # repricer.tests
2025-08-20T16:48:21.2677535Z 
2025-08-20T16:48:21.2677603Z <a id="db"></a>
2025-08-20T16:48:21.2677702Z 
2025-08-20T16:48:21.2677762Z # db
2025-08-20T16:48:21.2677847Z 
2025-08-20T16:48:21.2677920Z <a id="db.utils.views"></a>
2025-08-20T16:48:21.2678046Z 
2025-08-20T16:48:21.2678111Z # db.utils.views
2025-08-20T16:48:21.2678220Z 
2025-08-20T16:48:21.2678307Z <a id="db.utils.views.replace_view"></a>
2025-08-20T16:48:21.2678471Z 
2025-08-20T16:48:21.2678542Z #### replace\_view
2025-08-20T16:48:21.2678647Z 
2025-08-20T16:48:21.2678709Z ```python
2025-08-20T16:48:21.2678904Z def replace_view(name: str, new_sql: str) -> None
2025-08-20T16:48:21.2679141Z ```
2025-08-20T16:48:21.2679229Z 
2025-08-20T16:48:21.2679319Z Drop and recreate a SQL view atomically.
2025-08-20T16:48:21.2679481Z 
2025-08-20T16:48:21.2679549Z <a id="db.utils"></a>
2025-08-20T16:48:21.2679942Z 
2025-08-20T16:48:21.2680002Z # db.utils
2025-08-20T16:48:21.2680090Z 
2025-08-20T16:48:21.2680175Z <a id="price_importer"></a>
2025-08-20T16:48:21.2680305Z 
2025-08-20T16:48:21.2680371Z # price\_importer
2025-08-20T16:48:21.2680483Z 
2025-08-20T16:48:21.2680582Z <a id="price_importer.services_common.dsn"></a>
2025-08-20T16:48:21.2680763Z 
2025-08-20T16:48:21.2680850Z # price\_importer.services\_common.dsn
2025-08-20T16:48:21.2681017Z 
2025-08-20T16:48:21.2681140Z <a id="price_importer.services_common.dsn.build_dsn"></a>
2025-08-20T16:48:21.2681343Z 
2025-08-20T16:48:21.2681414Z #### build\_dsn
2025-08-20T16:48:21.2681517Z 
2025-08-20T16:48:21.2681577Z ```python
2025-08-20T16:48:21.2681751Z def build_dsn(sync: bool = True) -> str
2025-08-20T16:48:21.2681967Z ```
2025-08-20T16:48:21.2682054Z 
2025-08-20T16:48:21.2682118Z Return safe DSN.
2025-08-20T16:48:21.2682221Z 
2025-08-20T16:48:21.2682399Z Prefers explicit DSNs via ``PG_SYNC_DSN``/``PG_ASYNC_DSN`` or ``DATABASE_URL``.
2025-08-20T16:48:21.2682875Z Falls back to individual PG_* variables.
2025-08-20T16:48:21.2683419Z sync=True → SQLAlchemy (+psycopg) else plain asyncpg.
2025-08-20T16:48:21.2683624Z 
2025-08-20T16:48:21.2683760Z <a id="price_importer.services_common.models_vendor"></a>
2025-08-20T16:48:21.2683972Z 
2025-08-20T16:48:21.2684084Z # price\_importer.services\_common.models\_vendor
2025-08-20T16:48:21.2684271Z 
2025-08-20T16:48:21.2684376Z <a id="price_importer.services_common.db_url"></a>
2025-08-20T16:48:21.2684565Z 
2025-08-20T16:48:21.2684658Z # price\_importer.services\_common.db\_url
2025-08-20T16:48:21.2684827Z 
2025-08-20T16:48:21.2684966Z <a id="price_importer.services_common.db_url.build_url"></a>
2025-08-20T16:48:21.2685178Z 
2025-08-20T16:48:21.2685242Z #### build\_url
2025-08-20T16:48:21.2685347Z 
2025-08-20T16:48:21.2685410Z ```python
2025-08-20T16:48:21.2685580Z def build_url(async_: bool = True) -> str
2025-08-20T16:48:21.2685807Z ```
2025-08-20T16:48:21.2685887Z 
2025-08-20T16:48:21.2686002Z Return Postgres DSN from environment variables.
2025-08-20T16:48:21.2686201Z 
2025-08-20T16:48:21.2686306Z <a id="price_importer.services_common.keepa"></a>
2025-08-20T16:48:21.2686491Z 
2025-08-20T16:48:21.2686587Z # price\_importer.services\_common.keepa
2025-08-20T16:48:21.2686752Z 
2025-08-20T16:48:21.2686849Z <a id="price_importer.services_common.llm"></a>
2025-08-20T16:48:21.2687032Z 
2025-08-20T16:48:21.2687120Z # price\_importer.services\_common.llm
2025-08-20T16:48:21.2687280Z 
2025-08-20T16:48:21.2687399Z <a id="price_importer.services_common.settings"></a>
2025-08-20T16:48:21.2687588Z 
2025-08-20T16:48:21.2687683Z # price\_importer.services\_common.settings
2025-08-20T16:48:21.2687852Z 
2025-08-20T16:48:21.2687958Z <a id="price_importer.services_common.db"></a>
2025-08-20T16:48:21.2688134Z 
2025-08-20T16:48:21.2688220Z # price\_importer.services\_common.db
2025-08-20T16:48:21.2688383Z 
2025-08-20T16:48:21.2688534Z <a id="price_importer.services_common.db.build_sqlalchemy_url"></a>
2025-08-20T16:48:21.2688771Z 
2025-08-20T16:48:21.2688982Z #### build\_sqlalchemy\_url
2025-08-20T16:48:21.2689120Z 
2025-08-20T16:48:21.2689183Z ```python
2025-08-20T16:48:21.2689357Z def build_sqlalchemy_url() -> str
2025-08-20T16:48:21.2689558Z ```
2025-08-20T16:48:21.2689642Z 
2025-08-20T16:48:21.2689737Z Return Postgres URL for SQLAlchemy engines.
2025-08-20T16:48:21.2689910Z 
2025-08-20T16:48:21.2690054Z <a id="price_importer.services_common.db.build_asyncpg_dsn"></a>
2025-08-20T16:48:21.2690290Z 
2025-08-20T16:48:21.2690362Z #### build\_asyncpg\_dsn
2025-08-20T16:48:21.2690486Z 
2025-08-20T16:48:21.2690551Z ```python
2025-08-20T16:48:21.2690715Z def build_asyncpg_dsn() -> str
2025-08-20T16:48:21.2690913Z ```
2025-08-20T16:48:21.2690993Z 
2025-08-20T16:48:21.2691120Z Return DSN suitable for asyncpg (without driver suffix).
2025-08-20T16:48:21.2691337Z 
2025-08-20T16:48:21.2691469Z <a id="price_importer.services_common.db.refresh_mvs"></a>
2025-08-20T16:48:21.2691676Z 
2025-08-20T16:48:21.2691747Z #### refresh\_mvs
2025-08-20T16:48:21.2691972Z 
2025-08-20T16:48:21.2692034Z ```python
2025-08-20T16:48:21.2692229Z def refresh_mvs(conn: Engine | Connection) -> None
2025-08-20T16:48:21.2692472Z ```
2025-08-20T16:48:21.2692694Z 
2025-08-20T16:48:21.2692831Z Refresh materialized views, using CONCURRENTLY when safe.
2025-08-20T16:48:21.2693043Z 
2025-08-20T16:48:21.2693135Z <a id="price_importer.services_common"></a>
2025-08-20T16:48:21.2693309Z 
2025-08-20T16:48:21.2693394Z # price\_importer.services\_common
2025-08-20T16:48:21.2693546Z 
2025-08-20T16:48:21.2693659Z <a id="price_importer.services_common.base"></a>
2025-08-20T16:48:21.2693843Z 
2025-08-20T16:48:21.2693932Z # price\_importer.services\_common.base
2025-08-20T16:48:21.2694101Z 
2025-08-20T16:48:21.2694189Z <a id="price_importer.normaliser"></a>
2025-08-20T16:48:21.2694350Z 
2025-08-20T16:48:21.2694432Z # price\_importer.normaliser
2025-08-20T16:48:21.2694577Z 
2025-08-20T16:48:21.2694677Z <a id="price_importer.common.models_vendor"></a>
2025-08-20T16:48:21.2694856Z 
2025-08-20T16:48:21.2694958Z # price\_importer.common.models\_vendor
2025-08-20T16:48:21.2695121Z 
2025-08-20T16:48:21.2695211Z <a id="price_importer.common.db_url"></a>
2025-08-20T16:48:21.2695385Z 
2025-08-20T16:48:21.2695467Z # price\_importer.common.db\_url
2025-08-20T16:48:21.2695612Z 
2025-08-20T16:48:21.2695714Z <a id="price_importer.common.db_url.make_dsn"></a>
2025-08-20T16:48:21.2695907Z 
2025-08-20T16:48:21.2695969Z #### make\_dsn
2025-08-20T16:48:21.2696069Z 
2025-08-20T16:48:21.2696137Z ```python
2025-08-20T16:48:21.2696308Z def make_dsn(async_: bool = False) -> str
2025-08-20T16:48:21.2696537Z ```
2025-08-20T16:48:21.2696617Z 
2025-08-20T16:48:21.2696696Z Return DSN using shared builder.
2025-08-20T16:48:21.2696845Z 
2025-08-20T16:48:21.2696950Z <a id="price_importer.common.db_url.build_url"></a>
2025-08-20T16:48:21.2697137Z 
2025-08-20T16:48:21.2697199Z #### build\_url
2025-08-20T16:48:21.2697302Z 
2025-08-20T16:48:21.2697361Z ```python
2025-08-20T16:48:21.2697536Z def build_url(async_: bool = False) -> str
2025-08-20T16:48:21.2697767Z ```
2025-08-20T16:48:21.2697849Z 
2025-08-20T16:48:21.2697989Z Return Postgres DSN built from environment variables.
2025-08-20T16:48:21.2698190Z 
2025-08-20T16:48:21.2698275Z <a id="price_importer.common"></a>
2025-08-20T16:48:21.2698435Z 
2025-08-20T16:48:21.2698511Z # price\_importer.common
2025-08-20T16:48:21.2698638Z 
2025-08-20T16:48:21.2698733Z <a id="price_importer.common.base"></a>
2025-08-20T16:48:21.2698895Z 
2025-08-20T16:48:21.2698975Z # price\_importer.common.base
2025-08-20T16:48:21.2699117Z 
2025-08-20T16:48:21.2699223Z <a id="price_importer.tests.conftest"></a>
2025-08-20T16:48:21.2699398Z 
2025-08-20T16:48:21.2699481Z # price\_importer.tests.conftest
2025-08-20T16:48:21.2699633Z 
2025-08-20T16:48:21.2699732Z <a id="price_importer.tests.test_reader"></a>
2025-08-20T16:48:21.2699929Z 
2025-08-20T16:48:21.2700019Z # price\_importer.tests.test\_reader
2025-08-20T16:48:21.2700176Z 
2025-08-20T16:48:21.2700274Z <a id="price_importer.tests.test_imports"></a>
2025-08-20T16:48:21.2700594Z 
2025-08-20T16:48:21.2700684Z # price\_importer.tests.test\_imports
2025-08-20T16:48:21.2700844Z 
2025-08-20T16:48:21.2700939Z <a id="price_importer.tests.test_smoke"></a>
2025-08-20T16:48:21.2701116Z 
2025-08-20T16:48:21.2701198Z # price\_importer.tests.test\_smoke
2025-08-20T16:48:21.2701352Z 
2025-08-20T16:48:21.2701460Z <a id="price_importer.tests.test_normaliser"></a>
2025-08-20T16:48:21.2701643Z 
2025-08-20T16:48:21.2701737Z # price\_importer.tests.test\_normaliser
2025-08-20T16:48:21.2701908Z 
2025-08-20T16:48:21.2701990Z <a id="price_importer.tests"></a>
2025-08-20T16:48:21.2702137Z 
2025-08-20T16:48:21.2702212Z # price\_importer.tests
2025-08-20T16:48:21.2702343Z 
2025-08-20T16:48:21.2702425Z <a id="price_importer.reader"></a>
2025-08-20T16:48:21.2702677Z 
2025-08-20T16:48:21.2702758Z # price\_importer.reader
2025-08-20T16:48:21.2702881Z 
2025-08-20T16:48:21.2702969Z <a id="price_importer.repository"></a>
2025-08-20T16:48:21.2703131Z 
2025-08-20T16:48:21.2703217Z # price\_importer.repository
2025-08-20T16:48:21.2703478Z 
2025-08-20T16:48:21.2703566Z <a id="price_importer.import"></a>
2025-08-20T16:48:21.2703719Z 
2025-08-20T16:48:21.2703796Z # price\_importer.import
2025-08-20T16:48:21.2703919Z 
2025-08-20T16:48:21.2703993Z <a id="fees_h10"></a>
2025-08-20T16:48:21.2704106Z 
2025-08-20T16:48:21.2704168Z # fees\_h10
2025-08-20T16:48:21.2704258Z 
2025-08-20T16:48:21.2704339Z <a id="fees_h10.worker"></a>
2025-08-20T16:48:21.2704469Z 
2025-08-20T16:48:21.2704535Z # fees\_h10.worker
2025-08-20T16:48:21.2704647Z 
2025-08-20T16:48:21.2704742Z <a id="fees_h10.worker.list_active_asins"></a>
2025-08-20T16:48:21.2704915Z 
2025-08-20T16:48:21.2704985Z #### list\_active\_asins
2025-08-20T16:48:21.2705112Z 
2025-08-20T16:48:21.2705174Z ```python
2025-08-20T16:48:21.2705346Z def list_active_asins() -> list[str]
2025-08-20T16:48:21.2705551Z ```
2025-08-20T16:48:21.2705632Z 
2025-08-20T16:48:21.2705748Z Return known ASINs or an empty list if unavailable.
2025-08-20T16:48:21.2705939Z 
2025-08-20T16:48:21.2706035Z <a id="fees_h10.tests.test_smoke"></a>
2025-08-20T16:48:21.2706199Z 
2025-08-20T16:48:21.2706276Z # fees\_h10.tests.test\_smoke
2025-08-20T16:48:21.2706411Z 
2025-08-20T16:48:21.2706494Z <a id="fees_h10.tests"></a>
2025-08-20T16:48:21.2706621Z 
2025-08-20T16:48:21.2706686Z # fees\_h10.tests
2025-08-20T16:48:21.2706787Z 
2025-08-20T16:48:21.2706867Z <a id="fees_h10.client"></a>
2025-08-20T16:48:21.2706996Z 
2025-08-20T16:48:21.2707060Z # fees\_h10.client
2025-08-20T16:48:21.2707167Z 
2025-08-20T16:48:21.2707248Z <a id="fees_h10.repository"></a>
2025-08-20T16:48:21.2707393Z 
2025-08-20T16:48:21.2707469Z # fees\_h10.repository
2025-08-20T16:48:21.2707584Z 
2025-08-20T16:48:21.2707684Z <a id="fees_h10.repository.upsert_fees_raw"></a>
2025-08-20T16:48:21.2707865Z 
2025-08-20T16:48:21.2707941Z #### upsert\_fees\_raw
2025-08-20T16:48:21.2708052Z 
2025-08-20T16:48:21.2708113Z ```python
2025-08-20T16:48:21.2708283Z def upsert_fees_raw(engine: Engine,
2025-08-20T16:48:21.2708517Z                     rows: Iterable[Mapping[str, Any]],
2025-08-20T16:48:21.2708768Z                     *,
2025-08-20T16:48:21.2708991Z                     testing: bool = False) -> Optional[Dict[str, int]]
2025-08-20T16:48:21.2709258Z ```
2025-08-20T16:48:21.2709338Z 
2025-08-20T16:48:21.2709424Z Idempotent upsert for fees.
2025-08-20T16:48:21.2709556Z 
2025-08-20T16:48:21.2709708Z TESTING-only: returns counts for inserted/updated/skipped rows.
2025-08-20T16:48:21.2710050Z Assumes logical key (asin, marketplace, fee_type).
2025-08-20T16:48:21.2710355Z Only updates when one of the mutable fields changes.
2025-08-20T16:48:21.2710556Z 
2025-08-20T16:48:21.2710624Z <a id="emailer"></a>
2025-08-20T16:48:21.2710735Z 
2025-08-20T16:48:21.2710805Z # emailer
2025-08-20T16:48:21.2710893Z 
2025-08-20T16:48:21.2710993Z <a id="emailer.tests.test_import_emailer"></a>
2025-08-20T16:48:21.2711169Z 
2025-08-20T16:48:21.2711264Z # emailer.tests.test\_import\_emailer
2025-08-20T16:48:21.2711422Z 
2025-08-20T16:48:21.2711506Z <a id="emailer.tests.test_smoke"></a>
2025-08-20T16:48:21.2711795Z 
2025-08-20T16:48:21.2711873Z # emailer.tests.test\_smoke
2025-08-20T16:48:21.2712006Z 
2025-08-20T16:48:21.2712087Z <a id="emailer.tests"></a>
2025-08-20T16:48:21.2712216Z 
2025-08-20T16:48:21.2712284Z # emailer.tests
2025-08-20T16:48:21.2712387Z 
2025-08-20T16:48:21.2712475Z <a id="emailer.generate_body"></a>
2025-08-20T16:48:21.2712732Z 
2025-08-20T16:48:21.2712805Z # emailer.generate\_body
2025-08-20T16:48:21.2712933Z 
2025-08-20T16:48:21.2713002Z <a id="llm_server"></a>
2025-08-20T16:48:21.2713119Z 
2025-08-20T16:48:21.2713180Z # llm\_server
2025-08-20T16:48:21.2713281Z 
2025-08-20T16:48:21.2713354Z <a id="llm_server.app"></a>
2025-08-20T16:48:21.2713483Z 
2025-08-20T16:48:21.2713554Z # llm\_server.app
2025-08-20T16:48:21.2713658Z 
