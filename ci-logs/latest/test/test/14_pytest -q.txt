2025-08-19T12:36:10.5226660Z ##[group]Run pytest -q --cov=services
2025-08-19T12:36:10.5227054Z [36;1mpytest -q --cov=services[0m
2025-08-19T12:36:10.5267655Z shell: /usr/bin/bash -e {0}
2025-08-19T12:36:10.5267902Z env:
2025-08-19T12:36:10.5268355Z   REDIS_URL: redis://localhost:6379/0
2025-08-19T12:36:10.5268640Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-19T12:36:10.5268875Z   TRUST_X_FORWARDED: 1
2025-08-19T12:36:10.5269077Z   PG_USER: postgres
2025-08-19T12:36:10.5269267Z   PG_PASSWORD: pass
2025-08-19T12:36:10.5269446Z   PG_DATABASE: awa
2025-08-19T12:36:10.5269626Z   PG_HOST: localhost
2025-08-19T12:36:10.5269815Z   PG_PORT: 5432
2025-08-19T12:36:10.5270235Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-19T12:36:10.5270636Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-19T12:36:10.5271017Z   DATABASE_URL: ***localhost:5432/awa
2025-08-19T12:36:10.5271276Z   DATA_DIR: /home/runner/work/_temp/awa-data
2025-08-19T12:36:10.5271529Z   ENABLE_LIVE: 0
2025-08-19T12:36:10.5271893Z   TESTING: 1
2025-08-19T12:36:10.5272136Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:36:10.5272575Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-19T12:36:10.5273000Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:36:10.5273356Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:36:10.5273711Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:36:10.5274067Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-19T12:36:10.5274373Z   POSTGRES_USER: postgres
2025-08-19T12:36:10.5274586Z   POSTGRES_PASSWORD: pass
2025-08-19T12:36:10.5274787Z   POSTGRES_DB: awa
2025-08-19T12:36:10.5274970Z   LLM_PROVIDER: lan
2025-08-19T12:36:10.5275180Z   LLM_BASE_URL: http://localhost:8000
2025-08-19T12:36:10.5275431Z ##[endgroup]
2025-08-19T12:36:44.3532877Z ........s.............................sssssss........................... [ 43%]
2025-08-19T12:37:19.0983484Z ...................................................F.F...F.............. [ 86%]
2025-08-19T12:37:19.8688377Z ......................                                                   [100%]
2025-08-19T12:37:19.8689319Z =================================== FAILURES ===================================
2025-08-19T12:37:19.8690150Z ___________________________ test_roi_basic_auth_good ___________________________
2025-08-19T12:37:19.8690602Z 
2025-08-19T12:37:19.8691132Z monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7f398a8fab10>
2025-08-19T12:37:19.8691659Z 
2025-08-19T12:37:19.8691927Z     def test_roi_basic_auth_good(monkeypatch):
2025-08-19T12:37:19.8692523Z         os.environ["API_BASIC_USER"] = "u"
2025-08-19T12:37:19.8693057Z         os.environ["API_BASIC_PASS"] = "p"
2025-08-19T12:37:19.8693474Z         client = _client()
2025-08-19T12:37:19.8694027Z >       r = client.get("/roi", headers=_auth_headers("u", "p"))
2025-08-19T12:37:19.8694587Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8694905Z 
2025-08-19T12:37:19.8695195Z services/api/tests/test_roi_basic_auth.py:32: 
2025-08-19T12:37:19.8695873Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:37:19.8697028Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:37:19.8697906Z     return super().get(
2025-08-19T12:37:19.8699113Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:37:19.8699957Z     return self.request(
2025-08-19T12:37:19.8701013Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:37:19.8701908Z     return super().request(
2025-08-19T12:37:19.8702892Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:37:19.8703993Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:37:19.8704746Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8706213Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:37:19.8707190Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:37:19.8707774Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8709114Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:37:19.8710114Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:37:19.8710636Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8711650Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:37:19.8712593Z     response = self._send_handling_auth(
2025-08-19T12:37:19.8713754Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:37:19.8714989Z     response = self._send_handling_redirects(
2025-08-19T12:37:19.8716223Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:37:19.8717296Z     response = self._send_single_request(request)
2025-08-19T12:37:19.8717866Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8719219Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:37:19.8720271Z     response = transport.handle_request(request)
2025-08-19T12:37:19.8720837Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8721997Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:37:19.8722911Z     raise exc
2025-08-19T12:37:19.8723946Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:37:19.8724997Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:37:19.8726097Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:37:19.8727182Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:37:19.8727880Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8729072Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:37:19.8729938Z     return self.__get_result()
2025-08-19T12:37:19.8730404Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8731412Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:37:19.8732264Z     raise self._exception
2025-08-19T12:37:19.8733251Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:37:19.8734135Z     retval = await retval_or_awaitable
2025-08-19T12:37:19.8734588Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8735605Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:37:19.8736572Z     await super().__call__(scope, receive, send)
2025-08-19T12:37:19.8738152Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:37:19.8739430Z     return await middleware(scope, receive, send)
2025-08-19T12:37:19.8740020Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8741234Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:37:19.8742349Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:37:19.8742962Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8744064Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:37:19.8745159Z     raise exc from None
2025-08-19T12:37:19.8746150Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:37:19.8746974Z     return await self.app(
2025-08-19T12:37:19.8748184Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:37:19.8749315Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:37:19.8750737Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.8752012Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.8752720Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8753916Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:37:19.8755072Z     raise exc
2025-08-19T12:37:19.8756132Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:37:19.8757109Z     await self.app(scope, receive, _send)
2025-08-19T12:37:19.8758670Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.8759967Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.8760655Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8761745Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:37:19.8762704Z     await self.app(scope, receive, send)
2025-08-19T12:37:19.8763867Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.8764984Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.8767444Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8768727Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:37:19.8769706Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:37:19.8771024Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:37:19.8772068Z     await old_call(self, scope, receive, send)
2025-08-19T12:37:19.8773208Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.8774283Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.8774896Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8775971Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:37:19.8777063Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:37:19.8778554Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:37:19.8779377Z     raise exc
2025-08-19T12:37:19.8780298Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:37:19.8781160Z     await app(scope, receive, sender)
2025-08-19T12:37:19.8782087Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:37:19.8782926Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:37:19.8783844Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:37:19.8784832Z     await route.handle(scope, receive, send)
2025-08-19T12:37:19.8785747Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:37:19.8786502Z     await self.app(scope, receive, send)
2025-08-19T12:37:19.8787364Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:37:19.8788491Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:37:19.8789642Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:37:19.8790471Z     raise exc
2025-08-19T12:37:19.8791393Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:37:19.8792264Z     await app(scope, receive, sender)
2025-08-19T12:37:19.8793159Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:37:19.8794136Z     response = await f(request)
2025-08-19T12:37:19.8794525Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8795504Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:37:19.8796490Z     return await old_app(*args, **kwargs)
2025-08-19T12:37:19.8796918Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8797785Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:37:19.8798699Z     solved_result = await solve_dependencies(
2025-08-19T12:37:19.8799799Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:37:19.8800754Z     solved = await call(**solved_result.values)
2025-08-19T12:37:19.8801213Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8802172Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:37:19.8802982Z     pexpire = await self._check(key)
2025-08-19T12:37:19.8803381Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8804278Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:37:19.8805082Z     pexpire = await redis.evalsha(
2025-08-19T12:37:19.8806280Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:37:19.8807420Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:37:19.8808123Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8809142Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:37:19.8810015Z     return await conn.retry.call_with_retry(
2025-08-19T12:37:19.8811011Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:37:19.8811792Z     return await do()
2025-08-19T12:37:19.8812096Z            ^^^^^^^^^^
2025-08-19T12:37:19.8813115Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:37:19.8814156Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:37:19.8814730Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8815727Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:37:19.8816590Z     response = await connection.read_response()
2025-08-19T12:37:19.8817054Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8818245Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:37:19.8819313Z     await self.disconnect(nowait=True)
2025-08-19T12:37:19.8820300Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:37:19.8821179Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:37:19.8821600Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8822303Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:37:19.8822960Z     return self._transport.close()
2025-08-19T12:37:19.8823350Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.8824135Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:37:19.8824782Z     super().close()
2025-08-19T12:37:19.8825498Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:37:19.8826281Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:37:19.8827325Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:37:19.8828143Z     self._check_closed()
2025-08-19T12:37:19.8828647Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:37:19.8828984Z 
2025-08-19T12:37:19.8829383Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:37:19.8829792Z 
2025-08-19T12:37:19.8829919Z     def _check_closed(self):
2025-08-19T12:37:19.8830270Z         if self._closed:
2025-08-19T12:37:19.8830738Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:37:19.8831291Z E           RuntimeError: Event loop is closed
2025-08-19T12:37:19.8831580Z 
2025-08-19T12:37:19.8832186Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:37:19.8833113Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:37:19.8981289Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "139871e53a4946b683508df802651dc3", "level": "error", "timestamp": "2025-08-19T12:37:15.657530Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f398a9e3da0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f398a851ee0>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f398a8f9160>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f398a870110>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f398a851ee0>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='1c378fe\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f398ddd68e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f398a870110>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f398ddd6200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "139871e53a4946b683508df802651dc3", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f398abd49'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='1c\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f399d5c2c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f398a8f90a0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "conn": "<starlette.requests.Request object at 0x7f398a8f90a0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "conn": "<starlette.requests.Request object at 0x7f398a8f90a0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/roi', name='roi', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi at 0x7f398d3928e0>, 'path_params': {}, 'route': APIRo\"+46"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/roi', name='roi', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398a8514e0>", "request": "<starlette.requests.Request object at 0x7f398a8f9280>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398a8514e0>", "conn": "<starlette.requests.Request object at 0x7f398a8f9280>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398a8514e0>", "conn": "<starlette.requests.Request object at 0x7f398a8f9280>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f398a8f9280>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f398a8f9280>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f398a963950>", "request": "<starlette.requests.Request object at 0x7f398a8f9280>", "sentry_scope": "<Scope id=0x7f398a994120 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f398a8'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f398a8153a0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f398a8f9280>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f398a8f94f0>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f398a8f94c0>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "\"Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='ro\"+2748", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f399d3232c0>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "True", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f398a8f9280>", "dependant": "\"Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='ro\"+2748", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f398a8f9490>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f399d3232c0>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f398a8f94c0>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+455", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+455", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "use_path": "/roi", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f39\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "request": "<starlette.requests.Request object at 0x7f398a8f9280>", "response": "<starlette.responses.Response object at 0x7f398a8f9490>", "route_index": "8", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f398a9913a0>", "callback": "<function http_default_callback at 0x7f398e039760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:8:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "key": "fastapi-limiter:testclient:8:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:8:0'\"+17", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f398a762090>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f398df86840>", "set_db_data_fn": "<function _set_db_data at 0x7f398ac6a3e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+28", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f398a884a40>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f398a851e40>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f398a852fc0>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+28", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=17> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=17>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=17>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f398abd8e50>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f398abd8e50>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f398abd8e50>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:37:19.9057584Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f39884357f0>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:37:19.9060267Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f3988436d80>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:37:19.9061847Z _____________________ test_stats_contract_needs_basic_auth _____________________
2025-08-19T12:37:19.9062108Z 
2025-08-19T12:37:19.9062248Z     def test_stats_contract_needs_basic_auth():
2025-08-19T12:37:19.9062561Z         os.environ["API_BASIC_USER"] = "u"
2025-08-19T12:37:19.9062853Z         os.environ["API_BASIC_PASS"] = "p"
2025-08-19T12:37:19.9063109Z         client = _client()
2025-08-19T12:37:19.9063372Z >       r = client.get("/stats/kpi")
2025-08-19T12:37:19.9063639Z             ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9063794Z 
2025-08-19T12:37:19.9063964Z services/api/tests/test_roi_basic_auth.py:48: 
2025-08-19T12:37:19.9064351Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:37:19.9064963Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:37:19.9065437Z     return super().get(
2025-08-19T12:37:19.9065940Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:37:19.9066386Z     return self.request(
2025-08-19T12:37:19.9066936Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:37:19.9067406Z     return super().request(
2025-08-19T12:37:19.9068042Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:37:19.9068638Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:37:19.9069035Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9069605Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:37:19.9070125Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:37:19.9070438Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9071048Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:37:19.9071574Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:37:19.9071853Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9072376Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:37:19.9072851Z     response = self._send_handling_auth(
2025-08-19T12:37:19.9073459Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:37:19.9073993Z     response = self._send_handling_redirects(
2025-08-19T12:37:19.9074622Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:37:19.9075185Z     response = self._send_single_request(request)
2025-08-19T12:37:19.9075638Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9076247Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:37:19.9076850Z     response = transport.handle_request(request)
2025-08-19T12:37:19.9077148Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9077770Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:37:19.9078500Z     raise exc
2025-08-19T12:37:19.9079062Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:37:19.9079614Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:37:19.9080194Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:37:19.9080900Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:37:19.9081279Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9081826Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:37:19.9082287Z     return self.__get_result()
2025-08-19T12:37:19.9082533Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9083059Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:37:19.9083526Z     raise self._exception
2025-08-19T12:37:19.9084092Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:37:19.9084617Z     retval = await retval_or_awaitable
2025-08-19T12:37:19.9084889Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9085479Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:37:19.9086029Z     await super().__call__(scope, receive, send)
2025-08-19T12:37:19.9086781Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:37:19.9087422Z     return await middleware(scope, receive, send)
2025-08-19T12:37:19.9087723Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9088467Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:37:19.9089104Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:37:19.9089474Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9090098Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:37:19.9090605Z     raise exc from None
2025-08-19T12:37:19.9091180Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:37:19.9091696Z     return await self.app(
2025-08-19T12:37:19.9092273Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:37:19.9092835Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:37:19.9093566Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.9094252Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.9094629Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9095258Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:37:19.9095754Z     raise exc
2025-08-19T12:37:19.9096307Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:37:19.9096847Z     await self.app(scope, receive, _send)
2025-08-19T12:37:19.9097668Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.9098597Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.9098974Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9099602Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:37:19.9100133Z     await self.app(scope, receive, send)
2025-08-19T12:37:19.9100828Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.9101500Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.9101867Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9102662Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:37:19.9103278Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:37:19.9104102Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:37:19.9104773Z     await old_call(self, scope, receive, send)
2025-08-19T12:37:19.9105479Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.9106151Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.9106520Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9107160Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:37:19.9107823Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:37:19.9108695Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:37:19.9109193Z     raise exc
2025-08-19T12:37:19.9109755Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:37:19.9110296Z     await app(scope, receive, sender)
2025-08-19T12:37:19.9110868Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:37:19.9111404Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:37:19.9111991Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:37:19.9112488Z     await route.handle(scope, receive, send)
2025-08-19T12:37:19.9113062Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:37:19.9113565Z     await self.app(scope, receive, send)
2025-08-19T12:37:19.9114123Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:37:19.9114706Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:37:19.9115429Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:37:19.9115927Z     raise exc
2025-08-19T12:37:19.9116489Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:37:19.9117029Z     await app(scope, receive, sender)
2025-08-19T12:37:19.9117569Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:37:19.9118280Z     response = await f(request)
2025-08-19T12:37:19.9118535Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9119152Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:37:19.9119916Z     return await old_app(*args, **kwargs)
2025-08-19T12:37:19.9120192Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9120756Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:37:19.9121278Z     solved_result = await solve_dependencies(
2025-08-19T12:37:19.9121963Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:37:19.9122558Z     solved = await call(**solved_result.values)
2025-08-19T12:37:19.9122853Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9123442Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:37:19.9123958Z     pexpire = await self._check(key)
2025-08-19T12:37:19.9124218Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9124945Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:37:19.9125462Z     pexpire = await redis.evalsha(
2025-08-19T12:37:19.9126212Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:37:19.9126937Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:37:19.9127300Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9128020Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:37:19.9128583Z     return await conn.retry.call_with_retry(
2025-08-19T12:37:19.9129201Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:37:19.9129690Z     return await do()
2025-08-19T12:37:19.9129890Z            ^^^^^^^^^^
2025-08-19T12:37:19.9130516Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:37:19.9131190Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:37:19.9131556Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9132237Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:37:19.9132798Z     response = await connection.read_response()
2025-08-19T12:37:19.9133096Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9133720Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:37:19.9134258Z     await self.disconnect(nowait=True)
2025-08-19T12:37:19.9134869Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:37:19.9135436Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:37:19.9135716Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9136156Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:37:19.9136588Z     return self._transport.close()
2025-08-19T12:37:19.9136847Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9137348Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:37:19.9137779Z     super().close()
2025-08-19T12:37:19.9138461Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:37:19.9138975Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:37:19.9139551Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:37:19.9139980Z     self._check_closed()
2025-08-19T12:37:19.9140302Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:37:19.9140515Z 
2025-08-19T12:37:19.9140893Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:37:19.9141157Z 
2025-08-19T12:37:19.9141245Z     def _check_closed(self):
2025-08-19T12:37:19.9141470Z         if self._closed:
2025-08-19T12:37:19.9141761Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:37:19.9142101Z E           RuntimeError: Event loop is closed
2025-08-19T12:37:19.9142287Z 
2025-08-19T12:37:19.9142645Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:37:19.9143221Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:37:19.9244080Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "33fcc0f1818d48e3bfe70ec9581b232a", "level": "error", "timestamp": "2025-08-19T12:37:17.236666Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f398a9e3da0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f398abb8220>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f3988437770>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f398a870110>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f398abb8220>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='e1988a7\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f398ddd68e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f398a870110>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+60", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f398ddd6200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+119", "header_value": "None", "validation_failed": "False", "id_value": "33fcc0f1818d48e3bfe70ec9581b232a", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f398abd49'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='e1\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f399d5c2c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f3988436f00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "conn": "<starlette.requests.Request object at 0x7f3988436f00>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "conn": "<starlette.requests.Request object at 0x7f3988436f00>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/kpi', name='kpi', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function kpi at 0x7f398d393600>, 'path_params': {}, 'route': APIRo\"+52"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/kpi', name='kpi', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398abd5ee0>", "request": "<starlette.requests.Request object at 0x7f39884375f0>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398abd5ee0>", "conn": "<starlette.requests.Request object at 0x7f39884375f0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398abd5ee0>", "conn": "<starlette.requests.Request object at 0x7f39884375f0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f39884375f0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f39884375f0>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f398a963950>", "request": "<starlette.requests.Request object at 0x7f39884375f0>", "sentry_scope": "<Scope id=0x7f3978d9a7a0 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f39884'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f398a815da0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f39884375f0>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f3988437ce0>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f3988437cb0>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2077", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f399d3232c0>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f39884375f0>", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2077", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f3988436690>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f399d3232c0>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f3988437cb0>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+461", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+461", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "use_path": "/stats/kpi", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f39\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "request": "<starlette.requests.Request object at 0x7f39884375f0>", "response": "<starlette.responses.Response object at 0x7f3988436690>", "route_index": "11", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f398a9913a0>", "callback": "<function http_default_callback at 0x7f398e039760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:11:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "key": "fastapi-limiter:testclient:11:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:11:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f398a762090>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f398df86840>", "set_db_data_fn": "<function _set_db_data at 0x7f398ac6a3e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f398a884a40>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f398abd5f80>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f398abd4720>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=18> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f398abd8e50>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f398abd8e50>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f398abd8e50>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:37:19.9321271Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f3988437200>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:37:19.9323717Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f398ab43350>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:37:19.9326163Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f3988448f20>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:37:19.9329164Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f39884f95b0>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:37:19.9331607Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f39884fb3b0>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:37:19.9334181Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f39884fb320>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:37:19.9335501Z _________________________ test_roi_by_vendor_contract __________________________
2025-08-19T12:37:19.9335744Z 
2025-08-19T12:37:19.9335868Z     def test_roi_by_vendor_contract():
2025-08-19T12:37:19.9336149Z         client, up = client_with_auth()
2025-08-19T12:37:19.9336558Z >       r = client.get("/stats/roi_by_vendor", headers=_auth_headers(*up))
2025-08-19T12:37:19.9336937Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9337122Z 
2025-08-19T12:37:19.9337301Z services/api/tests/test_stats_contracts.py:29: 
2025-08-19T12:37:19.9337697Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:37:19.9338567Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:37:19.9339047Z     return super().get(
2025-08-19T12:37:19.9339561Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:37:19.9340012Z     return self.request(
2025-08-19T12:37:19.9340568Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:37:19.9341050Z     return super().request(
2025-08-19T12:37:19.9341575Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:37:19.9342166Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:37:19.9342564Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9343137Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:37:19.9343664Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:37:19.9343975Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9344580Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:37:19.9345118Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:37:19.9345395Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9345920Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:37:19.9346396Z     response = self._send_handling_auth(
2025-08-19T12:37:19.9347003Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:37:19.9347540Z     response = self._send_handling_redirects(
2025-08-19T12:37:19.9348285Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:37:19.9349009Z     response = self._send_single_request(request)
2025-08-19T12:37:19.9349319Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9349930Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:37:19.9350487Z     response = transport.handle_request(request)
2025-08-19T12:37:19.9350788Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9351389Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:37:19.9351879Z     raise exc
2025-08-19T12:37:19.9352426Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:37:19.9352977Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:37:19.9353670Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:37:19.9354247Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:37:19.9354623Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9355179Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:37:19.9355638Z     return self.__get_result()
2025-08-19T12:37:19.9355883Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9356410Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:37:19.9356870Z     raise self._exception
2025-08-19T12:37:19.9357419Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:37:19.9358075Z     retval = await retval_or_awaitable
2025-08-19T12:37:19.9358408Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9358992Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:37:19.9359544Z     await super().__call__(scope, receive, send)
2025-08-19T12:37:19.9360297Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:37:19.9360941Z     return await middleware(scope, receive, send)
2025-08-19T12:37:19.9361246Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9361867Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:37:19.9362497Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:37:19.9362865Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9363496Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:37:19.9364007Z     raise exc from None
2025-08-19T12:37:19.9364588Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:37:19.9365094Z     return await self.app(
2025-08-19T12:37:19.9365659Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:37:19.9366214Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:37:19.9366940Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.9367618Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.9368100Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9368729Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:37:19.9369266Z     raise exc
2025-08-19T12:37:19.9369820Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:37:19.9370544Z     await self.app(scope, receive, _send)
2025-08-19T12:37:19.9371244Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.9371931Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.9372303Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9372919Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:37:19.9373455Z     await self.app(scope, receive, send)
2025-08-19T12:37:19.9374151Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.9374822Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.9375379Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9376016Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:37:19.9376612Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:37:19.9377425Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:37:19.9378296Z     await old_call(self, scope, receive, send)
2025-08-19T12:37:19.9379011Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:37:19.9379681Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:37:19.9380047Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9380693Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:37:19.9381361Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:37:19.9382092Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:37:19.9382596Z     raise exc
2025-08-19T12:37:19.9383161Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:37:19.9383707Z     await app(scope, receive, sender)
2025-08-19T12:37:19.9384278Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:37:19.9384815Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:37:19.9385403Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:37:19.9385910Z     await route.handle(scope, receive, send)
2025-08-19T12:37:19.9386483Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:37:19.9386982Z     await self.app(scope, receive, send)
2025-08-19T12:37:19.9387534Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:37:19.9388212Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:37:19.9388937Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:37:19.9389439Z     raise exc
2025-08-19T12:37:19.9390009Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:37:19.9390554Z     await app(scope, receive, sender)
2025-08-19T12:37:19.9391097Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:37:19.9391575Z     response = await f(request)
2025-08-19T12:37:19.9391963Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9392587Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:37:19.9393154Z     return await old_app(*args, **kwargs)
2025-08-19T12:37:19.9393429Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9393963Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:37:19.9394458Z     solved_result = await solve_dependencies(
2025-08-19T12:37:19.9395138Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:37:19.9395728Z     solved = await call(**solved_result.values)
2025-08-19T12:37:19.9396017Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9396604Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:37:19.9397246Z     pexpire = await self._check(key)
2025-08-19T12:37:19.9397515Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9398285Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:37:19.9398808Z     pexpire = await redis.evalsha(
2025-08-19T12:37:19.9399556Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:37:19.9400264Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:37:19.9400621Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9401249Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:37:19.9401797Z     return await conn.retry.call_with_retry(
2025-08-19T12:37:19.9402415Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:37:19.9402917Z     return await do()
2025-08-19T12:37:19.9403117Z            ^^^^^^^^^^
2025-08-19T12:37:19.9403748Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:37:19.9404461Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:37:19.9404825Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9405445Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:37:19.9405998Z     response = await connection.read_response()
2025-08-19T12:37:19.9406297Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9406920Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:37:19.9407469Z     await self.disconnect(nowait=True)
2025-08-19T12:37:19.9408265Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:37:19.9408850Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:37:19.9409129Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9409573Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:37:19.9410023Z     return self._transport.close()
2025-08-19T12:37:19.9410279Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:37:19.9410782Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:37:19.9411209Z     super().close()
2025-08-19T12:37:19.9411674Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:37:19.9412185Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:37:19.9412752Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:37:19.9413184Z     self._check_closed()
2025-08-19T12:37:19.9413656Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:37:19.9413865Z 
2025-08-19T12:37:19.9414115Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:37:19.9414379Z 
2025-08-19T12:37:19.9414466Z     def _check_closed(self):
2025-08-19T12:37:19.9414689Z         if self._closed:
2025-08-19T12:37:19.9414983Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:37:19.9415328Z E           RuntimeError: Event loop is closed
2025-08-19T12:37:19.9415512Z 
2025-08-19T12:37:19.9415877Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:37:19.9416454Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:37:20.4630227Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "cc21d37c26c4461eb046b6d7d8d6ce94", "level": "error", "timestamp": "2025-08-19T12:37:18.164211Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f398a9e3da0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f398aa54400>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f39884c8260>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f398a870110>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f398aa54400>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='764184e\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f398ddd68e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f398a870110>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f398ddd6200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "cc21d37c26c4461eb046b6d7d8d6ce94", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f398abd49'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f398a9e3260'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='76\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f399d5c2c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f398a8314c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f39884c8440>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "conn": "<starlette.requests.Request object at 0x7f39884c8440>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "conn": "<starlette.requests.Request object at 0x7f39884c8440>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f398a871a60>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi_by_vendor at 0x7f398d393a60>, 'path_params': {}, 'rou\"+82"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398aa559e0>", "request": "<starlette.requests.Request object at 0x7f39884ca660>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398aa559e0>", "conn": "<starlette.requests.Request object at 0x7f39884ca660>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f398aa559e0>", "conn": "<starlette.requests.Request object at 0x7f39884ca660>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f39884ca660>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f39884ca660>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f398a963950>", "request": "<starlette.requests.Request object at 0x7f39884ca660>", "sentry_scope": "<Scope id=0x7f398aa32180 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f39884'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f398a8160c0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f39884ca660>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f39884c5670>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f39884c4d70>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2137", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f399d3232c0>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f39884ca660>", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2137", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f39884c4d40>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f399d3232c0>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f39884c4d70>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "use_path": "/stats/roi_by_vendor", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f39\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "request": "<starlette.requests.Request object at 0x7f39884ca660>", "response": "<starlette.responses.Response object at 0x7f39884c4d40>", "route_index": "12", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f398a9913a0>", "callback": "<function http_default_callback at 0x7f398e039760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:12:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f398a8732c0>", "key": "fastapi-limiter:testclient:12:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:12:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f398a762090>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f398df86840>", "set_db_data_fn": "<function _set_db_data at 0x7f398ac6a3e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f3964a691c0>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f398aa57920>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f398aa54040>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=19> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=19>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=19>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f3964b1b1c0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f3964b1b1c0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f3964b1b1c0>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:37:20.4705960Z =============================== warnings summary ===============================
2025-08-19T12:37:20.4706354Z services/alert_bot/tests/test_smoke.py:5
2025-08-19T12:37:20.4707681Z   /home/runner/work/AWA-App/AWA-App/services/alert_bot/tests/test_smoke.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-08-19T12:37:20.4708951Z     import pkg_resources  # noqa: F401
2025-08-19T12:37:20.4709328Z 
2025-08-19T12:37:20.4709517Z tests/api/test_ingest_endpoints.py: 12 warnings
2025-08-19T12:37:20.4709879Z tests/ingest/test_tasks_eager.py: 3 warnings
2025-08-19T12:37:20.4710193Z tests/test_api_fast.py: 1 warning
2025-08-19T12:37:20.4710482Z tests/test_health.py: 5 warnings
2025-08-19T12:37:20.4710763Z tests/test_smoke.py: 5 warnings
2025-08-19T12:37:20.4711061Z services/api/tests/test_cors.py: 1 warning
2025-08-19T12:37:20.4711420Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T12:37:20.4711774Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:37:20.4712128Z services/api/tests/test_rate_limit.py: 122 warnings
2025-08-19T12:37:20.4712515Z services/api/tests/test_roi_basic_auth.py: 4 warnings
2025-08-19T12:37:20.4712939Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T12:37:20.4713326Z services/api/tests/test_stats_contracts.py: 3 warnings
2025-08-19T12:37:20.4715017Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/extensions/sentry.py:27: DeprecationWarning: sentry_sdk.configure_scope is deprecated and will be removed in the next major version. Please consult our migration guide to learn how to migrate to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x#scope-configuring
2025-08-19T12:37:20.4716356Z     with configure_scope() as scope:
2025-08-19T12:37:20.4716525Z 
2025-08-19T12:37:20.4716688Z tests/api/test_ingest_endpoints.py: 3 warnings
2025-08-19T12:37:20.4717037Z tests/test_api_fast.py: 1 warning
2025-08-19T12:37:20.4717321Z tests/test_health.py: 5 warnings
2025-08-19T12:37:20.4717591Z tests/test_smoke.py: 5 warnings
2025-08-19T12:37:20.4717883Z services/api/tests/test_cors.py: 3 warnings
2025-08-19T12:37:20.4718353Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T12:37:20.4718703Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:37:20.4719049Z services/api/tests/test_rate_limit.py: 2 warnings
2025-08-19T12:37:20.4719433Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T12:37:20.4720502Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/__init__.py:89: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.1.
2025-08-19T12:37:20.4721282Z     await cls.redis.close()
2025-08-19T12:37:20.4721431Z 
2025-08-19T12:37:20.4721626Z tests/test_api_fast.py::test_health_endpoint
2025-08-19T12:37:20.4723156Z   /home/runner/work/AWA-App/AWA-App/tests/test_api_fast.py:13: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:37:20.4724525Z     return datetime.datetime.utcnow()
2025-08-19T12:37:20.4724715Z 
2025-08-19T12:37:20.4724857Z tests/test_api_fast.py: 1 warning
2025-08-19T12:37:20.4725146Z tests/test_health.py: 5 warnings
2025-08-19T12:37:20.4725427Z tests/test_smoke.py: 5 warnings
2025-08-19T12:37:20.4725723Z services/api/tests/test_cors.py: 1 warning
2025-08-19T12:37:20.4726062Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:37:20.4726420Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T12:37:20.4727605Z   /home/runner/work/AWA-App/AWA-App/services/api/routes/health.py:24: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:37:20.4729047Z     app_now = datetime.utcnow().replace(tzinfo=timezone.utc)
2025-08-19T12:37:20.4729293Z 
2025-08-19T12:37:20.4729441Z tests/test_health.py::test_health[0]
2025-08-19T12:37:20.4729745Z tests/test_health.py::test_health[1]
2025-08-19T12:37:20.4730049Z tests/test_health.py::test_health[2]
2025-08-19T12:37:20.4730347Z tests/test_health.py::test_health[3]
2025-08-19T12:37:20.4730630Z tests/test_health.py::test_health[4]
2025-08-19T12:37:20.4731720Z   /home/runner/work/AWA-App/AWA-App/tests/test_health.py:22: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:37:20.4732920Z     return datetime.datetime.utcnow()
2025-08-19T12:37:20.4733098Z 
2025-08-19T12:37:20.4733242Z tests/test_smoke.py::test_health[0]
2025-08-19T12:37:20.4733534Z tests/test_smoke.py::test_health[1]
2025-08-19T12:37:20.4733821Z tests/test_smoke.py::test_health[2]
2025-08-19T12:37:20.4734098Z tests/test_smoke.py::test_health[3]
2025-08-19T12:37:20.4734370Z tests/test_smoke.py::test_health[4]
2025-08-19T12:37:20.4735437Z   /home/runner/work/AWA-App/AWA-App/tests/test_smoke.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:37:20.4736569Z     return datetime.datetime.utcnow()
2025-08-19T12:37:20.4736996Z Sentry is attempting to send 0 pending events
2025-08-19T12:37:20.4737308Z Waiting up to True seconds
2025-08-19T12:37:20.4737546Z Press Ctrl-C to quit
2025-08-19T12:37:20.4737681Z 
2025-08-19T12:37:20.4738064Z services/api/tests/test_cors.py::test_cors_simple_get_allowed
2025-08-19T12:37:20.4739303Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_cors.py:27: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:37:20.4740345Z     return datetime.datetime.utcnow()
2025-08-19T12:37:20.4740523Z 
2025-08-19T12:37:20.4740714Z services/api/tests/test_health.py::test_health_route
2025-08-19T12:37:20.4741910Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_health.py:14: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:37:20.4742968Z     return datetime.datetime.utcnow()
2025-08-19T12:37:20.4743145Z 
2025-08-19T12:37:20.4743324Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T12:37:20.4753568Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_rate_limit.py:33: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:37:20.4754666Z     return datetime.datetime.utcnow()
2025-08-19T12:37:20.4754863Z 
2025-08-19T12:37:20.4755215Z services/api/tests/test_sentry_event.py::test_unhandled_exception_is_captured_and_tagged
2025-08-19T12:37:20.4756743Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_sentry_event.py:47: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
2025-08-19T12:37:20.4758096Z     hub = sentry_sdk.Hub.current
2025-08-19T12:37:20.4758272Z 
2025-08-19T12:37:20.4758545Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-08-19T12:37:20.4759029Z ================================ tests coverage ================================
2025-08-19T12:37:20.4759490Z _______________ coverage: platform linux, python 3.12.11-final-0 _______________
2025-08-19T12:37:20.4759757Z 
2025-08-19T12:37:20.4759906Z Coverage XML written to file coverage.xml
2025-08-19T12:37:20.4760309Z Required test coverage of 65% reached. Total coverage: 65.21%
2025-08-19T12:37:20.4760749Z =========================== short test summary info ============================
2025-08-19T12:37:20.4761381Z FAILED services/api/tests/test_roi_basic_auth.py::test_roi_basic_auth_good - RuntimeError: Event loop is closed
2025-08-19T12:37:20.4762244Z FAILED services/api/tests/test_roi_basic_auth.py::test_stats_contract_needs_basic_auth - RuntimeError: Event loop is closed
2025-08-19T12:37:20.4763304Z FAILED services/api/tests/test_stats_contracts.py::test_roi_by_vendor_contract - RuntimeError: Event loop is closed
2025-08-19T12:37:20.9640263Z ##[error]Process completed with exit code 1.
