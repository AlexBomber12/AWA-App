2025-08-19T13:35:35.5911844Z ##[group]Run pytest -q --cov=services
2025-08-19T13:35:35.5912402Z [36;1mpytest -q --cov=services[0m
2025-08-19T13:35:35.5965204Z shell: /usr/bin/bash -e {0}
2025-08-19T13:35:35.5965464Z env:
2025-08-19T13:35:35.5965683Z   REDIS_URL: redis://localhost:6379/0
2025-08-19T13:35:35.5965965Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-19T13:35:35.5966418Z   TRUST_X_FORWARDED: 1
2025-08-19T13:35:35.5966631Z   PG_USER: postgres
2025-08-19T13:35:35.5966827Z   PG_PASSWORD: pass
2025-08-19T13:35:35.5967018Z   PG_DATABASE: awa
2025-08-19T13:35:35.5967197Z   PG_HOST: localhost
2025-08-19T13:35:35.5967384Z   PG_PORT: 5432
2025-08-19T13:35:35.5967838Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-19T13:35:35.5968262Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-19T13:35:35.5968833Z   DATABASE_URL: ***localhost:5432/awa
2025-08-19T13:35:35.5969424Z   DATA_DIR: /home/runner/work/_temp/awa-data
2025-08-19T13:35:35.5969862Z   ENABLE_LIVE: 0
2025-08-19T13:35:35.5970179Z   TESTING: 1
2025-08-19T13:35:35.5970609Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T13:35:35.5971370Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-19T13:35:35.5972082Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T13:35:35.5972727Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T13:35:35.5973350Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T13:35:35.5973984Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-19T13:35:35.5974531Z   POSTGRES_USER: postgres
2025-08-19T13:35:35.5974915Z   POSTGRES_PASSWORD: pass
2025-08-19T13:35:35.5975299Z   POSTGRES_DB: awa
2025-08-19T13:35:35.5975638Z   LLM_PROVIDER: lan
2025-08-19T13:35:35.5976019Z   LLM_BASE_URL: http://localhost:8000
2025-08-19T13:35:35.5976459Z ##[endgroup]
2025-08-19T13:36:04.5211505Z ........s.............................sssssss........................... [ 43%]
2025-08-19T13:36:39.3689663Z ...................................................F.F...F.............. [ 86%]
2025-08-19T13:36:40.1830099Z ......................                                                   [100%]
2025-08-19T13:36:40.1831118Z =================================== FAILURES ===================================
2025-08-19T13:36:40.1832196Z ___________________________ test_roi_basic_auth_good ___________________________
2025-08-19T13:36:40.1832873Z 
2025-08-19T13:36:40.1833678Z monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fbb346dad80>
2025-08-19T13:36:40.1834399Z 
2025-08-19T13:36:40.1834753Z     def test_roi_basic_auth_good(monkeypatch):
2025-08-19T13:36:40.1835556Z         os.environ["API_BASIC_USER"] = "u"
2025-08-19T13:36:40.1836316Z         os.environ["API_BASIC_PASS"] = "p"
2025-08-19T13:36:40.1837054Z         client = _client()
2025-08-19T13:36:40.1837872Z >       r = client.get("/roi", headers=_auth_headers("u", "p"))
2025-08-19T13:36:40.1838417Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1838698Z 
2025-08-19T13:36:40.1839233Z services/api/tests/test_roi_basic_auth.py:32: 
2025-08-19T13:36:40.1839886Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T13:36:40.1840882Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T13:36:40.1841658Z     return super().get(
2025-08-19T13:36:40.1842473Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T13:36:40.1843187Z     return self.request(
2025-08-19T13:36:40.1844530Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T13:36:40.1845612Z     return super().request(
2025-08-19T13:36:40.1846457Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T13:36:40.1847526Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T13:36:40.1848259Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1849606Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T13:36:40.1850245Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T13:36:40.1850614Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1851556Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T13:36:40.1852204Z     rv = real_send(self, request, **kwargs)
2025-08-19T13:36:40.1852536Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1853178Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T13:36:40.1853757Z     response = self._send_handling_auth(
2025-08-19T13:36:40.1854562Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T13:36:40.1855203Z     response = self._send_handling_redirects(
2025-08-19T13:36:40.1855980Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T13:36:40.1856651Z     response = self._send_single_request(request)
2025-08-19T13:36:40.1857172Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1858309Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T13:36:40.1859422Z     response = transport.handle_request(request)
2025-08-19T13:36:40.1859899Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1860739Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T13:36:40.1861266Z     raise exc
2025-08-19T13:36:40.1861852Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T13:36:40.1862731Z     portal.call(self.app, scope, receive, send)
2025-08-19T13:36:40.1863390Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T13:36:40.1864002Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T13:36:40.1864397Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1865002Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T13:36:40.1865500Z     return self.__get_result()
2025-08-19T13:36:40.1865767Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1866342Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T13:36:40.1866836Z     raise self._exception
2025-08-19T13:36:40.1867432Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T13:36:40.1867966Z     retval = await retval_or_awaitable
2025-08-19T13:36:40.1868238Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1868835Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T13:36:40.1869670Z     await super().__call__(scope, receive, send)
2025-08-19T13:36:40.1870411Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T13:36:40.1871054Z     return await middleware(scope, receive, send)
2025-08-19T13:36:40.1871357Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1871973Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T13:36:40.1872591Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T13:36:40.1872955Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1873572Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T13:36:40.1874339Z     raise exc from None
2025-08-19T13:36:40.1874912Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T13:36:40.1875411Z     return await self.app(
2025-08-19T13:36:40.1876111Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T13:36:40.1876673Z     await self.middleware_stack(scope, receive, send)
2025-08-19T13:36:40.1877404Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.1878073Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.1878443Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1879393Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T13:36:40.1879905Z     raise exc
2025-08-19T13:36:40.1880453Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T13:36:40.1880985Z     await self.app(scope, receive, _send)
2025-08-19T13:36:40.1881666Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.1882331Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.1882694Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1883293Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T13:36:40.1883813Z     await self.app(scope, receive, send)
2025-08-19T13:36:40.1884486Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.1885138Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.1885505Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1886126Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T13:36:40.1886710Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T13:36:40.1887509Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T13:36:40.1888162Z     await old_call(self, scope, receive, send)
2025-08-19T13:36:40.1888849Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.1889647Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.1890011Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1890646Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T13:36:40.1891288Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T13:36:40.1892003Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T13:36:40.1892503Z     raise exc
2025-08-19T13:36:40.1893064Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T13:36:40.1893598Z     await app(scope, receive, sender)
2025-08-19T13:36:40.1894163Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T13:36:40.1894688Z     await self.middleware_stack(scope, receive, send)
2025-08-19T13:36:40.1895273Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T13:36:40.1895924Z     await route.handle(scope, receive, send)
2025-08-19T13:36:40.1896495Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T13:36:40.1896987Z     await self.app(scope, receive, send)
2025-08-19T13:36:40.1897529Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T13:36:40.1898223Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T13:36:40.1899051Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T13:36:40.1899546Z     raise exc
2025-08-19T13:36:40.1900098Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T13:36:40.1900636Z     await app(scope, receive, sender)
2025-08-19T13:36:40.1901180Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T13:36:40.1901652Z     response = await f(request)
2025-08-19T13:36:40.1901896Z                ^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1902502Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T13:36:40.1903056Z     return await old_app(*args, **kwargs)
2025-08-19T13:36:40.1903325Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1903849Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T13:36:40.1904331Z     solved_result = await solve_dependencies(
2025-08-19T13:36:40.1905001Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T13:36:40.1905581Z     solved = await call(**solved_result.values)
2025-08-19T13:36:40.1905870Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1906446Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T13:36:40.1906952Z     pexpire = await self._check(key)
2025-08-19T13:36:40.1907224Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1907780Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T13:36:40.1908280Z     pexpire = await redis.evalsha(
2025-08-19T13:36:40.1909123Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T13:36:40.1909824Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T13:36:40.1910184Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1910804Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T13:36:40.1911337Z     return await conn.retry.call_with_retry(
2025-08-19T13:36:40.1911945Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T13:36:40.1912435Z     return await do()
2025-08-19T13:36:40.1912666Z            ^^^^^^^^^^
2025-08-19T13:36:40.1913298Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T13:36:40.1913961Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T13:36:40.1914362Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1914977Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T13:36:40.1918241Z     response = await connection.read_response()
2025-08-19T13:36:40.1918721Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1919956Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T13:36:40.1921097Z     await self.disconnect(nowait=True)
2025-08-19T13:36:40.1922093Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T13:36:40.1922923Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T13:36:40.1923404Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1923872Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T13:36:40.1924306Z     return self._transport.close()
2025-08-19T13:36:40.1924563Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.1925071Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T13:36:40.1925494Z     super().close()
2025-08-19T13:36:40.1925966Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T13:36:40.1926466Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T13:36:40.1927019Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T13:36:40.1927445Z     self._check_closed()
2025-08-19T13:36:40.1927772Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T13:36:40.1927973Z 
2025-08-19T13:36:40.1928231Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T13:36:40.1928493Z 
2025-08-19T13:36:40.1928591Z     def _check_closed(self):
2025-08-19T13:36:40.1928818Z         if self._closed:
2025-08-19T13:36:40.1929404Z >           raise RuntimeError('Event loop is closed')
2025-08-19T13:36:40.1929763Z E           RuntimeError: Event loop is closed
2025-08-19T13:36:40.1929943Z 
2025-08-19T13:36:40.1930307Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T13:36:40.1930880Z ------------------------------ Captured log call -------------------------------
2025-08-19T13:36:40.2030420Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "bc9b8732848a4cd1b61e405564a30376", "level": "error", "timestamp": "2025-08-19T13:36:35.876205Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb348529c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb34683ce0>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7fbb346da360>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7fbb34852ab0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb34683ce0>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='e06f9f4\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7fbb37c12980>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7fbb34852ab0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7fbb37c122a0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "bc9b8732848a4cd1b61e405564a30376", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7fbb34588a'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='e0\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7fbb475b2c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7fbb346f6f30>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "conn": "<starlette.requests.Request object at 0x7fbb346f6f30>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "conn": "<starlette.requests.Request object at 0x7fbb346f6f30>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/roi', name='roi', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi at 0x7fbb373d2980>, 'path_params': {}, 'route': APIRo\"+46"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/roi', name='roi', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb346807c0>", "request": "<starlette.requests.Request object at 0x7fbb346f5ca0>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb346807c0>", "conn": "<starlette.requests.Request object at 0x7fbb346f5ca0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb346807c0>", "conn": "<starlette.requests.Request object at 0x7fbb346f5ca0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7fbb346f5ca0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7fbb346f5ca0>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7fbb34791760>", "request": "<starlette.requests.Request object at 0x7fbb346f5ca0>", "sentry_scope": "<Scope id=0x7fbb346891c0 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7fbb346'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7fbb34855300>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7fbb346f5ca0>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7fbb346f6f90>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7fbb346f51c0>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "\"Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='ro\"+2748", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7fbb3480f650>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "True", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7fbb346f5ca0>", "dependant": "\"Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='ro\"+2748", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7fbb346f7020>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7fbb3480f650>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7fbb346f51c0>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+455", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+455", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "use_path": "/roi", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7fbb\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "request": "<starlette.requests.Request object at 0x7fbb346f5ca0>", "response": "<starlette.responses.Response object at 0x7fbb346f7020>", "route_index": "8", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7fbb347a9940>", "callback": "<function http_default_callback at 0x7fbb37e79760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:8:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "key": "fastapi-limiter:testclient:8:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:8:0'\"+17", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7fbb348538c0>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7fbb37dc6840>", "set_db_data_fn": "<function _set_db_data at 0x7fbb34aae480>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+28", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7fbb346e6d40>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7fbb34682ac0>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7fbb34683600>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+28", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=17> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=17>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=17>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb3459cec0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb3459cec0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb3459cec0>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "func_name": "readuntil"}}]}]}
2025-08-19T13:36:40.2109765Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7fbb34393da0>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T13:36:40.2112380Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7fbb34461670>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T13:36:40.2116657Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7fbb344635c0>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T13:36:40.2118382Z _____________________ test_stats_contract_needs_basic_auth _____________________
2025-08-19T13:36:40.2118637Z 
2025-08-19T13:36:40.2118782Z     def test_stats_contract_needs_basic_auth():
2025-08-19T13:36:40.2119249Z         os.environ["API_BASIC_USER"] = "u"
2025-08-19T13:36:40.2119539Z         os.environ["API_BASIC_PASS"] = "p"
2025-08-19T13:36:40.2119789Z         client = _client()
2025-08-19T13:36:40.2120048Z >       r = client.get("/stats/kpi")
2025-08-19T13:36:40.2120314Z             ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2120463Z 
2025-08-19T13:36:40.2120627Z services/api/tests/test_roi_basic_auth.py:48: 
2025-08-19T13:36:40.2121004Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T13:36:40.2121608Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T13:36:40.2122071Z     return super().get(
2025-08-19T13:36:40.2122567Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T13:36:40.2123009Z     return self.request(
2025-08-19T13:36:40.2123545Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T13:36:40.2124011Z     return super().request(
2025-08-19T13:36:40.2124518Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T13:36:40.2125092Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T13:36:40.2125485Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2126043Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T13:36:40.2126544Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T13:36:40.2126851Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2127440Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T13:36:40.2127959Z     rv = real_send(self, request, **kwargs)
2025-08-19T13:36:40.2128228Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2128734Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T13:36:40.2129312Z     response = self._send_handling_auth(
2025-08-19T13:36:40.2129900Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T13:36:40.2130807Z     response = self._send_handling_redirects(
2025-08-19T13:36:40.2131432Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T13:36:40.2132112Z     response = self._send_single_request(request)
2025-08-19T13:36:40.2132415Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2133010Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T13:36:40.2133548Z     response = transport.handle_request(request)
2025-08-19T13:36:40.2133844Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2134434Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T13:36:40.2134914Z     raise exc
2025-08-19T13:36:40.2135447Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T13:36:40.2135991Z     portal.call(self.app, scope, receive, send)
2025-08-19T13:36:40.2136561Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T13:36:40.2137121Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T13:36:40.2137499Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2138034Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T13:36:40.2138485Z     return self.__get_result()
2025-08-19T13:36:40.2138729Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2139365Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T13:36:40.2139819Z     raise self._exception
2025-08-19T13:36:40.2140355Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T13:36:40.2140858Z     retval = await retval_or_awaitable
2025-08-19T13:36:40.2141127Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2141682Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T13:36:40.2142210Z     await super().__call__(scope, receive, send)
2025-08-19T13:36:40.2142936Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T13:36:40.2143560Z     return await middleware(scope, receive, send)
2025-08-19T13:36:40.2143859Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2144488Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T13:36:40.2145094Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T13:36:40.2145455Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2146082Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T13:36:40.2146584Z     raise exc from None
2025-08-19T13:36:40.2147147Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T13:36:40.2147644Z     return await self.app(
2025-08-19T13:36:40.2148197Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T13:36:40.2148740Z     await self.middleware_stack(scope, receive, send)
2025-08-19T13:36:40.2149597Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.2150261Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.2150629Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2151242Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T13:36:40.2151871Z     raise exc
2025-08-19T13:36:40.2152413Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T13:36:40.2153057Z     await self.app(scope, receive, _send)
2025-08-19T13:36:40.2153737Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.2154388Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.2154748Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2155341Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T13:36:40.2155856Z     await self.app(scope, receive, send)
2025-08-19T13:36:40.2156530Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.2157181Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.2157536Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2158154Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T13:36:40.2158730Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T13:36:40.2159643Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T13:36:40.2160289Z     await old_call(self, scope, receive, send)
2025-08-19T13:36:40.2160970Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.2161616Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.2161977Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2162597Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T13:36:40.2163236Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T13:36:40.2163956Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T13:36:40.2164448Z     raise exc
2025-08-19T13:36:40.2165000Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T13:36:40.2165524Z     await app(scope, receive, sender)
2025-08-19T13:36:40.2166082Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T13:36:40.2166603Z     await self.middleware_stack(scope, receive, send)
2025-08-19T13:36:40.2167176Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T13:36:40.2167668Z     await route.handle(scope, receive, send)
2025-08-19T13:36:40.2168237Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T13:36:40.2168732Z     await self.app(scope, receive, send)
2025-08-19T13:36:40.2169398Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T13:36:40.2169966Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T13:36:40.2170679Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T13:36:40.2171176Z     raise exc
2025-08-19T13:36:40.2171729Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T13:36:40.2172261Z     await app(scope, receive, sender)
2025-08-19T13:36:40.2172956Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T13:36:40.2173421Z     response = await f(request)
2025-08-19T13:36:40.2173665Z                ^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2174272Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T13:36:40.2174939Z     return await old_app(*args, **kwargs)
2025-08-19T13:36:40.2175216Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2175742Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T13:36:40.2176225Z     solved_result = await solve_dependencies(
2025-08-19T13:36:40.2176891Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T13:36:40.2177468Z     solved = await call(**solved_result.values)
2025-08-19T13:36:40.2177756Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2178345Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T13:36:40.2178850Z     pexpire = await self._check(key)
2025-08-19T13:36:40.2179233Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2179797Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T13:36:40.2180295Z     pexpire = await redis.evalsha(
2025-08-19T13:36:40.2181029Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T13:36:40.2181718Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T13:36:40.2182072Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2182681Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T13:36:40.2183222Z     return await conn.retry.call_with_retry(
2025-08-19T13:36:40.2183825Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T13:36:40.2184307Z     return await do()
2025-08-19T13:36:40.2184505Z            ^^^^^^^^^^
2025-08-19T13:36:40.2185121Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T13:36:40.2185775Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T13:36:40.2186134Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2186744Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T13:36:40.2187281Z     response = await connection.read_response()
2025-08-19T13:36:40.2187576Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2188177Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T13:36:40.2188710Z     await self.disconnect(nowait=True)
2025-08-19T13:36:40.2189463Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T13:36:40.2190017Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T13:36:40.2190292Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2190730Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T13:36:40.2191152Z     return self._transport.close()
2025-08-19T13:36:40.2191408Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2191910Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T13:36:40.2192334Z     super().close()
2025-08-19T13:36:40.2192790Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T13:36:40.2193289Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T13:36:40.2193994Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T13:36:40.2194407Z     self._check_closed()
2025-08-19T13:36:40.2194727Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T13:36:40.2195043Z 
2025-08-19T13:36:40.2195286Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T13:36:40.2195544Z 
2025-08-19T13:36:40.2195635Z     def _check_closed(self):
2025-08-19T13:36:40.2195863Z         if self._closed:
2025-08-19T13:36:40.2196161Z >           raise RuntimeError('Event loop is closed')
2025-08-19T13:36:40.2196503Z E           RuntimeError: Event loop is closed
2025-08-19T13:36:40.2196682Z 
2025-08-19T13:36:40.2197035Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T13:36:40.2197596Z ------------------------------ Captured log call -------------------------------
2025-08-19T13:36:40.2295911Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "463e9240976941caa789b4181cda4815", "level": "error", "timestamp": "2025-08-19T13:36:37.466247Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb348529c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb3458ae80>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7fbb34985760>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7fbb34852ab0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb3458ae80>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='90eec4b\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7fbb37c12980>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7fbb34852ab0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+60", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7fbb37c122a0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+119", "header_value": "None", "validation_failed": "False", "id_value": "463e9240976941caa789b4181cda4815", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7fbb34588a'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='90\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7fbb475b2c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7fbb34986c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "conn": "<starlette.requests.Request object at 0x7fbb34986c00>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "conn": "<starlette.requests.Request object at 0x7fbb34986c00>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/kpi', name='kpi', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function kpi at 0x7fbb373d36a0>, 'path_params': {}, 'route': APIRo\"+52"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/kpi', name='kpi', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb34589da0>", "request": "<starlette.requests.Request object at 0x7fbb34985700>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb34589da0>", "conn": "<starlette.requests.Request object at 0x7fbb34985700>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb34589da0>", "conn": "<starlette.requests.Request object at 0x7fbb34985700>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7fbb34985700>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7fbb34985700>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7fbb34791760>", "request": "<starlette.requests.Request object at 0x7fbb34985700>", "sentry_scope": "<Scope id=0x7fbb2cb4db60 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7fbb34b'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7fbb34855d00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7fbb34985700>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7fbb34b16420>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7fbb34b161b0>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2077", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7fbb3480f650>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7fbb34985700>", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2077", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7fbb34b14e60>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7fbb3480f650>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7fbb34b161b0>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+461", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+461", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "use_path": "/stats/kpi", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7fbb\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "request": "<starlette.requests.Request object at 0x7fbb34985700>", "response": "<starlette.responses.Response object at 0x7fbb34b14e60>", "route_index": "11", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7fbb347a9940>", "callback": "<function http_default_callback at 0x7fbb37e79760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:11:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "key": "fastapi-limiter:testclient:11:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:11:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7fbb348538c0>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7fbb37dc6840>", "set_db_data_fn": "<function _set_db_data at 0x7fbb34aae480>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7fbb346e6d40>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7fbb34680900>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7fbb34682c00>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=18> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb3459cec0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb3459cec0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb3459cec0>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "func_name": "readuntil"}}]}]}
2025-08-19T13:36:40.2370743Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7fbb344425a0>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T13:36:40.2373134Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7fbb34462420>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T13:36:40.2375920Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7fbb2cbd7230>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T13:36:40.2377205Z _________________________ test_roi_by_vendor_contract __________________________
2025-08-19T13:36:40.2377446Z 
2025-08-19T13:36:40.2377567Z     def test_roi_by_vendor_contract():
2025-08-19T13:36:40.2377851Z         client, up = client_with_auth()
2025-08-19T13:36:40.2378254Z >       r = client.get("/stats/roi_by_vendor", headers=_auth_headers(*up))
2025-08-19T13:36:40.2378635Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2378818Z 
2025-08-19T13:36:40.2379105Z services/api/tests/test_stats_contracts.py:29: 
2025-08-19T13:36:40.2379493Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T13:36:40.2380097Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T13:36:40.2380559Z     return super().get(
2025-08-19T13:36:40.2381052Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T13:36:40.2381491Z     return self.request(
2025-08-19T13:36:40.2382042Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T13:36:40.2382514Z     return super().request(
2025-08-19T13:36:40.2383018Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T13:36:40.2383600Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T13:36:40.2383993Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2384555Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T13:36:40.2385071Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T13:36:40.2385376Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2385968Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T13:36:40.2386483Z     rv = real_send(self, request, **kwargs)
2025-08-19T13:36:40.2386756Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2387271Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T13:36:40.2387737Z     response = self._send_handling_auth(
2025-08-19T13:36:40.2388336Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T13:36:40.2388856Z     response = self._send_handling_redirects(
2025-08-19T13:36:40.2389640Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T13:36:40.2390199Z     response = self._send_single_request(request)
2025-08-19T13:36:40.2390496Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2391081Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T13:36:40.2391622Z     response = transport.handle_request(request)
2025-08-19T13:36:40.2391921Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2392519Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T13:36:40.2393001Z     raise exc
2025-08-19T13:36:40.2393701Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T13:36:40.2394234Z     portal.call(self.app, scope, receive, send)
2025-08-19T13:36:40.2394795Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T13:36:40.2395532Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T13:36:40.2395902Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2396428Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T13:36:40.2396879Z     return self.__get_result()
2025-08-19T13:36:40.2397119Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2397634Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T13:36:40.2398087Z     raise self._exception
2025-08-19T13:36:40.2398638Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T13:36:40.2399258Z     retval = await retval_or_awaitable
2025-08-19T13:36:40.2399527Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2400089Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T13:36:40.2400614Z     await super().__call__(scope, receive, send)
2025-08-19T13:36:40.2401340Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T13:36:40.2401966Z     return await middleware(scope, receive, send)
2025-08-19T13:36:40.2402264Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2402879Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T13:36:40.2403491Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T13:36:40.2403855Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2404470Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T13:36:40.2404966Z     raise exc from None
2025-08-19T13:36:40.2405534Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T13:36:40.2406023Z     return await self.app(
2025-08-19T13:36:40.2406582Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T13:36:40.2407119Z     await self.middleware_stack(scope, receive, send)
2025-08-19T13:36:40.2407847Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.2408512Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.2408879Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2409677Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T13:36:40.2410171Z     raise exc
2025-08-19T13:36:40.2410715Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T13:36:40.2411250Z     await self.app(scope, receive, _send)
2025-08-19T13:36:40.2411934Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.2412592Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.2412951Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2413549Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T13:36:40.2414069Z     await self.app(scope, receive, send)
2025-08-19T13:36:40.2414932Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.2415581Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.2415936Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2416701Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T13:36:40.2417281Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T13:36:40.2418075Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T13:36:40.2418734Z     await old_call(self, scope, receive, send)
2025-08-19T13:36:40.2419539Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T13:36:40.2420199Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T13:36:40.2420559Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2421183Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T13:36:40.2421831Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T13:36:40.2422548Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T13:36:40.2423039Z     raise exc
2025-08-19T13:36:40.2423588Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T13:36:40.2424115Z     await app(scope, receive, sender)
2025-08-19T13:36:40.2424674Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T13:36:40.2425198Z     await self.middleware_stack(scope, receive, send)
2025-08-19T13:36:40.2425775Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T13:36:40.2426262Z     await route.handle(scope, receive, send)
2025-08-19T13:36:40.2426824Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T13:36:40.2427315Z     await self.app(scope, receive, send)
2025-08-19T13:36:40.2427854Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T13:36:40.2428428Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T13:36:40.2429291Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T13:36:40.2429789Z     raise exc
2025-08-19T13:36:40.2430339Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T13:36:40.2430873Z     await app(scope, receive, sender)
2025-08-19T13:36:40.2431401Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T13:36:40.2431865Z     response = await f(request)
2025-08-19T13:36:40.2432112Z                ^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2432724Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T13:36:40.2433283Z     return await old_app(*args, **kwargs)
2025-08-19T13:36:40.2433553Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2434083Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T13:36:40.2434567Z     solved_result = await solve_dependencies(
2025-08-19T13:36:40.2435231Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T13:36:40.2435812Z     solved = await call(**solved_result.values)
2025-08-19T13:36:40.2436269Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2436848Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T13:36:40.2437352Z     pexpire = await self._check(key)
2025-08-19T13:36:40.2437729Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2438284Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T13:36:40.2438780Z     pexpire = await redis.evalsha(
2025-08-19T13:36:40.2439654Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T13:36:40.2440352Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T13:36:40.2440711Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2441331Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T13:36:40.2441880Z     return await conn.retry.call_with_retry(
2025-08-19T13:36:40.2442490Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T13:36:40.2442976Z     return await do()
2025-08-19T13:36:40.2443168Z            ^^^^^^^^^^
2025-08-19T13:36:40.2443788Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T13:36:40.2444443Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T13:36:40.2444804Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2445418Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T13:36:40.2445959Z     response = await connection.read_response()
2025-08-19T13:36:40.2446266Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2446880Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T13:36:40.2447410Z     await self.disconnect(nowait=True)
2025-08-19T13:36:40.2448011Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T13:36:40.2448568Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T13:36:40.2448844Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2449399Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T13:36:40.2449824Z     return self._transport.close()
2025-08-19T13:36:40.2450077Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T13:36:40.2450567Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T13:36:40.2450988Z     super().close()
2025-08-19T13:36:40.2451450Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T13:36:40.2451955Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T13:36:40.2452509Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T13:36:40.2452923Z     self._check_closed()
2025-08-19T13:36:40.2453249Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T13:36:40.2453455Z 
2025-08-19T13:36:40.2453695Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T13:36:40.2453959Z 
2025-08-19T13:36:40.2454045Z     def _check_closed(self):
2025-08-19T13:36:40.2454267Z         if self._closed:
2025-08-19T13:36:40.2454555Z >           raise RuntimeError('Event loop is closed')
2025-08-19T13:36:40.2454891Z E           RuntimeError: Event loop is closed
2025-08-19T13:36:40.2455070Z 
2025-08-19T13:36:40.2455425Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T13:36:40.2456146Z ------------------------------ Captured log call -------------------------------
2025-08-19T13:36:40.8920154Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "0a96bc112839460ca108e0ef4d39d659", "level": "error", "timestamp": "2025-08-19T13:36:38.396255Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb348529c0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb2cb76ca0>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7fbb2cb889e0>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7fbb34852ab0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb2cb76ca0>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='20d3b1b\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7fbb37c12980>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7fbb34852ab0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7fbb37c122a0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "0a96bc112839460ca108e0ef4d39d659", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7fbb34588a'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7fbb3482ad20'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='20\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7fbb475b2c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7fbb34873aa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7fbb2cbd4fe0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "conn": "<starlette.requests.Request object at 0x7fbb2cbd4fe0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "conn": "<starlette.requests.Request object at 0x7fbb2cbd4fe0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7fbb3489dfa0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi_by_vendor at 0x7fbb373d3b00>, 'path_params': {}, 'rou\"+82"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb2cb759e0>", "request": "<starlette.requests.Request object at 0x7fbb2cbd7b30>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb2cb759e0>", "conn": "<starlette.requests.Request object at 0x7fbb2cbd7b30>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7fbb2cb759e0>", "conn": "<starlette.requests.Request object at 0x7fbb2cbd7b30>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7fbb2cbd7b30>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7fbb2cbd7b30>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7fbb34791760>", "request": "<starlette.requests.Request object at 0x7fbb2cbd7b30>", "sentry_scope": "<Scope id=0x7fbb2cb6dfc0 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7fbb2cb'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7fbb34856020>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7fbb2cbd7b30>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7fbb2cbd5430>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7fbb2cbd62d0>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2137", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7fbb3480f650>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7fbb2cbd7b30>", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2137", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7fbb2cbd7050>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7fbb3480f650>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7fbb2cbd62d0>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "use_path": "/stats/roi_by_vendor", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7fbb\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "request": "<starlette.requests.Request object at 0x7fbb2cbd7b30>", "response": "<starlette.responses.Response object at 0x7fbb2cbd7050>", "route_index": "12", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7fbb347a9940>", "callback": "<function http_default_callback at 0x7fbb37e79760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:12:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7fbb34861b50>", "key": "fastapi-limiter:testclient:12:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:12:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7fbb348538c0>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7fbb37dc6840>", "set_db_data_fn": "<function _set_db_data at 0x7fbb34aae480>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7fbb2ce7cd40>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7fbb2cb758a0>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7fbb2cb75c60>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=19> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=19>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=19>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb18ac65f0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb18ac65f0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7fbb18ac65f0>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "func_name": "readuntil"}}]}]}
2025-08-19T13:36:40.8995329Z =============================== warnings summary ===============================
2025-08-19T13:36:40.8995727Z services/alert_bot/tests/test_smoke.py:5
2025-08-19T13:36:40.8997016Z   /home/runner/work/AWA-App/AWA-App/services/alert_bot/tests/test_smoke.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-08-19T13:36:40.8998175Z     import pkg_resources  # noqa: F401
2025-08-19T13:36:40.8998367Z 
2025-08-19T13:36:40.8998539Z tests/api/test_ingest_endpoints.py: 3 warnings
2025-08-19T13:36:40.8998864Z tests/test_api_fast.py: 1 warning
2025-08-19T13:36:40.8999292Z tests/test_health.py: 5 warnings
2025-08-19T13:36:40.8999561Z tests/test_smoke.py: 5 warnings
2025-08-19T13:36:40.8999852Z services/api/tests/test_cors.py: 3 warnings
2025-08-19T13:36:40.9000201Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T13:36:40.9000553Z services/api/tests/test_health.py: 1 warning
2025-08-19T13:36:40.9000890Z services/api/tests/test_rate_limit.py: 2 warnings
2025-08-19T13:36:40.9001249Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T13:36:40.9002175Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/__init__.py:89: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.1.
2025-08-19T13:36:40.9003247Z     await cls.redis.close()
2025-08-19T13:36:40.9003398Z 
2025-08-19T13:36:40.9003595Z tests/test_api_fast.py::test_health_endpoint
2025-08-19T13:36:40.9004828Z   /home/runner/work/AWA-App/AWA-App/tests/test_api_fast.py:13: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T13:36:40.9005799Z     return datetime.datetime.utcnow()
2025-08-19T13:36:40.9005981Z 
2025-08-19T13:36:40.9006104Z tests/test_api_fast.py: 1 warning
2025-08-19T13:36:40.9006382Z tests/test_health.py: 5 warnings
2025-08-19T13:36:40.9006647Z tests/test_smoke.py: 5 warnings
2025-08-19T13:36:40.9006932Z services/api/tests/test_cors.py: 1 warning
2025-08-19T13:36:40.9007251Z services/api/tests/test_health.py: 1 warning
2025-08-19T13:36:40.9007604Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T13:36:40.9008775Z   /home/runner/work/AWA-App/AWA-App/services/api/routes/health.py:24: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T13:36:40.9009944Z     app_now = datetime.utcnow().replace(tzinfo=timezone.utc)
2025-08-19T13:36:40.9010165Z 
2025-08-19T13:36:40.9010305Z tests/test_health.py::test_health[0]
2025-08-19T13:36:40.9010596Z tests/test_health.py::test_health[1]
2025-08-19T13:36:40.9010878Z tests/test_health.py::test_health[2]
2025-08-19T13:36:40.9011308Z Sentry is attempting to send 0 pending events
2025-08-19T13:36:40.9011610Z Waiting up to True seconds
2025-08-19T13:36:40.9011850Z Press Ctrl-C to quit
2025-08-19T13:36:40.9012107Z tests/test_health.py::test_health[3]
2025-08-19T13:36:40.9012395Z tests/test_health.py::test_health[4]
2025-08-19T13:36:40.9013471Z   /home/runner/work/AWA-App/AWA-App/tests/test_health.py:22: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T13:36:40.9014455Z     return datetime.datetime.utcnow()
2025-08-19T13:36:40.9014632Z 
2025-08-19T13:36:40.9014764Z tests/test_smoke.py::test_health[0]
2025-08-19T13:36:40.9015048Z tests/test_smoke.py::test_health[1]
2025-08-19T13:36:40.9015324Z tests/test_smoke.py::test_health[2]
2025-08-19T13:36:40.9015597Z tests/test_smoke.py::test_health[3]
2025-08-19T13:36:40.9015871Z tests/test_smoke.py::test_health[4]
2025-08-19T13:36:40.9016907Z   /home/runner/work/AWA-App/AWA-App/tests/test_smoke.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T13:36:40.9017872Z     return datetime.datetime.utcnow()
2025-08-19T13:36:40.9018049Z 
2025-08-19T13:36:40.9018269Z services/api/tests/test_cors.py::test_cors_simple_get_allowed
2025-08-19T13:36:40.9019695Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_cors.py:27: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T13:36:40.9020751Z     return datetime.datetime.utcnow()
2025-08-19T13:36:40.9020930Z 
2025-08-19T13:36:40.9021124Z services/api/tests/test_health.py::test_health_route
2025-08-19T13:36:40.9022294Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_health.py:14: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T13:36:40.9023313Z     return datetime.datetime.utcnow()
2025-08-19T13:36:40.9023741Z 
2025-08-19T13:36:40.9023922Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T13:36:40.9025085Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_rate_limit.py:33: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T13:36:40.9026231Z     return datetime.datetime.utcnow()
2025-08-19T13:36:40.9026404Z 
2025-08-19T13:36:40.9026729Z services/api/tests/test_sentry_event.py::test_unhandled_exception_is_captured_and_tagged
2025-08-19T13:36:40.9028215Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_sentry_event.py:47: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
2025-08-19T13:36:40.9039774Z     hub = sentry_sdk.Hub.current
2025-08-19T13:36:40.9039985Z 
2025-08-19T13:36:40.9040273Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-08-19T13:36:40.9040775Z ================================ tests coverage ================================
2025-08-19T13:36:40.9041264Z _______________ coverage: platform linux, python 3.12.11-final-0 _______________
2025-08-19T13:36:40.9041522Z 
2025-08-19T13:36:40.9041688Z Coverage XML written to file coverage.xml
2025-08-19T13:36:40.9042097Z Required test coverage of 65% reached. Total coverage: 65.21%
2025-08-19T13:36:40.9042538Z =========================== short test summary info ============================
2025-08-19T13:36:40.9043187Z FAILED services/api/tests/test_roi_basic_auth.py::test_roi_basic_auth_good - RuntimeError: Event loop is closed
2025-08-19T13:36:40.9044049Z FAILED services/api/tests/test_roi_basic_auth.py::test_stats_contract_needs_basic_auth - RuntimeError: Event loop is closed
2025-08-19T13:36:40.9044928Z FAILED services/api/tests/test_stats_contracts.py::test_roi_by_vendor_contract - RuntimeError: Event loop is closed
2025-08-19T13:36:41.5725276Z ##[error]Process completed with exit code 1.
