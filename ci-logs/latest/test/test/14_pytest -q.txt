2025-08-19T12:42:27.6398560Z ##[group]Run pytest -q --cov=services
2025-08-19T12:42:27.6399034Z [36;1mpytest -q --cov=services[0m
2025-08-19T12:42:27.6441558Z shell: /usr/bin/bash -e {0}
2025-08-19T12:42:27.6441882Z env:
2025-08-19T12:42:27.6442168Z   REDIS_URL: redis://localhost:6379/0
2025-08-19T12:42:27.6442542Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-19T12:42:27.6442864Z   TRUST_X_FORWARDED: 1
2025-08-19T12:42:27.6443144Z   PG_USER: postgres
2025-08-19T12:42:27.6443424Z   PG_PASSWORD: pass
2025-08-19T12:42:27.6443694Z   PG_DATABASE: awa
2025-08-19T12:42:27.6443960Z   PG_HOST: localhost
2025-08-19T12:42:27.6444226Z   PG_PORT: 5432
2025-08-19T12:42:27.6444774Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-19T12:42:27.6445343Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-19T12:42:27.6446083Z   DATABASE_URL: ***localhost:5432/awa
2025-08-19T12:42:27.6446470Z   DATA_DIR: /home/runner/work/_temp/awa-data
2025-08-19T12:42:27.6446835Z   ENABLE_LIVE: 0
2025-08-19T12:42:27.6447085Z   TESTING: 1
2025-08-19T12:42:27.6447434Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:42:27.6448065Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-19T12:42:27.6448636Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:42:27.6449152Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:42:27.6449671Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:42:27.6450189Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-19T12:42:27.6450635Z   POSTGRES_USER: postgres
2025-08-19T12:42:27.6450961Z   POSTGRES_PASSWORD: pass
2025-08-19T12:42:27.6451252Z   POSTGRES_DB: awa
2025-08-19T12:42:27.6451516Z   LLM_PROVIDER: lan
2025-08-19T12:42:27.6451793Z   LLM_BASE_URL: http://localhost:8000
2025-08-19T12:42:27.6452114Z ##[endgroup]
2025-08-19T12:42:59.4422566Z ........s.............................sssssss........................... [ 43%]
2025-08-19T12:43:34.4741925Z ...................................................F.F...F.............. [ 86%]
2025-08-19T12:43:35.3571861Z ......................                                                   [100%]
2025-08-19T12:43:35.3573410Z =================================== FAILURES ===================================
2025-08-19T12:43:35.3574678Z ___________________________ test_roi_basic_auth_good ___________________________
2025-08-19T12:43:35.3575401Z 
2025-08-19T12:43:35.3576598Z monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7f0442112090>
2025-08-19T12:43:35.3577492Z 
2025-08-19T12:43:35.3577905Z     def test_roi_basic_auth_good(monkeypatch):
2025-08-19T12:43:35.3578846Z         os.environ["API_BASIC_USER"] = "u"
2025-08-19T12:43:35.3579550Z         os.environ["API_BASIC_PASS"] = "p"
2025-08-19T12:43:35.3580083Z         client = _client()
2025-08-19T12:43:35.3580707Z >       r = client.get("/roi", headers=_auth_headers("u", "p"))
2025-08-19T12:43:35.3581335Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3581664Z 
2025-08-19T12:43:35.3581980Z services/api/tests/test_roi_basic_auth.py:32: 
2025-08-19T12:43:35.3582721Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:43:35.3583879Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:43:35.3584764Z     return super().get(
2025-08-19T12:43:35.3585703Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:43:35.3587000Z     return self.request(
2025-08-19T12:43:35.3587988Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:43:35.3588648Z     return super().request(
2025-08-19T12:43:35.3589360Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:43:35.3590158Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:43:35.3590691Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3608199Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:43:35.3609378Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:43:35.3609986Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3611157Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:43:35.3612250Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:43:35.3612727Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3613653Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:43:35.3614572Z     response = self._send_handling_auth(
2025-08-19T12:43:35.3615485Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:43:35.3616496Z     response = self._send_handling_redirects(
2025-08-19T12:43:35.3617358Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:43:35.3618042Z     response = self._send_single_request(request)
2025-08-19T12:43:35.3618411Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3619170Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:43:35.3619824Z     response = transport.handle_request(request)
2025-08-19T12:43:35.3620175Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3620880Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:43:35.3621447Z     raise exc
2025-08-19T12:43:35.3622083Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:43:35.3622723Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:43:35.3623408Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:43:35.3624298Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:43:35.3624725Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3625349Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:43:35.3626086Z     return self.__get_result()
2025-08-19T12:43:35.3626366Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3626958Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:43:35.3627455Z     raise self._exception
2025-08-19T12:43:35.3628049Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:43:35.3628593Z     retval = await retval_or_awaitable
2025-08-19T12:43:35.3628884Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3629513Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:43:35.3630102Z     await super().__call__(scope, receive, send)
2025-08-19T12:43:35.3630909Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:43:35.3631601Z     return await middleware(scope, receive, send)
2025-08-19T12:43:35.3631932Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3632610Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:43:35.3633287Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:43:35.3633688Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3634369Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:43:35.3635126Z     raise exc from None
2025-08-19T12:43:35.3636075Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:43:35.3636687Z     return await self.app(
2025-08-19T12:43:35.3637286Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:43:35.3637959Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:43:35.3638762Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.3639471Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.3639864Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3640520Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:43:35.3641036Z     raise exc
2025-08-19T12:43:35.3641619Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:43:35.3642177Z     await self.app(scope, receive, _send)
2025-08-19T12:43:35.3642891Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.3643580Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.3643962Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3644598Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:43:35.3645148Z     await self.app(scope, receive, send)
2025-08-19T12:43:35.3646046Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.3646738Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.3647308Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3647973Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:43:35.3648596Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:43:35.3649434Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:43:35.3650123Z     await old_call(self, scope, receive, send)
2025-08-19T12:43:35.3650853Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.3651544Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.3651933Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3652611Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:43:35.3653302Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:43:35.3654058Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:43:35.3654576Z     raise exc
2025-08-19T12:43:35.3655154Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:43:35.3655713Z     await app(scope, receive, sender)
2025-08-19T12:43:35.3656608Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:43:35.3657173Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:43:35.3657785Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:43:35.3658448Z     await route.handle(scope, receive, send)
2025-08-19T12:43:35.3659039Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:43:35.3659539Z     await self.app(scope, receive, send)
2025-08-19T12:43:35.3660102Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:43:35.3660695Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:43:35.3661436Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:43:35.3661955Z     raise exc
2025-08-19T12:43:35.3662526Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:43:35.3663080Z     await app(scope, receive, sender)
2025-08-19T12:43:35.3663643Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:43:35.3664134Z     response = await f(request)
2025-08-19T12:43:35.3664387Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3665023Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:43:35.3665600Z     return await old_app(*args, **kwargs)
2025-08-19T12:43:35.3666150Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3666704Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:43:35.3667209Z     solved_result = await solve_dependencies(
2025-08-19T12:43:35.3667908Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:43:35.3668530Z     solved = await call(**solved_result.values)
2025-08-19T12:43:35.3668840Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3669445Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:43:35.3670131Z     pexpire = await self._check(key)
2025-08-19T12:43:35.3670406Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3670982Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:43:35.3671499Z     pexpire = await redis.evalsha(
2025-08-19T12:43:35.3672259Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:43:35.3672989Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:43:35.3673361Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3673999Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:43:35.3674562Z     return await conn.retry.call_with_retry(
2025-08-19T12:43:35.3675196Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:43:35.3675713Z     return await do()
2025-08-19T12:43:35.3676115Z            ^^^^^^^^^^
2025-08-19T12:43:35.3676759Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:43:35.3677442Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:43:35.3677822Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3678453Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:43:35.3679016Z     response = await connection.read_response()
2025-08-19T12:43:35.3679323Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3679961Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:43:35.3680742Z     await self.disconnect(nowait=True)
2025-08-19T12:43:35.3681378Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:43:35.3681949Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:43:35.3682234Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3682687Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:43:35.3683122Z     return self._transport.close()
2025-08-19T12:43:35.3683398Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3683910Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:43:35.3684343Z     super().close()
2025-08-19T12:43:35.3684822Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:43:35.3685336Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:43:35.3686104Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:43:35.3686549Z     self._check_closed()
2025-08-19T12:43:35.3686885Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:43:35.3687104Z 
2025-08-19T12:43:35.3687360Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:43:35.3687633Z 
2025-08-19T12:43:35.3687723Z     def _check_closed(self):
2025-08-19T12:43:35.3687958Z         if self._closed:
2025-08-19T12:43:35.3688259Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:43:35.3688612Z E           RuntimeError: Event loop is closed
2025-08-19T12:43:35.3688799Z 
2025-08-19T12:43:35.3689165Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:43:35.3689756Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:43:35.3792820Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "1cabb4862ce441018e7bdf7401875d16", "level": "error", "timestamp": "2025-08-19T12:43:30.831607Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f044226ff20>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f04420d1120>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f0440d83950>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f0454d27740>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f04420d1120>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='091089c\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f04456568e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f0454d27740>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f0445656200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "1cabb4862ce441018e7bdf7401875d16", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f044245c9'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='09\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f0454fc6c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f0440d83740>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "conn": "<starlette.requests.Request object at 0x7f0440d83740>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "conn": "<starlette.requests.Request object at 0x7f0440d83740>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/roi', name='roi', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi at 0x7f0444c168e0>, 'path_params': {}, 'route': APIRo\"+46"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/roi', name='roi', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f04420d3ce0>", "request": "<starlette.requests.Request object at 0x7f0440d838f0>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f04420d3ce0>", "conn": "<starlette.requests.Request object at 0x7f0440d838f0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f04420d3ce0>", "conn": "<starlette.requests.Request object at 0x7f0440d838f0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f0440d838f0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f0440d838f0>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f044224ff50>", "request": "<starlette.requests.Request object at 0x7f0440d838f0>", "sentry_scope": "<Scope id=0x7f04420e91c0 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f0440d'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f04420ad260>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f0440d838f0>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f0440d83b00>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f0440d83b90>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "\"Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='ro\"+2748", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f0454d27470>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "True", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f0440d838f0>", "dependant": "\"Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='ro\"+2748", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f0440d83bf0>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f0454d27470>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f0440d83b90>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+455", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+455", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "use_path": "/roi", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f04\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "request": "<starlette.requests.Request object at 0x7f0440d838f0>", "response": "<starlette.responses.Response object at 0x7f0440d83bf0>", "route_index": "8", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f04421eca40>", "callback": "<function http_default_callback at 0x7f04458bd760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:8:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "key": "fastapi-limiter:testclient:8:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:8:0'\"+17", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f044226e0c0>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f044560a840>", "set_db_data_fn": "<function _set_db_data at 0x7f04424ee3e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+28", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f0442108b80>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f04420d31a0>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f04420d1580>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+28", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=17> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=17>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=17>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f0442440de0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f0442440de0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f0442440de0>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:43:35.3873611Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f0440cae8a0>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:43:35.3876270Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f0440cc8a40>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:43:35.3878922Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f0440caf980>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:43:35.3880314Z _____________________ test_stats_contract_needs_basic_auth _____________________
2025-08-19T12:43:35.3880581Z 
2025-08-19T12:43:35.3880729Z     def test_stats_contract_needs_basic_auth():
2025-08-19T12:43:35.3881057Z         os.environ["API_BASIC_USER"] = "u"
2025-08-19T12:43:35.3881354Z         os.environ["API_BASIC_PASS"] = "p"
2025-08-19T12:43:35.3881618Z         client = _client()
2025-08-19T12:43:35.3881891Z >       r = client.get("/stats/kpi")
2025-08-19T12:43:35.3882168Z             ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3882572Z 
2025-08-19T12:43:35.3882745Z services/api/tests/test_roi_basic_auth.py:48: 
2025-08-19T12:43:35.3883143Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:43:35.3883773Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:43:35.3884267Z     return super().get(
2025-08-19T12:43:35.3884784Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:43:35.3885252Z     return self.request(
2025-08-19T12:43:35.3885939Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:43:35.3886438Z     return super().request(
2025-08-19T12:43:35.3886975Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:43:35.3887634Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:43:35.3888161Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3888767Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:43:35.3889310Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:43:35.3889631Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3890250Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:43:35.3890800Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:43:35.3891080Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3891622Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:43:35.3892121Z     response = self._send_handling_auth(
2025-08-19T12:43:35.3892747Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:43:35.3893483Z     response = self._send_handling_redirects(
2025-08-19T12:43:35.3894141Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:43:35.3894721Z     response = self._send_single_request(request)
2025-08-19T12:43:35.3895036Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3895696Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:43:35.3896455Z     response = transport.handle_request(request)
2025-08-19T12:43:35.3896768Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3897394Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:43:35.3897905Z     raise exc
2025-08-19T12:43:35.3898470Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:43:35.3899051Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:43:35.3899641Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:43:35.3900227Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:43:35.3900616Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3901170Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:43:35.3901651Z     return self.__get_result()
2025-08-19T12:43:35.3901907Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3902447Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:43:35.3902924Z     raise self._exception
2025-08-19T12:43:35.3903489Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:43:35.3904017Z     retval = await retval_or_awaitable
2025-08-19T12:43:35.3904445Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3905039Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:43:35.3905588Z     await super().__call__(scope, receive, send)
2025-08-19T12:43:35.3906488Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:43:35.3907153Z     return await middleware(scope, receive, send)
2025-08-19T12:43:35.3907464Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3908107Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:43:35.3908752Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:43:35.3909125Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3909777Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:43:35.3910308Z     raise exc from None
2025-08-19T12:43:35.3910900Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:43:35.3911426Z     return await self.app(
2025-08-19T12:43:35.3912011Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:43:35.3912579Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:43:35.3913332Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.3914034Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.3914418Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3915065Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:43:35.3915840Z     raise exc
2025-08-19T12:43:35.3916417Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:43:35.3916986Z     await self.app(scope, receive, _send)
2025-08-19T12:43:35.3917716Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.3918426Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.3918802Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3919485Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:43:35.3920041Z     await self.app(scope, receive, send)
2025-08-19T12:43:35.3920765Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.3921477Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.3921865Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3922525Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:43:35.3923151Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:43:35.3924007Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:43:35.3924709Z     await old_call(self, scope, receive, send)
2025-08-19T12:43:35.3925442Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.3926229Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.3926615Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3927429Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:43:35.3928124Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:43:35.3928895Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:43:35.3929424Z     raise exc
2025-08-19T12:43:35.3930011Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:43:35.3930576Z     await app(scope, receive, sender)
2025-08-19T12:43:35.3931170Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:43:35.3931734Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:43:35.3932349Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:43:35.3932882Z     await route.handle(scope, receive, send)
2025-08-19T12:43:35.3933489Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:43:35.3934007Z     await self.app(scope, receive, send)
2025-08-19T12:43:35.3934592Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:43:35.3935206Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:43:35.3936108Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:43:35.3936640Z     raise exc
2025-08-19T12:43:35.3937236Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:43:35.3937802Z     await app(scope, receive, sender)
2025-08-19T12:43:35.3938676Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:43:35.3939186Z     response = await f(request)
2025-08-19T12:43:35.3939443Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3940084Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:43:35.3940672Z     return await old_app(*args, **kwargs)
2025-08-19T12:43:35.3940955Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3941509Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:43:35.3942035Z     solved_result = await solve_dependencies(
2025-08-19T12:43:35.3942744Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:43:35.3943367Z     solved = await call(**solved_result.values)
2025-08-19T12:43:35.3943678Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3944299Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:43:35.3944835Z     pexpire = await self._check(key)
2025-08-19T12:43:35.3945104Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3945693Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:43:35.3946372Z     pexpire = await redis.evalsha(
2025-08-19T12:43:35.3947140Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:43:35.3947882Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:43:35.3948250Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3948900Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:43:35.3949475Z     return await conn.retry.call_with_retry(
2025-08-19T12:43:35.3950266Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:43:35.3950780Z     return await do()
2025-08-19T12:43:35.3950995Z            ^^^^^^^^^^
2025-08-19T12:43:35.3951642Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:43:35.3952334Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:43:35.3952714Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3953357Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:43:35.3953931Z     response = await connection.read_response()
2025-08-19T12:43:35.3954240Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3954883Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:43:35.3955457Z     await self.disconnect(nowait=True)
2025-08-19T12:43:35.3956200Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:43:35.3956789Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:43:35.3957077Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3957543Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:43:35.3957993Z     return self._transport.close()
2025-08-19T12:43:35.3958258Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.3958774Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:43:35.3959224Z     super().close()
2025-08-19T12:43:35.3959708Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:43:35.3960237Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:43:35.3960971Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:43:35.3961410Z     self._check_closed()
2025-08-19T12:43:35.3961744Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:43:35.3961956Z 
2025-08-19T12:43:35.3962215Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:43:35.3962488Z 
2025-08-19T12:43:35.3962583Z     def _check_closed(self):
2025-08-19T12:43:35.3962807Z         if self._closed:
2025-08-19T12:43:35.3963102Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:43:35.3963460Z E           RuntimeError: Event loop is closed
2025-08-19T12:43:35.3963656Z 
2025-08-19T12:43:35.3964017Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:43:35.3964613Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:43:35.4069423Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "9e75f260af9644a1831393f36bc6ea1f", "level": "error", "timestamp": "2025-08-19T12:43:32.517383Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f044226ff20>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f0440cffb00>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f0440caca40>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f0454d27740>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f0440cffb00>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='16695ae\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f04456568e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f0454d27740>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+60", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f0445656200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+119", "header_value": "None", "validation_failed": "False", "id_value": "9e75f260af9644a1831393f36bc6ea1f", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f044245c9'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='16\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f0454fc6c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f0440caccb0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "conn": "<starlette.requests.Request object at 0x7f0440caccb0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "conn": "<starlette.requests.Request object at 0x7f0440caccb0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/kpi', name='kpi', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function kpi at 0x7f0444c17600>, 'path_params': {}, 'route': APIRo\"+52"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/kpi', name='kpi', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f04420d3c40>", "request": "<starlette.requests.Request object at 0x7f0440caeb70>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f04420d3c40>", "conn": "<starlette.requests.Request object at 0x7f0440caeb70>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f04420d3c40>", "conn": "<starlette.requests.Request object at 0x7f0440caeb70>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f0440caeb70>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f0440caeb70>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f044224ff50>", "request": "<starlette.requests.Request object at 0x7f0440caeb70>", "sentry_scope": "<Scope id=0x7f0440605c40 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f0440c'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f04420adda0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f0440caeb70>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f0440cad9a0>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f0440cad970>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2077", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f0454d27470>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f0440caeb70>", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2077", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f0440cad940>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f0454d27470>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f0440cad970>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+461", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+461", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "use_path": "/stats/kpi", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f04\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "request": "<starlette.requests.Request object at 0x7f0440caeb70>", "response": "<starlette.responses.Response object at 0x7f0440cad940>", "route_index": "11", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f04421eca40>", "callback": "<function http_default_callback at 0x7f04458bd760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:11:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "key": "fastapi-limiter:testclient:11:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:11:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f044226e0c0>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f044560a840>", "set_db_data_fn": "<function _set_db_data at 0x7f04424ee3e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f0442108b80>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f04420d0400>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f04420d1da0>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=18> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f0442440de0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f0442440de0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f0442440de0>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:43:35.4150456Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f0442125a90>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:43:35.4151863Z _________________________ test_roi_by_vendor_contract __________________________
2025-08-19T12:43:35.4152428Z 
2025-08-19T12:43:35.4152559Z     def test_roi_by_vendor_contract():
2025-08-19T12:43:35.4152861Z         client, up = client_with_auth()
2025-08-19T12:43:35.4153286Z >       r = client.get("/stats/roi_by_vendor", headers=_auth_headers(*up))
2025-08-19T12:43:35.4153678Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4153867Z 
2025-08-19T12:43:35.4154051Z services/api/tests/test_stats_contracts.py:29: 
2025-08-19T12:43:35.4154453Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:43:35.4155073Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:43:35.4155566Z     return super().get(
2025-08-19T12:43:35.4156210Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:43:35.4156684Z     return self.request(
2025-08-19T12:43:35.4157254Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:43:35.4157775Z     return super().request(
2025-08-19T12:43:35.4158318Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:43:35.4158929Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:43:35.4159345Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4159940Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:43:35.4160483Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:43:35.4160809Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4161440Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:43:35.4161997Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:43:35.4162290Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4163002Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:43:35.4163502Z     response = self._send_handling_auth(
2025-08-19T12:43:35.4164138Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:43:35.4164701Z     response = self._send_handling_redirects(
2025-08-19T12:43:35.4165361Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:43:35.4166054Z     response = self._send_single_request(request)
2025-08-19T12:43:35.4166373Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4167003Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:43:35.4167585Z     response = transport.handle_request(request)
2025-08-19T12:43:35.4167913Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4168549Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:43:35.4169074Z     raise exc
2025-08-19T12:43:35.4169644Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:43:35.4170217Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:43:35.4170809Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:43:35.4171402Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:43:35.4171785Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4172344Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:43:35.4172818Z     return self.__get_result()
2025-08-19T12:43:35.4173068Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4173766Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:43:35.4174251Z     raise self._exception
2025-08-19T12:43:35.4174818Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:43:35.4175343Z     retval = await retval_or_awaitable
2025-08-19T12:43:35.4175623Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4176359Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:43:35.4176906Z     await super().__call__(scope, receive, send)
2025-08-19T12:43:35.4177665Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:43:35.4178335Z     return await middleware(scope, receive, send)
2025-08-19T12:43:35.4178650Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4179292Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:43:35.4179947Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:43:35.4180327Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4180976Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:43:35.4181502Z     raise exc from None
2025-08-19T12:43:35.4182096Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:43:35.4182621Z     return await self.app(
2025-08-19T12:43:35.4183202Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:43:35.4183774Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:43:35.4184518Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.4185440Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.4185971Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4186627Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:43:35.4187143Z     raise exc
2025-08-19T12:43:35.4187714Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:43:35.4188274Z     await self.app(scope, receive, _send)
2025-08-19T12:43:35.4188996Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.4189685Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.4190064Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4190706Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:43:35.4191257Z     await self.app(scope, receive, send)
2025-08-19T12:43:35.4192135Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.4192846Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.4193228Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4193879Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:43:35.4194496Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:43:35.4195342Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:43:35.4196328Z     await old_call(self, scope, receive, send)
2025-08-19T12:43:35.4197053Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:43:35.4197741Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:43:35.4198123Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4198786Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:43:35.4199470Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:43:35.4200228Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:43:35.4200745Z     raise exc
2025-08-19T12:43:35.4201328Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:43:35.4201901Z     await app(scope, receive, sender)
2025-08-19T12:43:35.4202481Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:43:35.4203039Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:43:35.4203648Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:43:35.4204164Z     await route.handle(scope, receive, send)
2025-08-19T12:43:35.4204759Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:43:35.4205275Z     await self.app(scope, receive, send)
2025-08-19T12:43:35.4205949Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:43:35.4206550Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:43:35.4207297Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:43:35.4208020Z     raise exc
2025-08-19T12:43:35.4208598Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:43:35.4209160Z     await app(scope, receive, sender)
2025-08-19T12:43:35.4209718Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:43:35.4210208Z     response = await f(request)
2025-08-19T12:43:35.4210464Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4211098Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:43:35.4211681Z     return await old_app(*args, **kwargs)
2025-08-19T12:43:35.4211969Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4212522Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:43:35.4213038Z     solved_result = await solve_dependencies(
2025-08-19T12:43:35.4213747Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:43:35.4214368Z     solved = await call(**solved_result.values)
2025-08-19T12:43:35.4214669Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4215278Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:43:35.4215930Z     pexpire = await self._check(key)
2025-08-19T12:43:35.4216206Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4216788Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:43:35.4217319Z     pexpire = await redis.evalsha(
2025-08-19T12:43:35.4218097Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:43:35.4219080Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:43:35.4219450Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4220096Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:43:35.4220666Z     return await conn.retry.call_with_retry(
2025-08-19T12:43:35.4221304Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:43:35.4221814Z     return await do()
2025-08-19T12:43:35.4222023Z            ^^^^^^^^^^
2025-08-19T12:43:35.4222677Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:43:35.4223377Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:43:35.4223759Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4224411Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:43:35.4224991Z     response = await connection.read_response()
2025-08-19T12:43:35.4225347Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4226132Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:43:35.4226701Z     await self.disconnect(nowait=True)
2025-08-19T12:43:35.4227332Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:43:35.4227915Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:43:35.4228205Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4228662Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:43:35.4229105Z     return self._transport.close()
2025-08-19T12:43:35.4229374Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:43:35.4229902Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:43:35.4230597Z     super().close()
2025-08-19T12:43:35.4231080Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:43:35.4231612Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:43:35.4232191Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:43:35.4232633Z     self._check_closed()
2025-08-19T12:43:35.4232966Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:43:35.4233178Z 
2025-08-19T12:43:35.4233434Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:43:35.4233703Z 
2025-08-19T12:43:35.4233803Z     def _check_closed(self):
2025-08-19T12:43:35.4234040Z         if self._closed:
2025-08-19T12:43:35.4234330Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:43:35.4234689Z E           RuntimeError: Event loop is closed
2025-08-19T12:43:35.4234886Z 
2025-08-19T12:43:35.4235248Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:43:35.4235956Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:43:36.2090490Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "a111dccd7e194c908c21961b386c8b83", "level": "error", "timestamp": "2025-08-19T12:43:33.473777Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f044226ff20>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f0440d6d120>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f0440d4b650>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f0454d27740>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f0440d6d120>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='25babef\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f04456568e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f0454d27740>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f0445656200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "a111dccd7e194c908c21961b386c8b83", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f044245c9'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f0442267020'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='25\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f0454fc6c00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f04420b9280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f0440d4b830>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "conn": "<starlette.requests.Request object at 0x7f0440d4b830>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "conn": "<starlette.requests.Request object at 0x7f0440d4b830>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f0442084a10>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi_by_vendor at 0x7f0444c17a60>, 'path_params': {}, 'rou\"+82"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f0440d6cc20>", "request": "<starlette.requests.Request object at 0x7f0440d4b740>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f0440d6cc20>", "conn": "<starlette.requests.Request object at 0x7f0440d4b740>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f0440d6cc20>", "conn": "<starlette.requests.Request object at 0x7f0440d4b740>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f0440d4b740>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f0440d4b740>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f044224ff50>", "request": "<starlette.requests.Request object at 0x7f0440d4b740>", "sentry_scope": "<Scope id=0x7f0440d66a40 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f0440d'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f04420ae0c0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f0440d4b740>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f0440d4abd0>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f0440d4bb00>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2137", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f0454d27470>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f0440d4b740>", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2137", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f0440d4b4d0>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f0454d27470>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f0440d4bb00>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "use_path": "/stats/roi_by_vendor", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f04\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "request": "<starlette.requests.Request object at 0x7f0440d4b740>", "response": "<starlette.responses.Response object at 0x7f0440d4b4d0>", "route_index": "12", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f04421eca40>", "callback": "<function http_default_callback at 0x7f04458bd760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:12:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f04420872f0>", "key": "fastapi-limiter:testclient:12:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:12:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f044226e0c0>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f044560a840>", "set_db_data_fn": "<function _set_db_data at 0x7f04424ee3e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f04302a1cc0>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f0440d6f4c0>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f0440d6fba0>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=19> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=19>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=19>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f04305f3a80>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f04305f3a80>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f04305f3a80>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:43:36.2219867Z =============================== warnings summary ===============================
2025-08-19T12:43:36.2220717Z services/alert_bot/tests/test_smoke.py:5
2025-08-19T12:43:36.2222379Z   /home/runner/work/AWA-App/AWA-App/services/alert_bot/tests/test_smoke.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-08-19T12:43:36.2223717Z     import pkg_resources  # noqa: F401
2025-08-19T12:43:36.2223909Z 
2025-08-19T12:43:36.2224092Z tests/api/test_ingest_endpoints.py: 12 warnings
2025-08-19T12:43:36.2224467Z tests/ingest/test_tasks_eager.py: 3 warnings
2025-08-19T12:43:36.2224802Z tests/test_api_fast.py: 1 warning
2025-08-19T12:43:36.2225104Z tests/test_health.py: 5 warnings
2025-08-19T12:43:36.2225397Z tests/test_smoke.py: 5 warnings
2025-08-19T12:43:36.2225703Z services/api/tests/test_cors.py: 1 warning
2025-08-19T12:43:36.2226196Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T12:43:36.2226606Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:43:36.2226981Z services/api/tests/test_rate_limit.py: 122 warnings
2025-08-19T12:43:36.2227392Z services/api/tests/test_roi_basic_auth.py: 4 warnings
2025-08-19T12:43:36.2227796Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T12:43:36.2228206Z services/api/tests/test_stats_contracts.py: 3 warnings
2025-08-19T12:43:36.2229885Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/extensions/sentry.py:27: DeprecationWarning: sentry_sdk.configure_scope is deprecated and will be removed in the next major version. Please consult our migration guide to learn how to migrate to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x#scope-configuring
2025-08-19T12:43:36.2231334Z     with configure_scope() as scope:
2025-08-19T12:43:36.2231520Z 
2025-08-19T12:43:36.2231690Z tests/api/test_ingest_endpoints.py: 3 warnings
2025-08-19T12:43:36.2232196Z tests/test_api_fast.py: 1 warning
2025-08-19T12:43:36.2232507Z tests/test_health.py: 5 warnings
2025-08-19T12:43:36.2232797Z tests/test_smoke.py: 5 warnings
2025-08-19T12:43:36.2233110Z services/api/tests/test_cors.py: 3 warnings
2025-08-19T12:43:36.2233474Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T12:43:36.2233825Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:43:36.2234173Z services/api/tests/test_rate_limit.py: 2 warnings
2025-08-19T12:43:36.2234543Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T12:43:36.2235497Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/__init__.py:89: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.1.
2025-08-19T12:43:36.2236422Z     await cls.redis.close()
2025-08-19T12:43:36.2236576Z 
2025-08-19T12:43:36.2236771Z tests/test_api_fast.py::test_health_endpoint
2025-08-19T12:43:36.2237933Z   /home/runner/work/AWA-App/AWA-App/tests/test_api_fast.py:13: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:43:36.2239019Z     return datetime.datetime.utcnow()
2025-08-19T12:43:36.2239214Z 
2025-08-19T12:43:36.2239347Z tests/test_api_fast.py: 1 warning
2025-08-19T12:43:36.2239642Z tests/test_health.py: 5 warnings
2025-08-19T12:43:36.2239925Z tests/test_smoke.py: 5 warnings
2025-08-19T12:43:36.2240229Z services/api/tests/test_cors.py: 1 warning
2025-08-19T12:43:36.2240572Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:43:36.2240940Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T12:43:36.2242180Z   /home/runner/work/AWA-App/AWA-App/services/api/routes/health.py:24: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:43:36.2243487Z     app_now = datetime.utcnow().replace(tzinfo=timezone.utc)
2025-08-19T12:43:36.2243715Z 
2025-08-19T12:43:36.2243856Z tests/test_health.py::test_health[0]
2025-08-19T12:43:36.2244156Z tests/test_health.py::test_health[1]
2025-08-19T12:43:36.2244445Z tests/test_health.py::test_health[2]
2025-08-19T12:43:36.2244733Z tests/test_health.py::test_health[3]
2025-08-19T12:43:36.2245018Z tests/test_health.py::test_health[4]
2025-08-19T12:43:36.2246322Z   /home/runner/work/AWA-App/AWA-App/tests/test_health.py:22: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:43:36.2247356Z     return datetime.datetime.utcnow()
2025-08-19T12:43:36.2247531Z 
2025-08-19T12:43:36.2247672Z tests/test_smoke.py::test_health[0]
2025-08-19T12:43:36.2247958Z tests/test_smoke.py::test_health[1]
2025-08-19T12:43:36.2248254Z tests/test_smoke.py::test_health[2]
2025-08-19T12:43:36.2248542Z tests/test_smoke.py::test_health[3]
2025-08-19T12:43:36.2248830Z tests/test_smoke.py::test_health[4]
2025-08-19T12:43:36.2249918Z   /home/runner/work/AWA-App/AWA-App/tests/test_smoke.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:43:36.2250933Z     return datetime.datetime.utcnow()
2025-08-19T12:43:36.2251112Z 
2025-08-19T12:43:36.2251341Z services/api/tests/test_cors.py::test_cors_simple_get_allowed
2025-08-19T12:43:36.2251862Z Sentry is attempting to send 0 pending events
2025-08-19T12:43:36.2252170Z Waiting up to True seconds
2025-08-19T12:43:36.2252412Z Press Ctrl-C to quit
2025-08-19T12:43:36.2253551Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_cors.py:27: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:43:36.2254837Z     return datetime.datetime.utcnow()
2025-08-19T12:43:36.2255022Z 
2025-08-19T12:43:36.2255210Z services/api/tests/test_health.py::test_health_route
2025-08-19T12:43:36.2256547Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_health.py:14: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:43:36.2257628Z     return datetime.datetime.utcnow()
2025-08-19T12:43:36.2257808Z 
2025-08-19T12:43:36.2257986Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T12:43:36.2259205Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_rate_limit.py:33: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:43:36.2260297Z     return datetime.datetime.utcnow()
2025-08-19T12:43:36.2260473Z 
2025-08-19T12:43:36.2260806Z services/api/tests/test_sentry_event.py::test_unhandled_exception_is_captured_and_tagged
2025-08-19T12:43:36.2262370Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_sentry_event.py:47: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
2025-08-19T12:43:36.2263612Z     hub = sentry_sdk.Hub.current
2025-08-19T12:43:36.2263778Z 
2025-08-19T12:43:36.2264040Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-08-19T12:43:36.2264516Z ================================ tests coverage ================================
2025-08-19T12:43:36.2264988Z _______________ coverage: platform linux, python 3.12.11-final-0 _______________
2025-08-19T12:43:36.2265399Z 
2025-08-19T12:43:36.2265548Z Coverage XML written to file coverage.xml
2025-08-19T12:43:36.2266066Z Required test coverage of 65% reached. Total coverage: 65.21%
2025-08-19T12:43:36.2266512Z =========================== short test summary info ============================
2025-08-19T12:43:36.2267154Z FAILED services/api/tests/test_roi_basic_auth.py::test_roi_basic_auth_good - RuntimeError: Event loop is closed
2025-08-19T12:43:36.2268027Z FAILED services/api/tests/test_roi_basic_auth.py::test_stats_contract_needs_basic_auth - RuntimeError: Event loop is closed
2025-08-19T12:43:36.2268913Z FAILED services/api/tests/test_stats_contracts.py::test_roi_by_vendor_contract - RuntimeError: Event loop is closed
2025-08-19T12:43:37.0220471Z ##[error]Process completed with exit code 1.
