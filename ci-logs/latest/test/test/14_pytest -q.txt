2025-08-19T22:00:31.9306009Z ##[group]Run pytest -q --cov=services
2025-08-19T22:00:31.9306352Z [36;1mpytest -q --cov=services[0m
2025-08-19T22:00:31.9347257Z shell: /usr/bin/bash -e {0}
2025-08-19T22:00:31.9347505Z env:
2025-08-19T22:00:31.9347717Z   REDIS_URL: redis://localhost:6379/0
2025-08-19T22:00:31.9348004Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-19T22:00:31.9348244Z   TRUST_X_FORWARDED: 1
2025-08-19T22:00:31.9348443Z   PG_USER: postgres
2025-08-19T22:00:31.9348638Z   PG_PASSWORD: pass
2025-08-19T22:00:31.9348830Z   PG_DATABASE: awa
2025-08-19T22:00:31.9349018Z   PG_HOST: localhost
2025-08-19T22:00:31.9349212Z   PG_PORT: 5432
2025-08-19T22:00:31.9349842Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-19T22:00:31.9350279Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-19T22:00:31.9350690Z   DATABASE_URL: ***localhost:5432/awa
2025-08-19T22:00:31.9350976Z   DATA_DIR: /home/runner/work/_temp/awa-data
2025-08-19T22:00:31.9351243Z   ENABLE_LIVE: 0
2025-08-19T22:00:31.9351426Z   TESTING: 1
2025-08-19T22:00:31.9351673Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T22:00:31.9352124Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-19T22:00:31.9352526Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T22:00:31.9352892Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T22:00:31.9353261Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T22:00:31.9353627Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-19T22:00:31.9353949Z   POSTGRES_USER: postgres
2025-08-19T22:00:31.9354173Z   POSTGRES_PASSWORD: pass
2025-08-19T22:00:31.9354384Z   POSTGRES_DB: awa
2025-08-19T22:00:31.9354570Z   LLM_PROVIDER: lan
2025-08-19T22:00:31.9354787Z   LLM_BASE_URL: http://localhost:8000
2025-08-19T22:00:31.9355226Z ##[endgroup]
2025-08-19T22:01:01.1981096Z ........s.............................sssssss........................... [ 41%]
2025-08-19T22:01:34.1857218Z .................................................................F...... [ 83%]
2025-08-19T22:01:34.8560039Z .............................
2025-08-19T22:01:34.8560808Z ERROR: Coverage failure: total of 65 is less than fail-under=75
2025-08-19T22:01:34.8588598Z                                                                          [100%]
2025-08-19T22:01:34.8589359Z =================================== FAILURES ===================================
2025-08-19T22:01:34.8590444Z ______________________ test_stats_contracts_stable_shapes ______________________
2025-08-19T22:01:34.8590985Z 
2025-08-19T22:01:34.8591307Z     def test_stats_contracts_stable_shapes():
2025-08-19T22:01:34.8591969Z         c, up = client_with_auth()
2025-08-19T22:01:34.8592764Z         for path in ("/stats/kpi", "/stats/roi_by_vendor", "/stats/roi_trend"):
2025-08-19T22:01:34.8593715Z >           r = c.get(path, headers=_auth_headers(*up))
2025-08-19T22:01:34.8594382Z                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8594757Z 
2025-08-19T22:01:34.8595253Z services/api/tests/test_stats_future_contracts.py:21: 
2025-08-19T22:01:34.8596019Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T22:01:34.8596926Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T22:01:34.8597592Z     return super().get(
2025-08-19T22:01:34.8598311Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T22:01:34.8598945Z     return self.request(
2025-08-19T22:01:34.8599941Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T22:01:34.8600434Z     return super().request(
2025-08-19T22:01:34.8600969Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T22:01:34.8601603Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T22:01:34.8602008Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8602905Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T22:01:34.8603441Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T22:01:34.8603755Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8604383Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T22:01:34.8604974Z     rv = real_send(self, request, **kwargs)
2025-08-19T22:01:34.8605251Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8605795Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T22:01:34.8606277Z     response = self._send_handling_auth(
2025-08-19T22:01:34.8606907Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T22:01:34.8607447Z     response = self._send_handling_redirects(
2025-08-19T22:01:34.8608107Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T22:01:34.8608671Z     response = self._send_single_request(request)
2025-08-19T22:01:34.8608972Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8609781Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T22:01:34.8624637Z     response = transport.handle_request(request)
2025-08-19T22:01:34.8625049Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8626105Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T22:01:34.8626942Z     raise exc
2025-08-19T22:01:34.8627869Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T22:01:34.8628470Z     portal.call(self.app, scope, receive, send)
2025-08-19T22:01:34.8629097Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T22:01:34.8630092Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T22:01:34.8630485Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8631057Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T22:01:34.8631527Z     return self.__get_result()
2025-08-19T22:01:34.8631774Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8632317Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T22:01:34.8632784Z     raise self._exception
2025-08-19T22:01:34.8633363Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T22:01:34.8633894Z     retval = await retval_or_awaitable
2025-08-19T22:01:34.8634171Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8634776Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T22:01:34.8635324Z     await super().__call__(scope, receive, send)
2025-08-19T22:01:34.8636088Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T22:01:34.8636743Z     return await middleware(scope, receive, send)
2025-08-19T22:01:34.8637052Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8637693Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T22:01:34.8638328Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T22:01:34.8638706Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8639349Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T22:01:34.8640253Z     raise exc from None
2025-08-19T22:01:34.8640848Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T22:01:34.8641356Z     return await self.app(
2025-08-19T22:01:34.8641928Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T22:01:34.8642544Z     await self.middleware_stack(scope, receive, send)
2025-08-19T22:01:34.8643310Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T22:01:34.8643987Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T22:01:34.8644381Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8645020Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T22:01:34.8645519Z     raise exc
2025-08-19T22:01:34.8646074Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T22:01:34.8646608Z     await self.app(scope, receive, _send)
2025-08-19T22:01:34.8647318Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T22:01:34.8647979Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T22:01:34.8648345Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8648964Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T22:01:34.8649635Z     await self.app(scope, receive, send)
2025-08-19T22:01:34.8650531Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T22:01:34.8651218Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T22:01:34.8651615Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8652259Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T22:01:34.8652851Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T22:01:34.8653682Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T22:01:34.8654343Z     await old_call(self, scope, receive, send)
2025-08-19T22:01:34.8655051Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T22:01:34.8655723Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T22:01:34.8656085Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8656740Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T22:01:34.8657399Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T22:01:34.8658141Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T22:01:34.8658641Z     raise exc
2025-08-19T22:01:34.8659212Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T22:01:34.8659976Z     await app(scope, receive, sender)
2025-08-19T22:01:34.8660598Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T22:01:34.8661144Z     await self.middleware_stack(scope, receive, send)
2025-08-19T22:01:34.8661740Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T22:01:34.8662236Z     await route.handle(scope, receive, send)
2025-08-19T22:01:34.8662946Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T22:01:34.8663443Z     await self.app(scope, receive, send)
2025-08-19T22:01:34.8663999Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T22:01:34.8664570Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T22:01:34.8665311Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T22:01:34.8665816Z     raise exc
2025-08-19T22:01:34.8666376Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T22:01:34.8666915Z     await app(scope, receive, sender)
2025-08-19T22:01:34.8667463Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T22:01:34.8667931Z     response = await f(request)
2025-08-19T22:01:34.8668175Z                ^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8668801Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T22:01:34.8669357Z     return await old_app(*args, **kwargs)
2025-08-19T22:01:34.8669813Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8670359Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T22:01:34.8670857Z     solved_result = await solve_dependencies(
2025-08-19T22:01:34.8671560Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T22:01:34.8672290Z     solved = await call(**solved_result.values)
2025-08-19T22:01:34.8672583Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8673181Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T22:01:34.8673700Z     pexpire = await self._check(key)
2025-08-19T22:01:34.8673953Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8674529Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T22:01:34.8675038Z     pexpire = await redis.evalsha(
2025-08-19T22:01:34.8675802Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T22:01:34.8676511Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T22:01:34.8676866Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8677500Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:677: in execute_command
2025-08-19T22:01:34.8678052Z     return await conn.retry.call_with_retry(
2025-08-19T22:01:34.8678677Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:50: in call_with_retry
2025-08-19T22:01:34.8679169Z     return await do()
2025-08-19T22:01:34.8679362Z            ^^^^^^^^^^
2025-08-19T22:01:34.8680206Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:652: in _send_command_parse_response
2025-08-19T22:01:34.8680887Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T22:01:34.8681262Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8681894Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:698: in parse_response
2025-08-19T22:01:34.8682445Z     response = await connection.read_response()
2025-08-19T22:01:34.8682741Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8683363Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:619: in read_response
2025-08-19T22:01:34.8683904Z     await self.disconnect(nowait=True)
2025-08-19T22:01:34.8684659Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:479: in disconnect
2025-08-19T22:01:34.8685220Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T22:01:34.8685496Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8685951Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T22:01:34.8686379Z     return self._transport.close()
2025-08-19T22:01:34.8686632Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T22:01:34.8687136Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T22:01:34.8687563Z     super().close()
2025-08-19T22:01:34.8688037Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T22:01:34.8688552Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T22:01:34.8689118Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T22:01:34.8689642Z     self._check_closed()
2025-08-19T22:01:34.8689973Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T22:01:34.8690209Z 
2025-08-19T22:01:34.8690471Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T22:01:34.8690736Z 
2025-08-19T22:01:34.8690821Z     def _check_closed(self):
2025-08-19T22:01:34.8691046Z         if self._closed:
2025-08-19T22:01:34.8691346Z >           raise RuntimeError('Event loop is closed')
2025-08-19T22:01:34.8691686Z E           RuntimeError: Event loop is closed
2025-08-19T22:01:34.8691863Z 
2025-08-19T22:01:34.8692231Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T22:01:34.8692943Z ------------------------------ Captured log call -------------------------------
2025-08-19T22:01:35.3981079Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "6abfc384a55f4a95a1e17db4a22c44e1", "level": "error", "timestamp": "2025-08-19T22:01:33.014321Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff1f8aa4110>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7ff1fa0bbb00>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7ff1f8875070>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7ff1f8aa41a0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7ff1fa0bbb00>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7ff1f9cca810'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='ae34f91\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7ff1fd2f5e40>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7ff1f8aa41a0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7ff1f9cca810'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7ff1fd2f5800>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "6abfc384a55f4a95a1e17db4a22c44e1", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7ff1f8a7ff80>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7ff1f9ad96'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7ff1f8a7ff80>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7ff1f9cca810'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='ae\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7ff20cbef240>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7ff1f8a7ff80>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7ff1f8874e00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7ff1f8a715b0>", "conn": "<starlette.requests.Request object at 0x7ff1f8874e00>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7ff1f8a715b0>", "conn": "<starlette.requests.Request object at 0x7ff1f8874e00>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7ff1f8a715b0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7ff1f8a715b0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi_by_vendor at 0x7ff1fc913240>, 'path_params': {}, 'rou\"+82"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7ff1fa0bb4c0>", "request": "<starlette.requests.Request object at 0x7ff1f8874f80>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7ff1fa0bb4c0>", "conn": "<starlette.requests.Request object at 0x7ff1f8874f80>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7ff1fa0bb4c0>", "conn": "<starlette.requests.Request object at 0x7ff1f8874f80>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7ff1f8874f80>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7ff1f8874f80>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7ff1f8a56600>", "request": "<starlette.requests.Request object at 0x7ff1f8874f80>", "sentry_scope": "<Scope id=0x7ff1f88a1000 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7ff1f88'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7ff1f8a3afc0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7ff1f8874f80>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7ff1f88772f0>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7ff1f8875e80>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[ModelField(field_info=Query(None), name='+2201", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7ff1f9c67bf0>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7ff1f8874f80>", "dependant": "'Dependant(path_params=[], query_params=[ModelField(field_info=Query(None), name='+2201", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7ff1f8875550>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7ff1f9c67bf0>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7ff1f8875e80>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7ff1f8a71bb0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7ff1\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7ff1f8a71bb0>", "request": "<starlette.requests.Request object at 0x7ff1f8874f80>", "response": "<starlette.responses.Response object at 0x7ff1f8875550>", "route_index": "12", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7ff1f8a13b00>", "callback": "<function http_default_callback at 0x7ff1fd304540>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:12:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7ff1f8a71bb0>", "key": "fastapi-limiter:testclient:12:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+98"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+98", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:12:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7ff1f89f1640>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7ff1fd280540>", "set_db_data_fn": "<function _set_db_data at 0x7ff1f9ffab60>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 677, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+98", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(en'+68", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 50, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7ff1f8874080>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7ff1fa0bad40>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7ff1fa0b9580>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 652, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+98", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 698, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+98", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 619, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 479, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=18> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 599, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7ff1f89ff930>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7ff1f89ff930>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 283, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7ff1f89ff930>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "func_name": "readuntil"}}]}]}
2025-08-19T22:01:35.4055757Z =============================== warnings summary ===============================
2025-08-19T22:01:35.4056141Z services/alert_bot/tests/test_smoke.py:5
2025-08-19T22:01:35.4057459Z   /home/runner/work/AWA-App/AWA-App/services/alert_bot/tests/test_smoke.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-08-19T22:01:35.4058615Z     import pkg_resources  # noqa: F401
2025-08-19T22:01:35.4058793Z 
2025-08-19T22:01:35.4058977Z tests/api/test_ingest_endpoints.py: 12 warnings
2025-08-19T22:01:35.4059333Z tests/ingest/test_tasks_eager.py: 3 warnings
2025-08-19T22:01:35.4059738Z tests/test_api_fast.py: 1 warning
2025-08-19T22:01:35.4060019Z tests/test_health.py: 5 warnings
2025-08-19T22:01:35.4060289Z tests/test_smoke.py: 5 warnings
2025-08-19T22:01:35.4060581Z services/api/tests/test_cors.py: 1 warning
2025-08-19T22:01:35.4060929Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T22:01:35.4061278Z services/api/tests/test_health.py: 1 warning
2025-08-19T22:01:35.4061634Z services/api/tests/test_rate_limit.py: 122 warnings
2025-08-19T22:01:35.4062014Z services/api/tests/test_roi_basic_auth.py: 4 warnings
2025-08-19T22:01:35.4062397Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T22:01:35.4062983Z services/api/tests/test_stats_contracts.py: 3 warnings
2025-08-19T22:01:35.4063430Z services/api/tests/test_stats_future_contracts.py: 2 warnings
2025-08-19T22:01:35.4065012Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/extensions/sentry.py:27: DeprecationWarning: sentry_sdk.configure_scope is deprecated and will be removed in the next major version. Please consult our migration guide to learn how to migrate to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x#scope-configuring
2025-08-19T22:01:35.4066334Z     with configure_scope() as scope:
2025-08-19T22:01:35.4066506Z 
2025-08-19T22:01:35.4066672Z tests/api/test_ingest_endpoints.py: 3 warnings
2025-08-19T22:01:35.4066990Z tests/test_api_fast.py: 1 warning
2025-08-19T22:01:35.4067273Z tests/test_health.py: 5 warnings
2025-08-19T22:01:35.4067542Z tests/test_smoke.py: 5 warnings
2025-08-19T22:01:35.4067836Z services/api/tests/test_cors.py: 3 warnings
2025-08-19T22:01:35.4068197Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T22:01:35.4068547Z services/api/tests/test_health.py: 1 warning
2025-08-19T22:01:35.4068897Z services/api/tests/test_rate_limit.py: 2 warnings
2025-08-19T22:01:35.4069265Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T22:01:35.4069750Z services/api/tests/test_stats_contracts.py: 3 warnings
2025-08-19T22:01:35.4070680Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/__init__.py:89: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.1.
2025-08-19T22:01:35.4071455Z     await cls.redis.close()
2025-08-19T22:01:35.4071595Z 
2025-08-19T22:01:35.4071783Z tests/test_api_fast.py::test_health_endpoint
2025-08-19T22:01:35.4072929Z   /home/runner/work/AWA-App/AWA-App/tests/test_api_fast.py:13: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T22:01:35.4073934Z     return datetime.datetime.utcnow()
2025-08-19T22:01:35.4074342Z Sentry is attempting to send 0 pending events
2025-08-19T22:01:35.4074654Z Waiting up to True seconds
2025-08-19T22:01:35.4075014Z Press Ctrl-C to quit
2025-08-19T22:01:35.4075148Z 
2025-08-19T22:01:35.4075280Z tests/test_api_fast.py: 1 warning
2025-08-19T22:01:35.4075562Z tests/test_health.py: 5 warnings
2025-08-19T22:01:35.4075831Z tests/test_smoke.py: 5 warnings
2025-08-19T22:01:35.4076118Z services/api/tests/test_cors.py: 1 warning
2025-08-19T22:01:35.4076447Z services/api/tests/test_health.py: 1 warning
2025-08-19T22:01:35.4076799Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T22:01:35.4077994Z   /home/runner/work/AWA-App/AWA-App/services/api/routes/health.py:24: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T22:01:35.4079086Z     app_now = datetime.utcnow().replace(tzinfo=timezone.utc)
2025-08-19T22:01:35.4079310Z 
2025-08-19T22:01:35.4079458Z tests/test_health.py::test_health[0]
2025-08-19T22:01:35.4079955Z tests/test_health.py::test_health[1]
2025-08-19T22:01:35.4080256Z tests/test_health.py::test_health[2]
2025-08-19T22:01:35.4080541Z tests/test_health.py::test_health[3]
2025-08-19T22:01:35.4080823Z tests/test_health.py::test_health[4]
2025-08-19T22:01:35.4081905Z   /home/runner/work/AWA-App/AWA-App/tests/test_health.py:22: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T22:01:35.4082885Z     return datetime.datetime.utcnow()
2025-08-19T22:01:35.4083057Z 
2025-08-19T22:01:35.4083195Z tests/test_smoke.py::test_health[0]
2025-08-19T22:01:35.4083482Z tests/test_smoke.py::test_health[1]
2025-08-19T22:01:35.4083761Z tests/test_smoke.py::test_health[2]
2025-08-19T22:01:35.4084181Z tests/test_smoke.py::test_health[3]
2025-08-19T22:01:35.4084461Z tests/test_smoke.py::test_health[4]
2025-08-19T22:01:35.4085534Z   /home/runner/work/AWA-App/AWA-App/tests/test_smoke.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T22:01:35.4086518Z     return datetime.datetime.utcnow()
2025-08-19T22:01:35.4086690Z 
2025-08-19T22:01:35.4086919Z services/api/tests/test_cors.py::test_cors_simple_get_allowed
2025-08-19T22:01:35.4088140Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_cors.py:27: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T22:01:35.4089163Z     return datetime.datetime.utcnow()
2025-08-19T22:01:35.4089347Z 
2025-08-19T22:01:35.4089646Z services/api/tests/test_health.py::test_health_route
2025-08-19T22:01:35.4090840Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_health.py:14: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T22:01:35.4091871Z     return datetime.datetime.utcnow()
2025-08-19T22:01:35.4092042Z 
2025-08-19T22:01:35.4092218Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T22:01:35.4093404Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_rate_limit.py:33: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T22:01:35.4094440Z     return datetime.datetime.utcnow()
2025-08-19T22:01:35.4094612Z 
2025-08-19T22:01:35.4094947Z services/api/tests/test_sentry_event.py::test_unhandled_exception_is_captured_and_tagged
2025-08-19T22:01:35.4096467Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_sentry_event.py:47: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
2025-08-19T22:01:35.4097786Z     hub = sentry_sdk.Hub.current
2025-08-19T22:01:35.4097950Z 
2025-08-19T22:01:35.4098217Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-08-19T22:01:35.4098693Z ================================ tests coverage ================================
2025-08-19T22:01:35.4099161Z _______________ coverage: platform linux, python 3.12.11-final-0 _______________
2025-08-19T22:01:35.4099419Z 
2025-08-19T22:01:35.4099670Z Coverage XML written to file coverage.xml
2025-08-19T22:01:35.4100109Z FAIL Required test coverage of 75% not reached. Total coverage: 65.38%
2025-08-19T22:01:35.4100585Z =========================== short test summary info ============================
2025-08-19T22:01:35.4101313Z FAILED services/api/tests/test_stats_future_contracts.py::test_stats_contracts_stable_shapes - RuntimeError: Event loop is closed
2025-08-19T22:01:35.8835196Z ##[error]Process completed with exit code 1.
