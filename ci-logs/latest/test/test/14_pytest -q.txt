2025-08-18T19:47:24.6483167Z ##[group]Run pytest -q --cov=services
2025-08-18T19:47:24.6483559Z [36;1mpytest -q --cov=services[0m
2025-08-18T19:47:24.6524560Z shell: /usr/bin/bash -e {0}
2025-08-18T19:47:24.6524815Z env:
2025-08-18T19:47:24.6525029Z   REDIS_URL: redis://localhost:6379/0
2025-08-18T19:47:24.6525338Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-18T19:47:24.6525593Z   TRUST_X_FORWARDED: 1
2025-08-18T19:47:24.6525815Z   PG_USER: postgres
2025-08-18T19:47:24.6526026Z   PG_PASSWORD: pass
2025-08-18T19:47:24.6526232Z   PG_DATABASE: awa
2025-08-18T19:47:24.6526430Z   PG_HOST: localhost
2025-08-18T19:47:24.6526636Z   PG_PORT: 5432
2025-08-18T19:47:24.6527254Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-18T19:47:24.6527911Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-18T19:47:24.6528470Z   DATABASE_URL: ***localhost:5432/awa
2025-08-18T19:47:24.6528770Z   DATA_DIR: /home/runner/work/_temp/awa-data
2025-08-18T19:47:24.6529054Z   ENABLE_LIVE: 0
2025-08-18T19:47:24.6529251Z   TESTING: 1
2025-08-18T19:47:24.6529515Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-18T19:47:24.6529987Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-18T19:47:24.6530424Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-18T19:47:24.6530820Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-18T19:47:24.6531214Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-18T19:47:24.6531616Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-18T19:47:24.6531960Z   POSTGRES_USER: postgres
2025-08-18T19:47:24.6532196Z   POSTGRES_PASSWORD: pass
2025-08-18T19:47:24.6532423Z   POSTGRES_DB: awa
2025-08-18T19:47:24.6532635Z   LLM_PROVIDER: lan
2025-08-18T19:47:24.6532867Z   LLM_BASE_URL: http://localhost:8000
2025-08-18T19:47:24.6533136Z ##[endgroup]
2025-08-18T19:47:57.2850549Z ........s.............................sssssss........................... [ 46%]
2025-08-18T19:48:30.4543171Z ..............................................F......................... [ 92%]
2025-08-18T19:48:31.1834082Z ...........                                                              [100%]
2025-08-18T19:48:31.1834934Z =================================== FAILURES ===================================
2025-08-18T19:48:31.1835962Z _______________ test_unhandled_exception_is_captured_and_tagged ________________
2025-08-18T19:48:31.1836563Z 
2025-08-18T19:48:31.1837549Z monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7f5fb81a1e50>
2025-08-18T19:48:31.1838031Z 
2025-08-18T19:48:31.1838389Z     def test_unhandled_exception_is_captured_and_tagged(monkeypatch):
2025-08-18T19:48:31.1838991Z         # install dummy transport
2025-08-18T19:48:31.1839454Z         hub = sentry_sdk.Hub.current
2025-08-18T19:48:31.1839887Z         if hub.client is not None:
2025-08-18T19:48:31.1840453Z             hub.client.transport = DummyTransport(hub.client.options)
2025-08-18T19:48:31.1840956Z     
2025-08-18T19:48:31.1841258Z         # inject a failing route
2025-08-18T19:48:31.1841622Z         def boom():
2025-08-18T19:48:31.1842077Z             raise RuntimeError("boom")
2025-08-18T19:48:31.1842451Z     
2025-08-18T19:48:31.1842842Z         app.add_api_route("/__boom", boom, methods=["GET"])
2025-08-18T19:48:31.1843281Z     
2025-08-18T19:48:31.1843597Z         with TestClient(app) as client:
2025-08-18T19:48:31.1844274Z >           r = client.get("/__boom", headers={"X-Request-ID": "test-rid-123"})
2025-08-18T19:48:31.1844894Z                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1845190Z 
2025-08-18T19:48:31.1845467Z services/api/tests/test_sentry_event.py:47: 
2025-08-18T19:48:31.1846128Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-18T19:48:31.1847299Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-18T19:48:31.1847998Z     return super().get(
2025-08-18T19:48:31.1848723Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-18T19:48:31.1849676Z     return self.request(
2025-08-18T19:48:31.1850491Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-18T19:48:31.1865446Z     return super().request(
2025-08-18T19:48:31.1866112Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-18T19:48:31.1866927Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-18T19:48:31.1867392Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1868068Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-18T19:48:31.1868880Z     return sentry_patched_function(*args, **kwargs)
2025-08-18T19:48:31.1869234Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1869929Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-18T19:48:31.1870540Z     rv = real_send(self, request, **kwargs)
2025-08-18T19:48:31.1870853Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1871454Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-18T19:48:31.1871989Z     response = self._send_handling_auth(
2025-08-18T19:48:31.1872672Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-18T19:48:31.1873275Z     response = self._send_handling_redirects(
2025-08-18T19:48:31.1874000Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-18T19:48:31.1874643Z     response = self._send_single_request(request)
2025-08-18T19:48:31.1874978Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1875667Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-18T19:48:31.1876294Z     response = transport.handle_request(request)
2025-08-18T19:48:31.1876607Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1877462Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-18T19:48:31.1877966Z     raise exc
2025-08-18T19:48:31.1878534Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-18T19:48:31.1879092Z     portal.call(self.app, scope, receive, send)
2025-08-18T19:48:31.1879671Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-18T19:48:31.1880254Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-18T19:48:31.1880633Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1881177Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-18T19:48:31.1881649Z     return self.__get_result()
2025-08-18T19:48:31.1881906Z            ^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1882434Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-18T19:48:31.1882894Z     raise self._exception
2025-08-18T19:48:31.1883449Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-18T19:48:31.1883959Z     retval = await retval_or_awaitable
2025-08-18T19:48:31.1884241Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1884819Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-18T19:48:31.1885362Z     await super().__call__(scope, receive, send)
2025-08-18T19:48:31.1886111Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-18T19:48:31.1886978Z     return await middleware(scope, receive, send)
2025-08-18T19:48:31.1887571Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1888251Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-18T19:48:31.1888876Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-18T19:48:31.1889248Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1889870Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-18T19:48:31.1890372Z     raise exc from None
2025-08-18T19:48:31.1891067Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-18T19:48:31.1891569Z     return await self.app(
2025-08-18T19:48:31.1892134Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-18T19:48:31.1892694Z     await self.middleware_stack(scope, receive, send)
2025-08-18T19:48:31.1893433Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-18T19:48:31.1894119Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-18T19:48:31.1894500Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1895138Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-18T19:48:31.1895640Z     raise exc
2025-08-18T19:48:31.1896210Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-18T19:48:31.1896907Z     await self.app(scope, receive, _send)
2025-08-18T19:48:31.1897600Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-18T19:48:31.1898269Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-18T19:48:31.1898643Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1899263Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-18T19:48:31.1899850Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-18T19:48:31.1900657Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-18T19:48:31.1901313Z     await old_call(self, scope, receive, send)
2025-08-18T19:48:31.1902009Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-18T19:48:31.1902669Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-18T19:48:31.1903039Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1903689Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-18T19:48:31.1904345Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-18T19:48:31.1905070Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-18T19:48:31.1905571Z     raise exc
2025-08-18T19:48:31.1906131Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-18T19:48:31.1906767Z     await app(scope, receive, sender)
2025-08-18T19:48:31.1907343Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-18T19:48:31.1907881Z     await self.middleware_stack(scope, receive, send)
2025-08-18T19:48:31.1908468Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-18T19:48:31.1909088Z     await route.handle(scope, receive, send)
2025-08-18T19:48:31.1909660Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-18T19:48:31.1910154Z     await self.app(scope, receive, send)
2025-08-18T19:48:31.1910702Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-18T19:48:31.1911278Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-18T19:48:31.1911988Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-18T19:48:31.1912595Z     raise exc
2025-08-18T19:48:31.1913147Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-18T19:48:31.1913680Z     await app(scope, receive, sender)
2025-08-18T19:48:31.1914220Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-18T19:48:31.1914696Z     response = await f(request)
2025-08-18T19:48:31.1914948Z                ^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1915557Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-18T19:48:31.1916111Z     return await old_app(*args, **kwargs)
2025-08-18T19:48:31.1916390Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1917138Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:302: in app
2025-08-18T19:48:31.1917643Z     raw_response = await run_endpoint_function(
2025-08-18T19:48:31.1918286Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:215: in run_endpoint_function
2025-08-18T19:48:31.1918890Z     return await run_in_threadpool(dependant.call, **values)
2025-08-18T19:48:31.1919243Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1919872Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/concurrency.py:38: in run_in_threadpool
2025-08-18T19:48:31.1920437Z     return await anyio.to_thread.run_sync(func)
2025-08-18T19:48:31.1920731Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1921280Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/to_thread.py:56: in run_sync
2025-08-18T19:48:31.1921826Z     return await get_async_backend().run_sync_in_worker_thread(
2025-08-18T19:48:31.1922566Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:2476: in run_sync_in_worker_thread
2025-08-18T19:48:31.1923119Z     return await future
2025-08-18T19:48:31.1923334Z            ^^^^^^^^^^^^
2025-08-18T19:48:31.1923865Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:967: in run
2025-08-18T19:48:31.1924372Z     result = context.run(func, *args)
2025-08-18T19:48:31.1924651Z              ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1925288Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:93: in _sentry_call
2025-08-18T19:48:31.1925844Z     return old_call(*args, **kwargs)
2025-08-18T19:48:31.1926109Z            ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-18T19:48:31.1926466Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-18T19:48:31.1926972Z 
2025-08-18T19:48:31.1927145Z     def boom():
2025-08-18T19:48:31.1927423Z >       raise RuntimeError("boom")
2025-08-18T19:48:31.1927700Z E       RuntimeError: boom
2025-08-18T19:48:31.1927851Z 
2025-08-18T19:48:31.1928059Z services/api/tests/test_sentry_event.py:42: RuntimeError
2025-08-18T19:48:31.1928542Z ------------------------------ Captured log call -------------------------------
2025-08-18T19:48:31.1929375Z WARNING  asgi_correlation_id:middleware.py:74 Generated new request ID (9bbb3c40e39849a49fe89bb9e28c094d), since request header value failed validation
2025-08-18T19:48:31.9047488Z ERROR    services.api.errors:errors.py:56 {"event": "unhandled_error", "request_id": "9bbb3c40e39849a49fe89bb9e28c094d", "level": "error", "timestamp": "2025-08-18T19:48:28.888550Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "boom", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5fb937b740>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5fb81487c0>", "exc": "RuntimeError('boom')", "request": "<starlette.requests.Request object at 0x7f5fb93e5460>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5fb81487c0>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f5fb9489e80'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f5fbc817d80>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+119", "header_value": "test-rid-123", "validation_failed": "True", "id_value": "9bbb3c40e39849a49fe89bb9e28c094d", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f5fb937af90>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f5fb92257'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f5fb937af90>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f5fb9489e80'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='4e\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f5fcc1a9a80>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f5fb937af90>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f5fb81c8b30>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f5fbc021df0>", "conn": "<starlette.requests.Request object at 0x7f5fb81c8b30>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f5fbc021df0>", "conn": "<starlette.requests.Request object at 0x7f5fb81c8b30>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f5fbc021df0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f5fbc021df0>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/__boom', name='boom', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function test_unhandled_exception_is_captured_and_tagged.<locals>.\"+108"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/__boom', name='boom', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f5fb8149b20>", "request": "<starlette.requests.Request object at 0x7f5fb81c8d70>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f5fb8149b20>", "conn": "<starlette.requests.Request object at 0x7f5fb81c8d70>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f5fb8149b20>", "conn": "<starlette.requests.Request object at 0x7f5fb81c8d70>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/__boom', 'raw\"+1672", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f5fb81c8d70>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f5fb81c8d70>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f5fb93e49e0>", "request": "<starlette.requests.Request object at 0x7f5fb81c8d70>", "sentry_scope": "<Scope id=0x7f5fb8130820 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f5fb81'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f5fb811f4c0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 302, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f5fb81c8d70>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f5fb81c8bf0>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f5fb81c8ce0>", "solved_result": "'SolvedDependency(values={}, errors=[], background_tasks=None, response=<starlett'+142", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+1043", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f5fbc0238c0>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 215, "name": "run_endpoint_function", "line": "", "locals": {"dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+1043", "values": "{}", "is_coroutine": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/concurrency.py", "lineno": 38, "name": "run_in_threadpool", "line": "", "locals": {"func": "'functools.partial(<function test_unhandled_exception_is_captured_and_tagged.<loc'+29", "args": "()", "kwargs": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/to_thread.py", "lineno": 56, "name": "run_sync", "line": "", "locals": {"func": "'functools.partial(<function test_unhandled_exception_is_captured_and_tagged.<loc'+29", "abandon_on_cancel": "False", "cancellable": "None", "limiter": "None", "args": "()"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", "lineno": 2476, "name": "run_sync_in_worker_thread", "line": "", "locals": {"cls": "<class 'anyio._backends._asyncio.AsyncIOBackend'>", "func": "'functools.partial(<function test_unhandled_exception_is_captured_and_tagged.<loc'+29", "args": "()", "abandon_on_cancel": "False", "limiter": "None", "idle_workers": "deque([<WorkerThread(AnyIO worker thread, started daemon 140048045430464)>])", "workers": "{<WorkerThread(AnyIO worker thread, started daemon 140048045430464)>}", "scope": "<anyio._backends._asyncio.CancelScope object at 0x7f5fb81729c0>", "future": "<Future finished exception=RuntimeError('boom')>", "root_task": "\"<Task pending name='anyio.from_thread.start_blocking_portal.<locals>.run_portal'\"+351", "worker": "<WorkerThread(AnyIO worker thread, started daemon 140048045430464)>", "context": "<_contextvars.Context object at 0x7f5fb9355ac0>", "worker_scope": "<anyio._backends._asyncio.CancelScope object at 0x7f5fb8192090>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", "lineno": 967, "name": "run", "line": "", "locals": {"self": "<WorkerThread(AnyIO worker thread, started daemon 140048045430464)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 93, "name": "_sentry_call", "line": "", "locals": {"args": "()", "kwargs": "{}", "current_scope": "<Scope id=0x7f5fb8132960 name=None type=ScopeType.CURRENT>", "sentry_scope": "<Scope id=0x7f5fb8130820 name=fastapi type=ScopeType.ISOLATION>", "old_call": "'<function test_unhandled_exception_is_captured_and_tagged.<locals>.boom at 0x7f5'+10"}}, {"filename": "/home/runner/work/AWA-App/AWA-App/services/api/tests/test_sentry_event.py", "lineno": 42, "name": "boom", "line": "", "locals": {}}]}]}
2025-08-18T19:48:31.9123437Z =============================== warnings summary ===============================
2025-08-18T19:48:31.9124042Z services/alert_bot/tests/test_smoke.py:5
2025-08-18T19:48:31.9125389Z   /home/runner/work/AWA-App/AWA-App/services/alert_bot/tests/test_smoke.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-08-18T19:48:31.9126577Z     import pkg_resources  # noqa: F401
2025-08-18T19:48:31.9126992Z 
2025-08-18T19:48:31.9127176Z tests/api/test_ingest_endpoints.py: 12 warnings
2025-08-18T19:48:31.9127530Z tests/ingest/test_tasks_eager.py: 3 warnings
2025-08-18T19:48:31.9127840Z tests/test_api_fast.py: 1 warning
2025-08-18T19:48:31.9128123Z tests/test_health.py: 5 warnings
2025-08-18T19:48:31.9128394Z tests/test_smoke.py: 5 warnings
2025-08-18T19:48:31.9128683Z services/api/tests/test_cors.py: 1 warning
2025-08-18T19:48:31.9129029Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-18T19:48:31.9129376Z services/api/tests/test_health.py: 1 warning
2025-08-18T19:48:31.9129727Z services/api/tests/test_rate_limit.py: 122 warnings
2025-08-18T19:48:31.9130142Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-18T19:48:31.9132493Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/extensions/sentry.py:27: DeprecationWarning: sentry_sdk.configure_scope is deprecated and will be removed in the next major version. Please consult our migration guide to learn how to migrate to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x#scope-configuring
2025-08-18T19:48:31.9134982Z     with configure_scope() as scope:
2025-08-18T19:48:31.9135309Z 
2025-08-18T19:48:31.9135508Z tests/api/test_ingest_endpoints.py: 3 warnings
2025-08-18T19:48:31.9135843Z tests/test_api_fast.py: 1 warning
2025-08-18T19:48:31.9136118Z tests/test_health.py: 5 warnings
2025-08-18T19:48:31.9136391Z tests/test_smoke.py: 5 warnings
2025-08-18T19:48:31.9136907Z services/api/tests/test_cors.py: 3 warnings
2025-08-18T19:48:31.9137343Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-18T19:48:31.9137764Z services/api/tests/test_health.py: 1 warning
2025-08-18T19:48:31.9138408Z services/api/tests/test_rate_limit.py: 2 warnings
2025-08-18T19:48:31.9139076Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-18T19:48:31.9140756Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/__init__.py:89: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.1.
2025-08-18T19:48:31.9142723Z     await cls.redis.close()
2025-08-18T19:48:31.9142989Z 
2025-08-18T19:48:31.9143331Z tests/test_api_fast.py::test_health_endpoint
2025-08-18T19:48:31.9145426Z   /home/runner/work/AWA-App/AWA-App/tests/test_api_fast.py:13: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-18T19:48:31.9147562Z     return datetime.datetime.utcnow()
2025-08-18T19:48:31.9147794Z 
2025-08-18T19:48:31.9147949Z tests/test_api_fast.py: 1 warning
2025-08-18T19:48:31.9148361Z tests/test_health.py: 5 warnings
2025-08-18T19:48:31.9148721Z tests/test_smoke.py: 5 warnings
2025-08-18T19:48:31.9149078Z services/api/tests/test_cors.py: 1 warning
2025-08-18T19:48:31.9149429Z services/api/tests/test_health.py: 1 warning
2025-08-18T19:48:31.9150010Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-18T19:48:31.9152162Z   /home/runner/work/AWA-App/AWA-App/services/api/routes/health.py:24: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-18T19:48:31.9154140Z     app_now = datetime.utcnow().replace(tzinfo=timezone.utc)
2025-08-18T19:48:31.9154571Z 
2025-08-18T19:48:31.9154745Z tests/test_health.py::test_health[0]
2025-08-18T19:48:31.9155175Z tests/test_health.py::test_health[1]
2025-08-18T19:48:31.9155483Z tests/test_health.py::test_health[2]
2025-08-18T19:48:31.9155774Z tests/test_health.py::test_health[3]
2025-08-18T19:48:31.9156055Z tests/test_health.py::test_health[4]
2025-08-18T19:48:31.9157310Z   /home/runner/work/AWA-App/AWA-App/tests/test_health.py:22: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-18T19:48:31.9158306Z     return datetime.datetime.utcnow()
2025-08-18T19:48:31.9158488Z 
2025-08-18T19:48:31.9158621Z tests/test_smoke.py::test_health[0]
2025-08-18T19:48:31.9158910Z tests/test_smoke.py::test_health[1]
2025-08-18T19:48:31.9159188Z tests/test_smoke.py::test_health[2]
2025-08-18T19:48:31.9159469Z tests/test_smoke.py::test_health[3]
2025-08-18T19:48:31.9159741Z tests/test_smoke.py::test_health[4]
2025-08-18T19:48:31.9160833Z   /home/runner/work/AWA-App/AWA-App/tests/test_smoke.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-18T19:48:31.9162510Z     return datetime.datetime.utcnow()
2025-08-18T19:48:31.9162715Z 
2025-08-18T19:48:31.9163371Z services/api/tests/test_cors.py::test_cors_simple_get_allowed
2025-08-18T19:48:31.9165006Z Exception ignored in atexit callback: <function AtexitIntegration.setup_once.<locals>._shutdown at 0x7f5fb9738ea0>
2025-08-18T19:48:31.9166076Z Traceback (most recent call last):
2025-08-18T19:48:31.9167447Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/atexit.py", line 57, in _shutdown
2025-08-18T19:48:31.9168120Z     client.close(callback=integration.callback)
2025-08-18T19:48:31.9168750Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/client.py", line 1018, in close
2025-08-18T19:48:31.9169326Z     self.flush(timeout=timeout, callback=callback)
2025-08-18T19:48:31.9169954Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/client.py", line 1050, in flush
2025-08-18T19:48:31.9170683Z     self.transport.flush(timeout=timeout, callback=callback)
2025-08-18T19:48:31.9171268Z   File "/home/runner/work/AWA-App/AWA-App/services/api/tests/test_sentry_event.py", line 25, in flush
2025-08-18T19:48:31.9172078Z     callback(None, True)
2025-08-18T19:48:31.9172729Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/atexit.py", line 26, in default_callback
2025-08-18T19:48:31.9173444Z     echo("Sentry is attempting to send %i pending events" % pending)
2025-08-18T19:48:31.9173848Z          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~
2025-08-18T19:48:31.9174284Z TypeError: %i format: a real number is required, not NoneType
2025-08-18T19:48:31.9175492Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_cors.py:27: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-18T19:48:31.9177236Z     return datetime.datetime.utcnow()
2025-08-18T19:48:31.9177585Z 
2025-08-18T19:48:31.9177950Z services/api/tests/test_health.py::test_health_route
2025-08-18T19:48:31.9179945Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_health.py:14: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-18T19:48:31.9181547Z     return datetime.datetime.utcnow()
2025-08-18T19:48:31.9181740Z 
2025-08-18T19:48:31.9182026Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-18T19:48:31.9183221Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_rate_limit.py:33: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-18T19:48:31.9184266Z     return datetime.datetime.utcnow()
2025-08-18T19:48:31.9184438Z 
2025-08-18T19:48:31.9184777Z services/api/tests/test_sentry_event.py::test_unhandled_exception_is_captured_and_tagged
2025-08-18T19:48:31.9186268Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_sentry_event.py:36: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
2025-08-18T19:48:31.9187643Z     hub = sentry_sdk.Hub.current
2025-08-18T19:48:31.9187811Z 
2025-08-18T19:48:31.9188076Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-08-18T19:48:31.9188909Z ================================ tests coverage ================================
2025-08-18T19:48:31.9189629Z _______________ coverage: platform linux, python 3.12.11-final-0 _______________
2025-08-18T19:48:31.9189892Z 
2025-08-18T19:48:31.9190075Z Coverage XML written to file coverage.xml
2025-08-18T19:48:31.9190822Z Required test coverage of 45% reached. Total coverage: 64.17%
2025-08-18T19:48:31.9191539Z =========================== short test summary info ============================
2025-08-18T19:48:31.9192231Z FAILED services/api/tests/test_sentry_event.py::test_unhandled_exception_is_captured_and_tagged - RuntimeError: boom
2025-08-18T19:48:32.6822334Z ##[error]Process completed with exit code 1.
