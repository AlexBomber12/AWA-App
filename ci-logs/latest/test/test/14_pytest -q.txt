2025-08-19T12:11:54.2117089Z ##[group]Run pytest -q --cov=services
2025-08-19T12:11:54.2117667Z [36;1mpytest -q --cov=services[0m
2025-08-19T12:11:54.2159599Z shell: /usr/bin/bash -e {0}
2025-08-19T12:11:54.2159856Z env:
2025-08-19T12:11:54.2160082Z   REDIS_URL: redis://localhost:6379/0
2025-08-19T12:11:54.2160357Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-19T12:11:54.2160600Z   TRUST_X_FORWARDED: 1
2025-08-19T12:11:54.2160804Z   PG_USER: postgres
2025-08-19T12:11:54.2161019Z   PG_PASSWORD: pass
2025-08-19T12:11:54.2161324Z   PG_DATABASE: awa
2025-08-19T12:11:54.2161522Z   PG_HOST: localhost
2025-08-19T12:11:54.2161726Z   PG_PORT: 5432
2025-08-19T12:11:54.2162168Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-19T12:11:54.2174590Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-19T12:11:54.2175464Z   DATABASE_URL: ***localhost:5432/awa
2025-08-19T12:11:54.2175777Z   DATA_DIR: /home/runner/work/_temp/awa-data
2025-08-19T12:11:54.2176051Z   ENABLE_LIVE: 0
2025-08-19T12:11:54.2176469Z   TESTING: 1
2025-08-19T12:11:54.2176723Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:11:54.2177196Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-19T12:11:54.2177612Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:11:54.2177979Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:11:54.2178349Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-19T12:11:54.2178708Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-19T12:11:54.2179032Z   POSTGRES_USER: postgres
2025-08-19T12:11:54.2179256Z   POSTGRES_PASSWORD: pass
2025-08-19T12:11:54.2179464Z   POSTGRES_DB: awa
2025-08-19T12:11:54.2179653Z   LLM_PROVIDER: lan
2025-08-19T12:11:54.2179871Z   LLM_BASE_URL: http://localhost:8000
2025-08-19T12:11:54.2180129Z ##[endgroup]
2025-08-19T12:12:23.4553530Z ........s.............................sssssss........................... [ 43%]
2025-08-19T12:12:58.1296835Z ...................................................F.F..FFF............. [ 86%]
2025-08-19T12:12:58.8829755Z ......................                                                   [100%]
2025-08-19T12:12:58.8830593Z =================================== FAILURES ===================================
2025-08-19T12:12:58.8831837Z ___________________________ test_roi_basic_auth_good ___________________________
2025-08-19T12:12:58.8832349Z 
2025-08-19T12:12:58.8832882Z monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7f90052b9c40>
2025-08-19T12:12:58.8833445Z 
2025-08-19T12:12:58.8833703Z     def test_roi_basic_auth_good(monkeypatch):
2025-08-19T12:12:58.8834222Z         os.environ["API_BASIC_USER"] = "u"
2025-08-19T12:12:58.8834703Z         os.environ["API_BASIC_PASS"] = "p"
2025-08-19T12:12:58.8835117Z         client = _client()
2025-08-19T12:12:58.8835680Z >       r = client.get("/roi", headers=_auth_headers("u", "p"))
2025-08-19T12:12:58.8836242Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8836566Z 
2025-08-19T12:12:58.8836904Z services/api/tests/test_roi_basic_auth.py:31: 
2025-08-19T12:12:58.8837658Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:12:58.8838833Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:12:58.8839734Z     return super().get(
2025-08-19T12:12:58.8840697Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:12:58.8841723Z     return self.request(
2025-08-19T12:12:58.8842769Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:12:58.8843680Z     return super().request(
2025-08-19T12:12:58.8844683Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:12:58.8845806Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:12:58.8846551Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8848050Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:12:58.8849061Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:12:58.8849635Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8850790Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:12:58.8852039Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:12:58.8852571Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8853584Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:12:58.8854478Z     response = self._send_handling_auth(
2025-08-19T12:12:58.8855700Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:12:58.8857009Z     response = self._send_handling_redirects(
2025-08-19T12:12:58.8858216Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:12:58.8859285Z     response = self._send_single_request(request)
2025-08-19T12:12:58.8859856Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8861011Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:12:58.8862243Z     response = transport.handle_request(request)
2025-08-19T12:12:58.8862801Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8863963Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:12:58.8864891Z     raise exc
2025-08-19T12:12:58.8865952Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:12:58.8867021Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:12:58.8868132Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:12:58.8869212Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:12:58.8869902Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8870929Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:12:58.8871967Z     return self.__get_result()
2025-08-19T12:12:58.8872409Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8873415Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:12:58.8874301Z     raise self._exception
2025-08-19T12:12:58.8875344Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:12:58.8876282Z     retval = await retval_or_awaitable
2025-08-19T12:12:58.8876778Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8877888Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:12:58.8878887Z     await super().__call__(scope, receive, send)
2025-08-19T12:12:58.8880243Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:12:58.8881567Z     return await middleware(scope, receive, send)
2025-08-19T12:12:58.8882111Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8883275Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:12:58.8884470Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:12:58.8885180Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8886412Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:12:58.8887709Z     raise exc from None
2025-08-19T12:12:58.8888688Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:12:58.8889594Z     return await self.app(
2025-08-19T12:12:58.8890555Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:12:58.8891698Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:12:58.8892927Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.8894174Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.8894871Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8896068Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:12:58.8897231Z     raise exc
2025-08-19T12:12:58.8898287Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:12:58.8899298Z     await self.app(scope, receive, _send)
2025-08-19T12:12:58.8900611Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.8902081Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.8902761Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8903929Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:12:58.8904946Z     await self.app(scope, receive, send)
2025-08-19T12:12:58.8906281Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.8907538Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.8908204Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8909327Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:12:58.8910338Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:12:58.8911870Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:12:58.8912983Z     await old_call(self, scope, receive, send)
2025-08-19T12:12:58.8914144Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.8915263Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.8915881Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8916940Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:12:58.8918012Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:12:58.8919206Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:12:58.8920025Z     raise exc
2025-08-19T12:12:58.8920977Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:12:58.8922021Z     await app(scope, receive, sender)
2025-08-19T12:12:58.8922951Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:12:58.8923814Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:12:58.8924782Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:12:58.8925812Z     await route.handle(scope, receive, send)
2025-08-19T12:12:58.8926761Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:12:58.8927576Z     await self.app(scope, receive, send)
2025-08-19T12:12:58.8928472Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:12:58.8929387Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:12:58.8930551Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:12:58.8931519Z     raise exc
2025-08-19T12:12:58.8932414Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:12:58.8933276Z     await app(scope, receive, sender)
2025-08-19T12:12:58.8934169Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:12:58.8935081Z     response = await f(request)
2025-08-19T12:12:58.8935463Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8936513Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:12:58.8937421Z     return await old_app(*args, **kwargs)
2025-08-19T12:12:58.8937850Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8938716Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:12:58.8939547Z     solved_result = await solve_dependencies(
2025-08-19T12:12:58.8940699Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:12:58.8941783Z     solved = await call(**solved_result.values)
2025-08-19T12:12:58.8942254Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8943233Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:12:58.8944086Z     pexpire = await self._check(key)
2025-08-19T12:12:58.8944497Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8945401Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:12:58.8946224Z     pexpire = await redis.evalsha(
2025-08-19T12:12:58.8947456Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:12:58.8948622Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:12:58.8949178Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8950189Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:12:58.8951081Z     return await conn.retry.call_with_retry(
2025-08-19T12:12:58.8952533Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:12:58.8953315Z     return await do()
2025-08-19T12:12:58.8953605Z            ^^^^^^^^^^
2025-08-19T12:12:58.8954506Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:12:58.8955513Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:12:58.8956035Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8956893Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:12:58.8957656Z     response = await connection.read_response()
2025-08-19T12:12:58.8958056Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8960995Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:12:58.8962557Z     await self.disconnect(nowait=True)
2025-08-19T12:12:58.8963777Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:12:58.8964719Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:12:58.8965091Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8965699Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:12:58.8966288Z     return self._transport.close()
2025-08-19T12:12:58.8966630Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.8967211Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:12:58.8967670Z     super().close()
2025-08-19T12:12:58.8968160Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:12:58.8968691Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:12:58.8969481Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:12:58.8969931Z     self._check_closed()
2025-08-19T12:12:58.8970266Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:12:58.8970479Z 
2025-08-19T12:12:58.8970735Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:12:58.8971007Z 
2025-08-19T12:12:58.8971097Z     def _check_closed(self):
2025-08-19T12:12:58.8971557Z         if self._closed:
2025-08-19T12:12:58.8971868Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:12:58.8972225Z E           RuntimeError: Event loop is closed
2025-08-19T12:12:58.8972408Z 
2025-08-19T12:12:58.8972784Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:12:58.8973377Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:12:58.9076732Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "8a6334108a5e45c38a2b18f6616874bf", "level": "error", "timestamp": "2025-08-19T12:12:54.750314Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f900540bd70>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f900526bec0>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f8ff4f03590>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f90053f6540>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f900526bec0>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='93d7d39\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f90087de8e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f90053f6540>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f90087de200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "8a6334108a5e45c38a2b18f6616874bf", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f90055d0a'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='93\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f90180bec00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f8ff4f03380>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "conn": "<starlette.requests.Request object at 0x7f8ff4f03380>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "conn": "<starlette.requests.Request object at 0x7f8ff4f03380>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/roi', name='roi', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi at 0x7f9007d9a980>, 'path_params': {}, 'route': APIRo\"+46"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/roi', name='roi', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f900526bf60>", "request": "<starlette.requests.Request object at 0x7f8ff4f03530>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f900526bf60>", "conn": "<starlette.requests.Request object at 0x7f8ff4f03530>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f900526bf60>", "conn": "<starlette.requests.Request object at 0x7f8ff4f03530>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/roi', 'raw_pa\"+1639", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f8ff4f03530>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f8ff4f03530>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f90053d3860>", "request": "<starlette.requests.Request object at 0x7f8ff4f03530>", "sentry_scope": "<Scope id=0x7f9005315d20 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f8ff4f'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f900522d300>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f8ff4f03530>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f8ff4f03740>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f8ff4f037d0>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "\"Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='ro\"+2748", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f9017e26e10>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "True", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f8ff4f03530>", "dependant": "\"Dependant(path_params=[], query_params=[ModelField(field_info=Query(0), name='ro\"+2748", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f8ff4f03890>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f9017e26e10>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f8ff4f037d0>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+455", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+455", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "use_path": "/roi", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f8f\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "request": "<starlette.requests.Request object at 0x7f8ff4f03530>", "response": "<starlette.responses.Response object at 0x7f8ff4f03890>", "route_index": "8", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f900532bba0>", "callback": "<function http_default_callback at 0x7f9008a45760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:8:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "key": "fastapi-limiter:testclient:8:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:8:0'\"+17", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f9005452c00>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f9008792840>", "set_db_data_fn": "<function _set_db_data at 0x7f9005676480>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+28", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f90052a4880>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f900526a3e0>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f9005269ee0>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+28", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=17> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=17>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=17>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f90055d8ec0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f90055d8ec0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f90055d8ec0>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=17>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:12:58.9155935Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f8ff4e07e60>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:12:58.9158499Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f8ff4e35310>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:12:58.9160057Z _____________________ test_stats_contract_needs_basic_auth _____________________
2025-08-19T12:12:58.9160314Z 
2025-08-19T12:12:58.9160457Z     def test_stats_contract_needs_basic_auth():
2025-08-19T12:12:58.9160777Z         os.environ["API_BASIC_USER"] = "u"
2025-08-19T12:12:58.9161070Z         os.environ["API_BASIC_PASS"] = "p"
2025-08-19T12:12:58.9161433Z         client = _client()
2025-08-19T12:12:58.9161702Z >       r = client.get("/stats/kpi")
2025-08-19T12:12:58.9161963Z             ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9162117Z 
2025-08-19T12:12:58.9162285Z services/api/tests/test_roi_basic_auth.py:47: 
2025-08-19T12:12:58.9162672Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:12:58.9163298Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:12:58.9163786Z     return super().get(
2025-08-19T12:12:58.9164298Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:12:58.9164759Z     return self.request(
2025-08-19T12:12:58.9165316Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:12:58.9165798Z     return super().request(
2025-08-19T12:12:58.9166329Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:12:58.9166924Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:12:58.9167323Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9167903Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:12:58.9168433Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:12:58.9168748Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9169355Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:12:58.9169886Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:12:58.9170162Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9170692Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:12:58.9171377Z     response = self._send_handling_auth(
2025-08-19T12:12:58.9172016Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:12:58.9172557Z     response = self._send_handling_redirects(
2025-08-19T12:12:58.9173208Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:12:58.9173788Z     response = self._send_single_request(request)
2025-08-19T12:12:58.9174235Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9174847Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:12:58.9175400Z     response = transport.handle_request(request)
2025-08-19T12:12:58.9175705Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9176320Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:12:58.9176810Z     raise exc
2025-08-19T12:12:58.9177361Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:12:58.9177917Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:12:58.9178498Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:12:58.9179076Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:12:58.9179576Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9180117Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:12:58.9180585Z     return self.__get_result()
2025-08-19T12:12:58.9180827Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9181576Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:12:58.9182054Z     raise self._exception
2025-08-19T12:12:58.9182602Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:12:58.9183114Z     retval = await retval_or_awaitable
2025-08-19T12:12:58.9183382Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9183959Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:12:58.9184516Z     await super().__call__(scope, receive, send)
2025-08-19T12:12:58.9185274Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:12:58.9185925Z     return await middleware(scope, receive, send)
2025-08-19T12:12:58.9186228Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9186861Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:12:58.9187498Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:12:58.9187869Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9188509Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:12:58.9189021Z     raise exc from None
2025-08-19T12:12:58.9189598Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:12:58.9190123Z     return await self.app(
2025-08-19T12:12:58.9190690Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:12:58.9191345Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:12:58.9192079Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.9192775Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.9193150Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9193782Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:12:58.9194284Z     raise exc
2025-08-19T12:12:58.9194834Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:12:58.9195377Z     await self.app(scope, receive, _send)
2025-08-19T12:12:58.9196221Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.9196910Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.9197285Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9197903Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:12:58.9198441Z     await self.app(scope, receive, send)
2025-08-19T12:12:58.9199127Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.9199804Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.9200174Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9200922Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:12:58.9201641Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:12:58.9202456Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:12:58.9203141Z     await old_call(self, scope, receive, send)
2025-08-19T12:12:58.9203850Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.9204532Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.9204907Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9205563Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:12:58.9206249Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:12:58.9207006Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:12:58.9207520Z     raise exc
2025-08-19T12:12:58.9208086Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:12:58.9208636Z     await app(scope, receive, sender)
2025-08-19T12:12:58.9209211Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:12:58.9209749Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:12:58.9210349Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:12:58.9210847Z     await route.handle(scope, receive, send)
2025-08-19T12:12:58.9211631Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:12:58.9212151Z     await self.app(scope, receive, send)
2025-08-19T12:12:58.9212712Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:12:58.9213293Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:12:58.9214028Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:12:58.9214534Z     raise exc
2025-08-19T12:12:58.9215102Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:12:58.9215646Z     await app(scope, receive, sender)
2025-08-19T12:12:58.9216196Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:12:58.9216675Z     response = await f(request)
2025-08-19T12:12:58.9216921Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9217549Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:12:58.9218249Z     return await old_app(*args, **kwargs)
2025-08-19T12:12:58.9218531Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9219072Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:12:58.9219567Z     solved_result = await solve_dependencies(
2025-08-19T12:12:58.9220259Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:12:58.9220851Z     solved = await call(**solved_result.values)
2025-08-19T12:12:58.9221322Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9221966Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:12:58.9222486Z     pexpire = await self._check(key)
2025-08-19T12:12:58.9222749Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9223461Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:12:58.9223980Z     pexpire = await redis.evalsha(
2025-08-19T12:12:58.9224733Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:12:58.9225446Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:12:58.9225814Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9226466Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:12:58.9227031Z     return await conn.retry.call_with_retry(
2025-08-19T12:12:58.9227664Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:12:58.9228163Z     return await do()
2025-08-19T12:12:58.9228371Z            ^^^^^^^^^^
2025-08-19T12:12:58.9229362Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:12:58.9230552Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:12:58.9231366Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9232510Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:12:58.9233518Z     response = await connection.read_response()
2025-08-19T12:12:58.9234004Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9234662Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:12:58.9235228Z     await self.disconnect(nowait=True)
2025-08-19T12:12:58.9235853Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:12:58.9236435Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:12:58.9236722Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9237172Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:12:58.9237615Z     return self._transport.close()
2025-08-19T12:12:58.9237880Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9238385Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:12:58.9238815Z     super().close()
2025-08-19T12:12:58.9239284Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:12:58.9239796Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:12:58.9240363Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:12:58.9240796Z     self._check_closed()
2025-08-19T12:12:58.9241281Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:12:58.9241539Z 
2025-08-19T12:12:58.9241966Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:12:58.9242240Z 
2025-08-19T12:12:58.9242331Z     def _check_closed(self):
2025-08-19T12:12:58.9242558Z         if self._closed:
2025-08-19T12:12:58.9242851Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:12:58.9243201Z E           RuntimeError: Event loop is closed
2025-08-19T12:12:58.9243383Z 
2025-08-19T12:12:58.9243757Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:12:58.9244344Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:12:58.9350250Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "4f7150b17e96477e98ad515bf45f620a", "level": "error", "timestamp": "2025-08-19T12:12:56.294888Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f900540bd70>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f90055fb420>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f8ff4e35190>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f90053f6540>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f90055fb420>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='8524c1a\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f90087de8e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f90053f6540>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+60", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f90087de200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+119", "header_value": "None", "validation_failed": "False", "id_value": "4f7150b17e96477e98ad515bf45f620a", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f90055d0a'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='85\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f90180bec00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f8ff4e37080>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "conn": "<starlette.requests.Request object at 0x7f8ff4e37080>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "conn": "<starlette.requests.Request object at 0x7f8ff4e37080>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/kpi', name='kpi', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function kpi at 0x7f9007d9b600>, 'path_params': {}, 'route': APIRo\"+52"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/kpi', name='kpi', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f8ff4e832e0>", "request": "<starlette.requests.Request object at 0x7f8ff4e35760>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f8ff4e832e0>", "conn": "<starlette.requests.Request object at 0x7f8ff4e35760>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f8ff4e832e0>", "conn": "<starlette.requests.Request object at 0x7f8ff4e35760>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/kpi', '\"+1622", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f8ff4e35760>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f8ff4e35760>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f90053d3860>", "request": "<starlette.requests.Request object at 0x7f8ff4e35760>", "sentry_scope": "<Scope id=0x7f8ff47b3300 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f8ff4e'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f900522de40>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f8ff4e35760>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f8ff4e35550>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f8ff4e35520>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2077", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f9017e26e10>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f8ff4e35760>", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2077", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f8ff4e354f0>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f9017e26e10>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f8ff4e35520>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+461", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+461", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "use_path": "/stats/kpi", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f8f\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "request": "<starlette.requests.Request object at 0x7f8ff4e35760>", "response": "<starlette.responses.Response object at 0x7f8ff4e354f0>", "route_index": "11", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f900532bba0>", "callback": "<function http_default_callback at 0x7f9008a45760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:11:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "key": "fastapi-limiter:testclient:11:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:11:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f9005452c00>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f9008792840>", "set_db_data_fn": "<function _set_db_data at 0x7f9005676480>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f90052a4880>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f90055d20c0>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f90055d2160>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=18> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=18>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f90055d8ec0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f90055d8ec0>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f90055d8ec0>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=18>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:12:58.9429776Z WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7f90052b8230>: Failed to resolve 'selfhosted.invalid' ([Errno -2] Name or service not known)")': /api/1/envelope/
2025-08-19T12:12:58.9431231Z ______________________________ test_kpi_contract _______________________________
2025-08-19T12:12:58.9431483Z 
2025-08-19T12:12:58.9431578Z     def test_kpi_contract():
2025-08-19T12:12:58.9431848Z         client, up = client_with_auth()
2025-08-19T12:12:58.9432202Z         r = client.get("/stats/kpi", headers=_auth_headers(*up))
2025-08-19T12:12:58.9432560Z >       assert r.status_code == 200
2025-08-19T12:12:58.9432989Z E       assert 401 == 200
2025-08-19T12:12:58.9433316Z E        +  where 401 = <Response [401 Unauthorized]>.status_code
2025-08-19T12:12:58.9433536Z 
2025-08-19T12:12:58.9433773Z services/api/tests/test_stats_contracts.py:20: AssertionError
2025-08-19T12:12:58.9434255Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:12:58.9435309Z WARNING  services.api.errors:errors.py:39 {"status_code": 401, "detail": "Unauthorized", "event": "http_error", "request_id": "d0400202ab164dce9441c26f1852946c", "level": "warning", "timestamp": "2025-08-19T12:12:57.196312Z"}
2025-08-19T12:12:58.9436217Z _________________________ test_roi_by_vendor_contract __________________________
2025-08-19T12:12:58.9436453Z 
2025-08-19T12:12:58.9436574Z     def test_roi_by_vendor_contract():
2025-08-19T12:12:58.9436850Z         client, up = client_with_auth()
2025-08-19T12:12:58.9437253Z >       r = client.get("/stats/roi_by_vendor", headers=_auth_headers(*up))
2025-08-19T12:12:58.9437754Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9437947Z 
2025-08-19T12:12:58.9438120Z services/api/tests/test_stats_contracts.py:27: 
2025-08-19T12:12:58.9438508Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:12:58.9439121Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:479: in get
2025-08-19T12:12:58.9439609Z     return super().get(
2025-08-19T12:12:58.9440119Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1053: in get
2025-08-19T12:12:58.9440573Z     return self.request(
2025-08-19T12:12:58.9441231Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:451: in request
2025-08-19T12:12:58.9441722Z     return super().request(
2025-08-19T12:12:58.9442248Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:825: in request
2025-08-19T12:12:58.9442854Z     return self.send(request, auth=auth, follow_redirects=follow_redirects)
2025-08-19T12:12:58.9443254Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9443823Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/utils.py:1816: in runner
2025-08-19T12:12:58.9444353Z     return sentry_patched_function(*args, **kwargs)
2025-08-19T12:12:58.9444660Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9445268Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/httpx.py:86: in send
2025-08-19T12:12:58.9445809Z     rv = real_send(self, request, **kwargs)
2025-08-19T12:12:58.9446085Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9446613Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:914: in send
2025-08-19T12:12:58.9447097Z     response = self._send_handling_auth(
2025-08-19T12:12:58.9447708Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
2025-08-19T12:12:58.9448256Z     response = self._send_handling_redirects(
2025-08-19T12:12:58.9448895Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
2025-08-19T12:12:58.9449468Z     response = self._send_single_request(request)
2025-08-19T12:12:58.9449773Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9450382Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
2025-08-19T12:12:58.9450941Z     response = transport.handle_request(request)
2025-08-19T12:12:58.9451446Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9452067Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
2025-08-19T12:12:58.9452559Z     raise exc
2025-08-19T12:12:58.9453131Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
2025-08-19T12:12:58.9453812Z     portal.call(self.app, scope, receive, send)
2025-08-19T12:12:58.9454390Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:291: in call
2025-08-19T12:12:58.9455335Z     return cast(T_Retval, self.start_task_soon(func, *args).result())
2025-08-19T12:12:58.9455975Z                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9456694Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:456: in result
2025-08-19T12:12:58.9457315Z     return self.__get_result()
2025-08-19T12:12:58.9457574Z            ^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9458109Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
2025-08-19T12:12:58.9458584Z     raise self._exception
2025-08-19T12:12:58.9459134Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func
2025-08-19T12:12:58.9459825Z     retval = await retval_or_awaitable
2025-08-19T12:12:58.9460095Z              ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9460664Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__
2025-08-19T12:12:58.9461431Z     await super().__call__(scope, receive, send)
2025-08-19T12:12:58.9462192Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:408: in _sentry_patched_asgi_app
2025-08-19T12:12:58.9462836Z     return await middleware(scope, receive, send)
2025-08-19T12:12:58.9463154Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9463777Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:179: in _run_asgi3
2025-08-19T12:12:58.9464418Z     return await self._run_app(scope, receive, send, asgi_version=3)
2025-08-19T12:12:58.9464799Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9465714Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:268: in _run_app
2025-08-19T12:12:58.9466463Z     raise exc from None
2025-08-19T12:12:58.9467199Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/asgi.py:263: in _run_app
2025-08-19T12:12:58.9467712Z     return await self.app(
2025-08-19T12:12:58.9468287Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
2025-08-19T12:12:58.9468845Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:12:58.9469575Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.9470255Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.9470633Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9471397Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
2025-08-19T12:12:58.9471899Z     raise exc
2025-08-19T12:12:58.9472449Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
2025-08-19T12:12:58.9472984Z     await self.app(scope, receive, _send)
2025-08-19T12:12:58.9473681Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.9474357Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.9474725Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9475345Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__
2025-08-19T12:12:58.9475880Z     await self.app(scope, receive, send)
2025-08-19T12:12:58.9476574Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.9477417Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.9477786Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9478423Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py:90: in __call__
2025-08-19T12:12:58.9479019Z     await self.app(scope, receive, handle_outgoing_request)
2025-08-19T12:12:58.9479849Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:297: in _sentry_exceptionmiddleware_call
2025-08-19T12:12:58.9480522Z     await old_call(self, scope, receive, send)
2025-08-19T12:12:58.9481329Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py:199: in _create_span_call
2025-08-19T12:12:58.9482167Z     return await old_call(app, scope, new_receive, new_send, **kwargs)
2025-08-19T12:12:58.9482542Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9483189Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
2025-08-19T12:12:58.9483855Z     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
2025-08-19T12:12:58.9484603Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:12:58.9485119Z     raise exc
2025-08-19T12:12:58.9485681Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:12:58.9486219Z     await app(scope, receive, sender)
2025-08-19T12:12:58.9486794Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
2025-08-19T12:12:58.9487345Z     await self.middleware_stack(scope, receive, send)
2025-08-19T12:12:58.9487941Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:736: in app
2025-08-19T12:12:58.9488443Z     await route.handle(scope, receive, send)
2025-08-19T12:12:58.9489021Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:290: in handle
2025-08-19T12:12:58.9489521Z     await self.app(scope, receive, send)
2025-08-19T12:12:58.9490073Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:78: in app
2025-08-19T12:12:58.9490658Z     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
2025-08-19T12:12:58.9491606Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
2025-08-19T12:12:58.9492129Z     raise exc
2025-08-19T12:12:58.9492691Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
2025-08-19T12:12:58.9493239Z     await app(scope, receive, sender)
2025-08-19T12:12:58.9493795Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py:75: in app
2025-08-19T12:12:58.9494268Z     response = await f(request)
2025-08-19T12:12:58.9494516Z                ^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9495133Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py:137: in _sentry_app
2025-08-19T12:12:58.9495694Z     return await old_app(*args, **kwargs)
2025-08-19T12:12:58.9495966Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9496503Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py:292: in app
2025-08-19T12:12:58.9496994Z     solved_result = await solve_dependencies(
2025-08-19T12:12:58.9497681Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py:638: in solve_dependencies
2025-08-19T12:12:58.9498280Z     solved = await call(**solved_result.values)
2025-08-19T12:12:58.9498571Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9499295Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:54: in __call__
2025-08-19T12:12:58.9499821Z     pexpire = await self._check(key)
2025-08-19T12:12:58.9500084Z               ^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9500654Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py:30: in _check
2025-08-19T12:12:58.9501321Z     pexpire = await redis.evalsha(
2025-08-19T12:12:58.9502123Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py:106: in _sentry_execute_command
2025-08-19T12:12:58.9502838Z     value = await old_execute_command(self, name, *args, **kwargs)
2025-08-19T12:12:58.9503198Z             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9503827Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:615: in execute_command
2025-08-19T12:12:58.9504580Z     return await conn.retry.call_with_retry(
2025-08-19T12:12:58.9505207Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py:59: in call_with_retry
2025-08-19T12:12:58.9505704Z     return await do()
2025-08-19T12:12:58.9505902Z            ^^^^^^^^^^
2025-08-19T12:12:58.9506528Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:589: in _send_command_parse_response
2025-08-19T12:12:58.9507200Z     return await self.parse_response(conn, command_name, **options)
2025-08-19T12:12:58.9507569Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9508186Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py:636: in parse_response
2025-08-19T12:12:58.9508747Z     response = await connection.read_response()
2025-08-19T12:12:58.9509047Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9509683Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:562: in read_response
2025-08-19T12:12:58.9510227Z     await self.disconnect(nowait=True)
2025-08-19T12:12:58.9510844Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py:418: in disconnect
2025-08-19T12:12:58.9511527Z     self._writer.close()  # type: ignore[union-attr]
2025-08-19T12:12:58.9511804Z     ^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9512253Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py:358: in close
2025-08-19T12:12:58.9512684Z     return self._transport.close()
2025-08-19T12:12:58.9512942Z            ^^^^^^^^^^^^^^^^^^^^^^^
2025-08-19T12:12:58.9513443Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:1213: in close
2025-08-19T12:12:58.9513869Z     super().close()
2025-08-19T12:12:58.9514339Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py:875: in close
2025-08-19T12:12:58.9514863Z     self._loop.call_soon(self._call_connection_lost, None)
2025-08-19T12:12:58.9515422Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:799: in call_soon
2025-08-19T12:12:58.9515853Z     self._check_closed()
2025-08-19T12:12:58.9516179Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-19T12:12:58.9516393Z 
2025-08-19T12:12:58.9516635Z self = <_UnixSelectorEventLoop running=False closed=True debug=False>
2025-08-19T12:12:58.9516902Z 
2025-08-19T12:12:58.9516989Z     def _check_closed(self):
2025-08-19T12:12:58.9517216Z         if self._closed:
2025-08-19T12:12:58.9517510Z >           raise RuntimeError('Event loop is closed')
2025-08-19T12:12:58.9517855Z E           RuntimeError: Event loop is closed
2025-08-19T12:12:58.9518037Z 
2025-08-19T12:12:58.9518406Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py:545: RuntimeError
2025-08-19T12:12:58.9518997Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:12:59.4017835Z ERROR    services.api.errors:errors.py:57 {"event": "unhandled_error", "request_id": "2f4a60a0d7db4325b658011032e3889c", "level": "error", "timestamp": "2025-08-19T12:12:57.206174Z", "exception": [{"exc_type": "RuntimeError", "exc_value": "Event loop is closed", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/errors.py", "lineno": 164, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.errors.ServerErrorMiddleware object at 0x7f900540bd70>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "_send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f8ff4ee7e20>", "exc": "RuntimeError('Event loop is closed')", "request": "<starlette.requests.Request object at 0x7f8ff4ece150>", "response_started": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.cors.CORSMiddleware object at 0x7f90053f6540>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "<function ServerErrorMiddleware.__call__.<locals>._send at 0x7f8ff4ee7e20>", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CORSMiddleware', trace_id='e438027\"+136", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_send", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CORSMiddleware", "old_call": "<function CORSMiddleware.__call__ at 0x7f90087de8e0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/cors.py", "lineno": 85, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.cors.CORSMiddleware object at 0x7f90053f6540>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "method": "GET", "headers": "\"Headers({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip, deflat\"+91", "origin": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'CorrelationIdMiddleware', trace_id\"+145", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "_sentry_send", "send_patched": "True", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "CorrelationIdMiddleware", "old_call": "<function CorrelationIdMiddleware.__call__ at 0x7f90087de200>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/middleware.py", "lineno": 90, "name": "__call__", "line": "", "locals": {"self": "'CorrelationIdMiddleware(app=<starlette.middleware.exceptions.ExceptionMiddleware'+286", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "headers": "\"MutableHeaders({'host': 'testserver', 'accept': '*/*', 'accept-encoding': 'gzip,\"+150", "header_value": "None", "validation_failed": "False", "id_value": "2f4a60a0d7db4325b658011032e3889c", "handle_outgoing_request": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 297, "name": "_sentry_exceptionmiddleware_call", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "old_call": "'<function _enable_span_for_middleware.<locals>._create_span_call at 0x7f90055d0a'+3"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/starlette.py", "lineno": 199, "name": "_create_span_call", "line": "", "locals": {"app": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function CorrelationIdMiddleware.__call__.<locals>.handle_outgoing_request at 0'+14", "kwargs": "{}", "integration": "'<sentry_sdk.integrations.starlette.StarletteIntegration object at 0x7f90051acfb0'+1", "name": "None", "source": "route", "middleware_span": "\"<Span(op='middleware.starlette', description:'ExceptionMiddleware', trace_id='e4\"+141", "_sentry_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "receive_name": "_sentry_receive", "receive_patched": "True", "new_receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "_sentry_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "send_name": "handle_outgoing_request", "send_patched": "False", "new_send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "middleware_name": "ExceptionMiddleware", "old_call": "<function ExceptionMiddleware.__call__ at 0x7f90180bec00>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/middleware/exceptions.py", "lineno": 63, "name": "__call__", "line": "", "locals": {"self": "<starlette.middleware.exceptions.ExceptionMiddleware object at 0x7f900525d280>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "conn": "<starlette.requests.Request object at 0x7f8ff47e01a0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "conn": "<starlette.requests.Request object at 0x7f8ff47e01a0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+25", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "conn": "<starlette.requests.Request object at 0x7f8ff47e01a0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 716, "name": "__call__", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 736, "name": "app", "line": "", "locals": {"self": "<fastapi.routing.APIRouter object at 0x7f900522af00>", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "partial": "None", "route": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "match": "<Match.FULL: 2>", "child_scope": "\"{'endpoint': <function roi_by_vendor at 0x7f9007d9bb00>, 'path_params': {}, 'rou\"+82"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 290, "name": "handle", "line": "", "locals": {"self": "APIRoute(path='/stats/roi_by_vendor', name='roi_by_vendor', methods=['GET'])", "scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 78, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f8ff4ee5300>", "request": "<starlette.requests.Request object at 0x7f8ff47e07a0>", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 53, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f8ff4ee5300>", "conn": "<starlette.requests.Request object at 0x7f8ff47e07a0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/_exception_handler.py", "lineno": 42, "name": "wrapped_app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "sender": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "handler": "None", "response_started": "False", "app": "<function request_response.<locals>.app.<locals>.app at 0x7f8ff4ee5300>", "conn": "<starlette.requests.Request object at 0x7f8ff47e07a0>", "exception_handlers": "\"{<class 'starlette.exceptions.HTTPException'>: <function patch_exception_middlew\"+822", "status_handlers": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/starlette/routing.py", "lineno": 75, "name": "app", "line": "", "locals": {"scope": "\"{'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/stats/roi_by_\"+1707", "receive": "'<function _enable_span_for_middleware.<locals>._create_span_call.<locals>._sentr'+28", "send": "'<function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0'+14", "f": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+32", "request": "<starlette.requests.Request object at 0x7f8ff47e07a0>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/fastapi.py", "lineno": 137, "name": "_sentry_app", "line": "", "locals": {"args": "(<starlette.requests.Request object at 0x7f8ff47e07a0>,)", "kwargs": "{}", "integration": "<sentry_sdk.integrations.fastapi.FastApiIntegration object at 0x7f90053d3860>", "request": "<starlette.requests.Request object at 0x7f8ff47e07a0>", "sentry_scope": "<Scope id=0x7f8ff4ef7920 name=fastapi type=ScopeType.ISOLATION>", "extractor": "'<sentry_sdk.integrations.starlette.StarletteRequestExtractor object at 0x7f8ff47'+6", "_make_request_event_processor": "'<function patch_get_request_handler.<locals>._sentry_get_request_handler.<locals'+71", "info": "{}", "old_app": "<function get_request_handler.<locals>.app at 0x7f900522e160>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/routing.py", "lineno": 292, "name": "app", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f8ff47e07a0>", "response": "None", "file_stack": "<contextlib.AsyncExitStack object at 0x7f8ff47e05c0>", "body": "None", "errors": "[]", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f8ff47e0590>", "actual_response_class": "<class 'starlette.responses.JSONResponse'>", "body_field": "None", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2137", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f9017e26e10>", "embed_body_fields": "False", "is_body_form": "None", "is_coroutine": "False", "response_field": "None", "response_model_by_alias": "True", "response_model_exclude": "None", "response_model_exclude_defaults": "False", "response_model_exclude_none": "False", "response_model_exclude_unset": "False", "response_model_include": "None", "status_code": "None"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi/dependencies/utils.py", "lineno": 638, "name": "solve_dependencies", "line": "", "locals": {"request": "<starlette.requests.Request object at 0x7f8ff47e07a0>", "dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+2137", "body": "None", "background_tasks": "None", "response": "<starlette.responses.Response object at 0x7f8ff47e0560>", "dependency_overrides_provider": "<fastapi.applications.FastAPI object at 0x7f9017e26e10>", "dependency_cache": "{}", "async_exit_stack": "<contextlib.AsyncExitStack object at 0x7f8ff47e0590>", "embed_body_fields": "False", "values": "{}", "errors": "[]", "sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "call": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "use_sub_dependant": "'Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], b'+471", "original_call": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "use_path": "/stats/roi_by_vendor", "solved_result": "\"SolvedDependency(values={'request': <starlette.requests.Request object at 0x7f8f\"+201"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 54, "name": "__call__", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "request": "<starlette.requests.Request object at 0x7f8ff47e07a0>", "response": "<starlette.responses.Response object at 0x7f8ff47e0560>", "route_index": "12", "dep_index": "0", "i": "15", "route": "APIRoute(path='/health', name='health', methods=['GET'])", "j": "0", "dependency": "Depends(RateLimiter)", "identifier": "<function client_ip_identifier at 0x7f900532bba0>", "callback": "<function http_default_callback at 0x7f9008a45760>", "rate_key": "testclient", "key": "fastapi-limiter:testclient:12:0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/depends.py", "lineno": 30, "name": "_check", "line": "", "locals": {"self": "<fastapi_limiter.depends.RateLimiter object at 0x7f900522b1d0>", "key": "fastapi-limiter:testclient:12:0", "redis": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sentry_sdk/integrations/redis/_async_common.py", "lineno": 106, "name": "_sentry_execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "name": "EVALSHA", "args": "\"('a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:testclient:12:0\"+18", "kwargs": "{}", "integration": "<sentry_sdk.integrations.redis.RedisIntegration object at 0x7f9005452c00>", "cache_properties": "\"{'op': None, 'description': 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 'key': (\"+172", "cache_span": "None", "db_properties": "'{\\'op\\': \\'db.redis\\', \\'description\\': \"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb8'+51", "db_span": "'<Span(op=\\'db.redis\\', description:\"EVALSHA \\'a3f9e982197e9e887f6b5dcb7ec273863bb83'+198", "RedisIntegration": "<class 'sentry_sdk.integrations.redis.RedisIntegration'>", "is_cluster": "False", "old_execute_command": "<function Redis.execute_command at 0x7f9008792840>", "set_db_data_fn": "<function _set_db_data at 0x7f9005676480>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 615, "name": "execute_command", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}", "pool": "'<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(ho'+31", "command_name": "EVALSHA", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/retry.py", "lineno": 59, "name": "call_with_retry", "line": "", "locals": {"self": "<redis.asyncio.retry.Retry object at 0x7f8fe4d431c0>", "do": "<function Redis.execute_command.<locals>.<lambda> at 0x7f8ff4ee5c60>", "fail": "<function Redis.execute_command.<locals>.<lambda> at 0x7f8ff4ee5760>", "failures": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 589, "name": "_send_command_parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "conn": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "args": "\"('EVALSHA', 'a3f9e982197e9e887f6b5dcb7ec273863bb83aad', 1, 'fastapi-limiter:test\"+29", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/client.py", "lineno": 636, "name": "parse_response", "line": "", "locals": {"self": "'<redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyn'+61", "connection": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "command_name": "EVALSHA", "options": "{}"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 562, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 418, "name": "disconnect", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "nowait": "True"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 358, "name": "close", "line": "", "locals": {"self": "'<StreamWriter transport=<_SelectorSocketTransport closing fd=19> reader=<StreamR'+58"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 1213, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=19>", "__class__": "<class 'asyncio.selector_events._SelectorSocketTransport'>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/selector_events.py", "lineno": 875, "name": "close", "line": "", "locals": {"self": "<_SelectorSocketTransport closing fd=19>"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 799, "name": "call_soon", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>", "callback": "'<bound method _SelectorSocketTransport._call_connection_lost of <_SelectorSocket'+25", "context": "None", "args": "(None,)"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/base_events.py", "lineno": 545, "name": "_check_closed", "line": "", "locals": {"self": "<_UnixSelectorEventLoop running=False closed=True debug=False>"}}]}, {"exc_type": "RuntimeError", "exc_value": "Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/from_thread.py:222> cb=[TaskGroup._spawn.<locals>.task_done() at /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending> attached to a different loop", "syntax_error": null, "is_cause": false, "frames": [{"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/asyncio/connection.py", "lineno": 542, "name": "read_response", "line": "", "locals": {"self": "<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>", "disable_decoding": "False", "timeout": "None", "disconnect_on_error": "True", "push_request": "False", "read_timeout": "None", "host_error": "localhost:6379"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 82, "name": "read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f8fe4523b60>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/resp2.py", "lineno": 90, "name": "_read_response", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f8fe4523b60>", "disable_decoding": "False"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/redis/_parsers/base.py", "lineno": 219, "name": "_readline", "line": "", "locals": {"self": "<redis._parsers.resp2._AsyncRESP2Parser object at 0x7f8fe4523b60>", "found": "-1", "tail": "b''"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 568, "name": "readline", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "sep": "b'\\n'", "seplen": "1"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 660, "name": "readuntil", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "separator": "b'\\n'", "seplen": "1", "offset": "0", "buflen": "0"}}, {"filename": "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/asyncio/streams.py", "lineno": 545, "name": "_wait_for_data", "line": "", "locals": {"self": "<StreamReader transport=<_SelectorSocketTransport closing fd=19>>", "func_name": "readuntil"}}]}]}
2025-08-19T12:12:59.4096345Z ___________________________ test_roi_trend_contract ____________________________
2025-08-19T12:12:59.4096615Z 
2025-08-19T12:12:59.4096736Z     def test_roi_trend_contract():
2025-08-19T12:12:59.4097032Z         client, up = client_with_auth()
2025-08-19T12:12:59.4097405Z         r = client.get("/stats/roi_trend", headers=_auth_headers(*up))
2025-08-19T12:12:59.4097804Z >       assert r.status_code == 200
2025-08-19T12:12:59.4098070Z E       assert 401 == 200
2025-08-19T12:12:59.4098408Z E        +  where 401 = <Response [401 Unauthorized]>.status_code
2025-08-19T12:12:59.4098630Z 
2025-08-19T12:12:59.4098874Z services/api/tests/test_stats_contracts.py:36: AssertionError
2025-08-19T12:12:59.4099355Z ------------------------------ Captured log call -------------------------------
2025-08-19T12:12:59.4100406Z WARNING  services.api.errors:errors.py:39 {"status_code": 401, "detail": "Unauthorized", "event": "http_error", "request_id": "2ab83894bd4a420185063f9c11cd848e", "level": "warning", "timestamp": "2025-08-19T12:12:58.006966Z"}
2025-08-19T12:12:59.4101378Z =============================== warnings summary ===============================
2025-08-19T12:12:59.4101732Z services/alert_bot/tests/test_smoke.py:5
2025-08-19T12:12:59.4103070Z   /home/runner/work/AWA-App/AWA-App/services/alert_bot/tests/test_smoke.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-08-19T12:12:59.4104430Z     import pkg_resources  # noqa: F401
2025-08-19T12:12:59.4104605Z 
2025-08-19T12:12:59.4104855Z Sentry is attempting to send 0 pending events
2025-08-19T12:12:59.4105165Z Waiting up to True seconds
2025-08-19T12:12:59.4105405Z Press Ctrl-C to quit
2025-08-19T12:12:59.4105697Z tests/api/test_ingest_endpoints.py: 12 warnings
2025-08-19T12:12:59.4106054Z tests/ingest/test_tasks_eager.py: 3 warnings
2025-08-19T12:12:59.4106359Z tests/test_api_fast.py: 1 warning
2025-08-19T12:12:59.4106638Z tests/test_health.py: 5 warnings
2025-08-19T12:12:59.4106909Z tests/test_smoke.py: 5 warnings
2025-08-19T12:12:59.4107198Z services/api/tests/test_cors.py: 1 warning
2025-08-19T12:12:59.4107555Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T12:12:59.4108031Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:12:59.4108386Z services/api/tests/test_rate_limit.py: 122 warnings
2025-08-19T12:12:59.4108769Z services/api/tests/test_roi_basic_auth.py: 4 warnings
2025-08-19T12:12:59.4109147Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T12:12:59.4109526Z services/api/tests/test_stats_contracts.py: 3 warnings
2025-08-19T12:12:59.4111088Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/asgi_correlation_id/extensions/sentry.py:27: DeprecationWarning: sentry_sdk.configure_scope is deprecated and will be removed in the next major version. Please consult our migration guide to learn how to migrate to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x#scope-configuring
2025-08-19T12:12:59.4112549Z     with configure_scope() as scope:
2025-08-19T12:12:59.4112716Z 
2025-08-19T12:12:59.4112882Z tests/api/test_ingest_endpoints.py: 3 warnings
2025-08-19T12:12:59.4113205Z tests/test_api_fast.py: 1 warning
2025-08-19T12:12:59.4113485Z tests/test_health.py: 5 warnings
2025-08-19T12:12:59.4113749Z tests/test_smoke.py: 5 warnings
2025-08-19T12:12:59.4114041Z services/api/tests/test_cors.py: 3 warnings
2025-08-19T12:12:59.4114389Z services/api/tests/test_errors_json.py: 2 warnings
2025-08-19T12:12:59.4114734Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:12:59.4115082Z services/api/tests/test_rate_limit.py: 2 warnings
2025-08-19T12:12:59.4115441Z services/api/tests/test_sentry_event.py: 1 warning
2025-08-19T12:12:59.4116385Z   /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/fastapi_limiter/__init__.py:89: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.1.
2025-08-19T12:12:59.4117173Z     await cls.redis.close()
2025-08-19T12:12:59.4117317Z 
2025-08-19T12:12:59.4117512Z tests/test_api_fast.py::test_health_endpoint
2025-08-19T12:12:59.4118633Z   /home/runner/work/AWA-App/AWA-App/tests/test_api_fast.py:13: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:12:59.4119646Z     return datetime.datetime.utcnow()
2025-08-19T12:12:59.4119824Z 
2025-08-19T12:12:59.4119949Z tests/test_api_fast.py: 1 warning
2025-08-19T12:12:59.4120226Z tests/test_health.py: 5 warnings
2025-08-19T12:12:59.4120498Z tests/test_smoke.py: 5 warnings
2025-08-19T12:12:59.4120788Z services/api/tests/test_cors.py: 1 warning
2025-08-19T12:12:59.4121258Z services/api/tests/test_health.py: 1 warning
2025-08-19T12:12:59.4121691Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T12:12:59.4122865Z   /home/runner/work/AWA-App/AWA-App/services/api/routes/health.py:24: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:12:59.4123976Z     app_now = datetime.utcnow().replace(tzinfo=timezone.utc)
2025-08-19T12:12:59.4124334Z 
2025-08-19T12:12:59.4124477Z tests/test_health.py::test_health[0]
2025-08-19T12:12:59.4124766Z tests/test_health.py::test_health[1]
2025-08-19T12:12:59.4125052Z tests/test_health.py::test_health[2]
2025-08-19T12:12:59.4125337Z tests/test_health.py::test_health[3]
2025-08-19T12:12:59.4125621Z tests/test_health.py::test_health[4]
2025-08-19T12:12:59.4126702Z   /home/runner/work/AWA-App/AWA-App/tests/test_health.py:22: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:12:59.4127710Z     return datetime.datetime.utcnow()
2025-08-19T12:12:59.4127885Z 
2025-08-19T12:12:59.4128014Z tests/test_smoke.py::test_health[0]
2025-08-19T12:12:59.4128302Z tests/test_smoke.py::test_health[1]
2025-08-19T12:12:59.4128583Z tests/test_smoke.py::test_health[2]
2025-08-19T12:12:59.4128977Z tests/test_smoke.py::test_health[3]
2025-08-19T12:12:59.4129269Z tests/test_smoke.py::test_health[4]
2025-08-19T12:12:59.4130346Z   /home/runner/work/AWA-App/AWA-App/tests/test_smoke.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:12:59.4131446Z     return datetime.datetime.utcnow()
2025-08-19T12:12:59.4131618Z 
2025-08-19T12:12:59.4131847Z services/api/tests/test_cors.py::test_cors_simple_get_allowed
2025-08-19T12:12:59.4133062Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_cors.py:27: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:12:59.4134104Z     return datetime.datetime.utcnow()
2025-08-19T12:12:59.4134281Z 
2025-08-19T12:12:59.4134471Z services/api/tests/test_health.py::test_health_route
2025-08-19T12:12:59.4135660Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_health.py:14: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:12:59.4136718Z     return datetime.datetime.utcnow()
2025-08-19T12:12:59.4136891Z 
2025-08-19T12:12:59.4137070Z services/api/tests/test_rate_limit.py: 102 warnings
2025-08-19T12:12:59.4138265Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_rate_limit.py:33: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-19T12:12:59.4139312Z     return datetime.datetime.utcnow()
2025-08-19T12:12:59.4149113Z 
2025-08-19T12:12:59.4149617Z services/api/tests/test_sentry_event.py::test_unhandled_exception_is_captured_and_tagged
2025-08-19T12:12:59.4151356Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_sentry_event.py:47: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
2025-08-19T12:12:59.4152616Z     hub = sentry_sdk.Hub.current
2025-08-19T12:12:59.4152790Z 
2025-08-19T12:12:59.4153065Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-08-19T12:12:59.4153556Z ================================ tests coverage ================================
2025-08-19T12:12:59.4154026Z _______________ coverage: platform linux, python 3.12.11-final-0 _______________
2025-08-19T12:12:59.4154292Z 
2025-08-19T12:12:59.4154453Z Coverage XML written to file coverage.xml
2025-08-19T12:12:59.4154866Z Required test coverage of 65% reached. Total coverage: 65.27%
2025-08-19T12:12:59.4155315Z =========================== short test summary info ============================
2025-08-19T12:12:59.4156143Z FAILED services/api/tests/test_roi_basic_auth.py::test_roi_basic_auth_good - RuntimeError: Event loop is closed
2025-08-19T12:12:59.4157031Z FAILED services/api/tests/test_roi_basic_auth.py::test_stats_contract_needs_basic_auth - RuntimeError: Event loop is closed
2025-08-19T12:12:59.4157805Z FAILED services/api/tests/test_stats_contracts.py::test_kpi_contract - assert 401 == 200
2025-08-19T12:12:59.4158299Z  +  where 401 = <Response [401 Unauthorized]>.status_code
2025-08-19T12:12:59.4158944Z FAILED services/api/tests/test_stats_contracts.py::test_roi_by_vendor_contract - RuntimeError: Event loop is closed
2025-08-19T12:12:59.4159701Z FAILED services/api/tests/test_stats_contracts.py::test_roi_trend_contract - assert 401 == 200
2025-08-19T12:12:59.4160206Z  +  where 401 = <Response [401 Unauthorized]>.status_code
2025-08-19T12:12:59.9255457Z ##[error]Process completed with exit code 1.
