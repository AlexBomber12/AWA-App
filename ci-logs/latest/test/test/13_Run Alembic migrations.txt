2025-08-21T21:09:02.2546288Z ##[group]Run alembic -c services/api/alembic.ini upgrade head
2025-08-21T21:09:02.2546741Z [36;1malembic -c services/api/alembic.ini upgrade head[0m
2025-08-21T21:09:02.2586767Z shell: /usr/bin/bash -e {0}
2025-08-21T21:09:02.2587007Z env:
2025-08-21T21:09:02.2587217Z   REDIS_URL: redis://localhost:6379/0
2025-08-21T21:09:02.2587506Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-21T21:09:02.2587760Z   TRUST_X_FORWARDED: 1
2025-08-21T21:09:02.2587968Z   PG_USER: postgres
2025-08-21T21:09:02.2588165Z   PG_PASSWORD: pass
2025-08-21T21:09:02.2588350Z   PG_DATABASE: awa
2025-08-21T21:09:02.2588530Z   PG_HOST: localhost
2025-08-21T21:09:02.2588723Z   PG_PORT: 5432
2025-08-21T21:09:02.2589172Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-21T21:09:02.2589595Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-21T21:09:02.2590008Z   DATABASE_URL: ***localhost:5432/awa
2025-08-21T21:09:02.2590255Z   DATA_DIR: /tmp/awa-data
2025-08-21T21:09:02.2590473Z   ENABLE_LIVE: 0
2025-08-21T21:09:02.2590656Z   TESTING: 1
2025-08-21T21:09:02.2590939Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:09:02.2591363Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-21T21:09:02.2591777Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:09:02.2592148Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:09:02.2592891Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:09:02.2593277Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-21T21:09:02.2593599Z   POSTGRES_USER: postgres
2025-08-21T21:09:02.2593817Z   POSTGRES_PASSWORD: pass
2025-08-21T21:09:02.2594024Z   POSTGRES_DB: awa
2025-08-21T21:09:02.2594214Z ##[endgroup]
2025-08-21T21:09:03.2576685Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-08-21T21:09:03.2577293Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-08-21T21:09:03.2798112Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_baseline
2025-08-21T21:09:03.2943255Z INFO  [alembic.runtime.migration] Running upgrade 0001_baseline -> 0002_create_roi_view
2025-08-21T21:09:03.2969743Z INFO  [alembic.runtime.migration] Running upgrade 0002_create_roi_view -> 3e9d5c5aff2c
2025-08-21T21:09:03.3134909Z INFO  [alembic.runtime.migration] Running upgrade 3e9d5c5aff2c -> 0003_vendor_prices
2025-08-21T21:09:03.3279463Z INFO  [alembic.runtime.migration] Running upgrade 0003_vendor_prices -> 0004_fee_cron
2025-08-21T21:09:03.3350240Z INFO  [alembic.runtime.migration] Running upgrade 0004_fee_cron -> 0006_fix_roi_views
2025-08-21T21:09:03.3384295Z INFO  [alembic.runtime.migration] Running upgrade 0006_fix_roi_views -> 0020_unified_schema
2025-08-21T21:09:03.3493012Z INFO  [alembic.runtime.migration] Running upgrade 0020_unified_schema -> 0022_fix_roi_view
2025-08-21T21:09:03.3569600Z INFO  [alembic.runtime.migration] Running upgrade 0022_fix_roi_view -> 0023_add_storage_fee
2025-08-21T21:09:03.3606003Z INFO  [alembic.runtime.migration] Running upgrade 0023_add_storage_fee -> 0024_create_buybox
2025-08-21T21:09:03.3633419Z INFO  [alembic.runtime.migration] Running upgrade 0024_create_buybox -> 0025_pr4_indexes_loadlog
2025-08-21T21:09:03.3843183Z INFO  [alembic.runtime.migration] Running upgrade 0025_pr4_indexes_loadlog -> 0026_fix_refund_views
2025-08-21T21:09:03.3901587Z INFO  [alembic.runtime.migration] Running upgrade 0025_pr4_indexes_loadlog -> 0026_amazon_new_reports
2025-08-21T21:09:03.4094798Z INFO  [alembic.runtime.migration] Running upgrade 0026_amazon_new_reports, 0026_fix_refund_views -> 0027_merge_reports_and_refund_heads
2025-08-21T21:09:03.4160351Z Traceback (most recent call last):
2025-08-21T21:09:03.4161604Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
2025-08-21T21:09:03.4165413Z     self.dialect.do_execute(
2025-08-21T21:09:03.4166840Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
2025-08-21T21:09:03.4168454Z     cursor.execute(statement, parameters)
2025-08-21T21:09:03.4169581Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-21T21:09:03.4170669Z     raise ex.with_traceback(None)
2025-08-21T21:09:03.4171655Z psycopg.errors.StringDataRightTruncation: value too long for type character varying(32)
2025-08-21T21:09:03.4172535Z 
2025-08-21T21:09:03.4173021Z The above exception was the direct cause of the following exception:
2025-08-21T21:09:03.4173513Z 
2025-08-21T21:09:03.4173786Z Traceback (most recent call last):
2025-08-21T21:09:03.4174614Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/bin/alembic", line 7, in <module>
2025-08-21T21:09:03.4175304Z     sys.exit(main())
2025-08-21T21:09:03.4176052Z              ^^^^^^
2025-08-21T21:09:03.4177028Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 1016, in main
2025-08-21T21:09:03.4178071Z     CommandLine(prog=prog).main(argv=argv)
2025-08-21T21:09:03.4179191Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 1006, in main
2025-08-21T21:09:03.4180902Z     self.run_cmd(cfg, options)
2025-08-21T21:09:03.4181973Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 940, in run_cmd
2025-08-21T21:09:03.4183420Z     fn(
2025-08-21T21:09:03.4184405Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/command.py", line 483, in upgrade
2025-08-21T21:09:03.4185380Z     script.run_env()
2025-08-21T21:09:03.4186443Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/script/base.py", line 549, in run_env
2025-08-21T21:09:03.4187542Z     util.load_python_file(self.dir, "env.py")
2025-08-21T21:09:03.4189869Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 116, in load_python_file
2025-08-21T21:09:03.4191071Z     module = load_module_py(module_id, path)
2025-08-21T21:09:03.4191614Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:09:03.4192966Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 136, in load_module_py
2025-08-21T21:09:03.4194142Z     spec.loader.exec_module(module)  # type: ignore
2025-08-21T21:09:03.4194709Z     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:09:03.4195431Z   File "<frozen importlib._bootstrap_external>", line 999, in exec_module
2025-08-21T21:09:03.4196427Z   File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
2025-08-21T21:09:03.4197530Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 55, in <module>
2025-08-21T21:09:03.4198337Z     run_migrations_online()
2025-08-21T21:09:03.4199329Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 51, in run_migrations_online
2025-08-21T21:09:03.4200245Z     context.run_migrations()
2025-08-21T21:09:03.4200803Z   File "<string>", line 8, in run_migrations
2025-08-21T21:09:03.4202047Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/environment.py", line 946, in run_migrations
2025-08-21T21:09:03.4203360Z     self.get_context().run_migrations(**kw)
2025-08-21T21:09:03.4204596Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 634, in run_migrations
2025-08-21T21:09:03.4205756Z     head_maintainer.update_to_step(step)
2025-08-21T21:09:03.4206991Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 847, in update_to_step
2025-08-21T21:09:03.4208187Z     self._update_version(update_from_rev, update_to_rev)
2025-08-21T21:09:03.4209495Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 801, in _update_version
2025-08-21T21:09:03.4210616Z     ret = self.context.impl._exec(
2025-08-21T21:09:03.4211366Z           ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:09:03.4212570Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/ddl/impl.py", line 246, in _exec
2025-08-21T21:09:03.4213564Z     return conn.execute(construct, params)
2025-08-21T21:09:03.4214087Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:09:03.4215227Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
2025-08-21T21:09:03.4216182Z     return meth(
2025-08-21T21:09:03.4216502Z            ^^^^^
2025-08-21T21:09:03.4217644Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
2025-08-21T21:09:03.4218822Z     return connection._execute_clauseelement(
2025-08-21T21:09:03.4219371Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:09:03.4220616Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
2025-08-21T21:09:03.4221751Z     ret = self._execute_context(
2025-08-21T21:09:03.4222195Z           ^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:09:03.4223513Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
2025-08-21T21:09:03.4224905Z     return self._exec_single_context(
2025-08-21T21:09:03.4225422Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:09:03.4226627Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
2025-08-21T21:09:03.4227785Z     self._handle_dbapi_exception(
2025-08-21T21:09:03.4229024Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
2025-08-21T21:09:03.4230396Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-08-21T21:09:03.4231793Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
2025-08-21T21:09:03.4233068Z     self.dialect.do_execute(
2025-08-21T21:09:03.4234203Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
2025-08-21T21:09:03.4235283Z     cursor.execute(statement, parameters)
2025-08-21T21:09:03.4236221Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-21T21:09:03.4237066Z     raise ex.with_traceback(None)
2025-08-21T21:09:03.4238121Z sqlalchemy.exc.DataError: (psycopg.errors.StringDataRightTruncation) value too long for type character varying(32)
2025-08-21T21:09:03.4239730Z [SQL: UPDATE alembic_version SET version_num='0027_merge_reports_and_refund_heads' WHERE alembic_version.version_num = '0026_fix_refund_views']
2025-08-21T21:09:03.4240836Z (Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-21T21:09:03.5000368Z ##[error]Process completed with exit code 1.
