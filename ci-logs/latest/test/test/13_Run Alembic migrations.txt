2025-08-21T21:04:44.5771264Z ##[group]Run alembic -c services/api/alembic.ini upgrade head
2025-08-21T21:04:44.5771708Z [36;1malembic -c services/api/alembic.ini upgrade head[0m
2025-08-21T21:04:44.5811973Z shell: /usr/bin/bash -e {0}
2025-08-21T21:04:44.5812233Z env:
2025-08-21T21:04:44.5812462Z   REDIS_URL: redis://localhost:6379/0
2025-08-21T21:04:44.5812759Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-21T21:04:44.5813020Z   TRUST_X_FORWARDED: 1
2025-08-21T21:04:44.5813240Z   PG_USER: postgres
2025-08-21T21:04:44.5813453Z   PG_PASSWORD: pass
2025-08-21T21:04:44.5813663Z   PG_DATABASE: awa
2025-08-21T21:04:44.5814039Z   PG_HOST: localhost
2025-08-21T21:04:44.5814250Z   PG_PORT: 5432
2025-08-21T21:04:44.5814705Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-21T21:04:44.5815161Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-21T21:04:44.5815614Z   DATABASE_URL: ***localhost:5432/awa
2025-08-21T21:04:44.5815885Z   DATA_DIR: /tmp/awa-data
2025-08-21T21:04:44.5816113Z   ENABLE_LIVE: 0
2025-08-21T21:04:44.5816311Z   TESTING: 1
2025-08-21T21:04:44.5816606Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:04:44.5817056Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-21T21:04:44.5817505Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:04:44.5817901Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:04:44.5818301Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:04:44.5818700Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-21T21:04:44.5819048Z   POSTGRES_USER: postgres
2025-08-21T21:04:44.5819291Z   POSTGRES_PASSWORD: pass
2025-08-21T21:04:44.5819512Z   POSTGRES_DB: awa
2025-08-21T21:04:44.5819719Z ##[endgroup]
2025-08-21T21:04:45.2774743Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-08-21T21:04:45.2776205Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-08-21T21:04:45.3028806Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_baseline
2025-08-21T21:04:45.3188341Z INFO  [alembic.runtime.migration] Running upgrade 0001_baseline -> 0002_create_roi_view
2025-08-21T21:04:45.3216754Z INFO  [alembic.runtime.migration] Running upgrade 0002_create_roi_view -> 3e9d5c5aff2c
2025-08-21T21:04:45.3397356Z INFO  [alembic.runtime.migration] Running upgrade 3e9d5c5aff2c -> 0003_vendor_prices
2025-08-21T21:04:45.3546134Z INFO  [alembic.runtime.migration] Running upgrade 0003_vendor_prices -> 0004_fee_cron
2025-08-21T21:04:45.3623432Z INFO  [alembic.runtime.migration] Running upgrade 0004_fee_cron -> 0006_fix_roi_views
2025-08-21T21:04:45.3658181Z INFO  [alembic.runtime.migration] Running upgrade 0006_fix_roi_views -> 0020_unified_schema
2025-08-21T21:04:45.3772638Z INFO  [alembic.runtime.migration] Running upgrade 0020_unified_schema -> 0022_fix_roi_view
2025-08-21T21:04:45.3842680Z INFO  [alembic.runtime.migration] Running upgrade 0022_fix_roi_view -> 0023_add_storage_fee
2025-08-21T21:04:45.3882580Z INFO  [alembic.runtime.migration] Running upgrade 0023_add_storage_fee -> 0024_create_buybox
2025-08-21T21:04:45.3911581Z INFO  [alembic.runtime.migration] Running upgrade 0024_create_buybox -> 0025_pr4_indexes_loadlog
2025-08-21T21:04:45.4141233Z INFO  [alembic.runtime.migration] Running upgrade 0025_pr4_indexes_loadlog -> 0026_fix_refund_views
2025-08-21T21:04:45.4204313Z INFO  [alembic.runtime.migration] Running upgrade 0025_pr4_indexes_loadlog -> 0026_amazon_new_reports
2025-08-21T21:04:45.4423878Z INFO  [alembic.runtime.migration] Running upgrade 0026_amazon_new_reports, 0026_fix_refund_views -> 0027_merge_reports_and_refund_heads
2025-08-21T21:04:45.4487205Z Traceback (most recent call last):
2025-08-21T21:04:45.4488824Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
2025-08-21T21:04:45.4493182Z     self.dialect.do_execute(
2025-08-21T21:04:45.4494905Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
2025-08-21T21:04:45.4496896Z     cursor.execute(statement, parameters)
2025-08-21T21:04:45.4498481Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-21T21:04:45.4499943Z     raise ex.with_traceback(None)
2025-08-21T21:04:45.4501530Z psycopg.errors.StringDataRightTruncation: value too long for type character varying(32)
2025-08-21T21:04:45.4502489Z 
2025-08-21T21:04:45.4503069Z The above exception was the direct cause of the following exception:
2025-08-21T21:04:45.4503838Z 
2025-08-21T21:04:45.4504113Z Traceback (most recent call last):
2025-08-21T21:04:45.4505004Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/bin/alembic", line 7, in <module>
2025-08-21T21:04:45.4505786Z     sys.exit(main())
2025-08-21T21:04:45.4506171Z              ^^^^^^
2025-08-21T21:04:45.4507223Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 1016, in main
2025-08-21T21:04:45.4508342Z     CommandLine(prog=prog).main(argv=argv)
2025-08-21T21:04:45.4509574Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 1006, in main
2025-08-21T21:04:45.4510828Z     self.run_cmd(cfg, options)
2025-08-21T21:04:45.4512000Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 940, in run_cmd
2025-08-21T21:04:45.4512967Z     fn(
2025-08-21T21:04:45.4513835Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/command.py", line 483, in upgrade
2025-08-21T21:04:45.4514709Z     script.run_env()
2025-08-21T21:04:45.4515665Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/script/base.py", line 549, in run_env
2025-08-21T21:04:45.4516634Z     util.load_python_file(self.dir, "env.py")
2025-08-21T21:04:45.4517779Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 116, in load_python_file
2025-08-21T21:04:45.4518820Z     module = load_module_py(module_id, path)
2025-08-21T21:04:45.4519316Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:04:45.4520807Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 136, in load_module_py
2025-08-21T21:04:45.4521936Z     spec.loader.exec_module(module)  # type: ignore
2025-08-21T21:04:45.4522483Z     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:04:45.4523161Z   File "<frozen importlib._bootstrap_external>", line 999, in exec_module
2025-08-21T21:04:45.4524067Z   File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
2025-08-21T21:04:45.4525096Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 55, in <module>
2025-08-21T21:04:45.4525828Z     run_migrations_online()
2025-08-21T21:04:45.4526734Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 51, in run_migrations_online
2025-08-21T21:04:45.4527566Z     context.run_migrations()
2025-08-21T21:04:45.4528072Z   File "<string>", line 8, in run_migrations
2025-08-21T21:04:45.4529245Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/environment.py", line 946, in run_migrations
2025-08-21T21:04:45.4530478Z     self.get_context().run_migrations(**kw)
2025-08-21T21:04:45.4531639Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 634, in run_migrations
2025-08-21T21:04:45.4532676Z     head_maintainer.update_to_step(step)
2025-08-21T21:04:45.4533830Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 847, in update_to_step
2025-08-21T21:04:45.4534931Z     self._update_version(update_from_rev, update_to_rev)
2025-08-21T21:04:45.4536134Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 801, in _update_version
2025-08-21T21:04:45.4537219Z     ret = self.context.impl._exec(
2025-08-21T21:04:45.4537920Z           ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:04:45.4538903Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/ddl/impl.py", line 246, in _exec
2025-08-21T21:04:45.4539839Z     return conn.execute(construct, params)
2025-08-21T21:04:45.4540455Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:04:45.4541316Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
2025-08-21T21:04:45.4541974Z     return meth(
2025-08-21T21:04:45.4542516Z            ^^^^^
2025-08-21T21:04:45.4543395Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
2025-08-21T21:04:45.4544031Z     return connection._execute_clauseelement(
2025-08-21T21:04:45.4544333Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:04:45.4545010Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
2025-08-21T21:04:45.4546024Z     ret = self._execute_context(
2025-08-21T21:04:45.4546365Z           ^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:04:45.4547000Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
2025-08-21T21:04:45.4548085Z     return self._exec_single_context(
2025-08-21T21:04:45.4548551Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:04:45.4549613Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
2025-08-21T21:04:45.4550227Z     self._handle_dbapi_exception(
2025-08-21T21:04:45.4551108Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
2025-08-21T21:04:45.4551841Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-08-21T21:04:45.4552607Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
2025-08-21T21:04:45.4553199Z     self.dialect.do_execute(
2025-08-21T21:04:45.4553819Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
2025-08-21T21:04:45.4554417Z     cursor.execute(statement, parameters)
2025-08-21T21:04:45.4554990Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-21T21:04:45.4555518Z     raise ex.with_traceback(None)
2025-08-21T21:04:45.4556140Z sqlalchemy.exc.DataError: (psycopg.errors.StringDataRightTruncation) value too long for type character varying(32)
2025-08-21T21:04:45.4557086Z [SQL: UPDATE alembic_version SET version_num='0027_merge_reports_and_refund_heads' WHERE alembic_version.version_num = '0026_fix_refund_views']
2025-08-21T21:04:45.4557770Z (Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-21T21:04:45.5375768Z ##[error]Process completed with exit code 1.
