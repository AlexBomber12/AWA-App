2025-08-17T19:38:55.8099392Z ##[group]Run alembic -c services/api/alembic.ini upgrade head
2025-08-17T19:38:55.8099839Z [36;1malembic -c services/api/alembic.ini upgrade head[0m
2025-08-17T19:38:55.8137430Z shell: /usr/bin/bash -e {0}
2025-08-17T19:38:55.8137665Z env:
2025-08-17T19:38:55.8137838Z   PG_USER: postgres
2025-08-17T19:38:55.8138042Z   PG_PASSWORD: pass
2025-08-17T19:38:55.8138234Z   PG_DATABASE: awa
2025-08-17T19:38:55.8138437Z   PG_HOST: localhost
2025-08-17T19:38:55.8138628Z   PG_PORT: 5432
2025-08-17T19:38:55.8139034Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-17T19:38:55.8139444Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-17T19:38:55.8139836Z   DATABASE_URL: ***localhost:5432/awa
2025-08-17T19:38:55.8140075Z   DATA_DIR: /tmp/awa-data
2025-08-17T19:38:55.8140276Z   ENABLE_LIVE: 0
2025-08-17T19:38:55.8140449Z   TESTING: 1
2025-08-17T19:38:55.8140690Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-17T19:38:55.8141345Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-17T19:38:55.8141784Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-17T19:38:55.8142141Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-17T19:38:55.8142500Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-17T19:38:55.8142861Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-17T19:38:55.8143175Z   POSTGRES_USER: postgres
2025-08-17T19:38:55.8143579Z   POSTGRES_PASSWORD: pass
2025-08-17T19:38:55.8143785Z   POSTGRES_DB: awa
2025-08-17T19:38:55.8143970Z ##[endgroup]
2025-08-17T19:38:56.5636794Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-08-17T19:38:56.5637934Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-08-17T19:38:56.5791645Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_baseline
2025-08-17T19:38:56.5930975Z INFO  [alembic.runtime.migration] Running upgrade 0001_baseline -> 0002_create_roi_view
2025-08-17T19:38:56.5956753Z INFO  [alembic.runtime.migration] Running upgrade 0002_create_roi_view -> 3e9d5c5aff2c
2025-08-17T19:38:56.6115772Z INFO  [alembic.runtime.migration] Running upgrade 3e9d5c5aff2c -> 0003_vendor_prices
2025-08-17T19:38:56.6249802Z INFO  [alembic.runtime.migration] Running upgrade 0003_vendor_prices -> 0004_fee_cron
2025-08-17T19:38:56.6319522Z INFO  [alembic.runtime.migration] Running upgrade 0004_fee_cron -> 0006_fix_roi_views
2025-08-17T19:38:56.6351291Z INFO  [alembic.runtime.migration] Running upgrade 0006_fix_roi_views -> 0020_unified_schema
2025-08-17T19:38:56.6456806Z INFO  [alembic.runtime.migration] Running upgrade 0020_unified_schema -> 0022_fix_roi_view
2025-08-17T19:38:56.6519550Z INFO  [alembic.runtime.migration] Running upgrade 0022_fix_roi_view -> 0023_add_storage_fee
2025-08-17T19:38:56.6555716Z INFO  [alembic.runtime.migration] Running upgrade 0023_add_storage_fee -> 0024_create_buybox
2025-08-17T19:38:56.6578206Z INFO  [alembic.runtime.migration] Running upgrade 0024_create_buybox -> 0025_pr4_indexes_loadlog
2025-08-17T19:38:56.6720062Z Traceback (most recent call last):
2025-08-17T19:38:56.6722596Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1971, in _exec_single_context
2025-08-17T19:38:56.6726111Z     self.dialect.do_execute(
2025-08-17T19:38:56.6727684Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 919, in do_execute
2025-08-17T19:38:56.6728829Z     cursor.execute(statement, parameters)
2025-08-17T19:38:56.6729903Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-17T19:38:56.6731083Z     raise ex.with_traceback(None)
2025-08-17T19:38:56.6731830Z psycopg.errors.UndefinedColumn: column "reimb_id" does not exist
2025-08-17T19:38:56.6733041Z CONTEXT:  SQL statement "CREATE UNIQUE INDEX uq_reimbursements_raw_reimb_id ON reimbursements_raw(reimb_id)"
2025-08-17T19:38:56.6734083Z PL/pgSQL function inline_code_block line 5 at SQL statement
2025-08-17T19:38:56.6734812Z 
2025-08-17T19:38:56.6735275Z The above exception was the direct cause of the following exception:
2025-08-17T19:38:56.6735744Z 
2025-08-17T19:38:56.6735971Z Traceback (most recent call last):
2025-08-17T19:38:56.6736748Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/bin/alembic", line 7, in <module>
2025-08-17T19:38:56.6737415Z     sys.exit(main())
2025-08-17T19:38:56.6737759Z              ^^^^^^
2025-08-17T19:38:56.6738643Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 641, in main
2025-08-17T19:38:56.6739543Z     CommandLine(prog=prog).main(argv=argv)
2025-08-17T19:38:56.6740479Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 631, in main
2025-08-17T19:38:56.6741542Z     self.run_cmd(cfg, options)
2025-08-17T19:38:56.6742471Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 608, in run_cmd
2025-08-17T19:38:56.6743298Z     fn(
2025-08-17T19:38:56.6744426Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/command.py", line 403, in upgrade
2025-08-17T19:38:56.6745418Z     script.run_env()
2025-08-17T19:38:56.6746085Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/script/base.py", line 583, in run_env
2025-08-17T19:38:56.6746693Z     util.load_python_file(self.dir, "env.py")
2025-08-17T19:38:56.6748085Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 95, in load_python_file
2025-08-17T19:38:56.6748780Z     module = load_module_py(module_id, path)
2025-08-17T19:38:56.6749281Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:38:56.6750350Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 113, in load_module_py
2025-08-17T19:38:56.6751342Z     spec.loader.exec_module(module)  # type: ignore
2025-08-17T19:38:56.6751655Z     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:38:56.6752065Z   File "<frozen importlib._bootstrap_external>", line 999, in exec_module
2025-08-17T19:38:56.6752592Z   File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
2025-08-17T19:38:56.6753208Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 55, in <module>
2025-08-17T19:38:56.6753764Z     run_migrations_online()
2025-08-17T19:38:56.6754690Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 51, in run_migrations_online
2025-08-17T19:38:56.6755379Z     context.run_migrations()
2025-08-17T19:38:56.6755879Z   File "<string>", line 8, in run_migrations
2025-08-17T19:38:56.6757053Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/environment.py", line 948, in run_migrations
2025-08-17T19:38:56.6758150Z     self.get_context().run_migrations(**kw)
2025-08-17T19:38:56.6759312Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 627, in run_migrations
2025-08-17T19:38:56.6759911Z     step.migration_fn(**kw)
2025-08-17T19:38:56.6760517Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/versions/0025_pr4_indexes_loadlog.py", line 36, in upgrade
2025-08-17T19:38:56.6761347Z     op.execute(
2025-08-17T19:38:56.6761602Z   File "<string>", line 8, in execute
2025-08-17T19:38:56.6761908Z   File "<string>", line 3, in execute
2025-08-17T19:38:56.6762524Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/operations/ops.py", line 2537, in execute
2025-08-17T19:38:56.6763487Z     return operations.invoke(op)
2025-08-17T19:38:56.6763785Z            ^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:38:56.6764375Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/operations/base.py", line 445, in invoke
2025-08-17T19:38:56.6764929Z     return fn(self, operation)
2025-08-17T19:38:56.6765174Z            ^^^^^^^^^^^^^^^^^^^
2025-08-17T19:38:56.6766396Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/operations/toimpl.py", line 224, in execute_sql
2025-08-17T19:38:56.6767035Z     operations.migration_context.impl.execute(
2025-08-17T19:38:56.6767661Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/ddl/impl.py", line 214, in execute
2025-08-17T19:38:56.6768252Z     self._exec(sql, execution_options)
2025-08-17T19:38:56.6769252Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/ddl/impl.py", line 207, in _exec
2025-08-17T19:38:56.6769829Z     return conn.execute(construct, multiparams)
2025-08-17T19:38:56.6770138Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:38:56.6771035Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1422, in execute
2025-08-17T19:38:56.6771630Z     return meth(
2025-08-17T19:38:56.6772055Z            ^^^^^
2025-08-17T19:38:56.6772936Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 514, in _execute_on_connection
2025-08-17T19:38:56.6773609Z     return connection._execute_clauseelement(
2025-08-17T19:38:56.6773910Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:38:56.6774598Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1644, in _execute_clauseelement
2025-08-17T19:38:56.6775392Z     ret = self._execute_context(
2025-08-17T19:38:56.6775652Z           ^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:38:56.6776286Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1850, in _execute_context
2025-08-17T19:38:56.6776888Z     return self._exec_single_context(
2025-08-17T19:38:56.6777322Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:38:56.6778376Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1990, in _exec_single_context
2025-08-17T19:38:56.6779001Z     self._handle_dbapi_exception(
2025-08-17T19:38:56.6779677Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2357, in _handle_dbapi_exception
2025-08-17T19:38:56.6780497Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-08-17T19:38:56.6781741Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1971, in _exec_single_context
2025-08-17T19:38:56.6782463Z     self.dialect.do_execute(
2025-08-17T19:38:56.6783539Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 919, in do_execute
2025-08-17T19:38:56.6784557Z     cursor.execute(statement, parameters)
2025-08-17T19:38:56.6785167Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-17T19:38:56.6785715Z     raise ex.with_traceback(None)
2025-08-17T19:38:56.6786281Z sqlalchemy.exc.ProgrammingError: (psycopg.errors.UndefinedColumn) column "reimb_id" does not exist
2025-08-17T19:38:56.6787083Z CONTEXT:  SQL statement "CREATE UNIQUE INDEX uq_reimbursements_raw_reimb_id ON reimbursements_raw(reimb_id)"
2025-08-17T19:38:56.6787684Z PL/pgSQL function inline_code_block line 5 at SQL statement
2025-08-17T19:38:56.6787995Z [SQL: 
2025-08-17T19:38:56.6788173Z         DO $$ BEGIN
2025-08-17T19:38:56.6788369Z             IF NOT EXISTS (
2025-08-17T19:38:56.6788834Z                 SELECT 1 FROM pg_indexes WHERE schemaname='public' AND indexname='uq_reimbursements_raw_reimb_id'
2025-08-17T19:38:56.6789257Z             ) THEN
2025-08-17T19:38:56.6789655Z                 CREATE UNIQUE INDEX uq_reimbursements_raw_reimb_id ON reimbursements_raw(reimb_id);
2025-08-17T19:38:56.6790039Z             END IF;
2025-08-17T19:38:56.6790221Z         END $$;
2025-08-17T19:38:56.6790395Z         ]
2025-08-17T19:38:56.6790907Z (Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-17T19:38:56.7446175Z ##[error]Process completed with exit code 1.
