2025-08-17T19:36:47.8862930Z ##[group]Run alembic -c services/api/alembic.ini upgrade head
2025-08-17T19:36:47.8863383Z [36;1malembic -c services/api/alembic.ini upgrade head[0m
2025-08-17T19:36:47.8903844Z shell: /usr/bin/bash -e {0}
2025-08-17T19:36:47.8904087Z env:
2025-08-17T19:36:47.8904259Z   PG_USER: postgres
2025-08-17T19:36:47.8904466Z   PG_PASSWORD: pass
2025-08-17T19:36:47.8904661Z   PG_DATABASE: awa
2025-08-17T19:36:47.8904848Z   PG_HOST: localhost
2025-08-17T19:36:47.8905039Z   PG_PORT: 5432
2025-08-17T19:36:47.8905465Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-17T19:36:47.8905894Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-17T19:36:47.8906680Z   DATABASE_URL: ***localhost:5432/awa
2025-08-17T19:36:47.8906935Z   DATA_DIR: /tmp/awa-data
2025-08-17T19:36:47.8907148Z   ENABLE_LIVE: 0
2025-08-17T19:36:47.8907323Z   TESTING: 1
2025-08-17T19:36:47.8907567Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-17T19:36:47.8907987Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-17T19:36:47.8908421Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-17T19:36:47.8908797Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-17T19:36:47.8909171Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-17T19:36:47.8909539Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-17T19:36:47.8909854Z   POSTGRES_USER: postgres
2025-08-17T19:36:47.8910077Z   POSTGRES_PASSWORD: pass
2025-08-17T19:36:47.8910283Z   POSTGRES_DB: awa
2025-08-17T19:36:47.8910468Z ##[endgroup]
2025-08-17T19:36:48.8425084Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-08-17T19:36:48.8426084Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-08-17T19:36:48.8582060Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_baseline
2025-08-17T19:36:48.8726013Z INFO  [alembic.runtime.migration] Running upgrade 0001_baseline -> 0002_create_roi_view
2025-08-17T19:36:48.8751840Z INFO  [alembic.runtime.migration] Running upgrade 0002_create_roi_view -> 3e9d5c5aff2c
2025-08-17T19:36:48.8917695Z INFO  [alembic.runtime.migration] Running upgrade 3e9d5c5aff2c -> 0003_vendor_prices
2025-08-17T19:36:48.9054352Z INFO  [alembic.runtime.migration] Running upgrade 0003_vendor_prices -> 0004_fee_cron
2025-08-17T19:36:48.9125402Z INFO  [alembic.runtime.migration] Running upgrade 0004_fee_cron -> 0006_fix_roi_views
2025-08-17T19:36:48.9157876Z INFO  [alembic.runtime.migration] Running upgrade 0006_fix_roi_views -> 0020_unified_schema
2025-08-17T19:36:48.9265998Z INFO  [alembic.runtime.migration] Running upgrade 0020_unified_schema -> 0022_fix_roi_view
2025-08-17T19:36:48.9329742Z INFO  [alembic.runtime.migration] Running upgrade 0022_fix_roi_view -> 0023_add_storage_fee
2025-08-17T19:36:48.9366972Z INFO  [alembic.runtime.migration] Running upgrade 0023_add_storage_fee -> 0024_create_buybox
2025-08-17T19:36:48.9389456Z INFO  [alembic.runtime.migration] Running upgrade 0024_create_buybox -> 0025_pr4_indexes_loadlog
2025-08-17T19:36:48.9529222Z Traceback (most recent call last):
2025-08-17T19:36:48.9532175Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1971, in _exec_single_context
2025-08-17T19:36:48.9535645Z     self.dialect.do_execute(
2025-08-17T19:36:48.9537157Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 919, in do_execute
2025-08-17T19:36:48.9538241Z     cursor.execute(statement, parameters)
2025-08-17T19:36:48.9539296Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-17T19:36:48.9540310Z     raise ex.with_traceback(None)
2025-08-17T19:36:48.9541045Z psycopg.errors.UndefinedColumn: column "reimb_id" does not exist
2025-08-17T19:36:48.9542233Z CONTEXT:  SQL statement "CREATE UNIQUE INDEX uq_reimbursements_raw_reimb_id ON reimbursements_raw(reimb_id)"
2025-08-17T19:36:48.9543264Z PL/pgSQL function inline_code_block line 5 at SQL statement
2025-08-17T19:36:48.9543986Z 
2025-08-17T19:36:48.9544421Z The above exception was the direct cause of the following exception:
2025-08-17T19:36:48.9544866Z 
2025-08-17T19:36:48.9545095Z Traceback (most recent call last):
2025-08-17T19:36:48.9545866Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/bin/alembic", line 7, in <module>
2025-08-17T19:36:48.9546841Z     sys.exit(main())
2025-08-17T19:36:48.9547183Z              ^^^^^^
2025-08-17T19:36:48.9548090Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 641, in main
2025-08-17T19:36:48.9549008Z     CommandLine(prog=prog).main(argv=argv)
2025-08-17T19:36:48.9550222Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 631, in main
2025-08-17T19:36:48.9551133Z     self.run_cmd(cfg, options)
2025-08-17T19:36:48.9552045Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 608, in run_cmd
2025-08-17T19:36:48.9552871Z     fn(
2025-08-17T19:36:48.9553736Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/command.py", line 403, in upgrade
2025-08-17T19:36:48.9554602Z     script.run_env()
2025-08-17T19:36:48.9555713Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/script/base.py", line 583, in run_env
2025-08-17T19:36:48.9556918Z     util.load_python_file(self.dir, "env.py")
2025-08-17T19:36:48.9557774Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 95, in load_python_file
2025-08-17T19:36:48.9558554Z     module = load_module_py(module_id, path)
2025-08-17T19:36:48.9558870Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:36:48.9559537Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 113, in load_module_py
2025-08-17T19:36:48.9560378Z     spec.loader.exec_module(module)  # type: ignore
2025-08-17T19:36:48.9560861Z     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:36:48.9561553Z   File "<frozen importlib._bootstrap_external>", line 999, in exec_module
2025-08-17T19:36:48.9562282Z   File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
2025-08-17T19:36:48.9562936Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 55, in <module>
2025-08-17T19:36:48.9563387Z     run_migrations_online()
2025-08-17T19:36:48.9563932Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 51, in run_migrations_online
2025-08-17T19:36:48.9564724Z     context.run_migrations()
2025-08-17T19:36:48.9565237Z   File "<string>", line 8, in run_migrations
2025-08-17T19:36:48.9566077Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/environment.py", line 948, in run_migrations
2025-08-17T19:36:48.9567221Z     self.get_context().run_migrations(**kw)
2025-08-17T19:36:48.9567935Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 627, in run_migrations
2025-08-17T19:36:48.9568578Z     step.migration_fn(**kw)
2025-08-17T19:36:48.9569383Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/versions/0025_pr4_indexes_loadlog.py", line 36, in upgrade
2025-08-17T19:36:48.9570016Z     op.execute(
2025-08-17T19:36:48.9570301Z   File "<string>", line 8, in execute
2025-08-17T19:36:48.9570608Z   File "<string>", line 3, in execute
2025-08-17T19:36:48.9571473Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/operations/ops.py", line 2537, in execute
2025-08-17T19:36:48.9572137Z     return operations.invoke(op)
2025-08-17T19:36:48.9572465Z            ^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:36:48.9573173Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/operations/base.py", line 445, in invoke
2025-08-17T19:36:48.9573747Z     return fn(self, operation)
2025-08-17T19:36:48.9573993Z            ^^^^^^^^^^^^^^^^^^^
2025-08-17T19:36:48.9574916Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/operations/toimpl.py", line 224, in execute_sql
2025-08-17T19:36:48.9575642Z     operations.migration_context.impl.execute(
2025-08-17T19:36:48.9576634Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/ddl/impl.py", line 214, in execute
2025-08-17T19:36:48.9577247Z     self._exec(sql, execution_options)
2025-08-17T19:36:48.9577948Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/ddl/impl.py", line 207, in _exec
2025-08-17T19:36:48.9578783Z     return conn.execute(construct, multiparams)
2025-08-17T19:36:48.9579101Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:36:48.9579733Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1422, in execute
2025-08-17T19:36:48.9580280Z     return meth(
2025-08-17T19:36:48.9580462Z            ^^^^^
2025-08-17T19:36:48.9581111Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 514, in _execute_on_connection
2025-08-17T19:36:48.9581926Z     return connection._execute_clauseelement(
2025-08-17T19:36:48.9582312Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:36:48.9583014Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1644, in _execute_clauseelement
2025-08-17T19:36:48.9583671Z     ret = self._execute_context(
2025-08-17T19:36:48.9584213Z           ^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:36:48.9585355Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1850, in _execute_context
2025-08-17T19:36:48.9586676Z     return self._exec_single_context(
2025-08-17T19:36:48.9586977Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-17T19:36:48.9587670Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1990, in _exec_single_context
2025-08-17T19:36:48.9590942Z     self._handle_dbapi_exception(
2025-08-17T19:36:48.9592063Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2357, in _handle_dbapi_exception
2025-08-17T19:36:48.9594593Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-08-17T19:36:48.9595965Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1971, in _exec_single_context
2025-08-17T19:36:48.9597827Z     self.dialect.do_execute(
2025-08-17T19:36:48.9598961Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 919, in do_execute
2025-08-17T19:36:48.9600016Z     cursor.execute(statement, parameters)
2025-08-17T19:36:48.9601047Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-17T19:36:48.9602001Z     raise ex.with_traceback(None)
2025-08-17T19:36:48.9602995Z sqlalchemy.exc.ProgrammingError: (psycopg.errors.UndefinedColumn) column "reimb_id" does not exist
2025-08-17T19:36:48.9604210Z CONTEXT:  SQL statement "CREATE UNIQUE INDEX uq_reimbursements_raw_reimb_id ON reimbursements_raw(reimb_id)"
2025-08-17T19:36:48.9604845Z PL/pgSQL function inline_code_block line 5 at SQL statement
2025-08-17T19:36:48.9605164Z [SQL: 
2025-08-17T19:36:48.9605347Z         DO $$ BEGIN
2025-08-17T19:36:48.9605551Z             IF NOT EXISTS (
2025-08-17T19:36:48.9606029Z                 SELECT 1 FROM pg_indexes WHERE schemaname='public' AND indexname='uq_reimbursements_raw_reimb_id'
2025-08-17T19:36:48.9606671Z             ) THEN
2025-08-17T19:36:48.9607082Z                 CREATE UNIQUE INDEX uq_reimbursements_raw_reimb_id ON reimbursements_raw(reimb_id);
2025-08-17T19:36:48.9607488Z             END IF;
2025-08-17T19:36:48.9607667Z         END $$;
2025-08-17T19:36:48.9607849Z         ]
2025-08-17T19:36:48.9608180Z (Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-17T19:36:49.0324627Z ##[error]Process completed with exit code 1.
