2025-08-21T21:08:08.5546646Z ##[group]Run alembic -c services/api/alembic.ini upgrade head
2025-08-21T21:08:08.5547339Z [36;1malembic -c services/api/alembic.ini upgrade head[0m
2025-08-21T21:08:08.5606569Z shell: /usr/bin/bash -e {0}
2025-08-21T21:08:08.5607025Z env:
2025-08-21T21:08:08.5607387Z   REDIS_URL: redis://localhost:6379/0
2025-08-21T21:08:08.5607842Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-21T21:08:08.5608214Z   TRUST_X_FORWARDED: 1
2025-08-21T21:08:08.5608548Z   PG_USER: postgres
2025-08-21T21:08:08.5608865Z   PG_PASSWORD: pass
2025-08-21T21:08:08.5609540Z   PG_DATABASE: awa
2025-08-21T21:08:08.5610079Z   PG_HOST: localhost
2025-08-21T21:08:08.5610415Z   PG_PORT: 5432
2025-08-21T21:08:08.5611436Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-21T21:08:08.5612131Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-21T21:08:08.5612886Z   DATABASE_URL: ***localhost:5432/awa
2025-08-21T21:08:08.5613328Z   DATA_DIR: /tmp/awa-data
2025-08-21T21:08:08.5613695Z   ENABLE_LIVE: 0
2025-08-21T21:08:08.5614022Z   TESTING: 1
2025-08-21T21:08:08.5614515Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:08:08.5615210Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-21T21:08:08.5615893Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:08:08.5616498Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:08:08.5617101Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:08:08.5617716Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-21T21:08:08.5618186Z ##[endgroup]
2025-08-21T21:08:09.5157312Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-08-21T21:08:09.5158050Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-08-21T21:08:09.5401526Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_baseline
2025-08-21T21:08:09.5602795Z INFO  [alembic.runtime.migration] Running upgrade 0001_baseline -> 0002_create_roi_view
2025-08-21T21:08:09.5643317Z INFO  [alembic.runtime.migration] Running upgrade 0002_create_roi_view -> 3e9d5c5aff2c
2025-08-21T21:08:09.5958047Z INFO  [alembic.runtime.migration] Running upgrade 3e9d5c5aff2c -> 0003_vendor_prices
2025-08-21T21:08:09.6190395Z INFO  [alembic.runtime.migration] Running upgrade 0003_vendor_prices -> 0004_fee_cron
2025-08-21T21:08:09.6284539Z INFO  [alembic.runtime.migration] Running upgrade 0004_fee_cron -> 0006_fix_roi_views
2025-08-21T21:08:09.6324662Z INFO  [alembic.runtime.migration] Running upgrade 0006_fix_roi_views -> 0020_unified_schema
2025-08-21T21:08:09.6500504Z INFO  [alembic.runtime.migration] Running upgrade 0020_unified_schema -> 0022_fix_roi_view
2025-08-21T21:08:09.6660344Z INFO  [alembic.runtime.migration] Running upgrade 0022_fix_roi_view -> 0023_add_storage_fee
2025-08-21T21:08:09.6726016Z INFO  [alembic.runtime.migration] Running upgrade 0023_add_storage_fee -> 0024_create_buybox
2025-08-21T21:08:09.6773949Z INFO  [alembic.runtime.migration] Running upgrade 0024_create_buybox -> 0025_pr4_indexes_loadlog
2025-08-21T21:08:09.7125360Z INFO  [alembic.runtime.migration] Running upgrade 0025_pr4_indexes_loadlog -> 0026_fix_refund_views
2025-08-21T21:08:09.7206789Z INFO  [alembic.runtime.migration] Running upgrade 0025_pr4_indexes_loadlog -> 0026_amazon_new_reports
2025-08-21T21:08:09.7425119Z INFO  [alembic.runtime.migration] Running upgrade 0026_amazon_new_reports, 0026_fix_refund_views -> 0027_merge_reports_and_refund_heads
2025-08-21T21:08:09.7496971Z Traceback (most recent call last):
2025-08-21T21:08:09.7508131Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
2025-08-21T21:08:09.7508893Z     self.dialect.do_execute(
2025-08-21T21:08:09.7510053Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
2025-08-21T21:08:09.7511002Z     cursor.execute(statement, parameters)
2025-08-21T21:08:09.7511885Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-21T21:08:09.7513185Z     raise ex.with_traceback(None)
2025-08-21T21:08:09.7513860Z psycopg.errors.StringDataRightTruncation: value too long for type character varying(32)
2025-08-21T21:08:09.7514422Z 
2025-08-21T21:08:09.7514697Z The above exception was the direct cause of the following exception:
2025-08-21T21:08:09.7515120Z 
2025-08-21T21:08:09.7515264Z Traceback (most recent call last):
2025-08-21T21:08:09.7515897Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/bin/alembic", line 7, in <module>
2025-08-21T21:08:09.7516733Z     sys.exit(main())
2025-08-21T21:08:09.7517029Z              ^^^^^^
2025-08-21T21:08:09.7517768Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 1016, in main
2025-08-21T21:08:09.7518600Z     CommandLine(prog=prog).main(argv=argv)
2025-08-21T21:08:09.7519424Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 1006, in main
2025-08-21T21:08:09.7520359Z     self.run_cmd(cfg, options)
2025-08-21T21:08:09.7521129Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 940, in run_cmd
2025-08-21T21:08:09.7521905Z     fn(
2025-08-21T21:08:09.7522637Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/command.py", line 483, in upgrade
2025-08-21T21:08:09.7523487Z     script.run_env()
2025-08-21T21:08:09.7524278Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/script/base.py", line 549, in run_env
2025-08-21T21:08:09.7525186Z     util.load_python_file(self.dir, "env.py")
2025-08-21T21:08:09.7526203Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 116, in load_python_file
2025-08-21T21:08:09.7527119Z     module = load_module_py(module_id, path)
2025-08-21T21:08:09.7527544Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:08:09.7530032Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 136, in load_module_py
2025-08-21T21:08:09.7531098Z     spec.loader.exec_module(module)  # type: ignore
2025-08-21T21:08:09.7531561Z     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:08:09.7532166Z   File "<frozen importlib._bootstrap_external>", line 999, in exec_module
2025-08-21T21:08:09.7532960Z   File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
2025-08-21T21:08:09.7533860Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 55, in <module>
2025-08-21T21:08:09.7534554Z     run_migrations_online()
2025-08-21T21:08:09.7535315Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 51, in run_migrations_online
2025-08-21T21:08:09.7536076Z     context.run_migrations()
2025-08-21T21:08:09.7536515Z   File "<string>", line 8, in run_migrations
2025-08-21T21:08:09.7537512Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/environment.py", line 946, in run_migrations
2025-08-21T21:08:09.7538480Z     self.get_context().run_migrations(**kw)
2025-08-21T21:08:09.7539460Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 634, in run_migrations
2025-08-21T21:08:09.7540569Z     head_maintainer.update_to_step(step)
2025-08-21T21:08:09.7541531Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 847, in update_to_step
2025-08-21T21:08:09.7542527Z     self._update_version(update_from_rev, update_to_rev)
2025-08-21T21:08:09.7543539Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 801, in _update_version
2025-08-21T21:08:09.7544463Z     ret = self.context.impl._exec(
2025-08-21T21:08:09.7544838Z           ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:08:09.7545644Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/ddl/impl.py", line 246, in _exec
2025-08-21T21:08:09.7546821Z     return conn.execute(construct, params)
2025-08-21T21:08:09.7547235Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:08:09.7548111Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
2025-08-21T21:08:09.7548948Z     return meth(
2025-08-21T21:08:09.7549238Z            ^^^^^
2025-08-21T21:08:09.7550299Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
2025-08-21T21:08:09.7551265Z     return connection._execute_clauseelement(
2025-08-21T21:08:09.7551724Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:08:09.7552640Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
2025-08-21T21:08:09.7553246Z     ret = self._execute_context(
2025-08-21T21:08:09.7553480Z           ^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:08:09.7554023Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
2025-08-21T21:08:09.7554568Z     return self._exec_single_context(
2025-08-21T21:08:09.7554958Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:08:09.7555864Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
2025-08-21T21:08:09.7556438Z     self._handle_dbapi_exception(
2025-08-21T21:08:09.7557387Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
2025-08-21T21:08:09.7558499Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-08-21T21:08:09.7559388Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
2025-08-21T21:08:09.7560187Z     self.dialect.do_execute(
2025-08-21T21:08:09.7560738Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
2025-08-21T21:08:09.7561279Z     cursor.execute(statement, parameters)
2025-08-21T21:08:09.7561786Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-21T21:08:09.7562277Z     raise ex.with_traceback(None)
2025-08-21T21:08:09.7562770Z sqlalchemy.exc.DataError: (psycopg.errors.StringDataRightTruncation) value too long for type character varying(32)
2025-08-21T21:08:09.7563550Z [SQL: UPDATE alembic_version SET version_num='0027_merge_reports_and_refund_heads' WHERE alembic_version.version_num = '0026_fix_refund_views']
2025-08-21T21:08:09.7564157Z (Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-21T21:08:09.9099330Z ##[error]Process completed with exit code 1.
