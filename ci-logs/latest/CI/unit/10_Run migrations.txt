2025-08-21T21:03:48.0724734Z ##[group]Run alembic -c services/api/alembic.ini upgrade head
2025-08-21T21:03:48.0725160Z [36;1malembic -c services/api/alembic.ini upgrade head[0m
2025-08-21T21:03:48.0766733Z shell: /usr/bin/bash -e {0}
2025-08-21T21:03:48.0766962Z env:
2025-08-21T21:03:48.0767403Z   REDIS_URL: redis://localhost:6379/0
2025-08-21T21:03:48.0767697Z   RATE_LIMIT_DEFAULT: 100/minute
2025-08-21T21:03:48.0767914Z   TRUST_X_FORWARDED: 1
2025-08-21T21:03:48.0768110Z   PG_USER: postgres
2025-08-21T21:03:48.0768299Z   PG_PASSWORD: pass
2025-08-21T21:03:48.0768472Z   PG_DATABASE: awa
2025-08-21T21:03:48.0768649Z   PG_HOST: localhost
2025-08-21T21:03:48.0768828Z   PG_PORT: 5432
2025-08-21T21:03:48.0769252Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-21T21:03:48.0769630Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-21T21:03:48.0769991Z   DATABASE_URL: ***localhost:5432/awa
2025-08-21T21:03:48.0770225Z   DATA_DIR: /tmp/awa-data
2025-08-21T21:03:48.0770425Z   ENABLE_LIVE: 0
2025-08-21T21:03:48.0770597Z   TESTING: 1
2025-08-21T21:03:48.0770861Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:03:48.0771248Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-21T21:03:48.0771643Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:03:48.0771987Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:03:48.0772328Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-21T21:03:48.0772673Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-21T21:03:48.0772963Z ##[endgroup]
2025-08-21T21:03:48.6566322Z INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
2025-08-21T21:03:48.6567356Z INFO  [alembic.runtime.migration] Will assume transactional DDL.
2025-08-21T21:03:48.6769149Z INFO  [alembic.runtime.migration] Running upgrade  -> 0001_baseline
2025-08-21T21:03:48.6918707Z INFO  [alembic.runtime.migration] Running upgrade 0001_baseline -> 0002_create_roi_view
2025-08-21T21:03:48.6944437Z INFO  [alembic.runtime.migration] Running upgrade 0002_create_roi_view -> 3e9d5c5aff2c
2025-08-21T21:03:48.7106160Z INFO  [alembic.runtime.migration] Running upgrade 3e9d5c5aff2c -> 0003_vendor_prices
2025-08-21T21:03:48.7265644Z INFO  [alembic.runtime.migration] Running upgrade 0003_vendor_prices -> 0004_fee_cron
2025-08-21T21:03:48.7337306Z INFO  [alembic.runtime.migration] Running upgrade 0004_fee_cron -> 0006_fix_roi_views
2025-08-21T21:03:48.7369910Z INFO  [alembic.runtime.migration] Running upgrade 0006_fix_roi_views -> 0020_unified_schema
2025-08-21T21:03:48.7485093Z INFO  [alembic.runtime.migration] Running upgrade 0020_unified_schema -> 0022_fix_roi_view
2025-08-21T21:03:48.7556388Z INFO  [alembic.runtime.migration] Running upgrade 0022_fix_roi_view -> 0023_add_storage_fee
2025-08-21T21:03:48.7593294Z INFO  [alembic.runtime.migration] Running upgrade 0023_add_storage_fee -> 0024_create_buybox
2025-08-21T21:03:48.7621804Z INFO  [alembic.runtime.migration] Running upgrade 0024_create_buybox -> 0025_pr4_indexes_loadlog
2025-08-21T21:03:48.7844695Z INFO  [alembic.runtime.migration] Running upgrade 0025_pr4_indexes_loadlog -> 0026_fix_refund_views
2025-08-21T21:03:48.7902047Z INFO  [alembic.runtime.migration] Running upgrade 0025_pr4_indexes_loadlog -> 0026_amazon_new_reports
2025-08-21T21:03:48.8109265Z INFO  [alembic.runtime.migration] Running upgrade 0026_amazon_new_reports, 0026_fix_refund_views -> 0027_merge_reports_and_refund_heads
2025-08-21T21:03:48.8172164Z Traceback (most recent call last):
2025-08-21T21:03:48.8184145Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
2025-08-21T21:03:48.8185351Z     self.dialect.do_execute(
2025-08-21T21:03:48.8186449Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
2025-08-21T21:03:48.8187692Z     cursor.execute(statement, parameters)
2025-08-21T21:03:48.8188710Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-21T21:03:48.8189997Z     raise ex.with_traceback(None)
2025-08-21T21:03:48.8190739Z psycopg.errors.StringDataRightTruncation: value too long for type character varying(32)
2025-08-21T21:03:48.8191429Z 
2025-08-21T21:03:48.8191742Z The above exception was the direct cause of the following exception:
2025-08-21T21:03:48.8192199Z 
2025-08-21T21:03:48.8192353Z Traceback (most recent call last):
2025-08-21T21:03:48.8193050Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/bin/alembic", line 7, in <module>
2025-08-21T21:03:48.8193719Z     sys.exit(main())
2025-08-21T21:03:48.8194029Z              ^^^^^^
2025-08-21T21:03:48.8194846Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 1016, in main
2025-08-21T21:03:48.8195788Z     CommandLine(prog=prog).main(argv=argv)
2025-08-21T21:03:48.8196706Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 1006, in main
2025-08-21T21:03:48.8197804Z     self.run_cmd(cfg, options)
2025-08-21T21:03:48.8198728Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/config.py", line 940, in run_cmd
2025-08-21T21:03:48.8199619Z     fn(
2025-08-21T21:03:48.8200439Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/command.py", line 483, in upgrade
2025-08-21T21:03:48.8201327Z     script.run_env()
2025-08-21T21:03:48.8202232Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/script/base.py", line 549, in run_env
2025-08-21T21:03:48.8203207Z     util.load_python_file(self.dir, "env.py")
2025-08-21T21:03:48.8204309Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 116, in load_python_file
2025-08-21T21:03:48.8205358Z     module = load_module_py(module_id, path)
2025-08-21T21:03:48.8205831Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:03:48.8206907Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/util/pyfiles.py", line 136, in load_module_py
2025-08-21T21:03:48.8208181Z     spec.loader.exec_module(module)  # type: ignore
2025-08-21T21:03:48.8208666Z     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:03:48.8209302Z   File "<frozen importlib._bootstrap_external>", line 999, in exec_module
2025-08-21T21:03:48.8210149Z   File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
2025-08-21T21:03:48.8211131Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 55, in <module>
2025-08-21T21:03:48.8211903Z     run_migrations_online()
2025-08-21T21:03:48.8212775Z   File "/home/runner/work/AWA-App/AWA-App/services/api/migrations/env.py", line 51, in run_migrations_online
2025-08-21T21:03:48.8213634Z     context.run_migrations()
2025-08-21T21:03:48.8214112Z   File "<string>", line 8, in run_migrations
2025-08-21T21:03:48.8215209Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/environment.py", line 946, in run_migrations
2025-08-21T21:03:48.8216298Z     self.get_context().run_migrations(**kw)
2025-08-21T21:03:48.8217835Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 634, in run_migrations
2025-08-21T21:03:48.8218904Z     head_maintainer.update_to_step(step)
2025-08-21T21:03:48.8219996Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 847, in update_to_step
2025-08-21T21:03:48.8221105Z     self._update_version(update_from_rev, update_to_rev)
2025-08-21T21:03:48.8222263Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/runtime/migration.py", line 801, in _update_version
2025-08-21T21:03:48.8223293Z     ret = self.context.impl._exec(
2025-08-21T21:03:48.8223690Z           ^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:03:48.8224572Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/alembic/ddl/impl.py", line 246, in _exec
2025-08-21T21:03:48.8225757Z     return conn.execute(construct, params)
2025-08-21T21:03:48.8226211Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:03:48.8227382Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
2025-08-21T21:03:48.8228346Z     return meth(
2025-08-21T21:03:48.8228629Z            ^^^^^
2025-08-21T21:03:48.8229630Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
2025-08-21T21:03:48.8230761Z     return connection._execute_clauseelement(
2025-08-21T21:03:48.8231213Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:03:48.8232305Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
2025-08-21T21:03:48.8233364Z     ret = self._execute_context(
2025-08-21T21:03:48.8233752Z           ^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:03:48.8234745Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
2025-08-21T21:03:48.8235822Z     return self._exec_single_context(
2025-08-21T21:03:48.8236226Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-08-21T21:03:48.8237446Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
2025-08-21T21:03:48.8238510Z     self._handle_dbapi_exception(
2025-08-21T21:03:48.8239611Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
2025-08-21T21:03:48.8240906Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-08-21T21:03:48.8242154Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
2025-08-21T21:03:48.8245337Z     self.dialect.do_execute(
2025-08-21T21:03:48.8246416Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
2025-08-21T21:03:48.8247928Z     cursor.execute(statement, parameters)
2025-08-21T21:03:48.8248945Z   File "/opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/psycopg/cursor.py", line 97, in execute
2025-08-21T21:03:48.8249853Z     raise ex.with_traceback(None)
2025-08-21T21:03:48.8250702Z sqlalchemy.exc.DataError: (psycopg.errors.StringDataRightTruncation) value too long for type character varying(32)
2025-08-21T21:03:48.8252013Z [SQL: UPDATE alembic_version SET version_num='0027_merge_reports_and_refund_heads' WHERE alembic_version.version_num = '0026_fix_refund_views']
2025-08-21T21:03:48.8253027Z (Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-08-21T21:03:48.8958397Z ##[error]Process completed with exit code 1.
