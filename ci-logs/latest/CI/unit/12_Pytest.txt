2025-08-16T21:34:38.9650497Z ##[group]Run pytest -q --cov=services
2025-08-16T21:34:38.9650823Z [36;1mpytest -q --cov=services[0m
2025-08-16T21:34:38.9690798Z shell: /usr/bin/bash -e {0}
2025-08-16T21:34:38.9691025Z env:
2025-08-16T21:34:38.9691213Z   PG_USER: postgres
2025-08-16T21:34:38.9691407Z   PG_PASSWORD: pass
2025-08-16T21:34:38.9691578Z   PG_DATABASE: awa
2025-08-16T21:34:38.9691760Z   PG_HOST: localhost
2025-08-16T21:34:38.9691947Z   PG_PORT: 5432
2025-08-16T21:34:38.9692370Z   PG_SYNC_DSN: ***localhost:5432/awa
2025-08-16T21:34:38.9692855Z   PG_ASYNC_DSN: ***localhost:5432/awa
2025-08-16T21:34:38.9693236Z   DATABASE_URL: ***localhost:5432/awa
2025-08-16T21:34:38.9693468Z   DATA_DIR: /tmp/awa-data
2025-08-16T21:34:38.9693921Z   ENABLE_LIVE: 0
2025-08-16T21:34:38.9694097Z   TESTING: 1
2025-08-16T21:34:38.9694338Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-16T21:34:38.9694731Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib/pkgconfig
2025-08-16T21:34:38.9695113Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-16T21:34:38.9695485Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-16T21:34:38.9695835Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.11/x64
2025-08-16T21:34:38.9696181Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.11/x64/lib
2025-08-16T21:34:38.9696465Z ##[endgroup]
2025-08-16T21:34:49.0733276Z .....s.............................F.................................... [ 58%]
2025-08-16T21:35:20.3564752Z ...................................................                      [100%]
2025-08-16T21:35:20.3576426Z =================================== FAILURES ===================================
2025-08-16T21:35:20.3577077Z ____________________________ test_api_image_builds _____________________________
2025-08-16T21:35:20.3577460Z 
2025-08-16T21:35:20.3577767Z     @pytest.mark.skipif(shutil.which("docker") is None, reason="docker not available")
2025-08-16T21:35:20.3578210Z     def test_api_image_builds() -> None:
2025-08-16T21:35:20.3578516Z         env = {**os.environ, "DOCKER_BUILDKIT": "1"}
2025-08-16T21:35:20.3578780Z         try:
2025-08-16T21:35:20.3578974Z >           subprocess.check_call(
2025-08-16T21:35:20.3579199Z                 [
2025-08-16T21:35:20.3579397Z                     "docker",
2025-08-16T21:35:20.3579605Z                     "build",
2025-08-16T21:35:20.3579796Z                     "-q",
2025-08-16T21:35:20.3579984Z                     "-f",
2025-08-16T21:35:20.3580188Z                     "services/api/Dockerfile",
2025-08-16T21:35:20.3580433Z                     ".",
2025-08-16T21:35:20.3580610Z                     "-t",
2025-08-16T21:35:20.3580791Z                     IMAGE,
2025-08-16T21:35:20.3580972Z                 ],
2025-08-16T21:35:20.3581136Z                 cwd=ROOT,
2025-08-16T21:35:20.3581317Z                 env=env,
2025-08-16T21:35:20.3581495Z             )
2025-08-16T21:35:20.3581595Z 
2025-08-16T21:35:20.3581686Z tests/test_docker_build.py:20: 
2025-08-16T21:35:20.3581939Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-08-16T21:35:20.3582143Z 
2025-08-16T21:35:20.3582325Z popenargs = (['docker', 'build', '-q', '-f', 'services/api/Dockerfile', '.', ...],)
2025-08-16T21:35:20.3583678Z kwargs = {'cwd': PosixPath('/home/runner/work/AWA-App/AWA-App'), 'env': {'ACCEPT_EULA': 'Y', 'ACTIONS_RUNNER_ACTION_ARCHIVE_CAC...ctionarchivecache', 'AGENT_TOOLSDIRECTORY': '/opt/hostedtoolcache', 'ANDROID_HOME': '/usr/local/lib/android/sdk', ...}}
2025-08-16T21:35:20.3585228Z retcode = 1
2025-08-16T21:35:20.3585484Z cmd = ['docker', 'build', '-q', '-f', 'services/api/Dockerfile', '.', ...]
2025-08-16T21:35:20.3585728Z 
2025-08-16T21:35:20.3585821Z     def check_call(*popenargs, **kwargs):
2025-08-16T21:35:20.3586148Z         """Run command with arguments.  Wait for command to complete.  If
2025-08-16T21:35:20.3586495Z         the exit code was zero then return, otherwise raise
2025-08-16T21:35:20.3586866Z         CalledProcessError.  The CalledProcessError object will have the
2025-08-16T21:35:20.3587462Z         return code in the returncode attribute.
2025-08-16T21:35:20.3587706Z     
2025-08-16T21:35:20.3587940Z         The arguments are the same as for the call function.  Example:
2025-08-16T21:35:20.3588239Z     
2025-08-16T21:35:20.3588399Z         check_call(["ls", "-l"])
2025-08-16T21:35:20.3588603Z         """
2025-08-16T21:35:20.3588786Z         retcode = call(*popenargs, **kwargs)
2025-08-16T21:35:20.3589029Z         if retcode:
2025-08-16T21:35:20.3589207Z             cmd = kwargs.get("args")
2025-08-16T21:35:20.3589430Z             if cmd is None:
2025-08-16T21:35:20.3589636Z                 cmd = popenargs[0]
2025-08-16T21:35:20.3589874Z >           raise CalledProcessError(retcode, cmd)
2025-08-16T21:35:20.3590467Z E           subprocess.CalledProcessError: Command '['docker', 'build', '-q', '-f', 'services/api/Dockerfile', '.', '-t', 'awa-test:d16b6601']' returned non-zero exit status 1.
2025-08-16T21:35:20.3590952Z 
2025-08-16T21:35:20.3591204Z /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/subprocess.py:413: CalledProcessError
2025-08-16T21:35:20.3591689Z ----------------------------- Captured stderr call -----------------------------
2025-08-16T21:35:20.3592798Z ERROR: failed to build: failed to solve: process "/bin/sh -c sed -i 's|http://deb.debian.org|https://deb.debian.org|g' /etc/apt/sources.list     && apt-get update     && apt-get install -y --no-install-recommends tzdata postgresql-client curl     && rm -rf /var/lib/apt/lists/*" did not complete successfully: exit code: 2
2025-08-16T21:35:20.3594004Z Error response from daemon: No such image: awa-test:d16b6601
2025-08-16T21:35:20.3594340Z =============================== warnings summary ===============================
2025-08-16T21:35:20.3594632Z services/alert_bot/tests/test_smoke.py:5
2025-08-16T21:35:20.3595719Z   /home/runner/work/AWA-App/AWA-App/services/alert_bot/tests/test_smoke.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-08-16T21:35:20.3596783Z     import pkg_resources  # noqa: F401
2025-08-16T21:35:20.3596954Z 
2025-08-16T21:35:20.3597098Z tests/test_api_fast.py::test_health_endpoint
2025-08-16T21:35:20.3598041Z   /home/runner/work/AWA-App/AWA-App/tests/test_api_fast.py:13: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-16T21:35:20.3598969Z     return datetime.datetime.utcnow()
2025-08-16T21:35:20.3599134Z 
2025-08-16T21:35:20.3599216Z tests/test_api_fast.py: 1 warning
2025-08-16T21:35:20.3599445Z tests/test_health.py: 5 warnings
2025-08-16T21:35:20.3599669Z tests/test_smoke.py: 5 warnings
2025-08-16T21:35:20.3599906Z services/api/tests/test_health.py: 1 warning
2025-08-16T21:35:20.3600867Z   /home/runner/work/AWA-App/AWA-App/services/api/routes/health.py:24: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-16T21:35:20.3602019Z     app_now = datetime.utcnow().replace(tzinfo=timezone.utc)
2025-08-16T21:35:20.3602233Z 
2025-08-16T21:35:20.3602322Z tests/test_health.py::test_health[0]
2025-08-16T21:35:20.3602560Z tests/test_health.py::test_health[1]
2025-08-16T21:35:20.3602784Z tests/test_health.py::test_health[2]
2025-08-16T21:35:20.3603039Z tests/test_health.py::test_health[3]
2025-08-16T21:35:20.3603263Z tests/test_health.py::test_health[4]
2025-08-16T21:35:20.3604251Z   /home/runner/work/AWA-App/AWA-App/tests/test_health.py:22: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-16T21:35:20.3605172Z     return datetime.datetime.utcnow()
2025-08-16T21:35:20.3605471Z 
2025-08-16T21:35:20.3605561Z tests/test_smoke.py::test_health[0]
2025-08-16T21:35:20.3605800Z tests/test_smoke.py::test_health[1]
2025-08-16T21:35:20.3606021Z tests/test_smoke.py::test_health[2]
2025-08-16T21:35:20.3606251Z tests/test_smoke.py::test_health[3]
2025-08-16T21:35:20.3606478Z tests/test_smoke.py::test_health[4]
2025-08-16T21:35:20.3607357Z   /home/runner/work/AWA-App/AWA-App/tests/test_smoke.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-16T21:35:20.3608271Z     return datetime.datetime.utcnow()
2025-08-16T21:35:20.3608434Z 
2025-08-16T21:35:20.3608557Z services/api/tests/test_health.py::test_health_route
2025-08-16T21:35:20.3609558Z   /home/runner/work/AWA-App/AWA-App/services/api/tests/test_health.py:14: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
2025-08-16T21:35:20.3610530Z     return datetime.datetime.utcnow()
2025-08-16T21:35:20.3610690Z 
2025-08-16T21:35:20.3610863Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-08-16T21:35:20.3611224Z ================================ tests coverage ================================
2025-08-16T21:35:20.3611580Z _______________ coverage: platform linux, python 3.12.11-final-0 _______________
2025-08-16T21:35:20.3611823Z 
2025-08-16T21:35:20.3611921Z Coverage XML written to file coverage.xml
2025-08-16T21:35:20.3612230Z Required test coverage of 45% reached. Total coverage: 58.64%
2025-08-16T21:35:20.3612559Z =========================== short test summary info ============================
2025-08-16T21:35:20.3613333Z FAILED tests/test_docker_build.py::test_api_image_builds - subprocess.CalledProcessError: Command '['docker', 'build', '-q', '-f', 'services/api/Dockerfile', '.', '-t', 'awa-test:d16b6601']' returned non-zero exit status 1.
2025-08-16T21:35:20.7913484Z ##[error]Process completed with exit code 1.
