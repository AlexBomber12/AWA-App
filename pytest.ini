[pytest]
testpaths = tests services
python_files = test_*.py
asyncio_mode = auto
markers =
    unit: fast, pure unit tests (default)
    integration: needs DB or external services (skipped by default)
    live: talks to real external APIs or network (skipped by default)
    future: placeholders for not-yet-implemented behavior (often xfail)
    slow: very slow tests (skipped locally, run in CI)
    needs_wait_for_db: requires the real services.api.main._wait_for_db retry loop
    real_sleep: opt out of the global sleep shim
    real_lifespan: opt out of the global API lifespan shim
addopts = -q --cov=services/api --cov=services/worker --cov=packages/awa_common --cov-report=xml --cov-report=term-missing -m "not integration and not live"
filterwarnings =
    ignore::UserWarning:pkg_resources
    ignore:Importing pandas-specific classes.*:FutureWarning:pandera\._pandas_deprecated
    ignore:Call to deprecated close.*:DeprecationWarning:fastapi_limiter
timeout = 180
