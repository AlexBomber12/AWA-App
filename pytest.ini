[pytest]
testpaths = tests services
python_files = test_*.py
asyncio_mode = auto
markers =
    unit: fast, hermetic unit tests (no external I/O)
    integration: requires real DB/Redis
    live: talks to real external APIs or network (skipped by default)
    future: placeholders for not-yet-implemented behavior (often xfail)
    slow: very slow tests (skipped locally, run in CI)
    needs_wait_for_db: requires the real services.api.main._wait_for_db retry loop
    real_sleep: opt out of the global sleep shim
    real_lifespan: opt out of the global API lifespan shim
addopts = -q --cov=services/api --cov=services/worker --cov=packages/awa_common --cov-report=xml --cov-report=term-missing -m "not integration and not live"
filterwarnings =
    ignore:Importing pandas-specific classes.*:FutureWarning:pandera\._pandas_deprecated
    ignore:Call to deprecated close.*:DeprecationWarning:fastapi_limiter
    ignore:.*sentry_sdk.metrics module is deprecated.*:DeprecationWarning
    ignore:The 'app' shortcut is now deprecated.*:DeprecationWarning:httpx\.
timeout = 180
