# ---------------------------------------------------------------------------
# Core application
# ---------------------------------------------------------------------------
ENV=local
APP_ENV=dev
APP_NAME=awa-app
SERVICE_NAME=api
ALEMBIC_CONFIG=services/api/alembic.ini
REQUEST_TIMEOUT_S=15
WAIT_FOR_DB_MAX_ATTEMPTS=
WAIT_FOR_DB_DELAY_S=

# ---------------------------------------------------------------------------
# Database
# ---------------------------------------------------------------------------
DATABASE_URL=postgresql+psycopg://app:app@db:5432/app
PG_ASYNC_DSN=
ASYNC_DB_POOL_SIZE=10
ASYNC_DB_MAX_OVERFLOW=10
ASYNC_DB_POOL_TIMEOUT=30
DB_STATEMENT_TIMEOUT_SECONDS=30
DB_POOL_WARN_PCT=0.85
DB_POOL_WARN_INTERVAL_S=60

# ---------------------------------------------------------------------------
# Redis / Celery
# ---------------------------------------------------------------------------
REDIS_URL=redis://redis:6379/0
CACHE_REDIS_URL=
CACHE_DEFAULT_TTL_S=300
CACHE_NAMESPACE=cache:
BROKER_URL=
RESULT_BACKEND=
QUEUE_NAMES=ingest,alerts
BACKLOG_PROBE_SECONDS=15
REDIS_BACKLOG_WARN_SIZE=1000
REDIS_BACKLOG_WARN_INTERVAL_S=60
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_STORE_EAGER_RESULT=0
CELERY_RESULT_EXPIRES=86400
CELERY_TASK_ALWAYS_EAGER=0
CELERY_LOOP_LAG_MONITOR=1
CELERY_LOOP_LAG_INTERVAL_S=
SCHEDULE_NIGHTLY_MAINTENANCE=1
NIGHTLY_MAINTENANCE_CRON=30 2 * * *
SCHEDULE_MV_REFRESH=1
MV_REFRESH_CRON=30 2 * * *
SCHEDULE_LOGISTICS_ETL=0
LOGISTICS_CRON=0 3 * * *

# ---------------------------------------------------------------------------
# Security & limiter
# ---------------------------------------------------------------------------
CORS_ORIGINS=
MAX_REQUEST_BYTES=268435456
SECURITY_HSTS_ENABLED=0
SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin
SECURITY_FRAME_OPTIONS=DENY
SECURITY_X_CONTENT_TYPE_OPTIONS=nosniff
SECURITY_ENABLE_AUDIT=1
OIDC_ISSUER=https://keycloak.local/realms/awa
OIDC_AUDIENCE=awa-webapp
OIDC_JWKS_URL=
OIDC_JWKS_TTL_SECONDS=300
OIDC_JWKS_STALE_GRACE_SECONDS=120
OIDC_JWKS_TIMEOUT_CONNECT_S=2.0
OIDC_JWKS_TIMEOUT_READ_S=2.0
OIDC_JWKS_TIMEOUT_TOTAL_S=5.0
OIDC_JWKS_POOL_LIMIT=8
OIDC_JWKS_BACKGROUND_REFRESH=1
RATE_LIMIT_VIEWER=30/minute
RATE_LIMIT_OPS=120/minute
RATE_LIMIT_ADMIN=240/minute
RATE_LIMIT_WINDOW_SECONDS=60
RATE_LIMIT_SCORE_PER_USER=8
RATE_LIMIT_ROI_BY_VENDOR_PER_USER=12
LIMITER_NEAR_LIMIT_THRESHOLD=0.9
LIMITER_WARN_INTERVAL_S=60

# ---------------------------------------------------------------------------
# HTTP client defaults
# ---------------------------------------------------------------------------
HTTP_CONNECT_TIMEOUT_S=5.0
HTTP_READ_TIMEOUT_S=30.0
HTTP_TOTAL_TIMEOUT_S=60.0
HTTP_POOL_TIMEOUT_S=5.0
HTTP_MAX_CONNECTIONS=20
HTTP_MAX_KEEPALIVE_CONNECTIONS=5
HTTP_MAX_RETRIES=5
HTTP_BACKOFF_BASE_S=0.5
HTTP_BACKOFF_MAX_S=30.0
HTTP_BACKOFF_JITTER_S=1.0

# ---------------------------------------------------------------------------
# Ingestion
# ---------------------------------------------------------------------------
INGEST_CHUNK_SIZE_MB=8
INGEST_STREAMING_ENABLED=1
INGEST_STREAMING_THRESHOLD_MB=50
INGEST_STREAMING_CHUNK_SIZE_MB=8
INGEST_STREAMING_CHUNK_SIZE=50000
SPOOL_MAX_BYTES=67108864
INGEST_IDEMPOTENT=1
ANALYZE_MIN_ROWS=50000

# ---------------------------------------------------------------------------
# S3 / MinIO storage
# ---------------------------------------------------------------------------
MINIO_ENDPOINT=minio:9000
MINIO_SECURE=0
MINIO_ACCESS_KEY=minio
MINIO_SECRET_KEY=minio123
MINIO_BUCKET=awa-bucket
AWS_REGION=us-east-1
S3_CONNECT_TIMEOUT_S=5.0
S3_READ_TIMEOUT_S=30.0
S3_MAX_CONNECTIONS=50
S3_MULTIPART_THRESHOLD_MB=16
S3_USE_AIOBOTO3=1
S3_ADDRESSING_STYLE=

# ---------------------------------------------------------------------------
# LLM
# ---------------------------------------------------------------------------
LLM_PROVIDER=local
LLM_SECONDARY_PROVIDER=
LLM_BASE_URL=http://localhost:8000
LLM_PROVIDER_BASE_URL=
LLM_API_KEY=
LLM_LOCAL_MODEL=gpt-4o-mini
LLM_CLOUD_MODEL=gpt-5
LLM_CLOUD_API_KEY=
LLM_CLOUD_API_BASE=
LLM_REQUEST_TIMEOUT_SEC=60.0
LLM_REQUEST_TIMEOUT_S=60.0
LLM_MAX_RETRIES=2
LLM_BACKOFF_BASE_MS=500
LLM_BACKOFF_MAX_MS=5000
LLM_BIN_TIMEOUT_SEC=30.0
LLM_MAX_OUTPUT_BYTES=65536
LLM_LAN_HEALTH_TIMEOUT_S=1.0
LLM_EMAIL_CLOUD_THRESHOLD_CHARS=12000
LLM_PRICELIST_CLOUD_THRESHOLD_ROWS=500
LLM_ENABLE_EMAIL=0
LLM_ENABLE_PRICELIST=0
LLM_ALLOW_CLOUD_FALLBACK=1
LLM_MIN_CONFIDENCE=0.35

# ---------------------------------------------------------------------------
# Observability
# ---------------------------------------------------------------------------
LOG_LEVEL=INFO
SENTRY_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.05
SENTRY_PROFILES_SAMPLE_RATE=0.0
PROMETHEUS_MULTIPROC_DIR=
ENABLE_METRICS=1
METRICS_TEXTFILE_DIR=
METRICS_FLUSH_INTERVAL_S=15
WORKER_METRICS_HTTP=0
WORKER_METRICS_PORT=9108

# ---------------------------------------------------------------------------
# Stats & ROI
# ---------------------------------------------------------------------------
STATS_ENABLE_CACHE=1
STATS_CACHE_TTL_S=600
STATS_CACHE_NAMESPACE=stats:
STATS_USE_SQL=0
ROI_CACHE_TTL_SECONDS=300
RETURNS_STATS_VIEW_NAME=returns_raw
ROI_VIEW_NAME=v_roi_full
ROI_MATERIALIZED_VIEW_NAME=mat_v_roi_full

# ---------------------------------------------------------------------------
# Alerts / Telegram
# ---------------------------------------------------------------------------
TELEGRAM_TOKEN=
TELEGRAM_DEFAULT_CHAT_ID=
TELEGRAM_API_BASE=https://api.telegram.org
ALERTS_ENABLED=1
ALERT_RULES_SOURCE=yaml
ALERT_RULES_FILE=config/alert_rules.yaml
ALERT_RULES_PATH=services/alert_bot/config.yaml
ALERT_RULES_WATCH=0
ALERT_RULES_WATCH_INTERVAL_S=60
ALERTS_EVALUATION_INTERVAL_CRON=*/5 * * * *
ALERT_SCHEDULE_CRON=*/1 * * * *
ALERT_EVAL_CONCURRENCY=8
ALERT_SEND_CONCURRENCY=8
ALERT_TELEGRAM_MAX_RPS=25
ALERT_TELEGRAM_MAX_CHAT_RPS=1
ALERT_RULE_TIMEOUT_S=15
ALERT_DB_POOL_MIN_SIZE=1
ALERT_DB_POOL_MAX_SIZE=5
ALERT_DB_POOL_TIMEOUT=10.0
ALERT_DB_POOL_ACQUIRE_TIMEOUT=3.0
ALERT_DB_POOL_ACQUIRE_RETRIES=3
ALERT_DB_POOL_RETRY_DELAY=0.25

# ---------------------------------------------------------------------------
# Health checks
# ---------------------------------------------------------------------------
HEALTHCHECK_DB_TIMEOUT_S=2.0
HEALTHCHECK_REDIS_SOCKET_TIMEOUT_S=2.0
HEALTHCHECK_HTTP_TIMEOUT_S=2.0
HEALTHCHECK_CELERY_TIMEOUT_S=2.0
HEALTHCHECK_INSPECT_TIMEOUT_S=1.0
HEALTHCHECK_RETRY_ATTEMPTS=3
HEALTHCHECK_RETRY_DELAY_S=1.0

# ---------------------------------------------------------------------------
# External APIs / ETL
# ---------------------------------------------------------------------------
ENABLE_LIVE=0
TASK_ID=
KEEPA_KEY=
HELIUM_API_KEY=
HELIUM10_KEY=
HELIUM10_BASE_URL=https://api.helium10.com
HELIUM10_TIMEOUT_S=60.0
HELIUM10_MAX_RETRIES=5
REGION=US
SP_FEES_DATE=
SP_REFRESH_TOKEN=
SP_CLIENT_ID=
SP_CLIENT_SECRET=
SP_API_BASE_URL=
LOGISTICS_TIMEOUT_S=15
LOGISTICS_RETRIES=3
LOGISTICS_SOURCES=
FREIGHT_API_URL=https://example.com/freight.csv
